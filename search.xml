<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Nginxå­¦ä¹ ç¬”è®°-è·¨ç«™è®¿é—®]]></title>
    <url>%2F2018%2F09%2F10%2FNginx%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E8%B7%A8%E7%AB%99%E8%AE%BF%E9%97%AE%2F</url>
    <content type="text"><![CDATA[Nginxè§£å†³è·¨ç«™è®¿é—®è·¨ç«™è®¿é—®é¦–å…ˆäº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯è·¨åŸŸè·¨åŸŸï¼ŒæŒ‡çš„æ˜¯æµè§ˆå™¨ä¸èƒ½æ‰§è¡Œå…¶ä»–ç½‘ç«™çš„è„šæœ¬ã€‚å®ƒæ˜¯ç”±æµè§ˆå™¨çš„åŒæºç­–ç•¥é€ æˆçš„ï¼Œæ˜¯æµè§ˆå™¨æ–½åŠ çš„å®‰å…¨é™åˆ¶ã€‚ æ‰€è°“åŒæºæ˜¯æŒ‡ï¼ŒåŸŸåï¼Œåè®®ï¼Œç«¯å£å‡ç›¸åŒï¼Œä¸æ˜Žç™½æ²¡å…³ç³»ï¼Œä¸¾ä¸ªæ —å­ï¼š 12345http://www.123.com/index.html è°ƒç”¨ http://www.123.com/server.php ï¼ˆéžè·¨åŸŸï¼‰http://www.123.com/index.html è°ƒç”¨ http://www.456.com/server.php ï¼ˆä¸»åŸŸåä¸åŒ:123/456ï¼Œè·¨åŸŸï¼‰http://abc.123.com/index.html è°ƒç”¨ http://def.123.com/server.php ï¼ˆå­åŸŸåä¸åŒ:abc/defï¼Œè·¨åŸŸï¼‰http://www.123.com:8080/index.html è°ƒç”¨ http://www.123.com:8081/server.php ï¼ˆç«¯å£ä¸åŒ:8080/8081ï¼Œè·¨åŸŸï¼‰http://www.123.com/index.html è°ƒç”¨ https://www.123.com/server.php ï¼ˆåè®®ä¸åŒ:http/httpsï¼Œè·¨åŸŸï¼‰ è¯·æ³¨æ„ï¼šlocalhostå’Œ127.0.0.1è™½ç„¶éƒ½æŒ‡å‘æœ¬æœºï¼Œä½†ä¹Ÿå±žäºŽè·¨åŸŸã€‚ æµè§ˆå™¨æ‰§è¡Œjavascriptè„šæœ¬æ—¶ï¼Œä¼šæ£€æŸ¥è¿™ä¸ªè„šæœ¬å±žäºŽå“ªä¸ªé¡µé¢ï¼Œå¦‚æžœä¸æ˜¯åŒæºé¡µé¢ï¼Œå°±ä¸ä¼šè¢«æ‰§è¡Œã€‚ æµè§ˆå™¨ä¸ºäº†å®‰å…¨ï¼Œé™åˆ¶äº†è·¨åŸŸçš„è®¿é—®ï¼Œå®žé™…ä¸Šå¦‚æžœæœåŠ¡ç«¯åœ¨è¿”å›žçš„å¤´ä¿¡æ¯ä¸­æ·»åŠ äº† Access-Control-Allow-Originå‚æ•°çš„è¯ï¼Œè¡¨æ˜ŽæœåŠ¡ ç«¯å…è®¸è·¨ç«™è®¿é—®ï¼Œé‚£ä¹ˆæµè§ˆå™¨åˆ™ä¸ä¼šåœ¨é˜»æ­¢è·¨åŸŸè®¿é—®äº†ï¼Œå› æ­¤å¯ä»¥å·§å¦™åœ°åˆ©ç”¨nginxæ–¹å‘ä»£ç†æ¥å®žçŽ°è·¨åŸŸè®¿é—®ã€‚ æ¡ˆä¾‹ä¾‹å¦‚ï¼šåœ¨å¼€å‘å‰åŽç«¯å®Œå…¨åˆ†ç¦»çš„ç³»ç»Ÿä¸­ï¼ŒæœåŠ¡ç«¯ä»£ç å±žäºŽä¸€ä¸ªå·¥ç¨‹ï¼Œå‰ç«¯ä»£ç å±žäºŽå¦ä¸€ä¸ªå·¥ç¨‹ï¼Œå‰ç«¯å¼€å‘äººå‘˜åœ¨è¿›è¡ŒæŽ¥å£å¯¹æŽ¥æ—¶ï¼Œå¯èƒ½ä¼šåœ¨webstormç­‰å·¥å…·è¿›è¡Œç¼–ç ï¼Œå¹¶ç”¨webstormçš„å†…ç½®æœåŠ¡å™¨è¿›è¡Œè°ƒè¯•ï¼Œè¿™å°±ä¼šæœ‰è·¨åŸŸé—®é¢˜ï¼Œå› ä¸ºï¼Œwebstormå†…ç½®æœåŠ¡å™¨é»˜è®¤å‰ç¼€éƒ¨åˆ†æ˜¯http://localhost:63342/ï¼Œè€ŒæœåŠ¡ç«¯æŽ¥å£çš„è·¯å¾„å‰ç¼€éƒ¨åˆ†ä¸€å®šä¸ä¼šæ˜¯è¿™æ ·ï¼Œè¿™æ ·ä¾¿äº§ç”Ÿäº†è·¨åŸŸè®¿é—®çš„é—®é¢˜ã€‚ æ¡ˆä¾‹ä»£ç ä¾‹å¦‚å¦‚ä¸‹è¿™ä¸€æ®µä»£ç ï¼Œåœ¨webstormä¸­è°ƒè¯•è¿™ä¸ªajaxæ‰€åœ¨çš„é¡µé¢ï¼Œé¡µé¢è·¯å¾„æ˜¯http://localhost:63342/untitled/across-domain.htmlï¼Œè€Œè¦è®¿é—®çš„æŽ¥å£è·¯å¾„æ˜¯http://localhost:8888/ssm/interfaces/test/m006 123456789101112131415161718192021222324$(function()&#123; $.ajax(&#123; url: "http://localhost:8888/ssm/interfaces/test/m006", type: "POST", async: false, dataType: "json", contentType: "application/json", cache: false, data: JSON.stringify(&#123; "id": "bgdsdgs", "name": "name", "email": "429661318@qq.com", "voModel2": [&#123; "id": "429661318@qq.com", "v3": &#123;"id":"sdfghjkl"&#125; &#125;] &#125;), success: function(data) &#123; $("#text").html(JSON.stringify(data)); &#125;, error: function(text) &#123; $("text").html(JSON.stringify(text)) &#125; &#125;) é€šè¿‡jsè¯·æ±‚éžæœ¬ç«™ç½‘å€çš„åœ°å€ä¼šæç¤ºè·¨åŸŸé—®é¢˜ï¼Œå¦‚ä¸‹å†…å®¹ï¼š Failed to load &lt;è·¨ç«™åœ°å€&gt;: No â€˜Access-Control-Allow-Originâ€™ header is present on the requested resource. Origin â€˜&lt;è¯·æ±‚åœ°å€&gt;â€™ is therefore not allowed accessã€‚ è§£å†³æ–¹æ¡ˆä¸€åå‘ä»£ç†ã€‚ 123456789location / &#123; root C:\Users\shengmengqi\WebstormProjects\angularJsFrame; index across-domain.html;&#125;# ä½œç”¨ï¼šè®¿é—®çš„http://localhost/ssm/interfaces/ç›¸å½“äºŽä¸€ä¸ªä»£ç†urlï¼Œå®žé™…è®¿é—®çš„# æ˜¯http://localhost:8888/ssm/interfaces/location /ssm/interfaces/&#123; proxy_pass http://localhost:8888/ssm/interfaces/;&#125; è§£å†³æ–¹æ¡ˆäºŒæ·»åŠ Access-Control-Allow-Originå¤´ä¿¡æ¯ã€‚ ä¸åšä»»ä½•é™åˆ¶çš„è·¨åŸŸè¯·æ±‚é…ç½®ï¼ˆä¸å»ºè®®ï¼‰ 123456789101112131415server &#123; ... ... add_header Access-Control-Allow-Origin *; location / &#123; if ($request_method = 'OPTIONS') &#123; add_header Access-Control-Allow-Origin *; add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS; return 204; &#125; ... ... &#125;&#125; ä¸Šè¿°é…ç½®åšæ³•ï¼Œè™½ç„¶åšåˆ°äº†åŽ»é™¤è·¨åŸŸè¯·æ±‚æŽ§åˆ¶ï¼Œä½†æ˜¯ç”±äºŽå¯¹ä»»ä½•è¯·æ±‚æ¥æºéƒ½ä¸åšæŽ§åˆ¶ï¼Œçœ‹èµ·æ¥å¹¶ä¸å®‰å…¨ï¼Œæ‰€ä»¥ä¸å»ºè®®ä½¿ç”¨ã€‚ æŒ‡å®šä¸€ä¸ªåŸŸåç™½åå•è·¨åŸŸè¯·æ±‚é…ç½®ï¼ˆå…·æœ‰å±€é™æ€§ï¼‰ 123456789101112131415server &#123; ... ... add_header Access-Control-Allow-Origin http://127.0.0.1; location / &#123; if ($request_method = 'OPTIONS') &#123; add_header Access-Control-Allow-Origin http://127.0.0.1; add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS; return 204; &#125; ... ... &#125;&#125; ä¸Šè¿°é…ç½®åšæ³•ï¼Œä»…å±€é™äºŽ http://127.0.0.1 åŸŸåè¿›è¡Œè·¨åŸŸè®¿é—®ï¼Œå‡è®¾æˆ‘ä½¿ç”¨ http://localhost è¯·æ±‚ï¼Œå°½ç®¡éƒ½æ˜¯åŒä¸€å°æœºå™¨ï¼ŒåŒä¸€ä¸ªæµè§ˆå™¨ï¼Œå®ƒä¾æ—§ä¼šæç¤º No â€˜Access-Control-Allow-Originâ€™ header is present on the requested resource ã€‚ å¦‚æžœæ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œä½¿ç”¨æ­¤ç§æ–¹å¼å·²ç»è¶³å¤Ÿã€‚ ç™½åå•åªèƒ½é…ç½®ä¸€ä¸ªï¼Œä¸èƒ½é…ç½®å¤šä¸ªã€‚ é€šè¿‡è®¾ç½®å˜é‡å€¼è§£å†³æŒ‡å®šå¤šä¸ªåŸŸåç™½åå•è·¨åŸŸè¯·æ±‚é…ç½®ï¼ˆå»ºè®®ä½¿ç”¨ï¼‰ 12345678910111213141516171819202122server &#123; ... ... set $cors_origin ""; if ($http_origin ~* "^http://127.0.0.1$") &#123; set $cors_origin $http_origin; &#125; if ($http_origin ~* "^http://localhost$") &#123; set $cors_origin $http_origin; &#125; add_header Access-Control-Allow-Origin $cors_origin; location / &#123; if ($request_method = 'OPTIONS') &#123; add_header Access-Control-Allow-Origin $cors_origin; add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS; return 204; &#125; ... ... &#125;&#125; è®¾ç½®ä¸€ä¸ªå˜é‡ $cors_origin æ¥å­˜å‚¨éœ€è¦è·¨åŸŸçš„ç™½åå•ï¼Œé€šè¿‡æ­£åˆ™åˆ¤æ–­ï¼Œè‹¥æ˜¯ç™½åå•åˆ—è¡¨ï¼Œåˆ™è®¾ç½® $cors_origin å€¼ä¸ºå¯¹åº”çš„åŸŸåï¼Œåˆ™åšåˆ°äº†å¤šåŸŸåè·¨åŸŸç™½åå•åŠŸèƒ½ã€‚ è§£å†³æ–¹æ¡ˆä¸‰ä»Žå®¢æˆ·ç«¯çš„è§’åº¦æ¥è¯´ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯ç”¨ jsonp è§£å†³ï¼Œè¿™é‡Œå°±ä¸å¤šåšåˆ†æžäº†ï¼Œæœ‰éœ€è¦çš„æœ‹å‹å¯ä»¥è‡ªè¡ŒæŸ¥è¯¢èµ„æ–™ï¼Œæœ¬æ–‡é‡ç‚¹è®²ç©¶çš„ä»ŽæœåŠ¡ç«¯è§’åº¦è§£å†³è·¨åŸŸé—®é¢˜ã€‚ å‚è€ƒèµ„æ–™ðŸŒ[nginx æŒ‡å®šå¤šä¸ªåŸŸåè·¨åŸŸè¯·æ±‚é…ç½®] ðŸŒ[ Nginxä½œä¸ºé™æ€èµ„æºwebæœåŠ¡ä¹‹è·¨åŸŸè®¿é—®] ðŸŒ[jQuery jsonpè·¨åŸŸè¯·æ±‚]]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Nginxå­¦ä¹ ç¬”è®°-ç¼“å­˜]]></title>
    <url>%2F2018%2F09%2F10%2FNginx%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E7%BC%93%E5%AD%98%2F</url>
    <content type="text"><![CDATA[Nginxç¼“å­˜æµè§ˆå™¨ç¼“å­˜æœºåˆ¶webç¼“å­˜åˆ†ä¸ºå¾ˆå¤šç§ï¼Œæ¯”å¦‚æ•°æ®åº“ç¼“å­˜ã€ä»£ç†æœåŠ¡å™¨ç¼“å­˜ã€CDNç¼“å­˜ï¼Œä»¥åŠæµè§ˆå™¨ç¼“å­˜ã€‚æµè§ˆå™¨é€šè¿‡ä»£ç†æœåŠ¡å™¨å‘æºæœåŠ¡å™¨å‘èµ·è¯·æ±‚çš„åŽŸç†å¦‚å›¾ã€‚ æµè§ˆå™¨å…ˆå‘ä»£ç†æœåŠ¡å™¨å‘èµ·Webè¯·æ±‚ï¼Œå†å°†è¯·æ±‚å‘åˆ°æºæœåŠ¡å™¨ã€‚å®ƒå±žäºŽå…±äº«ç¼“å­˜ï¼Œæ‰€ä»¥å¾ˆå¤šåœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨å…¶ç¼“å­˜èµ„æºï¼Œæ‰€ä»¥èŠ‚çœäº†å¾ˆå¤šæµé‡ã€‚ æµè§ˆå™¨ç¼“å­˜æµè§ˆå™¨ç¼“å­˜æ˜¯å°†æ–‡ä»¶ä¿å­˜åœ¨å®¢æˆ·ç«¯ã€‚åœ¨åŒä¸€ä¸ªå›žè¯è¿‡ç¨‹ä¸­æ£€æŸ¥ç¼“å­˜çš„å‰¯æœ¬æ˜¯å¦è¶³å¤Ÿæ–°ï¼Œåœ¨åŽé€€ç½‘é¡µæ—¶ï¼Œè®¿é—®è¿‡çš„èµ„æºå¯ä»¥ä»Žæµè§ˆå™¨ç¼“å­˜ä¸­æ‹¿å‡ºæ¥ä½¿ç”¨ã€‚ æµè§ˆå™¨ä¸€èˆ¬éƒ½æ˜¯é€šè¿‡httpç¼“å­˜çš„ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼ï¼Œå¦‚åœ¨htmlé¡µé¢ä¸­çš„metaæ ‡ç­¾å¢žåŠ å±žæ€§ï¼Œä½†ä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒçš„ï¼Œå› ä¸ºæœ‰äº›æµè§ˆå™¨ä¸èƒ½ç†è§£HTMLå†…å®¹æœ¬èº«ã€‚ 1&lt;meta HTTP-EQUIV="Pragma" CONTENT="no-cache" /&gt; headeræŽ§åˆ¶çš„ç¼“å­˜å¤§å¤šæ•°çš„æµè§ˆå™¨ç¼“å­˜éƒ½æ˜¯æœ‰httpçš„headeræ‰€å†³å®šçš„ã€‚ æ ¡éªŒæœºåˆ¶ï¼š æ ¡éªŒå¤´ è¯´æ˜Ž Expiresã€Cache-control æ ¡éªŒæ˜¯å¦è¿‡æœŸã€‚ ETag æ ¡éªŒèµ„æºçš„å”¯ä¸€æ ‡è¯†ã€‚ Last-Modified æ ¡éªŒèµ„æºçš„æœ€åŽä¿®æ”¹æ—¶é—´ã€‚ ExpiresWebæœåŠ¡å™¨å“åº”æ¶ˆæ¯å¤´å­—æ®µï¼Œåœ¨å“åº”httpè¯·æ±‚æ—¶å‘Šè¯‰æµè§ˆå™¨åœ¨è¿‡æœŸæ—¶é—´å†…æµè§ˆå™¨å¯ä»¥ç›´æŽ¥ä»Žæµè§ˆå™¨ç¼“å­˜è¯»å–æ•°æ®ï¼Œæ— éœ€å†æ¬¡è¯·æ±‚ã€‚ä½†æ˜¯Expiresæ˜¯HTTP1.0çš„ä¸œè¥¿ï¼Œåœ¨HTTP1.1ä¸­ï¼Œä»–çš„ä½œç”¨åŸºæœ¬ä¸Šå¯ä»¥å¿½ç•¥ã€‚ 1Expires: Sun, 09 Sep 2018 14:38:15 GMT Cache-controlä¸ŽExpiresçš„ä½œç”¨æ˜¯ä¸€è‡´çš„ï¼Œéƒ½æ˜¯æŒ‡å½“å‰èµ„æºçš„æœ‰æ•ˆæœŸï¼ŒæŽ§åˆ¶æµè§ˆå™¨æ˜¯ç›´æŽ¥ä»Žæµè§ˆå™¨ç¼“å­˜ä¸­å­˜å–æ•°æ®ï¼Œè¿˜æ˜¯é‡æ–°å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨å–æ•°æ®ã€‚å®ƒçš„ä¼˜å…ˆçº§é«˜äºŽExpires,è€Œä¸”å®ƒçš„é€‰æ‹©æ›´å¤šï¼Œè®¾ç½®ä¹Ÿæ›´ç»†è‡´ã€‚ Cache-Control ä¸ºå•å‘æŒ‡ä»¤ï¼Œå³è¯·æ±‚ä¸­å­˜åœ¨çš„æŒ‡ä»¤ï¼Œå¹¶ä¸æ„å‘³ç€å“åº”ä¸­å­˜åœ¨åŒæ ·çš„æŒ‡ä»¤ã€‚ Request Headersä¸­Cache-ControlæŒ‡ä»¤ï¼š æŒ‡ä»¤ è¯´æ˜Ž max-stale=\&lt;s> ç¼“å­˜å¯éšæ„æä¾›è¿‡æœŸæ–‡ä»¶ï¼Œå¦‚æžœæŒ‡å®šäº†å‚æ•° åœ¨è¿™æ®µæ—¶é—´å†…ï¼Œæ–‡æ¡£ä¸èƒ½è¿‡æœŸã€‚ max-age=\&lt;s> ç¼“å­˜æ— æ³•è¿”å›žç¼“å­˜æ—¶é—´å¤§äºŽç§’çš„æ–‡ä»¶ï¼Œè¿™æ¡æŒ‡ä»¤ä½¿å¾—ç¼“å­˜æ›´åŠ ä¸¥æ ¼ã€‚ no-cache éœ€è¦å›žæºéªŒè¯æ‰èƒ½å†³å®šæ˜¯å¦ç¼“å­˜ã€‚ no-store ç¦æ­¢ç¼“å­˜ã€‚ only-if-cached å½“ç¼“å­˜ä¸­æœ‰å‰¯æœ¬æ–‡ä»¶å­˜åœ¨æ—¶ï¼Œå®¢æˆ·ç«¯æ‰ä¼šèŽ·å–å‰¯æœ¬ã€‚ Response Headersä¸­Cache-ControlæŒ‡ä»¤ï¼š æŒ‡ä»¤ è¯´æ˜Ž public å¯å…±äº«ç¼“å­˜ï¼ˆå®¢æˆ·ç«¯å’Œä»£ç†æœåŠ¡å™¨éƒ½å¯ä»¥ç¼“å­˜ï¼‰ï¼Œå“åº”å¯ä»¥è¢«ç¼“å­˜ã€‚ private å¯ç§æœ‰ç¼“å­˜ï¼ˆå®¢æˆ·ç«¯èƒ½ç¼“å­˜ï¼Œä»£ç†æœåŠ¡å™¨ä¸èƒ½ç¼“å­˜ï¼‰ã€‚æ¯”å¦‚ç”¨æˆ·ç§æœ‰å†…å®¹ï¼Œä¸èƒ½å…±äº«ã€‚ no-cache å…è®¸ç¼“å­˜è€…ç¼“å­˜å“åº”ã€‚ no-store ç¦æ­¢ç¼“å­˜ã€‚ must-revalidation/proxy-revalidation å¦‚æžœç¼“å­˜å†…å®¹å¤±æ•ˆï¼Œè¯·æ±‚å¿…é¡»å‘é€æœåŠ¡å™¨/ä»£ç†è¿›è¡ŒéªŒè¯ã€‚ max-age=\&lt;s> ç¼“å­˜å†…å®¹åœ¨sç§’åŽå¤±æ•ˆã€‚ Last-ModifiedLast-Modified/If-Modified-Sinceè¦é…åˆCache-Controlä½¿ç”¨ã€‚ Last-Modified: è¡¨ç¤ºè¿™ä¸ªèµ„æºçš„æœ€åŽä¿®æ”¹æ—¶é—´ã€‚WebæœåŠ¡å™¨åœ¨å“åº”è¯·æ±‚æ—¶ï¼Œå‘Šè¯‰æµè§ˆå™¨èµ„æºçš„æœ€åŽä¿®æ”¹æ—¶é—´ã€‚å½“æµè§ˆå™¨å†æ¬¡è¿›è¡Œè¯·æ±‚æ—¶ï¼Œä¼šå‘æœåŠ¡å™¨ä¼ é€If-Modified-SinceåŒ…å¤´ï¼Œè¯¢é—®Last-Modifiedæ—¶é—´ç‚¹ä¹‹åŽèµ„æºæ˜¯å¦è¢«ä¿®æ”¹ã€‚ If-Modified-Since: å½“èµ„æºè¿‡æœŸæ—¶ï¼ˆç”¨Cache-Controlæ ‡è¯†çš„max-ageï¼‰,å‘çŽ°èµ„æºå…·æœ‰Last-Modifiedå£°æ˜Žï¼Œåˆ™å†æ¬¡å‘WebæœåŠ¡å™¨è¯·æ±‚å¤´å¸¦ä¸ŠIf-Modified-Since,è¡¨ç¤ºè¯·æ±‚æ—¶é—´ã€‚WebæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åŽå‘çŽ°æœ‰å¤´ä¿¡æ¯If-Modified-Sinceï¼Œåˆ™ä¸Žè¢«è¯·æ±‚èµ„æºçš„æœ€åŽä¿®æ”¹æ—¶é—´è¿›è¡Œæ¯”è¾ƒã€‚è‹¥æœ€åŽä¿®æ”¹æ—¶é—´æ¯”è¾ƒæ–°ï¼Œè¯´æ˜Žèµ„æºä¿®æ”¹è¿‡ï¼Œåˆ™è¿”å›žç›¸åº”æ•´ç‰‡èµ„æºå†…å®¹ï¼ˆå¸è½½å“åº”æ¶ˆæ¯åŒ…ä½“å†…ï¼‰ï¼ŒHTTP Codeä¸º200; è‹¥æœ€åŽä¿®æ”¹æ—¶é—´æ¯”è¾ƒæ—§ï¼Œè¯´æ˜Žèµ„æºæ²¡æœ‰æ›´æ–°ï¼Œåˆ™ç›¸åº”çš„HTTP Codeä¸º304ï¼Œå‘Šè¯‰æµè§ˆå™¨ä½¿ç”¨æ‰€ä¿å­˜çš„ç¼“å­˜ã€‚ ETagETag/If-None-Match: ä¹Ÿè¦é…åˆCache-Controlä½¿ç”¨ã€‚ ETagï¼šwebæœåŠ¡å™¨ç›¸åº”è¯·æ±‚æ—¶ï¼Œå‘Šè¯‰æµè§ˆå™¨å½“å‰èµ„æºåœ¨æœåŠ¡å™¨çš„å”¯ä¸€æ ‡è¯†ï¼ˆç”Ÿæˆè§„åˆ™ç”±æœåŠ¡å™¨äº§ç”Ÿï¼‰ã€‚Apacheä¸­ï¼ŒETagçš„å€¼ï¼Œé»˜è®¤æ˜¯å¯¹æ–‡ä»¶çš„ç´¢å¼•èŠ‚ï¼ˆINodeï¼‰ï¼Œå¤§å°ï¼ˆSizeï¼‰å’Œæœ€åŽä¿®æ”¹æ—¶é—´ï¼ˆMTimeï¼‰è¿›è¡ŒHashåŽå¾—åˆ°çš„ã€‚ If-None-Match:å½“èµ„æºè¿‡æœŸæ—¶ï¼ˆä½¿ç”¨Cache-Controlæ ‡è¯†çš„max-ageï¼‰ï¼Œå‘çŽ°èµ„æºå…·æœ‰ETagå£°æ˜Žï¼Œåˆ™å†æ¬¡å‘WebæœåŠ¡å™¨è¯·æ±‚æ—¶å¸¦ä¸Šå¤´ä¿¡æ¯If-None-Matchï¼ˆETagçš„å€¼ï¼‰ã€‚WebæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åŽï¼Œå¤´ä¿¡æ¯If-None-Cacheä¸Žè¢«è¯·æ±‚çš„èµ„æºè¿›è¡Œæ ¡éªŒä¸²æ¯”è¾ƒï¼Œç„¶åŽè¿”å›ž200æˆ–è€…304ã€‚ ä½ å¯èƒ½è§‰å¾—Last-Modifiedå·²ç»è¶³å¤Ÿè®©æµè§ˆå™¨çŸ¥é“æœ¬åœ°ç¼“å­˜æ˜¯å¦æ˜¯æœ€æ–°çš„ï¼Œä¸ºä»€ä¹ˆè¿˜æ˜¯è¦å¢žåŠ ETagå‘¢ï¼Ÿ HTTP1.1ä¸­çš„ETagçš„å‡ºçŽ°ä¸»è¦ä¸ºäº†è§£å†³å‡ ä¸ªLast-Modifiedä¸­æ¯”è¾ƒéš¾è§£å†³çš„é—®é¢˜ï¼š Last-Modifedæ ‡æ³¨çš„æœ€åŽä¿®æ”¹åªèƒ½ç²¾ç¡®åˆ°ç§’ï¼Œå¦‚æžœæŸäº›æ–‡ä»¶åœ¨1ç§’ä»¥å†…ï¼Œè¢«ä¿®æ”¹å¤šæ¬¡çš„è¯ï¼Œå®ƒå°†ä¸èƒ½å‡†ç¡®æ ‡æ³¨æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ æŸäº›æ–‡ä»¶ä¼šè¢«å®šæœŸç”Ÿæˆï¼Œå½“æ—¶å†…å®¹å¹¶æ²¡æœ‰å‘ç”Ÿä»»ä½•å˜åŒ–ï¼Œä½†Modifiedå´å˜äº†ï¼Œå¯¼è‡´æ–‡ä»¶æ²¡æ³•ä½¿ç”¨ç¼“å­˜ã€‚ æœ‰å¯èƒ½å­˜åœ¨æœåŠ¡å™¨æ²¡æœ‰å‡†ç¡®èŽ·å–æ–‡ä»¶ä¿®æ”¹æ—¶é—´ï¼Œæˆ–è€…ä¸Žä»£ç†æœåŠ¡å™¨çš„æ—¶é—´ä¸ä¸€è‡´ç­‰æƒ…å½¢ã€‚ ETagæ˜¯æœåŠ¡å™¨è‡ªåŠ¨ç”Ÿæˆï¼Œæˆ–è€…ç”±å¼€å‘è€…å¯¹ç”Ÿæˆçš„å¯¹åº”èµ„æºåœ¨æœåŠ¡å™¨ç«¯çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œèƒ½å¤Ÿæ›´åŠ å‡†ç¡®çš„æŽ§åˆ¶ç¼“å­˜ã€‚Last-Modifiedä¸ŽETagå¯ä»¥ä¸€èµ·ä½¿ç”¨ï¼ŒæœåŠ¡å™¨ä¼šä¼˜å…ˆéªŒè¯ETagï¼Œä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šç»§ç»­å¯¹Last-Modifedï¼Œæœ€åŽæ‰å†³å®šæ˜¯å¦è¿”å›ž304ã€‚ ç”¨æˆ·è¡Œä¸º ç”¨æˆ·æ“ä½œ Expires/Cache-Control Last_Modified/Etag åœ°å€æ å›žè½¦ æœ‰æ•ˆ æœ‰æ•ˆ é¡µé¢é“¾æŽ¥è·³è½¬ æœ‰æ•ˆ æœ‰æ•ˆ æ–°å¼€çª—å£ æœ‰æ•ˆ æœ‰æ•ˆ å‰è¿›åŽé€€ æœ‰æ•ˆ æœ‰æ•ˆ F5åˆ·æ–° æ— æ•ˆ æœ‰æ•ˆ Ctrl+f5åˆ·æ–° æ— æ•ˆ æ— æ•ˆ å…³äºŽEtagæŒ‡ä»¤çš„è¡Œä¸ºï¼š æŒ‡ä»¤ é¡µé¢é“¾æŽ¥è·³è½¬ åœ°å€æ å›žè½¦ F5åˆ·æ–° ç‚¹å‡»è¿”å›žæŒ‰é’® public ç¼“å­˜é¡µé¢ ç¼“å­˜é¡µé¢ é‡æ–°è¯·æ±‚é¡µé¢ ç¼“å­˜é¡µé¢ private é‡æ–°è¯·æ±‚ ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼ŒéšåŽç¼“å­˜ é‡æ–°è¯·æ±‚é¡µé¢ ç¼“å­˜é¡µé¢ no-cache/no-store é‡æ–°è¯·æ±‚ é‡æ–°è¯·æ±‚ é‡æ–°è¯·æ±‚é¡µé¢ ç¼“å­˜é¡µé¢ must-revalidation/proxy-revalidation æµè§ˆå™¨é‡æ–°è¯·æ±‚ ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼ŒéšåŽç¼“å­˜ é‡æ–°è¯·æ±‚é¡µé¢ ç¼“å­˜é¡µé¢ max-age=60s åœ¨60ç§’åŽé‡æ–°è¯·æ±‚ åœ¨60ç§’åŽé‡æ–°è¯·æ±‚ é‡æ–°è¯·æ±‚é¡µé¢ åœ¨60ç§’åŽé‡æ–°è¯·æ±‚ ç¼“å­˜æµç¨‹ Nginxè®¾ç½®ç¼“å­˜Nginxæä¾›äº†expiresã€etagã€if-modified-sinceæŒ‡ä»¤æ¥å®žçŽ°æµè§ˆå™¨ç¼“å­˜æŽ§åˆ¶ã€‚ expireså¦‚æžœæˆ‘ä»¬ä½¿ç”¨Nginxä½œä¸ºé™æ€èµ„æºæœåŠ¡å™¨ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨expiresè¿›è¡Œç¼“å­˜æŽ§åˆ¶ã€‚ 1234location / &#123; autoindex on; expires 3600s;&#125; è¿™æ—¶ä¼šå¾—åˆ°ç±»ä¼¼ä»¥ä¸‹çš„å“åº”å¤´ã€‚ å¯¹äºŽé™æ€èµ„æºä¼šè‡ªåŠ¨æ·»åŠ ETagã€‚ å¦‚æžœæ˜¯é™æ€èµ„æºï¼Œé‚£ä¹ˆLast-Modifiedå€¼ä¸ºæ–‡ä»¶çš„æœ€åŽä¿®æ”¹æ—¶é—´ã€‚ Expiresæ˜¯æ ¹æ®å½“å‰æœåŠ¡å™¨ç³»ç»Ÿæ—¶é—´ç®—å‡ºæ¥çš„ã€‚ etagå¯¹äºŽé™æ€èµ„æºä¼šè‡ªåŠ¨æ·»åŠ ETagï¼Œå¯ä»¥é€šè¿‡é…ç½®etag offæŒ‡ä»¤ç¦æ­¢ç”ŸæˆETagã€‚ 1234location / &#123; autoindex on; etag off;&#125; if_modified_sinceæ­¤æŒ‡ä»¤ç”¨äºŽæŒ‡å®šNginxå¦‚ä½•å¯¹æœåŠ¡å™¨ç«¯çš„Last-Moditiedæ—¶é—´å’Œæµè§ˆå™¨ç«¯çš„if-modified-sinceæ—¶é—´è¿›è¡Œæ¯”è¾ƒã€‚ é»˜è®¤çš„â€œif_modified_since exactâ€è¡¨ç¤ºç²¾å‡†åŒ¹é…ã€‚ ä¹Ÿå¯ä»¥ä½¿ç”¨â€if_modified_since _beforeâ€œè¡¨ç¤ºåªè¦æ–‡ä»¶çš„æœ€åŽä¿®æ”¹æ—¶é—´æ—©äºŽæˆ–ç­‰äºŽæµè§ˆå™¨çš„if-modified-sinceæ—¶é—´ï¼Œå°±è¿”å›ž304ã€‚ Nginxä»£ç†å±‚ç¼“å­˜ä½¿ç”¨Nginxä½œä¸ºåå‘ä»£ç†æ—¶ï¼Œè¯·æ±‚ä¼šå…ˆè¿›å…¥Nginxï¼Œç„¶åŽNginxå°†è¯·æ±‚è½¬å‘ç»™åŽç«¯åº”ç”¨ã€‚ é…ç½®å¦‚ä¸‹ï¼š 1234567891011# é…ç½®upstreamupstream backend_tomcat &#123; server emmin-1:8080 max_fails=10 fail_timeout=5s weight=1; server emmin-2:8080 max_fails=10 fail_timeout=5s weight=5;&#125;# é…ç½®locationlocation = /cache &#123; proxy_pass http://backend_tomcat/ expires 5sï¼›&#125; ç„¶åŽå†è¯·æ±‚ç›¸å…³URLæ—¶ï¼Œè¿‡æœŸæ—¶é—´ç›¸å…³å“åº”å¤´è¢«ExpiresæŒ‡ä»¤æ›´æ”¹äº†ï¼Œä½†æ˜¯last-modifiedæ˜¯æ²¡æœ‰å˜çš„ã€‚ å³ä½¿æˆ‘ä»¬æ›´æ”¹äº†ç¼“å­˜è¿‡æœŸå¤´ï¼Œä½†Nginxè‡ªå·±æ²¡æœ‰å¯¹è¿™äº›å†…å®¹åšä»£ç†å±‚ç¼“å­˜ï¼Œæ¯æ¬¡è¯·æ±‚è¿˜æ˜¯è¦åˆ°åŽç«¯éªŒè¯çš„ã€‚ å‡è®¾åœ¨è¿‡æœŸæ—¶é—´å†…ï¼Œè¿™äº›éªŒè¯åœ¨Nginxè¿™ä¸€å±‚è¿›è¡Œå°±å¯ä»¥äº†ï¼Œä¸éœ€è¦åˆ°åŽç«¯éªŒè¯ï¼Œè¿™æ ·å¯ä»¥å‡å°‘åŽç«¯å¾ˆå¤§çš„åŽ‹åŠ›ã€‚ å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š æµè§ˆå™¨å‘èµ·è¯·æ±‚ï¼Œé¦–å…ˆåˆ°Nginxï¼ŒNginxæ ¹æ®URLåœ¨Nginxæœ¬åœ°æŸ¥æ‰¾æ˜¯å¦æœ‰ä»£ç†å±‚æœ¬åœ°ç¼“å­˜ã€‚ Nginxæ²¡æœ‰æ‰¾åˆ°æœ¬åœ°ç¼“å­˜ï¼Œåˆ™è®¿é—®åŽç«¯èŽ·å–æœ€æ–°çš„æ–‡æ¡£ï¼Œå¹¶æ”¾å…¥Nginxæœ¬åœ°ç¼“å­˜ï¼Œè¿”å›ž200çŠ¶æ€ç å’Œæœ€æ–°çš„æ–‡æ¡£ç»™æµè§ˆå™¨ã€‚ Nginxæ‰¾åˆ°æœ¬åœ°ç¼“å­˜ï¼Œé¦–å…ˆéªŒè¯æ–‡æ¡£æ˜¯å¦è¿‡æœŸï¼ˆCache-Control:mas-age=\&lt;s>ï¼‰ã€‚å¦‚æžœè¿‡æœŸï¼Œåˆ™è®¿é—®åŽç«¯èŽ·å–æœ€æ–°çš„æ–‡æ¡£ï¼Œå¹¶æ”¾å…¥Nginxæœ¬åœ°ç¼“å­˜ï¼Œè¿”å›ž200çŠ¶æ€ç å’Œæœ€æ–°çš„æ–‡æ¡£ç»™æµè§ˆå™¨ï¼›å¦‚æžœæ–‡æ¡£æ²¡æœ‰è¿‡æœŸï¼Œå³if-modified-sinceä¸Žç¼“å­˜æ–‡æ¡£çš„last-moditiedåŒ¹é…ï¼Œåˆ™è¿”å›ž305çŠ¶æ€ç ç»™æµè§ˆå™¨ã€‚ å†…å®¹ä¸éœ€è¦è®¿é—®åŽç«¯ï¼Œå³ä¸éœ€è¦åŽç«¯åŠ¨æ€è®¡ç®—/æ¸²æŸ“ç­‰ï¼Œç›´æŽ¥Nginxä»£ç†å±‚å°±æŠŠå†…å®¹è¿”å›žï¼Œé€Ÿåº¦æ›´å¿«ã€‚åƒApache Traffic Serverã€Squidã€Varnishã€Nginxç­‰æŠ€æœ¯éƒ½å¯ä»¥ç”¨æ¥è¿›è¡Œå†…å®¹ç¼“å­˜ã€‚ è¿˜æœ‰CDNæŠ€æœ¯å°±æ˜¯ç”¨æ¥åŠ é€Ÿç”¨æˆ·è®¿é—®çš„ã€‚ ç”¨æˆ·é¦–å…ˆè®¿é—®å…¨å›½å„åœ°çš„CDNèŠ‚ç‚¹ï¼ˆä½¿ç”¨ATSã€Squidå®žçŽ°ï¼‰ï¼Œå¦‚æžœCDNæ²¡å‘½ä¸­ï¼Œåˆ™ä¼šå›žæºåˆ°ä¸­å¤®Nginxé›†ç¾¤ï¼Œè¯¥é›†ç¾¤åšäºŒçº§ç¼“å­˜ï¼Œå¦‚æžœæ²¡æœ‰å‘½ä¸­ç¼“å­˜ï¼ˆè¯¥é›†ç¾¤çš„ç¼“å­˜ä¸æ˜¯å¿…é¡»çš„ï¼Œè¦æ ¹æ®å®žé™…å‘½ä¸­æƒ…å†µç­‰å†³å®šï¼‰ï¼Œåˆ™æœ€åŽå›žæºåˆ°åŽç«¯åº”ç”¨é›†ç¾¤ã€‚ Nginxä»£ç†å±‚ç¼“å­˜é…ç½® HTTPæ¨¡å—é…ç½® 123456789proxy_buffering on;proxy_buffer_size 4k;proxy_buffers 512 4k;proxy_busy_buffers_size 64k;proxy_cache_path /export/cache/proxy_cache levels=1:2 keys_zone=cache:512m inactive=5m max_size=8g use_temp_path=off;# proxy timeoutproxy_connect_timeout 3s;proxy_read_timeout 5s;proxy_send_timeout 5s; proxy_cache_pathæŒ‡ä»¤é…ç½®ï¼š levels=1:2ï¼šè¡¨ç¤ºåˆ›å»ºä¸¤çº§ç›®å½•ç»“æž„ï¼Œç¼“å­˜ç›®å½•çš„ç¬¬ä¸€çº§æ˜¯1ä¸ªå­—ç¬¦ï¼Œç¬¬äºŒå­£ç›®å½•æ˜¯2ä¸ªå­—ç¬¦ï¼Œæ¯”å¦‚/export/cache/proxy_cache/7/3cã€‚å¦‚æžœå°†æ‰€æœ‰æ–‡ä»¶æ”¾åœ¨ä¸€çº§ç›®å½•ä¸‹çš„è¯ï¼Œæ–‡ä»¶é‡ä¼šå¾ˆå¤§ï¼Œä¼šå¯¼è‡´æ–‡ä»¶è®¿é—®å˜æ…¢ã€‚ keys_zone=cache:512mï¼šè®¾ç½®å­˜å‚¨æ‰€æœ‰ç¼“å­˜keyå’Œç›¸å…³ä¿¡æ¯çš„å…±äº«å†…å­˜åŒºï¼Œ1Må¤§çº¦èƒ½å­˜å‚¨8000ä¸ªkeyã€‚ inactive=5mï¼šinactiveæŒ‡å®šè¢«ç¼“å­˜çš„å†…å®¹å¤šä¹…ä¸è¢«è®¿é—®å°†ä»Žç¼“å­˜ä¸­ç§»é™¤ï¼Œä»¥ä¿è¯å†…å®¹çš„æ–°é²œï¼Œé»˜è®¤ä¸º10åˆ†é’Ÿã€‚ max_size=8gï¼šæœ€å¤§ç¼“å­˜é˜ˆå€¼ï¼Œâ€cache managerâ€è¿›ç¨‹ä¼šç›‘æŽ§æœ€å¤§ç¼“å­˜å¤§å°ï¼Œå½“ç¼“å­˜è¾¾åˆ°è¯¥é˜ˆå€¼æ—¶ï¼Œè¯¥è¿›ç¨‹å°†ä»Žç¼“å­˜ä¸­ç§»é™¤æœ€è¿‘æœ€å°‘è®¿é—®çš„å†…å®¹ã€‚ use_temp_pathï¼šå¦‚æžœä¸ºonï¼Œåˆ™å†…å®¹é¦–å…ˆè¢«å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼ˆproxy_temp_pathï¼‰ï¼Œç„¶åŽé‡å‘½ååˆ°proxy_cache_pathæŒ‡ä»¤çš„ç›®å½•ï¼›å¦‚æžœè®¾ç½®ä¸ºoffï¼Œåˆ™å†…å®¹ç›´æŽ¥è¢«å†™å…¥åˆ°proxy_cache_pathæŒ‡ä»¤çš„ç›®å½•ï¼Œå¦‚æžœéœ€è¦cacheå»ºè®®offã€‚ proxy_cacheé…ç½® 1234567location = /cache &#123; proxy_cache cache; proxy_cache_key $scheme$proxy_host$request_uri; proxy_cache_valid 200 5s; proxy_pass http://backend_tomcat/cache$is_args$args; add_header cache-status $upstream_cache_status;&#125; ç¼“å­˜ç›¸å…³é…ç½®ï¼š peoxy_cacheï¼šæŒ‡å®šä½¿ç”¨å“ªä¸ªå…±äº«å†…å­˜åŒºå­˜å‚¨ç¼“å­˜ä¿¡æ¯ã€‚ proxy_cache_keyï¼šè®¾ç½®ç¼“å­˜ä½¿ç”¨çš„keyï¼Œé»˜è®¤ä¸ºå®Œæ•´çš„è®¿é—®URLï¼Œæ ¹æ®å®žé™…æƒ…å†µè®¾ç½®ç¼“å­˜keyã€‚ proxy_cache_validï¼šä¸ºä¸åŒçš„å“åº”çŠ¶æ€ç è®¾ç½®ç¼“å­˜æ—¶é—´ã€‚å¦‚æžœæ˜¯proxy_cache_valid 5sï¼Œåˆ™200ã€301ã€302å“åº”éƒ½å°†è¢«ç¼“å­˜ã€‚ proxy_cache_validä¸æ˜¯å”¯ä¸€è®¾ç½®ç¼“å­˜æ—¶é—´çš„ï¼Œè¿˜å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ï¼ˆä¼˜å…ˆçº§ä»Žä¸Šåˆ°ä¸‹ï¼‰å®žçŽ°ã€‚ ä»¥ç§’ä¸ºå•ä½çš„â€œX-Accel-Expiresâ€å“åº”å¤´æ¥è®¾ç½®å“åº”ç¼“å­˜æ—¶é—´ã€‚ å¦‚æžœæ²¡æœ‰â€œX-Accel-Expiresâ€ï¼Œåˆ™å¯ä»¥æ ¹æ®â€œCache-Controlâ€ã€â€œExpiresâ€æ¥è®¾ç½®å“åº”ç¼“å­˜æ—¶é—´ã€‚ å¦åˆ™ï¼Œä½¿ç”¨proxy_cache_validè®¾ç½®ç¼“å­˜æ—¶é—´ã€‚ å¦‚æžœå“åº”å¤´åŒ…å«Cache-Controlï¼šprivate/no-cache/no-storeã€Set-Cookieï¼Œæˆ–è€…åªæœ‰ä¸€ä¸ªVaryå“åº”å¤´å¹¶ä¸”å…¶å€¼ä¸º*ï¼Œåˆ™å“åº”å†…å®¹å°†ä¸ä¼šè¢«ç¼“å­˜ã€‚å¯ä»¥ä½¿ç”¨proxy_ignore_headersæ¥å¿½ç•¥è¿™äº›å“åº”å¤´ã€‚ add_header cache-status $upstream_cache_statusï¼šåœ¨å“åº”å¤´ä¸­æ·»åŠ ç¼“å­˜å‘½ä¸­çš„çŠ¶æ€ã€‚ HITï¼šç¼“å­˜å‘½ä¸­ï¼Œç›´æŽ¥è¿”å›žç¼“å­˜ä¸­å†…å®¹ï¼Œä¸å›žæºåˆ°åŽç«¯ã€‚ MISSï¼šç¼“å­˜æœªå‘½ä¸­ï¼Œå›žæºåˆ°åŽç«¯èŽ·å–æœ€æ–°çš„å†…å®¹ã€‚ EXPIREDï¼šç¼“å­˜å‘½ä¸­ä½†è¿‡æœŸäº†ï¼Œå›žæºåˆ°åŽç«¯èŽ·å–æœ€æ–°çš„å†…å®¹ã€‚ UPDATINGï¼šç¼“å­˜å·²è¿‡æœŸä½†æ­£åœ¨è¢«åˆ«çš„Nginx Workerè¿›ç¨‹æ›´æ–°ã€‚é…ç½®äº†proxy_cache_use_stale updatingæŒ‡ä»¤æ—¶ä¼šå­˜åœ¨è¯¥çŠ¶æ€ã€‚ STALEï¼šç¼“å­˜å·²è¿‡æœŸï¼Œä½†å› åŽç«¯æœåŠ¡å‡ºçŽ°äº†é—®é¢˜ï¼ˆæ¯”å¦‚åŽç«¯æœåŠ¡æŒ‚äº†ï¼‰è¿”å›žè¿‡æœŸçš„å“åº”ã€‚é…ç½®äº†proxy_cache_use_stale updatingæŒ‡ä»¤æ—¶ä¼šå­˜åœ¨è¯¥çŠ¶æ€ã€‚ REVALIDATEDï¼šå¯ç”¨proxy_cache_revalidateæŒ‡ä»¤åŽï¼Œå½“ç¼“å­˜å†…å®¹è¿‡æœŸæ—¶ï¼ŒNginxé€šè¿‡ä¸€æ¬¡if-modified-sinceçš„è¯·æ±‚å¤´åŽ»éªŒè¯ç¼“å­˜å†…å®¹æ˜¯å¦è¿‡æœŸï¼Œæ­¤æ—¶ä¼šè¿”å›žè¯¥çŠ¶æ€ã€‚ BYPASSï¼šproxy_cache_bypassæŒ‡ä»¤æœ‰æ•ˆæ—¶ï¼Œå¼ºåˆ¶å›žæºåˆ°åŽç«¯èŽ·å–å†…å®¹ï¼Œå³ä½¿å·²ç»ç¼“å­˜äº†ã€‚ proxy_cache_use_staleï¼šå½“å¯¹ç¼“å­˜çš„è¿‡æœŸæ—¶é—´ä¸æ•æ„Ÿï¼Œæˆ–è€…åŽç«¯æœåŠ¡å‡ºé—®é¢˜æ—¶ï¼Œå³ä½¿ç¼“å­˜çš„å†…å®¹ä¸æ–°é²œä¹Ÿæ€»æ¯”è¿”å›žé”™è¯¯ç»™ç”¨æˆ·å¼ºï¼ˆç±»ä¼¼äºŽæ‰˜åº•ï¼‰ï¼Œæ­¤æ—¶å¯ä»¥é…ç½®è¯¥å‚æ•°ï¼Œå¦‚â€œproxy_cache_use_stale error timeout http_500 http_502 http_503 http_504â€ï¼Œå³å¦‚æžœå‡ºçŽ°è¶…æ—¶ã€åŽç«¯é“¾æŽ¥å‡ºé”™ã€500/502/503ç­‰é”™è¯¯æ—¶ï¼Œåˆ™å³ä½¿ç¼“å­˜å†…å®¹å·²è¿‡æœŸä¹Ÿå…ˆè¿”å›žç»™ç”¨æˆ·ï¼Œæ­¤æ—¶$upstream_cache_statusä¸ºSTALEã€‚ è¿˜æœ‰ä¸€ä¸ªupdatingè¡¨ç¤ºç¼“å­˜å·²è¿‡æœŸä½†æ˜¯æ­£åœ¨è¢«åˆ«çš„Nginx Workerè¿›ç¨‹æ›´æ–°ï¼Œåªæ˜¯è¿”å›žäº†è¿‡æœŸå†…å®¹ï¼Œæ­¤æ—¶$upstream_cache_statusä¸ºUPDATINGã€‚ proxy_cache_revalidateï¼šå½“ç¼“å­˜è¿‡æœŸåŽï¼Œå¦‚æžœå¼€å¯äº†proxy_cache_revalidateï¼Œåˆ™ä¼šå‘å‡ºä¸€æ¬¡if-modified-sinceæˆ–if-none-matchæ¡ä»¶è¯·æ±‚ï¼Œå¦‚æžœåŽç«¯è¿”å›ž304ï¼Œåˆ™æ­¤æ—¶$upstream_cache_statusä¸ºREVALIDATEDã€‚æˆ‘ä»¬å°†ä¼šå¾—åˆ°ä¸¤ä¸ªå¥½å¤„ï¼ŒèŠ‚çœå¸¦å®½å’Œå‡å°‘å†™ç£ç›˜çš„æ¬¡æ•°ã€‚ proxy_cache_lockï¼šå½“å¤šä¸ªå®¢æˆ·ç«¯åŒäº‹è¯·æ±‚åŒä¸€ä»½å†…å®¹æ—¶ï¼Œå¦‚æžœå¼€å¯proxy_cache_lockï¼ˆé»˜è®¤offï¼‰ï¼Œåˆ™åªæœ‰ä¸€ä¸ªè¯·æ±‚è¢«å‘é€è‡³åŽç«¯ã€‚å…¶ä»–è¯·æ±‚å°†ç­‰å¾…è¯¥è¯·æ±‚çš„è¿”å›žã€‚å½“ç¬¬ä¸€ä¸ªè¯·æ±‚è¿”å›žåŽï¼Œå…¶ä»–ç›¸åŒè¯·æ±‚å°†ä»Žç¼“å­˜ä¸­èŽ·å–å†…å®¹è¿”å›žã€‚å½“ç¬¬ä¸€ä¸ªè¯·æ±‚è¶…è¿‡äº†proxy_cache_lock_timeoutè¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤ä¸º5sï¼‰ï¼Œåˆ™å…¶ä»–è¯·æ±‚å°†åŒæ—¶è¯·æ±‚åˆ°åŽç«¯æ¥èŽ·å–å“åº”ï¼Œä¸”å“åº”ä¸ä¼šè¢«ç¼“å­˜ã€‚å¯ç”¨proxy_cache_lockå¯ä»¥åº”å¯¹Dog_pile effectï¼ˆå½“æŸä¸ªç¼“å­˜å¤±æ•ˆæ—¶ï¼ŒåŒæ—¶æœ‰å¤§é‡ç›¸åŒçš„è¯·æ±‚æ²¡å‘½ä¸­ç¼“å­˜ï¼Œè€ŒåŒæ—¶è¯·æ±‚åˆ°åŽç«¯ï¼Œä»Žè€Œå¯¼è‡´åŽç«¯åŽ‹åŠ›å¤ªå¤§ï¼Œæ­¤æ—¶é™åˆ¶ä¸€ä¸ªè¯·æ±‚åŽ»èŽ·å–å³å¯ï¼‰ã€‚ proxy_cache_lock_ageï¼šå¦‚æžœåœ¨proxy_cache_lock_ageæŒ‡å®šçš„æ—¶é—´å†…ï¼ˆé»˜è®¤ä¸º5sï¼‰ï¼Œæœ€åŽä¸€ä¸ªå‘é€åˆ°åŽç«¯è¿›è¡Œæ–°ç¼“å­˜æž„å»ºçš„è¯·æ±‚è¿˜æ²¡æœ‰å®Œæˆï¼Œåˆ™ä¸‹ä¸€ä¸ªè¯·æ±‚å°†è¢«å‘é€åˆ°åŽç«¯æ¥æž„å»ºç¼“å­˜ï¼ˆå› ä¸º1.7.8ç‰ˆæœ¬ä¹‹åŽï¼Œproxy_cache_lock_timeoutè¶…æ—¶ä¹‹åŽè¿”å›žçš„å†…å®¹æ˜¯ä¸ç¼“å­˜çš„ï¼Œéœ€è¦ä¸‹ä¸€æ¬¡è¯·æ±‚æ¥æž„å»ºå“åº”ç¼“å­˜ï¼‰ã€‚ æ¸…ç†ç¼“å­˜æœ‰æ—¶ç¼“å­˜çš„å†…å®¹æ˜¯é”™è¯¯çš„ï¼Œéœ€è¦æ‰‹å·¥æ¸…ç†ã€‚Nginxå•†ä¸šç‰ˆæä¾›äº†purgeråŠŸèƒ½ï¼Œå¯¹äºŽç¤¾åŒºç‰ˆNginxï¼Œåˆ™å¯ä»¥è€ƒè™‘ä½¿ç”¨ngx_cache_purgeæ¨¡å—è¿›è¡Œç¼“å­˜æ¸…ç†ã€‚ 12345location ~ /purge(/.*)&#123; allow 127.0.0.1; deny all; proxy_cache_purge cache$1$is_args$args;&#125; è¯¥æ–¹æ³•è¦é™åˆ¶è®¿é—®æƒé™ï¼Œå¦‚åªå¾ªåºå†…å®¹å¯ä»¥è®¿é—®æˆ–è€…éœ€è¦å¯†ç æ‰èƒ½è®¿é—®ã€‚ ä¸€äº›ç»éªŒ åªç¼“å­˜200çŠ¶æ€ç çš„å“åº”ã€‚åƒ302ç­‰ï¼Œè¦æ ¹æ®å®žé™…åœºæ™¯å†³å®šã€‚æ¯”å¦‚ï¼Œå½“ç³»ç»Ÿå‡ºé”™æ—¶ï¼Œè‡ªåŠ¨302åˆ°é”™è¯¯é¡µé¢ï¼Œæ­¤æ—¶ç¼“å­˜302å°±ä¸å¯¹äº†ã€‚ æœ‰äº›é¡µé¢ä¸éœ€è¦å¼ºä¸€è‡´ï¼Œå¯ä»¥è¿›è¡Œå‡ ç§’çš„ç¼“å­˜ã€‚æ¯”å¦‚å•†å“è¯¦æƒ…é¡µå±•ç¤ºçš„åº“å­˜ï¼Œå¯ä»¥ç¼“å­˜å‡ ç§’é’Ÿã€‚çŸ­æ—¶é—´ä¸ä¸€è‡´å¯¹äºŽç”¨æˆ·æ¥è¯´æ˜¯æ²¡æœ‰å½±å“çš„ã€‚ JS/CSS/imageç­‰ä¸€äº›å†…å®¹çš„ç¼“å­˜æ—¶é—´å¯ä»¥è®¾ç½®ä¸ºå¾ˆä¹…ï¼Œæ¯”å¦‚1ä¸ªæœˆç”šè‡³1å¹´ï¼Œé€šè¿‡åœ¨é¡µé¢ä¿®æ”¹ç‰ˆæœ¬æ¥æŽ§åˆ¶è¿‡æœŸã€‚ å‡è®¾å•†å“è¯¦æƒ…é¡µä¸€æ­¥åŠ è½½çš„ä¸€äº›æ•°æ®ï¼Œä½¿ç”¨last-modifiedè¿›è¡Œè¿‡æœŸæŽ§åˆ¶ï¼Œè€ŒæœåŠ¡å™¨åšäº†é€»è¾‘ä¿®æ”¹ï¼Œä½†å†…å®¹æ˜¯æ²¡æœ‰ä¿®æ”¹çš„ï¼Œå³å†…å®¹çš„æœ€åŽä¿®æ”¹æ—¶é—´æ²¡å˜ã€‚å¦‚æžœæƒ³è¿‡æœŸè¿™äº›å¼‚æ­¥åŠ è½½çš„æ•°æ®ï¼Œåˆ™å¯ä»¥è€ƒè™‘åœ¨å•†å“è¯¦æƒ…é¡µæ·»åŠ å¼‚æ­¥åŠ è½½æ•°æ®çš„ç‰ˆæœ¬å·ï¼Œé€šè¿‡ç‰ˆæœ¬å·æ¥åŠ è½½æœ€æ–°çš„æ•°æ®ï¼Œæˆ–è€…å°†last-modifiedæ—¶é—´åŠ 1æ¥è§£å†³ï¼Œä½†è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨ETagæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚ å•†å“è¯¦æƒ…é¡µå¼‚æ­¥åŠ è½½çš„ä¸€äº›æ•°æ®ï¼Œå¯ä»¥è€ƒè™‘æ›´é•¿æ—¶é—´çš„ç¼“å­˜ï¼Œæ¯”å¦‚1ä¸ªæœˆè€Œä¸æ˜¯å‡ åˆ†é’Ÿã€‚å¯ä»¥é€šè¿‡MQå°†ä¿®æ”¹æ—¶é—´æŽ¨é€åˆ°å•†å“è¯¦æƒ…é¡µï¼Œä»Žè€Œå®žçŽ°æŒ‰éœ€è¿‡æœŸæ•°æ®ã€‚ æœåŠ¡å™¨ç«¯è€ƒè™‘ä½¿ç”¨tmpfså†…å­˜æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ã€SSDç¼“å­˜ï¼Œä½¿ç”¨æœåŠ¡å™¨ç«¯è´Ÿè½½å‡è¡¡ç®—æ³•ä¸€è‡´æ€§å“ˆå¸Œæ¥æå‡ç¼“å­˜å‘½ä¸­çŽ‡ã€‚ ç¼“å­˜keyè¦åˆç†è®¾è®¡ã€‚æ¯”å¦‚ï¼ŒåŽ»æŽ‰æŸäº›å‚æ•°æˆ–æŽ’åºå‚æ•°ï¼Œä»¥ä¿è¯ä»£ç†å±‚çš„ç¼“å­˜å‘½ä¸­çŽ‡ï¼›è¦æœ‰æ¸…ç†ç¼“å­˜çš„å·¥å…·ï¼Œå‡ºé—®é¢˜æ—¶èƒ½å¿«é€Ÿæ¸…ç†æŽ‰é—®é¢˜keyã€‚ ABæµ‹è¯•/ä¸ªæ€§åŒ–éœ€æ±‚æ—¶ï¼Œè¦ç¦ç”¨æŽ‰æµè§ˆå™¨ç¼“å­˜ï¼Œä½†è¦è€ƒè™‘æœåŠ¡ç«¯ç¼“å­˜ã€‚ ä¸ºäº†ä¾¿äºŽæŸ¥æ‰¾é—®é¢˜ï¼Œä¸€èˆ¬ä¼šåœ¨å“åº”å¤´ä¸­æ·»åŠ æºæœåŠ¡å™¨ä¿¡æ¯ã€‚å¦‚è®¿é—®äº¬ä¸œå•†å“è¯¦æƒ…é¡µä¼šçœ‹åˆ°serå“åº”å¤´ï¼Œæ­¤å¤´å­˜å‚¨äº†æºæœåŠ¡å™¨IPï¼Œä»¥ä¾¿å‡ºçŽ°é—®é¢˜æ—¶ï¼ŒçŸ¥é“é‚£å°æœåŠ¡å™¨æœ‰é—®é¢˜ã€‚ å‚è€ƒèµ„æ–™ðŸŒ[æµè§ˆå™¨çš„ç¼“å­˜æœºåˆ¶] ðŸ“–ã€Šäº¿çº§æµé‡ç½‘ç«™æž¶æž„æ ¸å¿ƒæŠ€æœ¯ã€‹]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Nginxå­¦ä¹ ç¬”è®°-TCP_NODELAYå’ŒTCP_NOPUSHçš„è§£é‡Š]]></title>
    <url>%2F2018%2F09%2F09%2FNginx%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-TCP_NODELAY%E5%92%8CTCP_NOPUSH%E7%9A%84%E8%A7%A3%E9%87%8A%2F</url>
    <content type="text"><![CDATA[TCP_NODELAYå’ŒTCP_NOPUSHçš„è§£é‡Šé…ç½®é¡¹123è¯­æ³•: tcp_nodelay on | off;é»˜è®¤å€¼: tcp_nodelay on;ä¸Šä¸‹æ–‡: http, server, location å¼€å¯æˆ–å…³é—­nginxä½¿ç”¨TCP_NODELAYé€‰é¡¹çš„åŠŸèƒ½ã€‚ è¿™ä¸ªé€‰é¡¹ä»…åœ¨å°†è¿žæŽ¥è½¬å˜ä¸ºé•¿è¿žæŽ¥ï¼ˆkeepaliveï¼‰çš„æ—¶å€™æ‰è¢«å¯ç”¨ã€‚ï¼ˆè¯‘è€…æ³¨ï¼Œåœ¨upstreamå‘é€å“åº”åˆ°å®¢æˆ·ç«¯æ—¶ä¹Ÿä¼šå¯ç”¨ï¼‰ã€‚ 123è¯­æ³•: tcp_nopush on | off;é»˜è®¤å€¼: tcp_nopush off;ä¸Šä¸‹æ–‡: http, server, location å¼€å¯æˆ–è€…å…³é—­nginxåœ¨FreeBSDä¸Šä½¿ç”¨TCP_NOPUSHå¥—æŽ¥å­—é€‰é¡¹ï¼Œ åœ¨Linuxä¸Šä½¿ç”¨TCP_CORKå¥—æŽ¥å­—é€‰é¡¹ã€‚ é€‰é¡¹ä»…åœ¨ä½¿ç”¨sendfileçš„æ—¶å€™æ‰å¼€å¯ã€‚ å¼€å¯æ­¤é€‰é¡¹å…è®¸åœ¨Linuxå’ŒFreeBSD 4.*ä¸Šå°†å“åº”å¤´å’Œæ­£æ–‡çš„å¼€å§‹éƒ¨åˆ†ä¸€èµ·å‘é€ï¼Œä¸€æ¬¡æ€§å‘é€æ•´ä¸ªæ–‡ä»¶ã€‚åªæœ‰åœ¨å¼€å¯sendfileåŽæ‰å¯ç”¨ã€‚ tcp_nodelayçš„åŠŸèƒ½Nagleå’ŒDelayedAcknowledgmentçš„å»¶è¿Ÿé—®é¢˜ã€‚ æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹Nagleå’ŒDelayedAcknowledgmentçš„å«ä¹‰ï¼š åœ¨ç½‘ç»œæ‹¥å¡žæŽ§åˆ¶é¢†åŸŸï¼Œæˆ‘ä»¬çŸ¥é“æœ‰ä¸€ä¸ªéžå¸¸æœ‰åçš„ç®—æ³•å«åšNagleç®—æ³•ï¼ˆNagle algorithmï¼‰ï¼Œè¿™æ˜¯ä½¿ç”¨å®ƒçš„å‘æ˜ŽäººJohn Nagleçš„åå­—æ¥å‘½åçš„ï¼ŒJohn Nagleåœ¨1984å¹´é¦–æ¬¡ç”¨è¿™ä¸ªç®—æ³•æ¥å°è¯•è§£å†³ç¦ç‰¹æ±½è½¦å…¬å¸çš„ç½‘ç»œæ‹¥å¡žé—®é¢˜ï¼ˆRFC 896ï¼‰ï¼Œè¯¥é—®é¢˜çš„å…·ä½“æè¿°æ˜¯ï¼šå¦‚æžœæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸€æ¬¡äº§ç”Ÿ1ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œè€Œè¿™ä¸ª1ä¸ªå­—èŠ‚æ•°æ®åˆä»¥ç½‘ç»œæ•°æ®åŒ…çš„å½¢å¼å‘é€åˆ°è¿œç«¯æœåŠ¡å™¨ï¼Œé‚£ä¹ˆå°±å¾ˆå®¹æ˜“å¯¼è‡´ç½‘ç»œç”±äºŽå¤ªå¤šçš„æ•°æ®åŒ…è€Œè¿‡è½½ã€‚æ¯”å¦‚ï¼Œå½“ç”¨æˆ·ä½¿ç”¨Telnetè¿žæŽ¥åˆ°è¿œç¨‹æœåŠ¡å™¨æ—¶ï¼Œæ¯ä¸€æ¬¡å‡»é”®æ“ä½œå°±ä¼šäº§ç”Ÿ1ä¸ªå­—èŠ‚æ•°æ®ï¼Œè¿›è€Œå‘é€å‡ºåŽ»ä¸€ä¸ªæ•°æ®åŒ…ï¼Œæ‰€ä»¥ï¼Œåœ¨å…¸åž‹æƒ…å†µä¸‹ï¼Œä¼ é€ä¸€ä¸ªåªæ‹¥æœ‰1ä¸ªå­—èŠ‚æœ‰æ•ˆæ•°æ®çš„æ•°æ®åŒ…ï¼Œå´è¦å‘è´¹40ä¸ªå­—èŠ‚é•¿åŒ…å¤´ï¼ˆå³ipå¤´20å­—èŠ‚+tcpå¤´20å­—èŠ‚ï¼‰çš„é¢å¤–å¼€é”€ï¼Œè¿™ç§æœ‰æ•ˆè½½è·ï¼ˆpayloadï¼‰åˆ©ç”¨çŽ‡æžå…¶ä½Žä¸‹çš„æƒ…å†µè¢«ç»Ÿç§°ä¹‹ä¸ºæ„šè ¢çª—å£ç—‡å€™ç¾¤ï¼ˆSilly Window Syndromeï¼‰ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™ç§æƒ…å†µå¯¹äºŽè½»è´Ÿè½½çš„ç½‘ç»œæ¥è¯´ï¼Œå¯èƒ½è¿˜å¯ä»¥æŽ¥å—ï¼Œä½†æ˜¯å¯¹äºŽé‡è´Ÿè½½çš„ç½‘ç»œè€Œè¨€ï¼Œå°±æžæœ‰å¯èƒ½æ‰¿è½½ä¸äº†è€Œè½»æ˜“çš„å‘ç”Ÿæ‹¥å¡žç˜«ç—ªã€‚ é€šä¿—æ¥è¯´ Nagleï¼š å‡å¦‚éœ€è¦é¢‘ç¹çš„å‘é€ä¸€äº›å°åŒ…æ•°æ®ï¼Œæ¯”å¦‚è¯´1ä¸ªå­—èŠ‚ï¼Œä»¥IPv4ä¸ºä¾‹çš„è¯ï¼Œåˆ™æ¯ä¸ªåŒ…éƒ½è¦é™„å¸¦40å­—èŠ‚çš„å¤´ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ€»è®¡41ä¸ªå­—èŠ‚çš„æ•°æ®é‡Œï¼Œå…¶ä¸­åªæœ‰1ä¸ªå­—èŠ‚æ˜¯æˆ‘ä»¬éœ€è¦çš„æ•°æ®ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå‡ºçŽ°äº†Nagleç®—æ³•ã€‚å®ƒè§„å®šï¼šå¦‚æžœåŒ…çš„å¤§å°æ»¡è¶³MSSï¼Œé‚£ä¹ˆå¯ä»¥ç«‹å³å‘é€ï¼Œå¦åˆ™æ•°æ®ä¼šè¢«æ”¾åˆ°ç¼“å†²åŒºï¼Œç­‰åˆ°å·²ç»å‘é€çš„åŒ…è¢«ç¡®è®¤äº†ä¹‹åŽæ‰èƒ½ç»§ç»­å‘é€ã€‚ é€šè¿‡è¿™æ ·çš„è§„å®šï¼Œå¯ä»¥é™ä½Žç½‘ç»œé‡Œå°åŒ…çš„æ•°é‡ï¼Œä»Žè€Œæå‡ç½‘ç»œæ€§èƒ½ã€‚ DelayedAcknowledgmentï¼š å‡å¦‚éœ€è¦å•ç‹¬ç¡®è®¤æ¯ä¸€ä¸ªåŒ…çš„è¯ï¼Œé‚£ä¹ˆç½‘ç»œä¸­å°†ä¼šå……æ–¥ç€æ— æ•°çš„ACKï¼Œä»Žè€Œé™ä½Žäº†ç½‘ç»œæ€§èƒ½ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒDelayedAcknowledgmentè§„å®šï¼šä¸å†é’ˆå¯¹å•ä¸ªåŒ…å‘é€ACKï¼Œè€Œæ˜¯ä¸€æ¬¡ç¡®è®¤ä¸¤ä¸ªåŒ…ï¼Œæˆ–è€…åœ¨å‘é€å“åº”æ•°æ®çš„åŒæ—¶æŽå¸¦ç€å‘é€ACKï¼Œåˆæˆ–è€…è§¦å‘è¶…æ—¶æ—¶é—´åŽå†å‘é€ACKã€‚ é€šè¿‡è¿™æ ·çš„è§„å®šï¼Œå¯ä»¥é™ä½Žç½‘ç»œé‡ŒACKçš„æ•°é‡ï¼Œä»Žè€Œæå‡ç½‘ç»œæ€§èƒ½ã€‚ Nagleå’ŒDelayedAcknowledgmentæ˜¯å¦‚ä½•å½±å“æ€§èƒ½çš„ï¼Ÿ Nagleå’ŒDelayedAcknowledgmentè™½ç„¶éƒ½æ˜¯å¥½å¿ƒï¼Œä½†æ˜¯å®ƒä»¬åœ¨ä¸€èµ·çš„æ—¶å€™å´ä¼šåŠžåäº‹ã€‚ å¦‚æžœä¸€ä¸ª TCP è¿žæŽ¥çš„ä¸€ç«¯å¯ç”¨äº† Nagleâ€˜s Algorithmï¼Œè€Œå¦ä¸€ç«¯å¯ç”¨äº† TCP Delayed Ackï¼Œè€Œå‘é€çš„æ•°æ®åŒ…åˆæ¯”è¾ƒå°ï¼Œåˆ™å¯èƒ½ä¼šå‡ºçŽ°è¿™æ ·çš„æƒ…å†µï¼š å‘é€ç«¯åœ¨ç­‰å¾…æŽ¥æ”¶ç«¯å¯¹ä¸Šä¸€ä¸ªpacket çš„ Ack æ‰å‘é€å½“å‰çš„ packetï¼Œè€ŒæŽ¥æ”¶ç«¯åˆ™æ­£å¥½å»¶è¿Ÿäº†æ­¤ Ack çš„å‘é€ï¼Œé‚£ä¹ˆè¿™ä¸ªæ­£è¦è¢«å‘é€çš„ packet å°±ä¼šåŒæ ·è¢«å»¶è¿Ÿã€‚ å½“ç„¶ Delayed Ack æ˜¯æœ‰ä¸ªè¶…æ—¶æœºåˆ¶çš„ï¼Œè€Œé»˜è®¤çš„è¶…æ—¶æ­£å¥½å°±æ˜¯ 40msã€‚ çŽ°ä»£çš„ TCP/IP åè®®æ ˆå®žçŽ°ï¼Œé»˜è®¤å‡ ä¹Žéƒ½å¯ç”¨äº†è¿™ä¸¤ä¸ªåŠŸèƒ½ã€‚æŒ‰ä¸Šé¢çš„è¯´æ³•ï¼Œå½“åè®®æŠ¥æ–‡å¾ˆå°çš„æ—¶å€™ï¼Œå²‚ä¸æ¯æ¬¡éƒ½ä¼šè§¦å‘è¿™ä¸ªå»¶è¿Ÿé—®é¢˜ï¼Ÿ äº‹å®žä¸æ˜¯é‚£æ ·çš„ã€‚ä»…å½“åè®®çš„äº¤äº’æ˜¯å‘é€ç«¯è¿žç»­å‘é€ä¸¤ä¸ª packetï¼Œç„¶åŽç«‹åˆ» read çš„ æ—¶å€™æ‰ä¼šå‡ºçŽ°é—®é¢˜ã€‚ çŽ°åœ¨è®©æˆ‘ä»¬å‡è®¾æŸä¸ªåº”ç”¨ç¨‹åºå‘å‡ºäº†ä¸€ä¸ªè¯·æ±‚ï¼Œå¸Œæœ›å‘é€å°å—æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥é€‰æ‹©ç«‹å³å‘é€æ•°æ®æˆ–è€…ç­‰å¾…äº§ç”Ÿæ›´å¤šçš„æ•°æ®ç„¶åŽå†ä¸€æ¬¡å‘é€ä¸¤ç§ç­–ç•¥ã€‚ å¦‚æžœæˆ‘ä»¬é©¬ä¸Šå‘é€æ•°æ®ï¼Œé‚£ä¹ˆäº¤äº’æ€§çš„ä»¥åŠå®¢æˆ·/æœåŠ¡å™¨åž‹çš„åº”ç”¨ç¨‹åºå°†æžå¤§åœ°å—ç›Šã€‚ ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬æ­£åœ¨å‘é€ä¸€ä¸ªè¾ƒçŸ­çš„è¯·æ±‚å¹¶ä¸”ç­‰å€™è¾ƒå¤§çš„å“åº”æ—¶ï¼Œç›¸å…³è¿‡è½½ä¸Žä¼ è¾“çš„æ•°æ®æ€»é‡ç›¸æ¯”å°±ä¼šæ¯”è¾ƒä½Žï¼Œè€Œä¸”ï¼Œå¦‚æžœè¯·æ±‚ç«‹å³å‘å‡ºé‚£ä¹ˆå“åº”æ—¶é—´ä¹Ÿä¼šå¿«ä¸€äº›ã€‚ ä»¥ä¸Šæ“ä½œå¯ä»¥é€šè¿‡è®¾ç½®å¥—æŽ¥å­—çš„TCP_NODELAYé€‰é¡¹æ¥å®Œæˆï¼Œè¿™æ ·å°±ç¦ç”¨äº†Nagle ç®—æ³•ã€‚ å¦å¤–ä¸€ç§æƒ…å†µåˆ™éœ€è¦æˆ‘ä»¬ç­‰åˆ°æ•°æ®é‡è¾¾åˆ°æœ€å¤§æ—¶æ‰é€šè¿‡ç½‘ç»œä¸€æ¬¡å‘é€å…¨éƒ¨æ•°æ®ï¼Œè¿™ç§æ•°æ®ä¼ è¾“æ–¹å¼æœ‰ç›ŠäºŽå¤§é‡æ•°æ®çš„é€šä¿¡æ€§èƒ½ï¼Œå…¸åž‹çš„åº”ç”¨å°±æ˜¯æ–‡ä»¶æœåŠ¡å™¨ã€‚åº”ç”¨Nagleç®—æ³•åœ¨è¿™ç§æƒ…å†µä¸‹å°±ä¼šäº§ç”Ÿé—®é¢˜ã€‚ä½†æ˜¯ï¼Œå¦‚æžœä½ æ­£åœ¨å‘é€å¤§é‡æ•°æ®ï¼Œä½ å¯ä»¥è®¾ç½®TCP_CORKé€‰é¡¹ç¦ç”¨NagleåŒ–ï¼Œå…¶æ–¹å¼æ­£å¥½åŒ TCP_NODELAYç›¸åï¼ˆTCP_CORK å’Œ TCP_NODELAY æ˜¯äº’ç›¸æŽ’æ–¥çš„ï¼‰ã€‚å‡è®¾å®¢æˆ·ç«¯çš„è¯·æ±‚å‘ç”Ÿéœ€è¦ç­‰å¾…æœåŠ¡ç«¯çš„åº”ç­”åŽæ‰èƒ½ç»§ç»­å‘ç”Ÿä¸‹ä¸€åŒ…ï¼Œå³ä¸²è¡Œæ‰§è¡Œã€‚ å¥½æ¯”åœ¨ç”¨abæ€§èƒ½æµ‹è¯•æ—¶åªæœ‰ä¸€ä¸ªå¹¶å‘åš10kçš„åŽ‹åŠ›æµ‹è¯•ï¼Œæµ‹è¯•åœ°å€è¿”å›žçš„å†…å®¹åªæœ‰Hello worldï¼›abå‘å‡ºçš„requestéœ€è¦ç­‰å¾…æœåŠ¡å™¨è¿”å›žresponseæ—¶ï¼Œæ‰èƒ½å‘ç”Ÿä¸‹ä¸€ä¸ªrequestï¼› æ­¤æ—¶abåªä¼šå‘ç”Ÿä¸€ä¸ªgetè¯·æ±‚ï¼Œè¯·æ±‚çš„ç›¸å…³å†…å®¹åŒ…å«åœ¨headerä¸­ï¼›è€ŒæœåŠ¡å™¨éœ€è¦è¿”å›žä¸¤ä¸ªæ•°æ®ï¼Œä¸€ä¸ªæ˜¯responseå¤´ï¼Œå¦ä¸€ä¸ªæ˜¯html bodyï¼› æœåŠ¡å™¨å‘é€ç«¯å‘é€çš„ç¬¬ä¸€ä¸ª write æ˜¯ä¸ä¼šè¢«ç¼“å†²èµ·æ¥ï¼Œè€Œæ˜¯ç«‹åˆ»å‘é€çš„ï¼ˆresponse headerï¼‰ï¼Œ è¿™æ—¶abæŽ¥æ”¶ç«¯æ”¶åˆ°å¯¹åº”çš„æ•°æ®ï¼Œä½†å®ƒè¿˜æœŸå¾…æ›´å¤šæ•°æ®ï¼ˆhtmlï¼‰æ‰è¿›è¡Œå¤„ç†ï¼Œæ‰€ä»¥ä¸ä¼šå¾€å›žå‘é€æ•°æ®ï¼Œå› æ­¤ä¹Ÿæ²¡æœºä¼šæŠŠ Ack ç»™å¸¦å›žåŽ»ï¼Œæ ¹æ®Delayed Ack æœºåˆ¶ï¼Œ è¿™ä¸ª Ack ä¼šè¢« Hold ä½ã€‚ è¿™æ—¶æœåŠ¡å™¨å‘é€ç«¯å‘é€ç¬¬äºŒä¸ªåŒ…ï¼Œè€Œé˜Ÿåˆ—é‡Œè¿˜æœ‰æœªç¡®è®¤çš„æ•°æ®åŒ…ï¼ˆresponse headerï¼‰ï¼Œè¿™ä¸ª packetï¼ˆhtmlï¼‰ ä¼šè¢«ç¼“å†²èµ·æ¥ã€‚ æ­¤æ—¶ï¼ŒæœåŠ¡å™¨å‘é€ç«¯åœ¨ç­‰å¾…abæŽ¥æ”¶ç«¯çš„ Ackï¼›abæŽ¥æ”¶ç«¯åˆ™åœ¨ Delay è¿™ä¸ª Ackï¼Œæ‰€ä»¥éƒ½åœ¨ç­‰å¾…ï¼Œ ç›´åˆ°abæŽ¥æ”¶ç«¯ Deplayed Ack è¶…æ—¶ï¼ˆ40msï¼‰ï¼Œæ­¤ Ack è¢«å‘é€å›žåŽ»ï¼Œå‘é€ç«¯ç¼“å†²çš„è¿™ä¸ª packetï¼ˆhtmlï¼‰ æ‰ä¼šè¢«çœŸæ­£é€åˆ°æŽ¥æ”¶ç«¯ï¼Œ æ­¤æ—¶abæ‰æŽ¥å—åˆ°å®Œæ•´çš„æ•°æ®ï¼Œè¿›è¡Œå¯¹åº”çš„åº”ç”¨å±‚å¤„ç†ï¼Œå¤„ç†å®ŒæˆåŽæ‰ç»§ç»­å‘ç”Ÿä¸‹ä¸€ä¸ªrequestï¼Œå› æ­¤æœåŠ¡å™¨ç«¯æ‰ä¼šåœ¨readæ—¶å‡ºçŽ°40msçš„é˜»å¡žã€‚ tcp_nodelayä¸ºä»€ä¹ˆåªåœ¨keep-aliveæ‰å¯ä½œç”¨ï¼Ÿ TCPä¸­çš„Nagleç®—æ³•é»˜è®¤æ˜¯å¯ç”¨çš„ï¼Œä½†æ˜¯å®ƒå¹¶ä¸æ˜¯é€‚åˆä»»ä½•æƒ…å†µï¼Œå¯¹äºŽtelnetæˆ–rloginè¿™æ ·çš„è¿œç¨‹ç™»å½•åº”ç”¨çš„ç¡®æ¯”è¾ƒé€‚åˆï¼ˆåŽŸæœ¬å°±æ˜¯ä¸ºæ­¤è€Œè®¾è®¡ï¼‰ï¼Œä½†æ˜¯åœ¨æŸäº›åº”ç”¨åœºæ™¯ä¸‹æˆ‘ä»¬å´åˆéœ€è¦å…³é—­å®ƒã€‚ åœ¨Apacheå¯¹HTTPæŒä¹…è¿žæŽ¥ï¼ˆKeep-Aliveï¼ŒPrsistent-Connectionï¼‰å¤„ç†æ—¶å‡¸çŽ°çš„å¥‡æ•°åŒ…&amp;ç»“æŸå°åŒ…é—®é¢˜ï¼ˆThe Odd/Short-Final-Segment Problemï¼‰ã€‚ è¿™æ˜¯ä¸€ä¸ªå¹¶çš„å…³ç³»ï¼Œå³é—®é¢˜æ˜¯ç”±äºŽå·²æœ‰å¥‡æ•°ä¸ªåŒ…å‘å‡ºï¼Œå¹¶ä¸”è¿˜æœ‰ä¸€ä¸ªç»“æŸå°åŒ…ï¼ˆåœ¨è¿™é‡Œï¼Œç»“æŸå°åŒ…å¹¶ä¸æ˜¯æŒ‡å¸¦FINæ——æ ‡çš„åŒ…ï¼Œè€Œæ˜¯æŒ‡ä¸€ä¸ªHTTPè¯·æ±‚æˆ–å“åº”çš„ç»“æŸåŒ…ï¼‰ç­‰å¾…å‘å‡ºè€Œå¯¼è‡´çš„ã€‚ æˆ‘ä»¬æ¥çœ‹çœ‹å…·ä½“çš„é—®é¢˜è¯¦æƒ…ï¼Œä»¥3ä¸ªåŒ…+1ä¸ªç»“æŸå°åŒ…ä¸ºä¾‹ï¼Œå¯èƒ½å‘ç”Ÿçš„å‘åŒ…æƒ…å†µï¼š æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘å‡ºä¸¤ä¸ªå¤§åŒ…ï¼›å®¢æˆ·ç«¯åœ¨æŽ¥å—åˆ°ä¸¤ä¸ªå¤§åŒ…æ—¶ï¼Œå¿…é¡»å›žå¤ackï¼› æŽ¥ç€æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªä¸­åŒ…æˆ–å°åŒ…ï¼Œä½†æœåŠ¡å™¨ç”±äºŽDelayed Acknowledgmentå¹¶æ²¡æœ‰é©¬ä¸Šackï¼› ç”±äºŽå‘ç”Ÿé˜Ÿåˆ—ä¸­æœ‰æœªè¢«ackçš„åŒ…ï¼Œå› æ­¤æœ€åŽä¸€ä¸ªç»“æŸçš„å°åŒ…è¢«é˜»å¡žç­‰å¾…ã€‚ æœ€åŽä¸€ä¸ªå°åŒ…åŒ…å«äº†æ•´ä¸ªå“åº”æ•°æ®çš„æœ€åŽä¸€äº›æ•°æ®ï¼Œæ‰€ä»¥å®ƒæ˜¯ç»“æŸå°åŒ…ï¼Œå¦‚æžœå½“å‰HTTPæ˜¯éžæŒä¹…è¿žæŽ¥ï¼Œé‚£ä¹ˆåœ¨è¿žæŽ¥å…³é—­æ—¶ï¼Œæœ€åŽè¿™ä¸ªå°åŒ…ä¼šç«‹å³å‘é€å‡ºåŽ»ï¼Œè¿™ä¸ä¼šå‡ºçŽ°é—®é¢˜ï¼› ä½†æ˜¯ï¼Œå¦‚æžœå½“å‰HTTPæ˜¯æŒä¹…è¿žæŽ¥ï¼ˆéžpipeliningå¤„ç†ï¼Œpipeliningä»…HTTP 1.1æ”¯æŒï¼Œnginxç›®å‰å¯¹pipeliningçš„æ”¯æŒå¾ˆå¼±ï¼Œå®ƒå¿…é¡»æ˜¯å‰ä¸€ä¸ªè¯·æ±‚å®Œå…¨å¤„ç†å®ŒåŽæ‰èƒ½å¤„ç†åŽä¸€ä¸ªè¯·æ±‚ï¼‰ï¼Œå³è¿›è¡Œè¿žç»­çš„Request/Responseã€Request/Responseã€â€¦ï¼Œå¤„ç†ï¼Œé‚£ä¹ˆç”±äºŽæœ€åŽè¿™ä¸ªå°åŒ…å—åˆ°Nagleç®—æ³•å½±å“æ— æ³•åŠæ—¶çš„å‘é€å‡ºåŽ»ï¼ˆå…·ä½“æ˜¯ç”±äºŽå®¢æˆ·ç«¯åœ¨æœªç»“æŸä¸Šä¸€ä¸ªè¯·æ±‚å‰ä¸ä¼šå‘å‡ºæ–°çš„requestæ•°æ®ï¼Œå¯¼è‡´æ— æ³•æºå¸¦ACKè€Œå»¶è¿Ÿç¡®è®¤ï¼Œè¿›è€Œå¯¼è‡´æœåŠ¡å™¨æ²¡æ”¶åˆ°å®¢æˆ·ç«¯å¯¹ä¸Šä¸€ä¸ªå°åŒ…çš„çš„ç¡®è®¤å¯¼è‡´æœ€åŽä¸€ä¸ªå°åŒ…æ— æ³•å‘é€å‡ºæ¥ï¼‰ï¼Œå¯¼è‡´ç¬¬næ¬¡è¯·æ±‚/å“åº”æœªèƒ½ç»“æŸï¼Œä»Žè€Œå®¢æˆ·ç«¯ç¬¬n+1æ¬¡çš„Requestè¯·æ±‚æ•°æ®æ— æ³•å‘å‡ºã€‚ æˆ‘çš„ç†è§£æ˜¯è¿™æ ·çš„ï¼š åœ¨httpé•¿è¿žæŽ¥ä¸­ï¼ŒæœåŠ¡å™¨çš„å‘ç”Ÿç±»ä¼¼äºŽï¼šWrite-Write-Readï¼Œå³è¿”å›žresponse headerã€è¿”å›žhtmlã€è¯»å–ä¸‹ä¸€ä¸ªrequestã€‚ è€Œåœ¨httpçŸ­è¿žæŽ¥ä¸­ï¼ŒæœåŠ¡å™¨çš„å‘ç”Ÿç±»ä¼¼äºŽï¼šwrite-read-write-readï¼Œå³è¿”å›žå¤„ç†ç»“æžœåŽï¼Œå°±ä¸»åŠ¨å…³é—­è¿žæŽ¥ï¼ŒçŸ­è¿žæŽ¥ä¸­çš„closeä¹‹å‰çš„å°åŒ…ä¼šç«‹å³å‘ç”Ÿï¼Œä¸ä¼šé˜»å¡žã€‚ å› ä¸ºç¬¬ä¸€ä¸ª write ä¸ä¼šè¢«ç¼“å†²ï¼Œä¼šç«‹åˆ»åˆ°è¾¾æŽ¥æ”¶ç«¯ï¼Œå¦‚æžœæ˜¯ write-read-write-read æ¨¡å¼ï¼Œæ­¤æ—¶æŽ¥æ”¶ç«¯åº”è¯¥å·²ç»å¾—åˆ°æ‰€æœ‰éœ€è¦çš„æ•°æ®ä»¥è¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†ã€‚ æŽ¥æ”¶ç«¯æ­¤æ—¶å¤„ç†å®ŒåŽå‘é€ç»“æžœï¼ŒåŒæ—¶ä¹Ÿå°±å¯ä»¥æŠŠä¸Šä¸€ä¸ªpacket çš„ Ack å¯ä»¥å’Œæ•°æ®ä¸€èµ·å‘é€å›žåŽ»ï¼Œä¸éœ€è¦ delayï¼Œä»Žè€Œä¸ä¼šå¯¼è‡´ä»»ä½•é—®é¢˜ã€‚ æˆ‘åšäº†ä¸€ä¸ªç®€å•çš„è¯•éªŒï¼Œæ³¨é‡ŠæŽ‰äº† HTTP Body çš„å‘é€ï¼Œä»…ä»…å‘é€ Headersï¼Œ Content-Length æŒ‡å®šä¸º 0ã€‚ è¿™æ ·å°±ä¸ä¼šæœ‰ç¬¬äºŒä¸ª writeï¼Œå˜æˆäº† write-read-write-read æ¨¡å¼ã€‚æ­¤æ—¶å†ç”¨ ab æµ‹è¯•ï¼Œæžœç„¶æ²¡æœ‰ 40ms çš„å»¶è¿Ÿäº†ã€‚ å› æ­¤åœ¨çŸ­è¿žæŽ¥ä¸­å¹¶ä¸å­˜åœ¨å°åŒ…é˜»å¡žçš„é—®é¢˜ï¼Œè€Œåœ¨é•¿è¿žæŽ¥ä¸­éœ€è¦åštcp_nodelayå¼€å¯ã€‚ tcp_nopushåŠŸèƒ½TCP_CORKé€‰é¡¹çš„åŠŸèƒ½ç±»ä¼¼äºŽåœ¨å‘é€æ•°æ®ç®¡é“å‡ºå£å¤„æ’å…¥ä¸€ä¸ªâ€œå¡žå­â€ï¼Œä½¿å¾—å‘é€æ•°æ®å…¨éƒ¨è¢«é˜»å¡žï¼Œç›´åˆ°å–æ¶ˆTCP_CORKé€‰é¡¹ï¼ˆå³æ‹”åŽ»å¡žå­ï¼‰æˆ–è¢«é˜»å¡žæ•°æ®é•¿åº¦å·²è¶…è¿‡MSSæ‰å°†å…¶å‘é€å‡ºåŽ»ã€‚ é€‰é¡¹TCP_NODELAYæ˜¯ç¦ç”¨Nagleç®—æ³•ï¼Œå³æ•°æ®åŒ…ç«‹å³å‘é€å‡ºåŽ»ï¼Œè€Œé€‰é¡¹TCP_CORKä¸Žæ­¤ç›¸åï¼Œå¯ä»¥è®¤ä¸ºå®ƒæ˜¯Nagleç®—æ³•çš„è¿›ä¸€æ­¥å¢žå¼ºï¼Œå³é˜»å¡žæ•°æ®åŒ…å‘é€ã€‚ å…·ä½“ç‚¹è¯´å°±æ˜¯ï¼šTCP_CORKé€‰é¡¹çš„åŠŸèƒ½ç±»ä¼¼äºŽåœ¨å‘é€æ•°æ®ç®¡é“å‡ºå£å¤„æ’å…¥ä¸€ä¸ªâ€œå¡žå­â€ï¼Œä½¿å¾—å‘é€æ•°æ®å…¨éƒ¨è¢«é˜»å¡žï¼Œ ç›´åˆ°å–æ¶ˆTCP_CORKé€‰é¡¹ï¼ˆå³æ‹”åŽ»å¡žå­ï¼‰æˆ–è¢«é˜»å¡žæ•°æ®é•¿åº¦å·²è¶…è¿‡MSSæ‰å°†å…¶å‘é€å‡ºåŽ»ã€‚ ä¸¾ä¸ªå¯¹æ¯”ç¤ºä¾‹ï¼Œæ¯”å¦‚æ”¶åˆ°æŽ¥æ”¶ç«¯çš„ACKç¡®è®¤åŽï¼ŒNagleç®—æ³•å¯ä»¥è®©å½“å‰å¾…å‘é€æ•°æ®åŒ…å‘é€å‡ºåŽ»ï¼Œå³ä¾¿å®ƒçš„å½“å‰é•¿åº¦ä»ç„¶ä¸å¤Ÿä¸€ä¸ªMSSï¼Œä½†é€‰é¡¹TCP_CORKåˆ™ä¼šè¦æ±‚ç»§ç»­ç­‰å¾…ï¼Œè¿™åœ¨å‰é¢çš„tcp_nagle_check()å‡½æ•°åˆ†æžæ—¶å·²æåˆ°è¿™ä¸€ç‚¹ï¼Œå³å¦‚æžœåŒ…æ•°æ®é•¿åº¦å°äºŽå½“å‰MSS &amp;&amp;ï¼ˆï¼ˆåŠ å¡ž || â€¦ï¼‰|| â€¦ï¼‰ï¼Œé‚£ä¹ˆç¼“å­˜æ•°æ®è€Œä¸ç«‹å³å‘é€ã€‚ åœ¨TCP_NODELAYæ¨¡å¼ä¸‹ï¼Œå‡è®¾æœ‰3ä¸ªå°åŒ…è¦å‘é€ï¼Œç¬¬ä¸€ä¸ªå°åŒ…å‘å‡ºåŽï¼ŒæŽ¥ä¸‹æ¥çš„å°åŒ…éœ€è¦ç­‰å¾…ä¹‹å‰çš„å°åŒ…è¢«ackï¼Œåœ¨è¿™æœŸé—´å°åŒ…ä¼šåˆå¹¶ï¼Œç›´åˆ°æŽ¥æ”¶åˆ°ä¹‹å‰åŒ…çš„ackåŽæ‰ä¼šå‘ç”Ÿï¼› è€Œåœ¨TCP_CORKæ¨¡å¼ä¸‹ï¼Œç¬¬ä¸€ä¸ªå°åŒ…éƒ½ä¸ä¼šå‘ç”ŸæˆåŠŸï¼Œå› ä¸ºåŒ…å¤ªå°ï¼Œå‘ç”Ÿç®¡é“è¢«é˜»å¡žï¼ŒåŒä¸€ç›®çš„åœ°çš„å°åŒ…å½¼æ­¤åˆå¹¶åŽç»„æˆä¸€ä¸ªå¤§äºŽmssçš„åŒ…åŽï¼Œæ‰ä¼šè¢«å‘ç”Ÿã€‚ TCP_CORKé€‰é¡¹â€œå µå¡žâ€ç‰¹æ€§çš„æœ€ç»ˆç›®çš„æ— éžæ˜¯ä¸ºäº†æé«˜ç½‘ç»œåˆ©ç”¨çŽ‡ï¼Œæ—¢ç„¶åæ­£æ˜¯è¦å‘ä¸€ä¸ªæ•°æ®åŒ…ï¼ˆé›¶çª—å£æŽ¢æµ‹åŒ…ï¼‰ã€‚ å¦‚æžœæœ‰å®žé™…æ•°æ®ç­‰å¾…å‘é€ï¼Œé‚£ä¹ˆå¹²è„†å°±ç›´æŽ¥å‘é€ä¸€ä¸ªè´Ÿè½½ç­‰å¾…å‘é€æ•°æ®çš„æ•°æ®åŒ…å²‚ä¸æ˜¯æ›´å¥½ï¼Ÿ æˆ‘ä»¬å·²ç»çŸ¥é“ï¼ŒTCP_CORKé€‰é¡¹çš„ä½œç”¨ä¸»è¦æ˜¯é˜»å¡žå°æ•°æ®å‘é€ï¼Œæ‰€ä»¥åœ¨nginxå†…çš„ç”¨å¤„å°±åœ¨å¯¹å“åº”å¤´çš„å‘é€å¤„ç†ä¸Šã€‚ ä¸€èˆ¬è€Œè¨€ï¼Œå¤„ç†ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚ä¹‹åŽçš„å“åº”æ•°æ®åŒ…æ‹¬æœ‰å“åº”å¤´å’Œå“åº”ä½“ä¸¤éƒ¨åˆ†ï¼Œé‚£ä¹ˆåˆ©ç”¨TCP_CORKé€‰é¡¹å°±èƒ½è®©è¿™ä¸¤éƒ¨åˆ†æ•°æ®ä¸€èµ·å‘é€ã€‚ å‡è®¾æˆ‘ä»¬éœ€è¦ç­‰åˆ°æ•°æ®é‡è¾¾åˆ°æœ€å¤§æ—¶æ‰é€šè¿‡ç½‘ç»œä¸€æ¬¡å‘é€å…¨éƒ¨æ•°æ®ï¼Œè¿™ç§æ•°æ®ä¼ è¾“æ–¹å¼æœ‰ç›ŠäºŽå¤§é‡æ•°æ®çš„é€šä¿¡æ€§èƒ½ï¼Œå…¸åž‹çš„åº”ç”¨å°±æ˜¯æ–‡ä»¶æœåŠ¡å™¨ã€‚ åº”ç”¨Nagleç®—æ³•åœ¨è¿™ç§æƒ…å†µä¸‹å°±ä¼šäº§ç”Ÿé—®é¢˜ã€‚å› ä¸ºTCP_NODELAYåœ¨å‘ç”Ÿå°åŒ…æ—¶ä¸å†ç­‰å¾…ä¹‹å‰çš„åŒ…æœ‰æ²¡æœ‰ackï¼Œç½‘ç»œä¸­ä¼šå­˜åœ¨è¾ƒå¤šçš„å°åŒ…ï¼Œä½†è¿™ä¼šå½±å“ç½‘ç»œçš„ä¼ è¾“èƒ½åŠ›ã€‚ ä½†æ˜¯ï¼Œå¦‚æžœä½ æ­£åœ¨å‘é€å¤§é‡æ•°æ®ï¼Œä½ å¯ä»¥è®¾ç½®TCP_CORKé€‰é¡¹ç¦ç”¨NagleåŒ–ï¼Œå…¶æ–¹å¼æ­£å¥½åŒ TCP_NODELAYç›¸åï¼ˆTCP_CORK å’Œ TCP_NODELAY æ˜¯äº’ç›¸æŽ’æ–¥çš„ï¼‰ã€‚ ä¸‹é¢å°±è®©æˆ‘ä»¬ä»”ç»†åˆ†æžä¸‹å…¶å·¥ä½œåŽŸç†ã€‚ å‡è®¾åº”ç”¨ç¨‹åºä½¿ç”¨sendfile()å‡½æ•°æ¥è½¬ç§»å¤§é‡æ•°æ®ã€‚åº”ç”¨åè®®é€šå¸¸è¦æ±‚å‘é€æŸäº›ä¿¡æ¯æ¥é¢„å…ˆè§£é‡Šæ•°æ®ï¼Œè¿™äº›ä¿¡æ¯å…¶å®žå°±æ˜¯æŠ¥å¤´å†…å®¹ã€‚ å…¸åž‹æƒ…å†µä¸‹æŠ¥å¤´å¾ˆå°ï¼Œè€Œä¸”å¥—æŽ¥å­—ä¸Šè®¾ç½®äº†TCP_NODELAYã€‚æœ‰æŠ¥å¤´çš„åŒ…å°†è¢«ç«‹å³ä¼ è¾“ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼ˆå–å†³äºŽå†…éƒ¨çš„åŒ…è®¡æ•°å™¨ï¼‰ï¼Œå› ä¸ºè¿™ä¸ªåŒ…æˆåŠŸåœ°è¢«å¯¹æ–¹æ”¶åˆ°åŽéœ€è¦è¯·æ±‚å¯¹æ–¹ç¡®è®¤ã€‚ è¿™æ ·ï¼Œå¤§é‡æ•°æ®çš„ä¼ è¾“å°±ä¼šè¢«æŽ¨è¿Ÿè€Œä¸”äº§ç”Ÿäº†ä¸å¿…è¦çš„ç½‘ç»œæµé‡äº¤æ¢ã€‚ ä½†æ˜¯ï¼Œå¦‚æžœæˆ‘ä»¬åœ¨å¥—æŽ¥å­—ä¸Šè®¾ç½®äº†TCP_CORKï¼ˆå¯ä»¥æ¯”å–»ä¸ºåœ¨ç®¡é“ä¸Šæ’å…¥â€œå¡žå­â€ï¼‰é€‰é¡¹ï¼Œå…·æœ‰æŠ¥å¤´çš„åŒ…å°±ä¼šå¡«è¡¥å¤§é‡çš„æ•°æ®ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½æ ¹æ®å¤§å°è‡ªåŠ¨åœ°é€šè¿‡åŒ…ä¼ è¾“å‡ºåŽ»ã€‚ å½“æ•°æ®ä¼ è¾“å®Œæˆæ—¶ï¼Œæœ€å¥½å–æ¶ˆTCP_CORK é€‰é¡¹è®¾ç½®ç»™è¿žæŽ¥â€œæ‹”åŽ»å¡žå­â€ä»¥ä¾¿ä»»ä¸€éƒ¨åˆ†çš„å¸§éƒ½èƒ½å‘é€å‡ºåŽ»ã€‚è¿™åŒâ€œå¡žä½â€ç½‘ç»œè¿žæŽ¥åŒç­‰é‡è¦ã€‚ æ€»è€Œè¨€ä¹‹ï¼Œå¦‚æžœä½ è‚¯å®šèƒ½ä¸€èµ·å‘é€å¤šä¸ªæ•°æ®é›†åˆï¼ˆä¾‹å¦‚HTTPå“åº”çš„å¤´å’Œæ­£æ–‡ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å»ºè®®ä½ è®¾ç½®TCP_CORKé€‰é¡¹ï¼Œè¿™æ ·åœ¨è¿™äº›æ•°æ®ä¹‹é—´ä¸å­˜åœ¨å»¶è¿Ÿã€‚ èƒ½æžå¤§åœ°æœ‰ç›ŠäºŽWWWã€FTPä»¥åŠæ–‡ä»¶æœåŠ¡å™¨çš„æ€§èƒ½ï¼ŒåŒæ—¶ä¹Ÿç®€åŒ–äº†ä½ çš„å·¥ä½œã€‚ ä¸ºä»€ä¹ˆtcp_nopushåªæœ‰åœ¨å¼€å¯sendfileåŽæ‰å¯ç”¨ï¼Ÿ ä»ŽæŠ€æœ¯è§’åº¦æ¥çœ‹ï¼Œsendfile()æ˜¯ç£ç›˜å’Œä¼ è¾“æŽ§åˆ¶åè®®ï¼ˆTCPï¼‰ä¹‹é—´çš„ä¸€ç§ç³»ç»Ÿå‘¼å«ï¼Œä½†æ˜¯sendfile()è¿˜èƒ½å¤Ÿç”¨æ¥åœ¨ä¸¤ä¸ªæ–‡ä»¶å¤¹ä¹‹é—´ç§»åŠ¨æ•°æ®ã€‚ åœ¨å„ç§ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šå®žçŽ°sendfile()éƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œå½“ç„¶è¿™ç§ä¸åŒåªæ˜¯æžä¸ºç»†å¾®çš„å·®åˆ«ã€‚é€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬ä¼šå‡å®šæ‰€ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿæ˜¯Linuxæ ¸å¿ƒ2.4ç‰ˆæœ¬ã€‚ ç³»ç»Ÿå‘¼å«çš„åŽŸåž‹æœ‰å¦‚ä¸‹å‡ ç§ï¼š ssize_t sendfile(int out_fd, int in_fd, off_t *offset, size_t count) in_fd æ˜¯ä¸€ç§ç”¨æ¥è¯»æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ out_fd æ˜¯ä¸€ç§ç”¨æ¥å†™æ–‡ä»¶çš„æè¿°ç¬¦ã€‚ Offset æ˜¯ä¸€ç§æŒ‡å‘è¢«è¾“å…¥æ–‡ä»¶å˜é‡ä½ç½®çš„æŒ‡é’ˆï¼Œsendfile()å°†ä¼šä»Žå®ƒæ‰€æŒ‡å‘çš„ä½ç½®å¼€å§‹æ•°æ®çš„è¯»å–ã€‚ Count è¡¨ç¤ºçš„æ˜¯ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¹‹é—´æ•°æ®æ‹·è´çš„å­—èŠ‚æ•°ã€‚ sendfile()çš„å¨åŠ›åœ¨äºŽï¼Œå®ƒä¸ºå¤§å®¶æä¾›äº†ä¸€ç§è®¿é—®å½“å‰ä¸æ–­è†¨èƒ€çš„Linuxç½‘ç»œå †æ ˆçš„æœºåˆ¶ã€‚ è¿™ç§æœºåˆ¶å«åšâ€œé›¶æ‹·è´(zero-copy)â€,è¿™ç§æœºåˆ¶å¯ä»¥æŠŠâ€œä¼ è¾“æŽ§åˆ¶åè®®ï¼ˆTCPï¼‰â€æ¡†æž¶ç›´æŽ¥çš„ä»Žä¸»æœºå­˜å‚¨å™¨ä¸­ä¼ é€åˆ°ç½‘å¡çš„ç¼“å­˜å—ï¼ˆnetwork card buffersï¼‰ä¸­åŽ»ã€‚ ä¸ºäº†æ›´å¥½çš„ç†è§£â€œé›¶æ‹·è´ï¼ˆzero-copyï¼‰â€ä»¥åŠsendfile()ï¼Œè®©æˆ‘ä»¬å›žå¿†ä¸€ä¸‹ä»¥å‰æˆ‘ä»¬åœ¨ä¼ é€æ–‡ä»¶æ—¶æ‰€éœ€è¦æ‰§è¡Œçš„é‚£äº›æ­¥éª¤ã€‚ é¦–å…ˆï¼Œä¸€å—åœ¨ç”¨æˆ·æœºå™¨å­˜å‚¨å™¨å†…ç”¨äºŽæ•°æ®ç¼“å†²çš„ä½ç½®å…ˆè¢«ç¡®å®šäº†ä¸‹æ¥ã€‚ ç„¶åŽï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨read()è¿™æ¡ç³»ç»Ÿå‘¼å«æ¥æŠŠæ•°æ®ä»Žæ–‡ä»¶ä¸­æ‹·è´åˆ°å‰è¾¹å·²ç»å‡†å¤‡å¥½çš„é‚£ä¸ªç¼“å†²åŒºä¸­åŽ»ã€‚ ï¼ˆåœ¨é€šå¸¸çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ“åšä¼šæŠŠæ•°æ®ä»Žç£ç›˜ä¸Šæ‹·è´åˆ°æ“ä½œç³»ç»Ÿçš„é«˜é€Ÿç¼“å†²å­˜å‚¨å™¨ä¸­åŽ»ï¼Œç„¶åŽæ‰ä¼šæŠŠæ•°æ®ä»Žé«˜é€Ÿç¼“å†²å­˜å‚¨å™¨ä¸­æ‹·è´è‡³ç”¨æˆ·ç©ºé—´ä¸­åŽ»ï¼Œè¿™ç§è¿‡ç¨‹å°±æ˜¯æ‰€è°“çš„â€œä¸Šä¸‹æ–‡åˆ‡æ¢â€ã€‚ï¼‰ åœ¨å®Œæˆäº†ä¸Šè¿°çš„é‚£äº›æ­¥éª¤ä¹‹åŽï¼Œæˆ‘ä»¬å¾—ä½¿ç”¨write()ç³»ç»Ÿå‘¼å«æ¥å°†ç¼“å†²åŒºä¸­çš„å†…å®¹å‘é€åˆ°ç½‘ç»œä¸ŠåŽ»ï¼Œç¨‹åºæ®µå¦‚ä¸‹æ‰€ç¤ºï¼š 12345678910111213intout_fd, intin_fd;char buffer[BUFLEN];â€¦/* unsubstantial code skipped for clarity */â€¦read(in_fd, buffer, BUFLEN); /* syscall, make context switch */write(out_fd, buffer, BUFLEN); /* syscall, make context switch */ æ“ä½œç³»ç»Ÿæ ¸å¿ƒä¸å¾—ä¸æŠŠæ‰€æœ‰çš„æ•°æ®è‡³å°‘éƒ½æ‹·è´ä¸¤æ¬¡ï¼šå…ˆæ˜¯ä»Žæ ¸å¿ƒç©ºé—´åˆ°ç”¨æˆ·ç©ºé—´çš„æ‹·è´ï¼Œç„¶åŽè¿˜å¾—å†ä»Žç”¨æˆ·ç©ºé—´æ‹·è´å›žæ ¸å¿ƒç©ºé—´ã€‚ æ¯ä¸€æ¬¡æ“åšéƒ½éœ€è¦ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆcontext-switchï¼‰çš„è¿™ä¸ªæ­¥éª¤ï¼Œå…¶ä¸­åŒ…å«äº†è®¸å¤šå¤æ‚çš„é«˜åº¦å ç”¨CPUçš„æ“ä½œã€‚ ç³»ç»Ÿè‡ªå¸¦çš„å·¥å…·vmstatèƒ½å¤Ÿç”¨æ¥åœ¨ç»å¤§å¤šæ•°UNIXä»¥åŠä¸Žå…¶ç±»ä¼¼çš„æ“ä½œç³»ç»Ÿä¸Šæ˜¾ç¤ºå½“å‰çš„â€œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆcontext-switchï¼‰â€é€ŸçŽ‡ã€‚ è¯·çœ‹å«åšâ€œCSâ€çš„é‚£ä¸€æ ï¼Œæœ‰ç›¸å½“ä¸€éƒ¨åˆ†çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯å‘ç”Ÿåœ¨å–æ ·æœŸé—´çš„ã€‚ç”¨ä¸åŒç±»åž‹çš„æ–¹å¼è¿›è¡Œè£…è½½å¯ä»¥è®©ä½¿ç”¨è€…æ¸…æ¥šçš„çœ‹åˆ°ä½¿ç”¨è¿™äº›å‚æ•°è¿›è¡Œè£…è½½æ—¶çš„ä¸åŒæ•ˆæžœã€‚ åœ¨æœ‰äº†sendfile()é›¶æ‹·è´ï¼ˆzero-copyï¼‰ä¹‹åŽï¼Œå¦‚æžœå¯èƒ½çš„è¯ï¼Œé€šè¿‡ä½¿ç”¨ç›´æŽ¥å­˜å‚¨å™¨è®¿é—®ï¼ˆDirect Memory Accessï¼‰çš„ç¡¬ä»¶è®¾å¤‡ï¼Œæ•°æ®ä»Žç£ç›˜è¯»å–åˆ°æ“ä½œç³»ç»Ÿé«˜é€Ÿç¼“å†²å­˜å‚¨å™¨ä¸­ä¼šå˜å¾—éžå¸¸ä¹‹è¿…é€Ÿã€‚ è€ŒTLBé«˜é€Ÿç¼“å†²å­˜å‚¨å™¨åˆ™è¢«å®Œæ•´æ— ç¼ºçš„æ”¾åœ¨é‚£é‡Œï¼Œæ²¡æœ‰å……æ–¥ä»»ä½•æœ‰å…³æ•°æ®ä¼ è¾“çš„æ–‡ä»¶ã€‚ åº”ç”¨è½¯ä»¶åœ¨ä½¿ç”¨sendfile() primitiveçš„æ—¶å€™ä¼šæœ‰å¾ˆé«˜çš„æ€§èƒ½è¡¨çŽ°ï¼Œè¿™æ˜¯å› ä¸ºç³»ç»Ÿå‘¼å«æ²¡æœ‰ç›´æŽ¥çš„æŒ‡å‘å­˜å‚¨å™¨ï¼Œå› æ­¤ï¼Œå°±æé«˜äº†ä¼ è¾“æ•°æ®çš„æ€§èƒ½ã€‚ é€šå¸¸æ¥è¯´ï¼Œè¦è¢«ä¼ è¾“çš„æ•°æ®éƒ½æ˜¯ä»Žç³»ç»Ÿç¼“å†²å­˜å‚¨å™¨ä¸­ç›´æŽ¥è¯»å–çš„ï¼Œå…¶é—´å¹¶æ²¡æœ‰è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ“ä½œï¼Œä¹Ÿæ²¡æœ‰åžƒåœ¾æ•°æ®å æ®é«˜é€Ÿç¼“å†²å­˜å‚¨å™¨ã€‚ å› æ­¤ï¼Œåœ¨æœåŠ¡å™¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨sendfile()èƒ½å¤Ÿæ˜¾è‘—çš„å‡å°‘å¯¹CPUçš„å ç”¨ã€‚ TCP/IPç½‘ç»œçš„æ•°æ®ä¼ è¾“é€šå¸¸å»ºç«‹åœ¨æ•°æ®å—çš„åŸºç¡€ä¹‹ä¸Šã€‚ä»Žç¨‹åºå‘˜çš„è§‚ç‚¹æ¥çœ‹ï¼Œå‘é€æ•°æ®æ„å‘³ç€å‘å‡ºï¼ˆæˆ–è€…æäº¤ï¼‰ä¸€ç³»åˆ—â€œå‘é€æ•°æ®å—â€çš„è¯·æ±‚ã€‚ åœ¨ç³»ç»Ÿçº§ï¼Œå‘é€å•ä¸ªæ•°æ®å—å¯ä»¥é€šè¿‡è°ƒç”¨ç³»ç»Ÿå‡½æ•°write() æˆ–è€…sendfile() æ¥å®Œæˆã€‚ å› ä¸ºåœ¨ç½‘ç»œè¿žæŽ¥ä¸­æ˜¯ç”±ç¨‹åºå‘˜æ¥é€‰æ‹©æœ€é€‚å½“çš„åº”ç”¨åè®®ï¼Œæ‰€ä»¥ç½‘ç»œåŒ…çš„é•¿åº¦å’Œé¡ºåºéƒ½åœ¨ç¨‹åºå‘˜çš„æŽ§åˆ¶ä¹‹ä¸‹ã€‚åŒæ ·çš„ï¼Œç¨‹åºå‘˜è¿˜å¿…é¡»é€‰æ‹©è¿™ä¸ªåè®®åœ¨è½¯ä»¶ä¸­å¾—ä»¥å®žçŽ°çš„æ–¹å¼ã€‚ TCP/IPåè®®è‡ªèº«å·²ç»æœ‰äº†å¤šç§å¯äº’æ“ä½œçš„å®žçŽ°ï¼Œæ‰€ä»¥åœ¨åŒæ–¹é€šä¿¡æ—¶ï¼Œæ¯ä¸€æ–¹éƒ½æœ‰å®ƒè‡ªèº«çš„ä½Žçº§è¡Œä¸ºï¼Œè¿™ä¹Ÿæ˜¯ç¨‹åºå‘˜æ‰€åº”è¯¥çŸ¥é“çš„æƒ…å†µã€‚ å°½ç®¡æœ‰è®¸å¤šTCPé€‰é¡¹å¯ä¾›ç¨‹åºå‘˜æ“ä½œï¼Œè€Œæˆ‘ä»¬å´æœ€å…³æ³¨å¦‚ä½•å¤„ç½®å…¶ä¸­çš„ä¸¤ä¸ªé€‰é¡¹ï¼Œå®ƒä»¬æ˜¯TCP_NODELAY å’Œ TCP_CORKï¼Œè¿™ä¸¤ä¸ªé€‰é¡¹éƒ½å¯¹ç½‘ç»œè¿žæŽ¥çš„è¡Œä¸ºå…·æœ‰é‡è¦çš„ä½œç”¨ã€‚ è®¸å¤šUNIXç³»ç»Ÿéƒ½å®žçŽ°äº†TCP_NODELAYé€‰é¡¹ï¼Œä½†æ˜¯ï¼ŒTCP_CORKåˆ™æ˜¯Linuxç³»ç»Ÿæ‰€ç‹¬æœ‰çš„è€Œä¸”ç›¸å¯¹è¾ƒæ–°ï¼›å®ƒé¦–å…ˆåœ¨å†…æ ¸ç‰ˆæœ¬2.4ä¸Šå¾—ä»¥å®žçŽ°ã€‚ æ­¤å¤–ï¼Œå…¶ä»–UNIXç³»ç»Ÿç‰ˆæœ¬ä¹Ÿæœ‰åŠŸèƒ½ç±»ä¼¼çš„é€‰é¡¹ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨æŸç§ç”±BSDæ´¾ç”Ÿçš„ç³»ç»Ÿä¸Šçš„TCP_NOPUSHé€‰é¡¹å…¶å®žå°±æ˜¯TCP_CORKçš„ä¸€éƒ¨åˆ†å…·ä½“å®žçŽ°ã€‚ æ€»ç»“ä½ çš„æ•°æ®ä¼ è¾“å¹¶ä¸éœ€è¦æ€»æ˜¯å‡†ç¡®åœ°éµå®ˆæŸä¸€é€‰é¡¹æˆ–è€…å…¶å®ƒé€‰æ‹©ã€‚åœ¨é‚£ç§æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½æƒ³è¦é‡‡å–æ›´ä¸ºçµæ´»çš„æŽªæ–½æ¥æŽ§åˆ¶ç½‘ç»œè¿žæŽ¥ï¼š åœ¨å‘é€ä¸€ç³»åˆ—å½“ä½œå•ä¸€æ¶ˆæ¯çš„æ•°æ®ä¹‹å‰è®¾ç½®TCP_CORKï¼Œè€Œä¸”åœ¨å‘é€åº”ç«‹å³å‘å‡ºçš„çŸ­æ¶ˆæ¯ä¹‹å‰è®¾ç½®TCP_NODELAYã€‚ å¦‚æžœéœ€è¦æä¾›ç½‘ç»œçš„ä¼ è¾“æ•ˆçŽ‡ï¼Œåº”è¯¥å‡å°‘å°åŒ…çš„ä¼ è¾“ï¼Œä½¿ç”¨TCP_CORKæ¥åšæ±‡æ€»ä¼ è¾“ï¼Œåœ¨åˆ©ç”¨sendfileæ¥æé«˜æ•ˆçŽ‡ï¼› ä½†å¦‚æžœæ˜¯äº¤äº’æ€§çš„ä¸šåŠ¡ï¼Œé‚£åº”è¯¥è®©ä»»æ„å°åŒ…å¯ä»¥å¿«é€Ÿä¼ è¾“ï¼Œå…³é—­Nagleç®—æ³•ï¼Œæé«˜åŒ…çš„ä¼ è¾“æ•ˆçŽ‡ã€‚ TCP_CORKä¼˜åŒ–äº†ä¼ è¾“çš„bitsæ•ˆçŽ‡ï¼Œtcp_nodelayä¼˜åŒ–äº†ä¼ è¾“çš„packetæ•ˆçŽ‡ã€‚]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Nginxå­¦ä¹ ç¬”è®°-é…ç½®]]></title>
    <url>%2F2018%2F09%2F07%2FNginx%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E9%85%8D%E7%BD%AE%2F</url>
    <content type="text"><![CDATA[Nginxé…ç½®Nginx åŸºæœ¬é…ç½®æ ¼å¼åŸºæœ¬çš„Nginxé…ç½®æ–‡ä»¶ç”±è‹¥å¹²ä¸ªéƒ¨åˆ†ç»„æˆï¼Œæ¯ä¸€ä¸ªéƒ¨åˆ†éƒ½æ˜¯é€šè¿‡ä¸‹åˆ—æ–¹æ³•å®šä¹‰çš„ã€‚ 123&lt;section&gt; &#123; &lt;directive&gt; &lt;parameters&gt;;&#125; éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸€ä¸ªæŒ‡å®šè¡Œéƒ½ç”±åˆ†å·ç»“æŸï¼Œè¿™æ ‡è®°ç€ä¸€è¡Œçš„ç»“æŸã€‚ å¤§æ‹¬å·å®žé™…ä¸Šè¡¨ç¤ºä¸€ä¸ªæ–°é…ç½®çš„ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰ï¼Œä½†æ˜¯åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æŠŠä»–ä»¬ä½œä¸ºâ€œèŠ‚ã€éƒ¨åˆ†ï¼ˆsectionï¼‰â€æ¥è¯»ã€‚ Nginx å…¨å±€é…ç½®å‚æ•°å…¨å±€é…ç½®éƒ¨åˆ†è¢«ç”¨äºŽé…ç½®å¯¹æ•´ä¸ªserveréƒ½æœ‰æ•ˆçš„å‚æ•°ã€‚ å…¨å±€éƒ¨åˆ†ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šmainå’Œeventséƒ¨åˆ†ã€‚ å…¨å±€å‚æ•°ç¤ºä¾‹ï¼š 123456789101112user root;worker_processes 1;error_log /var/log/nginx/error.log;#error_log logs/error.log notice;#error_log logs/error.log info;pid /run/nginx.pid;events &#123; worker_connections 1024;&#125; å…¨å±€é…ç½®é‡è¦çš„é…ç½®æŒ‡ä»¤ï¼š load_module 123Syntax: load_module file;Default: â€”Context: main åŠ è½½åŠ¨æ€æ¨¡å—ã€‚ User 123Syntax: user user [group];Default: user nobody nobody;Context: main ä½¿ç”¨è¿™ä¸ªå‚æ•°æ¥é…ç½®workerè¿›ç¨‹çš„ç”¨æˆ·å’Œç»„ã€‚å¦‚æžœå¿½ç•¥groupï¼Œé‚£ä¹ˆgroupçš„åå­—ç­‰äºŽè¯¥å‚æ•°æŒ‡å®šç”¨æˆ·çš„ç”¨æˆ·ç»„ã€‚ worker_processes 123Syntax: worker_processes number | auto;Default: worker_processes 1;Context: main æŒ‡å®šworkerè¿›ç¨‹å¯åŠ¨çš„æ•°é‡ã€‚è¿™äº›è¿›ç¨‹ç”¨äºŽå¤„ç†å®¢æˆ·çš„æ‰€æœ‰è¿žæŽ¥ã€‚é€‰æ‹© ä¸€ä¸ªæ­£ç¡®çš„æ•°é‡å–å†³äºŽæœåŠ¡å™¨çŽ¯å¢ƒã€ç£ç›˜å­ç³»ç»Ÿå’Œç½‘ç»œåŸºç¡€è®¾æ–½ã€‚ ä¸€ä¸ªå¥½çš„ç»éªŒæ³•åˆ™æ˜¯è®¾ç½®è¯¥å‚æ•°çš„å€¼ä¸Ž CPU ç»‘å®šçš„è´Ÿè½½å¤„ç†å™¨æ ¸å¿ƒçš„æ•°é‡ç›¸åŒï¼Œå¹¶ç”¨ 1.5ï½ž2 ä¹‹é—´çš„æ•°ä¹˜ä»¥è¿™ä¸ªæ•°ä½œä¸ºI/Oå¯†é›†åž‹è´Ÿè½½ã€‚ worker_priority 123Syntax: worker_priority number;Default: worker_priority 0;Context: main æŒ‡å®šå·¥ä½œè¿›ç¨‹çš„è°ƒåº¦ä¼˜å…ˆçº§ï¼Œå€¼è¶Šå°ä¼˜å…ˆçº§è¶Šå¤§ã€‚å…è®¸èŒƒå›´åœ¨-20åˆ°20ä¹‹é—´å˜åŒ–ã€‚ worker_rlimit_core 123Syntax: worker_rlimit_core size;Default: â€”Context: main é™åˆ¶å·¥ä½œè¿›ç¨‹æ ¸å¿ƒæ–‡ä»¶ï¼ˆrlimit coreï¼‰æœ€å¤§å¤§å°ã€‚ pid 123Syntax: pid file;Default: pid logs/nginx.pid;Context: main è®¾ç½®è®°å½•ä¸»è¿›ç¨‹IDçš„æ–‡ä»¶ï¼Œè¿™ä¸ªé…ç½®å°†ä¼šè¦†ç›–ç¼–è¯‘æ—¶çš„é»˜è®¤é…ç½®ã€‚ use 123Syntax: use method;Default: â€”Context: events è¯¥æŒ‡ä»¤ç”¨äºŽæŒ‡ç¤ºä½¿ç”¨ä»€ä¹ˆæ ·çš„è¿žæŽ¥æ–¹æ³•ï¼Œè¿™ä¸ªé…ç½®å°†ä¼šè¦†ç›–ç¼–è¯‘æ—¶çš„é»˜è®¤é…ç½®ã€‚å¦‚æžœé…ç½®è¯¥æŒ‡ä»¤ï¼Œé‚£ä¹ˆéœ€è¦ä¸€ä¸ªeventsåŒºæ®µã€‚é€šå¸¸ä¸éœ€è¦è¦†ç›–ï¼Œé™¤éžæ˜¯ç¼–è¯‘æ—¶çš„é»˜è®¤å€¼éšç€æ—¶é—´çš„æŽ¨ç§»äº§ç”Ÿé”™è¯¯æ—¶æ‰éœ€è¦è¢«è¦†ç›–è®¾ç½®ã€‚ worker_connections 123Syntax: worker_connections number;Default: worker_connections 512;Context: events è¯¥æŒ‡ä»¤é…ç½®ä¸€ä¸ªå·¥ä½œè¿›ç¨‹èƒ½å¤ŸæŽ¥å—å¹¶å‘è¿žæŽ¥çš„æœ€å¤§æ•°ã€‚è¿™ä¸ªè¿žæŽ¥åŒ…æ‹¬å®¢æˆ·è¿žæŽ¥å’Œå‘ä¸Šæ¸¸æœåŠ¡å™¨çš„è¿žæŽ¥ï¼Œä½†ä¸é™äºŽæ­¤ã€‚è¿™å¯¹äºŽåå‘ä»£ç†æœåŠ¡å™¨å°¤ä¸ºé‡è¦ï¼Œä¸ºäº†è¾¾åˆ°è¿™ä¸ªå¹¶å‘æ€§è¿žæŽ¥æ•°é‡ï¼Œéœ€è¦åœ¨æ“ä½œç³»ç»Ÿå±‚é¢è¿›è¡Œä¸€äº›é¢å¤–è°ƒæ•´ã€‚ daemon 123Syntax: daemon on | off;Default: daemon on;Context: main å®ˆæŠ¤è¿›ç¨‹æ˜¯å¯ä»¥è„±ç¦»ç»ˆç«¯å¹¶ä¸”åœ¨åŽå°è¿è¡Œçš„è¿›ç¨‹ã€‚ä»–è„±ç¦»æ˜¯ä¸ºäº†é¿å…è¿›ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä¿¡æ¯åœ¨ç»ˆç«¯æ‰“å°å‡ºæ¥ï¼Œè¿™æ ·ä¸€æ¥ï¼Œè¿›ç¨‹ä¹Ÿä¸ä¼šè¢«ä»»ä½•ç»ˆç«¯æ‰€äº§ç”Ÿçš„ä¿¡æ¯æ‰“æ–­ã€‚é€šå¸¸ä¸ºäº†è°ƒè¯•å¯ä»¥å…³é—­ã€‚ error_log 123Syntax: error_log file [level];Default: error_log logs/error.log error;Context: main, http, mail, stream, server, location æ‰€æœ‰é”™è¯¯å†™å…¥çš„æ–‡ä»¶ã€‚å¦‚æžœåœ¨å…¶ä»–åŒºæ®µä¸­æ²¡æœ‰è®¾ç½®å…¶ä»–çš„error_logï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¥å¿—æ–‡ä»¶å°†ä¼šè®°å½•æ‰€æœ‰çš„é”™è¯¯ã€‚è¯¥æŒ‡å®šçš„ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šäº†è¢«è®°å½•é”™è¯¯çš„çº§åˆ«ï¼ˆdebugã€infoã€noticeã€warnã€errorã€critã€alertã€emergï¼‰ã€‚æ³¨æ„ï¼Œdebugçº§åˆ«çš„é”™è¯¯åªæœ‰åœ¨ç¼–è¯‘æ—¶é…ç½®äº†â€“with-debugé€‰é¡¹æ‰å¯ä»¥ä½¿ç”¨ã€‚ debug_connection 123Syntax: debug_connection address | CIDR | unix:;Default: â€”Context: events ä¸ºé€‰å®šçš„å®¢æˆ·ç«¯è¿žæŽ¥å¯ç”¨è°ƒè¯•æ—¥å¿—æ¨¡å¼ã€‚å…¶ä»–è¿žæŽ¥å°†ä½¿ç”¨error_logæŒ‡ä»¤è®¾ç½®çš„æ—¥å¿—è®°å½•çº§åˆ« ã€‚è¯•è¿žæŽ¥ç”±IPv4æˆ–IPv6åœ°å€æˆ–ç½‘ç»œæŒ‡å®šã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸»æœºåæŒ‡å®šè¿žæŽ¥ã€‚å¯¹äºŽä½¿ç”¨UNIXåŸŸå¥—æŽ¥å­—çš„è¿žæŽ¥ï¼Œè°ƒè¯•æ—¥å¿—ç”±â€œ unix:â€å‚æ•°å¯ç”¨ã€‚ 123456789events &#123; debug_connection 127.0.0.1; debug_connection localhost; debug_connection 192.0.2.0/24; debug_connection ::1; debug_connection 2001:0db8::/32; debug_connection unix:; ...&#125; debug_points 123Syntax: debug_points abort | stop;Default: â€”Context: main è¿™ä¸ªé…ç½®ç”¨æ¥å¸®åŠ©ç”¨æˆ·è°ƒè¯•Nginxï¼Œä»–æŽ¥æ”¶2ä¸ªå‚æ•°ï¼šstopå’Œabortã€‚Nginxåœ¨ä¸€äº›å…³é”®çš„é”™è¯¯é€»è¾‘ä¸­è®¾ç½®äº†è°ƒè¯•ç‚¹ã€‚å¦‚æžœè®¾ç½®ä¸ºstopï¼Œé‚£ä¹ˆNginxçš„ä»£ç æ‰§è¡Œåˆ°è¿™äº›è°ƒè¯•ç‚¹æ—¶ï¼Œä¼šå‘å‡ºSIGSTOPä¿¡å·ã€‚å¦‚æžœabortï¼Œåˆ™ä¼šäº§ç”Ÿä¸€ä¸ªcoredumpæ–‡ä»¶ã€‚é€šå¸¸ä¸ä¼šç”¨è¿™ä¸ªé…ç½®é¡¹ã€‚ working_directory 123Syntax: working_directory directory;Default: â€”Context: main æŒ‡å®šå·¥ä½œè¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•ï¼Œåº”ç¡®ä¿å·¥ä½œè¿›ç¨‹å…·æœ‰æŒ‡å®šç›®å½•çš„å†™å…¥æƒé™ã€‚ Nginx ä½¿ç”¨includeæ–‡ä»¶åœ¨Nginxé…ç½®æ–‡ä»¶ä¸­ï¼Œincludeæ–‡ä»¶å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ï¼Œä»¥ä¾¿å¢žå¼ºé…ç½®æ–‡ä»¶çš„å¯è¯»æ€§ï¼Œå¹¶ä¸”èƒ½å¤Ÿä½¿å¾—éƒ¨åˆ†é…ç½®æ–‡ä»¶é‡æ–°ä½¿ç”¨ã€‚ ä½¿ç”¨includeæ–‡ä»¶ï¼Œè¦ç¡®ä¿è¢«åŒ…å«çš„æ–‡ä»¶è‡ªèº«æœ‰æ­£ç¡®çš„Nginxè¯­æ³•ï¼Œå³é…ç½®æŒ‡ä»¤å’Œå—ï¼ˆblockï¼‰ï¼Œç„¶åŽæŒ‡å®šè¿™äº›æ–‡ä»¶çš„è·¯å¾„ã€‚ 12# åœ¨è·¯å¾„ä¸­å‡ºçŽ°é€šé…ç¬¦ï¼Œè¡¨ç¤ºå¯ä»¥é…ç½®å¤šä¸ªæ–‡ä»¶ã€‚include /etc/nginx/conf.d/*.conf; Nginx HTTPçš„serveréƒ¨åˆ†å®¢æˆ·ç«¯ç›¸å…³æŒ‡ä»¤chunked_transfer_encoding 123Syntax: chunked_transfer_encoding on | off;Default: chunked_transfer_encoding on;Context: http, server, location åœ¨å‘é€ç»™å®¢æˆ·ç«¯çš„å“åº”ä¸­ï¼Œè¯¥æŒ‡ä»¤å…è®¸ç¦ç”¨http/1.1æ ‡å‡†çš„å—ä¼ è¾“ç¼–ç ã€‚ client_body_buffer_size 123Syntax: client_body_buffer_size size;Default: client_body_buffer_size 8k|16k;Context: http, server, location ä¸ºäº†é˜»æ­¢ä¸´æ—¶æ–‡ä»¶å†™åˆ°ç£ç›˜ï¼Œå¯ä»¥é€šè¿‡è¯¥æŒ‡ä»¤ä¸ºå®¢æˆ·ç«¯è¯·æ±‚ä½“è®¾ç½®ç¼“å­˜å¤§å°ã€‚å¦‚æžœè¯·æ±‚ä¸»ä½“å¤§äºŽç¼“å†²åŒºï¼Œåˆ™æ•´ä¸ªä¸»ä½“æˆ–éƒ¨åˆ†å†™å…¥ä¸´æ—¶æ–‡ä»¶ã€‚é»˜è®¤çš„ç¼“å­˜å¤§å°ä¸ºä¸¤ä¸ªå†…å­˜é¡µé¢ã€‚32ä½ç³»ç»Ÿä¸º8kï¼Œ64ä½ç³»ç»Ÿä¸º16kã€‚ client_body_in_file_only 123Syntax: client_body_in_file_only on | clean | off;Default: client_body_in_file_only off;Context: http, server, location ç”¨äºŽè°ƒè¯•æˆ–è€…è¿›ä¸€æ­¥å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ä½“ã€‚è¯¥æŒ‡ä»¤è®¾ç½®ä¸ºâ€œnoâ€æ—¶èƒ½å¤Ÿå°†å®¢æˆ·ç«¯è¯·æ±‚ä½“å¼ºåˆ¶å†™å…¥åˆ°ç£ç›˜æ–‡ä»¶ï¼›è®¾ç½®ä¸ºâ€œcleanâ€æ—¶ä¼šåˆ é™¤è¯·æ±‚å¤„ç†åŽç•™ä¸‹çš„ä¸´æ—¶æ–‡ä»¶ã€‚ client_body_in_single_buffer 123Syntax: client_body_in_file_only on | clean | off;Default: client_body_in_file_only off;Context: http, server, location ä¸ºäº†å‡å°‘å¤åˆ¶çš„æ“ä½œï¼Œä½¿ç”¨è¯¥æŒ‡ä»¤å¼ºåˆ¶Nginxå°†æ•´ä¸ªå®¢æˆ·ç«¯è¯·æ±‚ä½“ä¿å­˜åœ¨å•ä¸ªç¼“å­˜åŒºä¸­ã€‚ä½¿ç”¨$request_body å˜é‡æ—¶ï¼Œå»ºè®®ä½¿ç”¨è¯¥æŒ‡ä»¤ ï¼Œä»¥èŠ‚çœæ‰€æ¶‰åŠçš„å¤åˆ¶æ“ä½œæ•°ã€‚ client_body_temp_path 123Syntax: client_body_temp_path path [level1 [level2 [level3]]];Default: client_body_temp_path client_body_temp;Context: http, server, location æŒ‡å®šå­˜å‚¨å®¢æˆ·ç«¯è¯·æ±‚ä¸»ä½“çš„ä¸´æ—¶æ–‡ä»¶çš„ç›®å½•ã€‚åœ¨æŒ‡å®šç›®å½•ä¸‹æœ€å¤šå¯ä»¥ä½¿ç”¨ä¸‰çº§å­ç›®å½•å±‚æ¬¡ç»“æž„ã€‚ä¾‹å¦‚åœ¨ä»¥ä¸‹é…ç½®ä¸­ï¼š 1client_body_temp_path /spool/nginx/client_temp 1 2; ä¸´æ—¶æ–‡ä»¶çš„è·¯å¾„ä¸ºå¦‚ä¸‹æ‰€ç¤ºï¼š 1/spool/nginx/client_temp/7/45/00000123457 client_body_timeout 123Syntax: client_body_timeout time;Default: client_body_timeout 60s;Context: http, server, location æŒ‡å®šè¯»å–å®¢æˆ·ç«¯è¯·æ±‚æ­£æ–‡çš„è¶…æ—¶æ—¶é—´ã€‚è¶…æ—¶ä»…è®¾ç½®ä¸ºä¸¤ä¸ªè¿žç»­è¯»å–æ“ä½œä¹‹é—´çš„æ—¶é—´æ®µï¼Œè€Œä¸æ˜¯æ•´ä¸ªè¯·æ±‚ä¸»ä½“çš„ä¼ è¾“ã€‚å¦‚æžœå®¢æˆ·ç«¯åœ¨æ­¤æ—¶é—´å†…æœªä¼ è¾“ä»»ä½•å†…å®¹ï¼Œè¯·æ±‚å°†ä»¥408ï¼ˆè¯·æ±‚è¶…æ—¶ï¼‰é”™è¯¯ç»ˆæ­¢ã€‚ client_header_buffer_size 123Syntax: client_header_buffer_size size;Default: client_header_buffer_size 1k;Context: http, server ä¸ºå®¢æˆ·ç«¯è¯·æ±‚å¤´æŒ‡å®šä¸€ä¸ªç¼“å­˜å¤§å°ï¼Œå½“è¯·æ±‚å¤´å¤§äºŽ1kbæ—¶ä¼šç”¨åˆ°è¿™ä¸ªè®¾ç½®ã€‚ client_header_timeout 123Syntax: client_header_timeout time;Default: client_header_timeout 60s;Context: http, server è¯»å–æ•´ä¸ªå®¢æˆ·ç«¯å¤´çš„è¶…æ—¶æ—¶é—´ã€‚å¦‚æžœå®¢æˆ·ç«¯åœ¨æ­¤æ—¶é—´å†…æœªä¼ è¾“æ•´ä¸ªæ ‡å¤´ï¼Œè¯·æ±‚å°†ä»¥408ï¼ˆè¯·æ±‚è¶…æ—¶ï¼‰é”™è¯¯ç»ˆæ­¢ã€‚ client_max_body_size 123Syntax: client_max_body_size size;Default: client_max_body_size 1m;Context: http, server, location è®¾ç½®å®¢æˆ·ç«¯è¯·æ±‚æ­£æ–‡çš„æœ€å¤§å¤§å°ï¼Œåœ¨â€œContent-Lengthâ€è¯·æ±‚å¤´å­—æ®µä¸­æŒ‡å®šã€‚å¦‚æžœè¯·æ±‚ä¸­çš„å¤§å°è¶…è¿‡é…ç½®çš„å€¼ï¼Œåˆ™ä¼šå°†413ï¼ˆè¯·æ±‚å®žä½“å¤ªå¤§ï¼‰é”™è¯¯è¿”å›žç»™å®¢æˆ·ç«¯ã€‚è®¾ç½®sizeä¸ºâ€œ0â€å°†ç¦ç”¨æ£€æŸ¥å®¢æˆ·ç«¯è¯·æ±‚æ­£æ–‡å¤§å°ã€‚ keepalive_disable 123Syntax: keepalive_disable none | browser ...;Default: keepalive_disable msie6;Context: http, server, location å¯¹æŸäº›ç±»åž‹çš„å®¢æˆ·ç«¯ç¦ç”¨keep-aliveè¯·æ±‚åŠŸèƒ½ã€‚ keepalive_requests 123Syntax: keepalive_requests number;Default: keepalive_requests 100;Context: http, server, location æŒ‡å®šåœ¨ä¸€ä¸ªkeep-aliveè¿žæŽ¥å…³é—­ä¹‹å‰æœ€å¤šå¯ä»¥æŽ¥å—å¤šå°‘ä¸ªè¯·æ±‚ã€‚ keepalive_timeout 123Syntax: keepalive_timeout timeout [header_timeout];Default: keepalive_timeout 75s;Context: http, server, location æŒ‡å®škeep-aliveè¿žæŽ¥è¶…æ—¶æ—¶é—´ï¼Œå³æ´»åŠ¨è¿žæŽ¥èƒ½å¤ŸæŒç»­å¤šä¹…ã€‚è®¾ç½®ä¸ºâ€œ0â€æ—¶ç¦ç”¨keep-aliveè¿žæŽ¥ã€‚ç¬¬äºŒä¸ªå‚æ•°ç”¨äºŽåœ¨å“åº”å¤´ä¸­è®¾ç½®â€œkeepaliveâ€å¤´ã€‚ msie_padding 123Syntax: msie_padding on | off;Default: msie_padding on;Context: http, server, location ä¸ºäº†å¡«å……å“åº”çš„å¤§å°è‡³512å­—èŠ‚ã€‚å¯¹äºŽMSIEå®¢æˆ·ç«¯ï¼Œå¤§äºŽ400çš„çŠ¶æ€ç ä¼šè¢«æ·»åŠ æ³¨é‡Šä»¥ä¾¿æ»¡è¶³512å­—èŠ‚ï¼Œé€šè¿‡å¯ç”¨è¯¥æŒ‡ä»¤å¯ä»¥é˜»æ­¢è¿™ç§è¡Œä¸ºã€‚ msie_refresh 123Syntax: msie_refresh on | off;Default: msie_refresh off;Context: http, server, location å¯¹äºŽMSIEå®¢æˆ·ç«¯ï¼Œè¯¥æŒ‡ä»¤å¯å¯ç”¨å‘é€ä¸€ä¸ªrefreshå¤´ï¼Œè€Œä¸æ˜¯redirectã€‚ æ–‡ä»¶I/Oç›¸å…³æŒ‡ä»¤aioï¼ˆå¼‚æ­¥I/Oï¼‰ 123Syntax: aio on | off | threads[=pool];Default: aio off;Context: http, server, location è¯¥æŒ‡ä»¤å¯ç”¨å¼‚æ­¥æ–‡ä»¶I/Oã€‚è¯¥æŒ‡ä»¤å¯¹äºŽçŽ°ä»£ç‰ˆæœ¬çš„FreeBSDå’Œæ‰€æœ‰çš„Linuxå‘è¡Œç‰ˆéƒ½æœ‰æ•ˆã€‚å¯ç”¨aioæ—¶ä¼šè‡ªåŠ¨å¯ç”¨directioï¼Œå°äºŽdirectioå®šä¹‰çš„å¤§å°çš„æ–‡ä»¶åˆ™é‡‡ç”¨sendfileè¿›è¡Œå‘é€ï¼Œè¶…è¿‡æˆ–ç­‰äºŽdirectioå®šä¹‰çš„å¤§å°çš„æ–‡ä»¶,å°†é‡‡ç”¨aioçº¿ç¨‹æ± è¿›è¡Œå‘é€ã€‚ä¹Ÿå°±æ˜¯è¯´aioå’Œdirectioé€‚åˆå¤§æ–‡ä»¶ä¸‹è½½ï¼Œå› ä¸ºå¤§æ–‡ä»¶ä¸é€‚åˆè¿›å…¥æ“ä½œç³»ç»Ÿçš„buffers/cacheï¼Œè¿™æ ·ä¼šæµªè´¹å†…å­˜ï¼Œè€Œä¸”Linux AIO(å¼‚æ­¥ç£ç›˜IO)ä¹Ÿè¦æ±‚ä½¿ç”¨directioçš„å½¢å¼ã€‚ ä¾‹å¦‚ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243# å¯ç”¨FreeBSDå’ŒLinuxä¸Šä½¿ç”¨å¼‚æ­¥æ–‡ä»¶I/O(AIO)ã€‚location /video/ &#123; aio on; output_buffers 1 64k;&#125;# åœ¨Linuxä¸Šï¼Œå¯ä»¥ä»Žå†…æ ¸ç‰ˆæœ¬2.6.22å¼€å§‹ä½¿ç”¨AIOã€‚æ­¤å¤–ï¼Œéœ€è¦å¯ç”¨ directioï¼Œå¦åˆ™è¯»å–å°†è¢«é˜»æ­¢ã€‚location /video/ &#123; aio on; directio 512; output_buffers 1 128k;&#125;# åœ¨Linuxä¸Šï¼Œ directio åªèƒ½ç”¨äºŽè¯»å–åœ¨512å­—èŠ‚è¾¹ç•Œï¼ˆæˆ–XFSä¸º4Kï¼‰ä¸Šå¯¹é½çš„å—ã€‚# æ–‡ä»¶çš„æœªå¯¹é½ç«¯ä»¥é˜»å¡žæ¨¡å¼è¯»å–ï¼Œç»“å°¾è¯»å–æœªå¯¹é½æ•°æ®å°†è¢«é˜»å¡žã€‚# å½“åœ¨Linuxä¸Šå¯ç”¨AIOå’Œsendfileæ—¶ï¼ŒAIOç”¨äºŽå¤§äºŽæˆ–ç­‰äºŽdirectioæŒ‡ä»¤ä¸­æŒ‡å®šå¤§å°çš„æ–‡ä»¶ã€‚# è€Œsendfileç”¨äºŽå°äºŽdirectioæŒ‡ä»¤ä¸­æŒ‡å®šå¤§å°çš„æ–‡ä»¶æˆ–ç¦ç”¨directioæ—¶ã€‚location /video/ &#123; sendfile on; aio on; directio 8m;&#125;# å¯ä»¥ä½¿ç”¨å¤šçº¿ç¨‹è¯»å–å’Œå‘é€æ–‡ä»¶ï¼Œè€Œä¸ä¼šé˜»æ­¢å·¥ä½œè¿›ç¨‹ã€‚location /video/ &#123; sendfile on; aio threads;&#125;# è¿˜å¯ä»¥æŒ‡å®šè¯»å–å’Œå‘é€æ–‡ä»¶æ“ä½œçš„çº¿ç¨‹æ± ã€‚# å¦‚æžœçœç•¥æ± åç§°ï¼Œåˆ™ä½¿ç”¨åä¸º"default"çš„æ± ã€‚# æ± çš„åç§°å¯ä»¥ä½¿ç”¨å˜é‡è®¾ç½®ã€‚# å¤šçº¿ç¨‹æ”¯æŒä»…åœ¨Linuxå¹³å°ä¸Šå¯ç”¨ï¼Œå¹¶ä¸”åªèƒ½ä¸Žå¤„ç†è¯·æ±‚çš„epollï¼Œkqueueæˆ–eventportæ–¹æ³•ä¸€èµ·ä½¿ç”¨ã€‚aio threads=pool$disk;thread_pool io_pool threads=16; http&#123; ........ location /data&#123; sendfile on; aio threads=io_pool; &#125; &#125; aio_write 123Syntax: aio_write on | off;Default: aio_write off;Context: http, server, location å¦‚æžœå¯ç”¨äº†aioï¼Œåˆ™è¯¥æŒ‡å®šæŒ‡å®šæ˜¯å¦å†™å…¥æ–‡ä»¶ã€‚ç›®å‰ï¼Œè¿™ç§æ–¹æ³•åªåœ¨ä½¿ç”¨aioçº¿ç¨‹æ—¶èµ·ä½œç”¨ï¼Œå¹¶ä¸”ä»…é™äºŽä½¿ç”¨ä»Žä»£ç†æœåŠ¡å™¨æŽ¥æ”¶åˆ°çš„æ•°æ®æ¥ç¼–å†™ä¸´æ—¶æ–‡ä»¶ã€‚ directioï¼ˆç›´æŽ¥I/Oï¼‰ 123Syntax: directio size | off;Default: directio off;Context: http, server, location æ“ä½œç³»ç»Ÿå†…æ ¸é€šå¸¸å°è¯•ä¼˜åŒ–å’Œç¼“å­˜ä»»ä½•è¯»/å†™è¯·æ±‚ã€‚ ç”±äºŽæ•°æ®åœ¨å†…æ ¸ä¸­ç¼“å­˜ï¼Œå¯¹åŒä¸€ä½ç½®çš„ä»»ä½•åŽç»­è¯»å–è¯·æ±‚å°†æ›´å¿«ï¼Œå› ä¸ºä¸éœ€è¦å†ä»Žç£ç›˜è¯»å–ä¿¡æ¯ã€‚ç›´æŽ¥I/Oæ˜¯æ–‡ä»¶ç³»ç»Ÿçš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå…¶ä»Žåº”ç”¨ç¨‹åºåˆ°ç£ç›˜ç›´æŽ¥è¯»å–å’Œå†™å…¥ï¼Œä»Žè€Œç»•è¿‡æ‰€æœ‰æ“ä½œç³»ç»Ÿç¼“å­˜ã€‚ è¿™ä½¿å¾—æ›´å¥½åœ°åˆ©ç”¨CPUå‘¨æœŸå’Œæé«˜ç¼“å­˜æ•ˆçŽ‡ã€‚åœ¨Linuxç³»ç»Ÿä¸‹ï¼Œä½¿ç”¨aioæ—¶éœ€è¦è¦ä½¿ç”¨è¯¥æŒ‡ä»¤ã€‚ directio_alignment 123Syntax: directio_alignment size;Default: directio_alignment 512;Context: http, server, location æŒ‡å®šdirectioçš„å¯¹å…¶æ–¹å¼ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ512å­—èŠ‚å¯¹å…¶å°±è¶³å¤Ÿäº†ã€‚ä½†æ˜¯åœ¨Linuxä½¿ç”¨XFSæ–‡ä»¶ç³»ç»Ÿæ—¶ï¼Œéœ€è¦å°†å…¶å¢žåŠ åˆ°4Kã€‚ open_file_cache 1234Syntax: open_file_cache off; open_file_cache max=N [inactive=time];Default: open_file_cache off;Context: http, server, location è¯¥æŒ‡ä»¤ç”¨äºŽå¯ç”¨ç¼“å­˜é™æ€æ–‡ä»¶çš„å…ƒä¿¡æ¯ã€‚å¯ä»¥ç¼“å­˜ä¿¡æ¯æœ‰ï¼š æ–‡ä»¶çš„æè¿°ç¬¦ï¼ˆfdï¼‰ã€æ–‡ä»¶å¤§å°ï¼ˆsizeï¼‰ã€æœ€åŽä¿®æ”¹æ—¶é—´ï¼ˆlast modified timeï¼‰ã€‚ ç›®å½•å­˜åœ¨çš„ä¿¡æ¯ï¼ˆpathï¼‰ã€‚ æ–‡ä»¶æŸ¥æ‰¾é”™è¯¯ï¼Œä¾‹å¦‚â€œæ‰¾ä¸åˆ°æ–‡ä»¶â€ã€â€œæ²¡æœ‰è¯»å–æƒé™â€œç­‰ã€‚ åº”è¯¥é€šè¿‡open_file_cache_errors æŒ‡ä»¤å•ç‹¬å¯ç”¨æ–‡ä»¶æŸ¥æ‰¾é”™è¯¯ ã€‚ è¯¥æŒ‡ä»¤å…·æœ‰ä»¥ä¸‹å‚æ•°ï¼š maxï¼šè®¾ç½®ç¼“å­˜ä¸­çš„æœ€å¤§å…ƒç´ æ•°ã€‚ åœ¨ç¼“å­˜æº¢å‡ºæ—¶ï¼Œåˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLRUï¼‰çš„å…ƒç´ ã€‚ inactiveï¼šå®šä¹‰ä¸€ä¸ªæ—¶é—´ï¼Œå¦‚æžœåœ¨æ­¤æœŸé—´æœªè®¿é—®è¯¥å…ƒç´ ï¼Œåˆ™ä»Žè¯¥ç¼“å­˜ä¸­åˆ é™¤è¯¥å…ƒç´ ; é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯60ç§’ã€‚ offï¼šç¦ç”¨ç¼“å­˜ã€‚ ä¾‹å¦‚ï¼š 1234open_file_cache max=1000 inactive=20s;open_file_cache_valid 30s;open_file_cache_min_uses 2;open_file_cache_errors on; open_file_cache_errors 123Syntax: open_file_cache_errors on | off;Default: open_file_cache_errors off;Context: http, server, location é€šè¿‡open_file_cacheå¯ç”¨æˆ–ç¦ç”¨æ–‡ä»¶æŸ¥æ‰¾é”™è¯¯çš„ç¼“å­˜ ã€‚ open_file_cache_min_uses 123Syntax: open_file_cache_min_uses number;Default: open_file_cache_min_uses 1;Context: http, server, location open_file_cacheæŒ‡ä»¤ä¸­inactiveå‚æ•°æ—¶é—´å†…æ–‡ä»¶çš„æœ€å°‘ä½¿ç”¨æ¬¡æ•°ã€‚å¦‚æžœåœ¨è®¾ç½®çš„inactiveæ—¶é—´å°‘äºŽè¯¥æŒ‡ä»¤è®¾ç½®çš„ä½¿ç”¨æ¬¡æ•°ï¼Œåˆ™åœ¨ç¼“å­˜å†…åˆ é™¤ã€‚å¦‚æžœè¶…è¿‡è¿™ä¸ªæ•°å­—ï¼Œæ–‡ä»¶æ›´æ”¹ä¿¡æ¯ä¸€ç›´æ˜¯åœ¨ç¼“å­˜ä¸­æ‰“å¼€çš„ã€‚ä¾‹å¦‚ï¼š 123# å¦‚æžœåœ¨60så†…æŸæ–‡ä»¶è¢«è®¿é—®çš„æ¬¡æ•°ä½ŽäºŽ8æ¬¡ï¼Œé‚£å°±å°†å®ƒä»Žç¼“å­˜ä¸­åˆ é™¤ã€‚open_file_cache max=64 inactive=60s;open_file_cache_min_uses 8; open_file_cache_valid 123Syntax: open_file_cache_valid time;Default: open_file_cache_valid 60s;Context: http, server, location éªŒè¯ç¼“å­˜é¡¹æœ‰æ•ˆæ€§çš„æ—¶é—´é—´éš”ã€‚å¦‚æžœç¼“å­˜ä¸­çš„æ–‡ä»¶å…ƒä¿¡æ¯ä¸æ˜¯æœ€æ–°çš„ï¼Œåˆ™æ›´æ–°å®ƒã€‚ postpone_output 123Syntax: postpone_output size;Default: postpone_output 1460;Context: http, server, location è®¾ç½®ä»Žç£ç›˜è¯»å–ç¼“å†²åŒºå“åº”çš„æ•°é‡å’Œå¤§å°ã€‚å¦‚æžœå¯èƒ½ï¼Œå®¢æˆ·ç«¯æ•°æ®ä¼ è¾“å°†è¢«å»¶è¿Ÿï¼Œç›´åˆ°è¾¾åˆ°æ­¤å€¼ã€‚ read_ahead 123Syntax: read_ahead size;Default: read_ahead 0;Context: http, server, location è®¾ç½®ä½¿ç”¨æ–‡ä»¶æ—¶å†…æ ¸çš„é¢„è¯»å–é‡ã€‚åœ¨Linuxä¸Šï¼Œä½¿ç”¨ posix_fadvise(0, 0, 0, POSIX_FADV_SEQUENTIAL) ç³»ç»Ÿè°ƒç”¨ï¼Œå› æ­¤sizeå¿½ç•¥è¯¥å‚æ•°ã€‚ sendfile 123Syntax: sendfile on | off;Default: sendfile off;Context: http, server, location, if in location å½“åº”ç”¨ç¨‹åºä¼ è¾“æ–‡ä»¶æ—¶ï¼Œå†…æ ¸é¦–å…ˆç¼“å†²æ•°æ®ï¼Œç„¶åŽå°†æ•°æ®å‘é€åˆ°åº”ç”¨ç¨‹åºç¼“å†²åŒºã€‚ åº”ç”¨ç¨‹åºåè¿‡æ¥å°†æ•°æ®å‘é€åˆ°ç›®çš„åœ°ã€‚sendfileæ–¹æ³•æ˜¯ä¸€ç§æ”¹è¿›çš„æ•°æ®ä¼ è¾“æ–¹æ³•ï¼Œå…¶ä¸­æ•°æ®åœ¨æ“ä½œç³»ç»Ÿå†…æ ¸ç©ºé—´å†…çš„æ–‡ä»¶æè¿°ç¬¦ä¹‹é—´å¤åˆ¶ï¼Œè€Œä¸å°†æ•°æ®ä¼ è¾“åˆ°åº”ç”¨ç¨‹åºç¼“å†²åŒºã€‚ è¿™ä½¿æ“ä½œç³»ç»Ÿèµ„æºçš„åˆ©ç”¨çŽ‡æé«˜ã€‚ sendfile_max_chunk 123Syntax: sendfile_max_chunk size;Default: sendfile_max_chunk 0;Context: http, server, location è®¾ç½®ä¸ºéžâ€œ0â€å€¼æ—¶ï¼Œé™åˆ¶å•ä¸ªsenfile()è°ƒç”¨ä¸­ä¼ è¾“çš„æ•°æ®é‡ã€‚è¯¥æŒ‡ä»¤ä»¤å¯ä»¥å‡å°‘é˜»å¡žè°ƒç”¨sendfile()æ‰€èŠ±è´¹çš„æœ€é•¿æ—¶é—´ï¼Œå› ä¸ºNGINXä¸ä¼šå°è¯•ä¸€æ¬¡å°†æ•´ä¸ªæ–‡ä»¶å‘é€å‡ºåŽ»ï¼Œè€Œæ˜¯æ¯æ¬¡å‘é€å¤§å°ä¸ºsizeçš„å—æ•°æ®ã€‚ HASHç›¸å…³æŒ‡ä»¤server_names_hash_max_size 123Syntax: server_names_hash_bucket_size size;Default: server_names_hash_bucket_size 32|64|128;Context: http è®¾ç½®æœåŠ¡å™¨åç§°æ•£åˆ—è¡¨çš„â€œæ¡¶â€å¤§å°ã€‚é»˜è®¤å€¼å–å†³äºŽå¤„ç†å™¨ç¼“å­˜è¡Œçš„å¤§å°ã€‚ server_tokens 123Syntax: server_names_hash_max_size size;Default: server_names_hash_max_size 512;Context: http è®¾ç½®æœåŠ¡å™¨åç§°æ•£åˆ—è¡¨çš„æœ€å¤§å¤§å°ã€‚ types_hash_bucket_size 123Syntax: types_hash_bucket_size size;Default: types_hash_bucket_size 64;Context: http, server, location è®¾ç½®ç±»åž‹æ•£åˆ—è¡¨çš„â€œæ¡¶â€å¤§å°ã€‚ types_hash_max_size 123Syntax: types_hash_max_size size;Default: types_hash_max_size 1024;Context: http, server, location è®¾ç½®ç±»åž‹æ•£åˆ—è¡¨çš„æœ€å¤§å¤§å°ã€‚ variables_hash_bucket_size 123Syntax: variables_hash_bucket_size size;Default: variables_hash_bucket_size 64;Context: http è®¾ç½®å˜é‡æ•£åˆ—è¡¨çš„â€œæ¡¶â€å¤§å°ã€‚ variables_hash_max_size 123Syntax: variables_hash_max_size size;Default: variables_hash_max_size 1024;Context: http è®¾ç½®å˜é‡æ•£åˆ—è¡¨çš„æœ€å¤§å¤§å°ã€‚ Socketbç›¸å…³æŒ‡ä»¤lingering_close 123Syntax: lingering_close off | on | always;Default: lingering_close on;Context: http, server, location æŽ§åˆ¶nginxå¦‚ä½•ä¿æŒå®¢æˆ·ç«¯è¿žæŽ¥ã€‚ onï¼šnginx åœ¨å®Œå…¨å…³é—­è¿žæŽ¥ä¹‹å‰ç­‰å¾…å¹¶å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„å…¶ä»–æ•°æ®ã€‚å…ˆå…³é—­tcpè¿žæŽ¥çš„å†™å†å…³é—­è¿žæŽ¥çš„è¯»ã€‚ç›´æŽ¥æ‰§è¡Œå…³é—­è‹¥æ­¤æ—¶nginxçš„tcpçš„write_bufferé‡Œæœ‰æ•°æ®æ²¡æœ‰å‘é€åˆ°å®¢æˆ·ç«¯è€Œread_bufferæœ‰æ•°æ®åˆ™è°ƒç”¨close()ä½¿å¾—nginxç›´æŽ¥è¿”å›žå®¢æˆ·ç«¯RSTå“åº”ï¼Œä¸¢å¼ƒäº†write_bufferé‡Œçš„æ•°æ®ã€‚è‹¥write_bufferé‡Œå­˜å‚¨çš„ä¸ºé”™è¯¯ä¿¡æ¯ï¼Œåˆ™å®¢æˆ·ç«¯æœªæ”¶åˆ°é”™è¯¯ä¿¡æ¯è¿žæŽ¥å·²ç»è¢«æœåŠ¡ç«¯rstäº†ï¼Œåˆ™å®¢æˆ·ç«¯ä¼šè®¤ä¸ºæœåŠ¡ç«¯å¤ªä¸è®²é“ç†äº†ï¼Œä¸å‘ŠçŸ¥é”™è¯¯ä¿¡æ¯å°±ç›´æŽ¥å…³é—­è¿žæŽ¥äº†ã€‚ alwaysï¼šnginxæ— æ¡ä»¶åœ°ç­‰å¾…å¹¶å¤„ç†å…¶ä»–å®¢æˆ·ç«¯æ•°æ®ã€‚ offï¼šç«‹å³å…³é—­è¿žæŽ¥ï¼Œæ­¤è¡Œä¸ºä¼šç ´ååè®®ï¼Œä¸åº”åœ¨æ­£å¸¸æƒ…å†µä¸‹ä½¿ç”¨ã€‚ lingering_time 123Syntax: lingering_time time;Default: lingering_time 30s;Context: http, server, location æŒ‡å®šnginxå¤„ç†ï¼ˆè¯»å–å’Œå¿½ç•¥ï¼‰æ¥è‡ªå®¢æˆ·ç«¯çš„å…¶ä»–æ•°æ®çš„æœ€é•¿æ—¶é—´ã€‚ä¹‹åŽï¼Œå³ä½¿æœ‰æ›´å¤šæ•°æ®ï¼Œè¿žæŽ¥ä¹Ÿå°†å…³é—­ã€‚ lingering_timeout 123Syntax: lingering_timeout time;Default: lingering_timeout 5s;Context: http, server, location æŒ‡å®šæ›´å¤šå®¢æˆ·ç«¯æ•°æ®åˆ°è¾¾çš„æœ€é•¿ç­‰å¾…æ—¶é—´ã€‚å¦‚æžœåœ¨æ­¤æœŸé—´æœªæ”¶åˆ°æ•°æ®ï¼Œåˆ™å…³é—­è¿žæŽ¥ã€‚å¦åˆ™ï¼Œå°†è¯»å–å¹¶å¿½ç•¥å·²ç­‰å¾…çš„æ—¶é—´ï¼Œå¹¶ä¸”nginxä¼šå†æ¬¡å¼€å§‹ç­‰å¾…æ›´å¤šæ•°æ®ã€‚é‡å¤â€œwait-read-ignoreâ€å¾ªçŽ¯ï¼Œä½†ä¸ä¼šè¶…è¿‡lingering_timeæŒ‡ä»¤æŒ‡å®šçš„å¾ªçŽ¯ ã€‚ 123Syntax: reset_timedout_connection on | off;Default: reset_timedout_connection off;Context: http, server, location å¼€å¯æ­¤æŒ‡ä»¤ä¹‹åŽï¼Œè¶…æ—¶çš„è¿žæŽ¥å°†ä¼šè¢«ç«‹å³å…³é—­ï¼Œé‡Šæ”¾ç›¸å…³çš„å†…å­˜ã€‚é»˜è®¤çš„çŠ¶æ€æ˜¯FIN_WAIT1ï¼Œè¿™ç§çŠ¶æ€å°†ä¼šä¸€ç›´ä¿æŒè¿žæŽ¥ã€‚ send_lowat 123Syntax: send_lowat size;Default: send_lowat 0;Context: http, server, location å¦‚æžœè¯¥æŒ‡ä»¤è®¾ç½®ä¸ºéžé›¶å€¼ï¼Œnginxå°†å°è¯•é€šè¿‡ä½¿ç”¨kqueueæ–¹æ³•çš„NOTE_LOWATæ ‡å¿—æˆ–å¥—æŽ¥å­—é€‰é¡¹æ¥æœ€å°åŒ–å®¢æˆ·ç«¯å¥—æŽ¥å­—ä¸Šçš„å‘é€æ“ä½œæ•°ã€‚åœ¨Linuxï¼ŒSolariså’ŒWindowsä¸Šå¿½ç•¥æ­¤æŒ‡ä»¤ã€‚ send_timeout 123Syntax: send_timeout time;Default: send_timeout 60s;Context: http, server, location è¯¥æŒ‡ä»¤è®¾ç½®ä¸¤æ¬¡æˆåŠŸçš„å®¢æˆ·ç«¯æŽ¥æ”¶å“åº”çš„å†™æ“ä½œä¹‹é—´çš„è¶…æ—¶æ—¶é—´ã€‚ä»…åœ¨ä¸¤æ¬¡è¿žç»­å†™æ“ä½œä¹‹é—´è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå“åº”çš„ä¼ è¾“ã€‚å¦‚æžœå®¢æˆ·ç«¯åœ¨æ­¤æ—¶é—´å†…æœªæ”¶åˆ°ä»»ä½•å†…å®¹ï¼Œåˆ™ä¼šå…³é—­è¿žæŽ¥ã€‚ tcp_nodelay 123Syntax: tcp_nodelay on | off;Default: tcp_nodelay on;Context: http, server, location å¯ç”¨æˆ–ç¦ç”¨TCP_NODELAYé€‰é¡¹ï¼Œç”¨äºŽkeep-aliveè¿žæŽ¥ã€‚ç¦ç”¨Nagleç®—æ³•ï¼Œå³æ•°æ®åŒ…ç«‹å³å‘é€å‡ºåŽ»ã€‚ åœ¨ç½‘ç»œæ‹¥å¡žæŽ§åˆ¶é¢†åŸŸï¼Œæœ‰ä¸€ä¸ªéžå¸¸æœ‰åçš„ç®—æ³•å«åšNagleç®—æ³•ï¼ˆNagle algorithmï¼‰ï¼Œè¿™æ˜¯ä½¿ç”¨å®ƒçš„å‘æ˜ŽäººJohn Nagleçš„åå­—æ¥å‘½åçš„ï¼ŒJohn Nagleåœ¨1984å¹´é¦–æ¬¡ç”¨è¿™ä¸ªç®—æ³•æ¥å°è¯•è§£å†³ç¦ç‰¹æ±½è½¦å…¬å¸çš„ç½‘ç»œæ‹¥å¡žé—®é¢˜ï¼ˆRFC 896ï¼‰ï¼Œè¯¥é—®é¢˜çš„å…·ä½“æè¿°æ˜¯ï¼šå¦‚æžœæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸€æ¬¡äº§ç”Ÿ1ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œè€Œè¿™ä¸ª1ä¸ªå­—èŠ‚æ•°æ®åˆä»¥ç½‘ç»œæ•°æ®åŒ…çš„å½¢å¼å‘é€åˆ°è¿œç«¯æœåŠ¡å™¨ï¼Œé‚£ä¹ˆå°±å¾ˆå®¹æ˜“å¯¼è‡´ç½‘ç»œç”±äºŽå¤ªå¤šçš„æ•°æ®åŒ…è€Œè¿‡è½½ã€‚æ¯”å¦‚ï¼Œå½“ç”¨æˆ·ä½¿ç”¨Telnetè¿žæŽ¥åˆ°è¿œç¨‹æœåŠ¡å™¨æ—¶ï¼Œæ¯ä¸€æ¬¡å‡»é”®æ“ä½œå°±ä¼šäº§ç”Ÿ1ä¸ªå­—èŠ‚æ•°æ®ï¼Œè¿›è€Œå‘é€å‡ºåŽ»ä¸€ä¸ªæ•°æ®åŒ…ï¼Œæ‰€ä»¥ï¼Œåœ¨å…¸åž‹æƒ…å†µä¸‹ï¼Œä¼ é€ä¸€ä¸ªåªæ‹¥æœ‰1ä¸ªå­—èŠ‚æœ‰æ•ˆæ•°æ®çš„æ•°æ®åŒ…ï¼Œå´è¦å‘è´¹40ä¸ªå­—èŠ‚é•¿åŒ…å¤´ï¼ˆå³ipå¤´20å­—èŠ‚+tcpå¤´20å­—èŠ‚ï¼‰çš„é¢å¤–å¼€é”€ï¼Œè¿™ç§æœ‰æ•ˆè½½è·ï¼ˆpayloadï¼‰åˆ©ç”¨çŽ‡æžå…¶ä½Žä¸‹çš„æƒ…å†µè¢«ç»Ÿç§°ä¹‹ä¸ºæ„šè ¢çª—å£ç—‡å€™ç¾¤ï¼ˆSilly Window Syndromeï¼‰ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™ç§æƒ…å†µå¯¹äºŽè½»è´Ÿè½½çš„ç½‘ç»œæ¥è¯´ï¼Œå¯èƒ½è¿˜å¯ä»¥æŽ¥å—ï¼Œä½†æ˜¯å¯¹äºŽé‡è´Ÿè½½çš„ç½‘ç»œè€Œè¨€ï¼Œå°±æžæœ‰å¯èƒ½æ‰¿è½½ä¸äº†è€Œè½»æ˜“çš„å‘ç”Ÿæ‹¥å¡žç˜«ç—ªã€‚ tcp_nopush 123Syntax: tcp_nopush on | off;Default: tcp_nopush off;Context: http, server, location ä»…ä¾èµ–äºŽsenfileçš„ä½¿ç”¨ã€‚å®ƒèƒ½å¤Ÿä½¿å¾—Nginxåœ¨ä¸€ä¸ªæ•°æ®åŒ…ä¸­å°è¯•å‘é€å“åº”å¤´ä»¥åŠåœ¨æ•°æ®åŒ…ä¸­å‘é€ä¸€ä¸ªå®Œæ•´çš„æ–‡ä»¶ã€‚tcp_nopushä¸ºonæ—¶ä¼šè°ƒç”¨tcp_corkæ–¹æ³•ï¼Œç»“æžœå°±æ˜¯æ•°æ®åŒ…ä¸ä¼šé©¬ä¸Šä¼ é€å‡ºåŽ»ï¼Œç­‰åˆ°æ•°æ®åŒ…æœ€å¤§æ—¶ï¼Œä¸€æ¬¡æ€§çš„ä¼ è¾“å‡ºåŽ»ï¼Œè¿™æ ·æœ‰åŠ©äºŽè§£å†³ç½‘ç»œå µå¡žã€‚ è™šæ‹ŸæœåŠ¡å™¨ç›¸å…³æŒ‡ä»¤ä»»ä½•ç”±å…³é”®å­—serverå¼€å§‹çš„éƒ¨åˆ†éƒ½è¢«ç§°ä½œâ€œè™šæ‹ŸæœåŠ¡å™¨â€éƒ¨åˆ†ã€‚å®ƒæè¿°çš„æ˜¯ä¸€ç»„æ ¹æ®ä¸åŒçš„server_nameæŒ‡ä»¤é€»è¾‘åˆ†å‰²çš„èµ„æºï¼Œè¿™äº›è™šæ‹ŸæœåŠ¡å™¨å“åº” HTTP è¯·æ±‚ï¼Œå› æ­¤å®ƒä»¬éƒ½åŒ…å«åœ¨httpéƒ¨åˆ†ä¸­ ã€‚ ä¸€ä¸ªè™šæ‹ŸæœåŠ¡å™¨ç”±listenå’Œserver_nameæŒ‡ä»¤ç»„åˆå®šä¹‰ã€‚ ListenæŒ‡ä»¤1234567891011121314151617Syntax: listen address[:port] [default_server] [ssl] [http2 | spdy] [proxy_protocol] [setfib=number] [fastopen=number] [backlog=number] [rcvbuf=size] [sndbuf=size] [accept_filter=filter] [deferred] [bind] [ipv6only=on|off] [reuseport] [so_keepalive=on|off|[keepidle]:[keepintvl]:[keepcnt]]; listen port [default_server] [ssl] [http2 | spdy] [proxy_protocol] [setfib=number] [fastopen=number] [backlog=number] [rcvbuf=size] [sndbuf=size] [accept_filter=filter] [deferred] [bind] [ipv6only=on|off] [reuseport] [so_keepalive=on|off|[keepidle]:[keepintvl]:[keepcnt]]; listen unix:path [default_server] [ssl] [http2 | spdy] [proxy_protocol] [backlog=number] [rcvbuf=size] [sndbuf=size] [accept_filter=filter] [deferred] [bind] [so_keepalive=on|off|[keepidle]:[keepintvl]:[keepcnt]]; Default: listen *:80 | *:8000;Context: server å‚æ•°æ³¨è§£ï¼š default_serverè¯¥å‚æ•°å®šä¹‰è¿™æ ·ä¸€ä¸ªç»„åˆï¼šaddress:port é»˜è®¤çš„è¯·æ±‚è¢«ç»‘å®šåœ¨æ­¤ã€‚ setfibè¯¥å‚æ•°ä¸ºå¥—æŽ¥å­—ç›‘å¬è®¾ç½®å“åº”çš„FIBã€‚è¯¥å‚æ•°ä»…æ”¯æŒFreeBSDï¼Œä¸æ”¯æŒUNIXåŸŸå¥—æŽ¥å­—ã€‚ backlogè¯¥å‚æ•°åœ¨listen()çš„è°ƒç”¨ä¸­è®¾ç½®backlogå‚æ•°è°ƒç”¨ã€‚è¯¥å‚æ•°åœ¨FreeBSDç³»ç»Ÿä¸­é»˜è®¤å€¼ä¸º-1ï¼Œåœ¨å…¶ä»–ç³»ç»Ÿä¸­ä¸º511ã€‚ rcvbufåœ¨å¥—æŽ¥å­—ç›‘å¬ä¸­ï¼Œè¯¥å‚æ•°è®¾ç½®SO_RCVBUGå‚æ•°ã€‚ sndbufåœ¨å¥—æŽ¥å­—ç›‘å¬ä¸­ï¼Œè¯¥å‚æ•°è®¾ç½®SO_SNDBUFå‚æ•°ã€‚ accept_filterè¯¥å‚æ•°è®¾ç½®æŽ¥å—çš„è¿‡æ»¤å™¨ï¼šdatareadyæˆ–è€…httpreadyã€‚è¯¥å‚æ•°ä»…æ”¯æŒFreeBSDã€‚ deferredè¯¥å‚æ•°ä½¿ç”¨å»¶è¿Ÿçš„accept()è°ƒç”¨è®¾ç½®TCP_DEFER_ACCEPTé€‰é¡¹ã€‚è¯¥å‚æ•°ä»…æ”¯æŒLinuxã€‚ bindè¯¥å‚æ•°ä¸ºaddress:portå¥—æŽ¥å­—å¯¹æ‰“å¼€ä¸€ä¸ªå•ç‹¬çš„bind()è°ƒç”¨ã€‚å¦‚æžœä»»ä½•å…¶ä»–ç‰¹å®šå¥—æŽ¥å­—å‚æ•°è¢«ä½¿ç”¨ï¼Œnameä¸€ä¸ªå•ç‹¬çš„bind()å°†ä¼šè¢«éšå¼çš„è°ƒç”¨ã€‚ ipv6onlyè¯¥å‚æ•°è®¾ç½®IPV6_V6ONLYå‚æ•°çš„å€¼ã€‚è¯¥å‚æ•°åªèƒ½åœ¨ä¸€ä¸ªå…¨æ–°çš„å¼€å§‹è®¾ç½®ï¼Œä¸æ”¯æŒUNIXåŸŸå¥—æŽ¥å­—ã€‚ sslè¯¥å‚æ•°è¡¨æ˜Žè¯¥ç«¯å£ä»…æŽ¥å—HTTPSçš„è¿žæŽ¥ã€‚è¯¥å‚æ•°å…è®¸æ›´ç´§å‡‘çš„é…ç½®ã€‚ http2è¯¥å‚æ•°é…ç½®ç«¯å£æŽ¥å—HTTP/2è¿žæŽ¥ã€‚é€šå¸¸sslåº”è¯¥æŒ‡å®šè¯¥å‚æ•°ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥å°†nginxé…ç½®ä¸ºæŽ¥å—æ²¡æœ‰SSLçš„HTTP/2è¿žæŽ¥ã€‚ spdyè¯¥å‚æ•°å…è®¸æŽ¥å— SPDYè¿™ä¸ªç«¯å£ä¸Šçš„è¿žæŽ¥ã€‚é€šå¸¸sslä¹Ÿåº”è¯¥æŒ‡å®šè¯¥å‚æ•°ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥å°†nginxé…ç½®ä¸ºæŽ¥å—ä¸å¸¦SSLçš„SPDYè¿žæŽ¥ã€‚ proxy_protocolè¯¥å‚æ•°å…è®¸æŒ‡å®šåœ¨è¿™ä¸ªç«¯å£ä¸ŠæŽ¥å—çš„æ‰€æœ‰è¿žæŽ¥éƒ½åº”è¯¥ä½¿ç”¨ä»£ç†åè®®ã€‚è¯¥å‚æ•°ä»Žç‰ˆæœ¬1.13.11èµ·æ”¯æŒPROXYåè®®ç‰ˆæœ¬2ã€‚ so_keepaliveè¯¥å‚æ•°ä¸ºTCPç›‘å¬å¥—æŽ¥å­—é…ç½®keepaliveã€‚ server_nameæŒ‡ä»¤123Syntax: server_name name ...;Default: server_name "";Context: server]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[GlusterFSå­¦ä¹ ç¬”è®°-é”™è¯¯è®°å½•]]></title>
    <url>%2F2018%2F09%2F04%2FGlusterFS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95%2F</url>
    <content type="text"><![CDATA[GlusterFSé”™è¯¯è®°å½•é‡ç”¨brickå‡ºçŽ°çš„é—®é¢˜é”™è¯¯ä¿¡æ¯ï¼š volume create: datastore: failed: /bricks/brick1/datastore is already part of a volume. ä»Žglusterfs3.3å¼€å§‹ ï¼Œæœ‰ä¸€ä¸ªæ–°çš„å˜åŒ–å°±æ˜¯ä¼šæ£€æµ‹è¿™ä¸ªç›®å½•æ˜¯å¦å·²ç»åŠ å…¥äº†volumeã€‚è¿™å°±å¯¼è‡´äº†å¾ˆå¤šglusteræ”¯æŒçš„é—®é¢˜ã€‚ å‡å¦‚ä½ ç§»é™¤äº†ä¸€ä¸ªvolumeçš„brickå¹¶ä¸”ç»§ç»­ä½¿ç”¨è¿™ä¸ªvolumeï¼Œç„¶åŽé‡æ–°æ·»åŠ ä¹‹å‰çš„è¿™ä¸ªbrickï¼Œè¿™æ—¶ä½ çš„æ–‡ä»¶çŠ¶æ€å°±ä¼šæ”¹å˜ã€‚å°±ä¼šé€ æˆä¸€ç³»åˆ—çš„é—®é¢˜ï¼Œå®ƒä»¬ä¸­çš„å¤§å¤šæ•°ä¼šå¼•èµ·æ•°æ®ä¸¢å¤±ã€‚ å‡å¦‚ä½ é‡æ–°ä½¿ç”¨ä¸€ä¸ªbrickçš„è¯ï¼Œè¯·ç¡®ä¿ä½ çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆã€‚ è§£å†³åŠžæ³•ï¼š 123setfattr -x trusted.glusterfs.volume-id $brick_pathsetfattr -x trusted.gfid $brick_pathrm -rf $brick_path/.glusterfs ä¾‹å­ï¼š 123setfattr -x trusted.glusterfs.volume-id /bricks/brick1/datastore/setfattr -x trusted.gfid /bricks/brick1/datastore/rm -f /bricks/brick1/.glusterfs/]]></content>
      <categories>
        <category>GlusterFS</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>GlusterFS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ansibleå­¦ä¹ ç¬”è®°-å˜é‡]]></title>
    <url>%2F2018%2F09%2F04%2FAnsible%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%8F%98%E9%87%8F%2F</url>
    <content type="text"><![CDATA[Ansibleå˜é‡æ­¤ç¬”è®°ä¸»è¦æ”¶é›†éžè‡ªå®šä¹‰å˜é‡ï¼Œæ–¹ä¾¿ä»¥åŽç”¨æ—¶æŸ¥è¯¢ã€‚å®˜ç½‘å·²ç»å¾ˆæ–¹ä¾¿äº†ã€‚ã€‚ã€‚ ðŸŒplaybooks variables Factså˜é‡ è‡ªå¸¦å˜é‡ Factså˜é‡ä¸è¯´å¤šäº†ï¼Œéœ€è¦çš„è¯ç”¨setupæŸ¥ã€‚ è‡ªå¸¦å˜é‡è¿™éƒ¨åˆ†æ­å»ºé›†ç¾¤ã€æ£€æŸ¥çŠ¶æ€ã€åšåˆ¤æ–­ç­‰æŒºæœ‰ç”¨çš„ã€‚ hostvarså¯ä»¥åœ¨ä¸€å°ä¸»æœºä¸ŠåŽ»è®¿é—®å¦ä¸€å°ä¸»æœºçš„å˜é‡ï¼ŒåŒ…æ‹¬çš„å¦ä¸€å°ä¸»æœºçš„Factså˜é‡ã€‚ ä¾‹å­ï¼š 123456789# hostvars[åœ¨ä¸»æœºæ¸…å•ä¸­ä¸»æœºåç§°][æƒ³æ”¶é›†çš„Factså˜é‡]...- name: hostvars debug: msg: '&#123;&#123; hostvars["192.168.198.22"]["ansible_distribution"] &#125;&#125;'# å¦‚æžœä½ ä¸»æœºæ¸…å•ä¸­æ²¡æœ‰IPåœ°å€ï¼Œä½†æ˜¯æƒ³å–åˆ°å…¶ä¸­ä¸€å°ä¸»æœºçš„IPåœ°å€çš„è¯ã€‚- name: hostvars debug: msg: '&#123;&#123; hostvars["env2"]["ansible_default_ipv4"]["address"] &#125;&#125;' group_namesåˆ—å‡ºå½“å‰ä¸»æœºæ¸…å•ä¸­æ‰€æœ‰ç»„ã€‚ å¯ä»¥åœ¨jinja2æ¨¡æ¿ä¸­ä½¿ç”¨ï¼Œæ ¹æ®ä¸»æœºæ¸…å•ä¸­ç»„æˆå‘˜æˆ–è€…è§’è‰²æ¥ç”Ÿæˆä¸åŒçš„æ¨¡æ¿æ–‡ä»¶ã€‚ ä¾‹å­ï¼š 123&#123;% if &apos;webserver&apos; in group_names %&#125; # some part of a configuration file that only applies to webservers&#123;% endif %&#125; groupsä¸»æœºæ¸…å•ä¸­æ‰€æœ‰ç»„å’Œä¸»æœºçš„åˆ—è¡¨ï¼Œè¿™ä¸ªå˜é‡æ¯”è¾ƒå¸¸ç”¨ã€‚ ä¾‹å­ï¼š åœ¨jinjia2æ¨¡æ¿ä¸­ä½¿ç”¨Forå¾ªçŽ¯é…ç½®æ‰€æœ‰çš„ä¸»æœºã€‚ 123&#123;% for host in groups[&apos;app_server&apos;] %&#125; &#123;&#123; hostvars[host][&apos;ansible_eth0&apos;][&apos;ipv4&apos;][&apos;address&apos;] &#125;&#125;&#123;% endfor %&#125; æŸ¥æ‰¾æŸä¸ªç»„ä¸­æ‰€æœ‰ä¸»æœºçš„IPåœ°å€ã€‚ 123&#123;% for host in groups[&apos;app_servers&apos;] %&#125; &#123;&#123; hostvars[host][&apos;ansible_eth0&apos;][&apos;ipv4&apos;][&apos;address&apos;] &#125;&#125;&#123;% endfor %&#125; æˆ‘åœ¨mongodbè„šæœ¬æ¨¡æ¿ä¸­ç”¨åˆ°çš„ä¾‹å­ï¼š 12345678use adminconfig=&#123;_id:&apos;&#123;&#123; mongodb_replication_replset &#125;&#125;&apos;,members:[&#123;&#123;%- for host in groups.mongodb -%&#125;_id:&#123;&#123; loop.index0 &#125;&#125;,host:&apos;&#123;&#123; host &#125;&#125;:&#123;&#123; mongodb_net_port &#125;&#125;&apos;&#123;%- if arbiteronly is defined and arbiteronly -%&#125;,arbiterOnly:true&#123;%- endif -%&#125;&#123;%- if not loop.last -%&#125; &#125;,&#123; &#123;%- endif -%&#125;&#123;%- endfor -%&#125;&#125;]&#125;;rs.initiate(config) inventory_hostnameä¸»æœºæ¸…å•ä¸­é…ç½®çš„ä¸»æœºåçš„åç§°ã€‚ ä¾‹å­ï¼š 123- name: inventory hostname debug: msg: '&#123;&#123; inventory_hostname &#125;&#125;' è¿”å›žï¼š 12345678910TASK [inventory hostname] ************************************************************************************ok: [mongodb-node1.emm] =&gt; &#123; &quot;msg&quot;: &quot;mongodb-node1.emm&quot;&#125;ok: [mongodb-node2.emm] =&gt; &#123; &quot;msg&quot;: &quot;mongodb-node2.emm&quot;&#125;ok: [mongodb-node3.emm] =&gt; &#123; &quot;msg&quot;: &quot;mongodb-node3.emm&quot;&#125; å¦‚æžœä¸»æœºåç§°æ—¶ä¸€ä¸ªå¾ˆé•¿çš„FQDNï¼Œå¯ä»¥ä½¿ç”¨inventory_hostname_shortèŽ·å–ç¬¬ä¸€ä¸ªå¥å·ä¹‹å‰çš„åç§°ã€‚ ä¾‹å­ï¼š 123- name: short inventory hostname debug: msg: '&#123;&#123; inventory_hostname_short &#125;&#125;' è¿”å›žï¼š 12345678910TASK [short inventory hostname] ************************************************************************************ok: [mongodb-node1.emm] =&gt; &#123; "msg": "mongodb-node1"&#125;ok: [mongodb-node2.emm] =&gt; &#123; "msg": "mongodb-node2"&#125;ok: [mongodb-node3.emm] =&gt; &#123; "msg": "mongodb-node3"&#125; ansible_play_hostsä¸»æœºæ¸…å•ä¸­æ‰€æœ‰æ´»åŠ¨çŠ¶æ€çš„ä¸»æœºååˆ—è¡¨ã€‚ 123- name: ansible play hosts debug: msg: '&#123;&#123; ansible_play_hosts &#125;&#125;' è¿”å›žï¼š 12345678TASK [ansible play hosts] ************************************************************************************ok: [mongodb-node1.emm] =&gt; &#123; &quot;msg&quot;: [ &quot;mongodb-node1.emm&quot;, &quot;mongodb-node2.emm&quot;, &quot;mongodb-node3.emm&quot; ]&#125; ansible_play_batchAnsible 2.2ç‰ˆæœ¬ä¹‹å‰ä¸ºplay_hostsã€‚ å½“å‰Playä¸­æ‰¹é‡è¿è¡Œä¸­çš„ä¸»æœºååˆ—è¡¨ã€‚ æ‰¹é‡å¤§å°ç”±serialå®šä¹‰ï¼Œå¦‚æžœserialæœªå®šä¹‰åˆ™ç›¸å½“äºŽansible_play_hostså˜é‡ã€‚ ä¾‹å­ï¼š ä¸ä½¿ç”¨serialæ—¶ï¼š 123- name: ansible play batch debug: msg: '&#123;&#123; ansible_play_batch &#125;&#125;' è¿”å›žï¼š 12345678TASK [ansible play batch] ************************************************************************************ok: [mongodb-node1.emm] =&gt; &#123; "msg": [ "mongodb-node1.emm", "mongodb-node2.emm", "mongodb-node3.emm" ]&#125; ä½¿ç”¨serialåšæ‰¹é‡è¿è¡Œæ—¶ï¼Œè¿”å›žï¼š 123456- hosts: mongodb serial: 1 tasks: - name: ansible play batch debug: msg: '&#123;&#123; ansible_play_batch &#125;&#125;' è¿”å›žçš„æ˜¯å½“å‰æ‰¹æ¬¡çš„ä¸»æœºååˆ—è¡¨ï¼š 123456TASK [ansible play batch] ************************************************************************************ok: [mongodb-node3.emm] =&gt; &#123; "msg": [ "mongodb-node3.emm" ]&#125; ansible_playbook_pythonè°ƒç”¨Ansibleå‘½ä»¤è¡Œå·¥å…·çš„pythonå¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ã€‚ inventory_dirAnsibleä¸»æœºæ¸…å•æ–‡ä»¶çš„ç›®å½•ã€‚ inventory_fileAnsibleä¸»æœºæ¸…å•æ–‡ä»¶çš„è·¯å¾„ã€‚ playbook_diræ‰§è¡ŒPlaybookçš„æ ¹ç›®å½•ã€‚ role_pathè§’è‰²çš„è·¯å¾„ã€‚ ansible_check_modeå¦‚æžœæ­¤å˜é‡è®¾ç½®ä¸ºTrueï¼Œåˆ™è¿è¡ŒPlaybookæ—¶ä¼šæ·»åŠ --checké€‰é¡¹ã€‚]]></content>
      <categories>
        <category>Ansible</category>
      </categories>
      <tags>
        <tag>Ansible</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ansibleå­¦ä¹ ç¬”è®°-æŒ‡ä»¤]]></title>
    <url>%2F2018%2F09%2F04%2FAnsible%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E6%8C%87%E4%BB%A4%2F</url>
    <content type="text"><![CDATA[Ansibleå¸¸ç”¨æŒ‡ä»¤Play æŒ‡ä»¤ è¯´æ˜Ž accelerate å¼€å¯åŠ é€Ÿæ¨¡å¼ accelerate_ipv6 æ˜¯å¦å¼€å¯ipv6 accelerate_port åŠ é€Ÿæ¨¡å¼çš„ç«¯å£ always_run any_errors_fatal æœ‰ä»»åŠ¡é”™è¯¯æ—¶ï¼Œç«‹å³åœæ­¢ become æ˜¯å¦ææƒ become_flags ææƒå‘½ä»¤çš„å‚æ•° become_method ææƒå¾—æ–¹å¼ become_user ææƒçš„ç”¨æˆ· check_mode å½“ä¸ºTrueæ—¶ï¼Œåªæ£€æŸ¥ï¼Œä¸åšä¿®æ”¹ connection è¿žæŽ¥æ–¹å¼ environment å®šä¹‰è¿œç«¯ç³»ç»Ÿçš„çŽ¯å¢ƒå˜é‡ force_handlers ä»»åŠ¡å¤±è´¥åŽï¼Œæ˜¯å¦ä¾ç„¶æ‰§è¡Œhandlersä¸­çš„ä»»åŠ¡ gather_facts æ˜¯å¦èŽ·å–è¿œç«¯ç³»ç»Ÿå¾—facts gather_subset èŽ·å–factså¾—å“ªäº›é”®å€¼ gather_timeout èŽ·å–factsçš„è¶…æ—¶æ—¶é—´ handlers å®šä¹‰taskæ‰§è¡Œå®Œæˆä»¥åŽéœ€è¦è°ƒç”¨çš„ä»»åŠ¡ hosts æŒ‡å®šè¿è¡Œå¾—ä¸»æœº ignore_errors æ˜¯å¦å¿½ç•¥é”™è¯¯ max_fail_percentage æœ€å¤§çš„é”™è¯¯ä¸»æœºæ•°ï¼Œè¶…è¿‡åˆ™ç«‹å³åœæ­¢ansbile name å®šä¹‰ä»»åŠ¡å¾—åç§° no_log ä¸è®°å½•æ—¥å¿— port å®šä¹‰sshçš„è¿žæŽ¥ç«¯å£ post_tasks æ‰§è¡Œä»»åŠ¡åŽè¦æ‰§è¡Œçš„ä»»åŠ¡ pre_tasks æ‰§è¡Œä»»åŠ¡å‰è¦æ‰§è¡Œçš„ä»»åŠ¡ remote_user è¿œç¨‹ç™»é™†çš„ç”¨æˆ· roles å®šä¹‰è§’è‰² run_once ä»»åŠ¡åªè¿è¡Œä¸€æ¬¡ serial ä»»åŠ¡æ¯æ¬¡æ‰§è¡Œçš„ä¸»æœºæ•° strategy playè¿è¡Œçš„æ¨¡å¼ tags æ ‡è®°æ ‡ç­¾ tasks å®šä¹‰ä»»åŠ¡ vars å®šä¹‰å˜é‡ vars_files åŒ…å«å˜é‡æ–‡ä»¶ vars_prompt è¦æ±‚ç”¨æˆ·è¾“å…¥å†…å®¹ vault_password åŠ å¯†å¯†ç  Role æŒ‡ä»¤ è¯´æ˜Ž always_run become æ˜¯å¦ææƒ become_flags ææƒå‘½ä»¤çš„å‚æ•° become_method ææƒçš„æ–¹å¼ become_user ææƒçš„ç”¨æˆ· check_mode å½“ä¸ºTrueæ—¶ï¼Œåªæ£€æŸ¥ï¼Œä¸åšä¿®æ”¹ connection è¿žæŽ¥æ–¹å¼ delegate_facts å§”æ‰˜facts delegate_to ä»»åŠ¡å§”æ´¾ environment å®šä¹‰è¿œç«¯ç³»ç»Ÿçš„çŽ¯å¢ƒå˜é‡ ignore_errors æ˜¯å¦å¿½ç•¥é”™è¯¯ no_log ä¸è®°å½•æ—¥å¿— port å®šä¹‰sshçš„è¿žæŽ¥ç«¯å£ remote_user è¿œç«¯ç³»ç»Ÿçš„æ‰§è¡Œç”¨æˆ· run_once åªè¿è¡Œä¸€æ¬¡ tags æ ‡è®°æ ‡ç­¾ vars å®šä¹‰å˜é‡ when æ¡ä»¶è¡¨è¾¾å¼ç»“æžœä¸ºTrueåˆ™æ‰§è¡Œblock Block æŒ‡ä»¤ è¯´æ˜Ž always alwaysé‡Œçš„ä»»åŠ¡æ€»æ˜¯æ‰§è¡Œ always_run any_errors_fatal æœ‰é”™è¯¯æ—¶ç«‹å³ä¸­æ–­ansbile become æ˜¯å¦ææƒ become_flags ææƒå‘½ä»¤çš„å‚æ•° become_method ææƒçš„æ–¹å¼ become_user ææƒçš„ç”¨æˆ· block åˆ†ç»„æ‰§è¡Œ check_mode å½“ä¸ºTrueæ—¶ï¼Œåªæ£€æŸ¥ï¼Œä¸åšä¿®æ”¹ connection è¿žæŽ¥æ–¹å¼ delegate_facts å§”æ‰˜facts delegate_to ä»»åŠ¡å§”æ´¾ environment å®šä¹‰è¿œç«¯ç³»ç»Ÿçš„çŽ¯å¢ƒå˜é‡ ignore_errors æ˜¯å¦å¿½ç•¥é”™è¯¯ no_log ä¸è®°å½•æ—¥å¿— port å®šä¹‰sshçš„è¿žæŽ¥ç«¯å£ remote_user è¿œç«¯ç³»ç»Ÿçš„æ‰§è¡Œç”¨æˆ· rescue blockä¸­çš„ä»»åŠ¡åœ¨æ‰§è¡Œä¸­ï¼Œå¦‚æžœæœ‰ä»»ä½•é”™è¯¯ï¼Œå°†æ‰§è¡Œrescueä¸­çš„ä»»åŠ¡ã€‚ run_once åªè¿è¡Œä¸€æ¬¡ tags æ ‡è®°æ ‡ç­¾ vars å®šä¹‰å˜é‡ when æ¡ä»¶è¡¨è¾¾å¼ç»“æžœä¸ºTrueåˆ™æ‰§è¡Œblock Task è¯´æ˜Ž action æ‰§è¡ŒåŠ¨ä½œ always_run any_errors_fatal ä¸ºTrueæ—¶ï¼Œåªè¦ä»»åŠ¡æœ‰é”™è¯¯ï¼Œå°±ç«‹å³åœæ­¢ansible args å®šä¹‰ä»»åŠ¡å¾—å‚æ•° async æ˜¯å¦å¼‚æ­¥æ‰§è¡Œä»»åŠ¡ become æ˜¯å¦ææƒ become_flags ææƒå‘½ä»¤çš„å‚æ•° become_method ææƒçš„æ–¹å¼ become_user ææƒçš„ç”¨æˆ· changed_when æ¡ä»¶è¡¨è¾¾å¼ä¸ºTrueæ—¶ï¼Œä½¿ä»»åŠ¡çŠ¶æ€ä¸ºchanged check_mode ä¸ºTrueæ—¶ï¼Œåªæ£€æŸ¥è¿è¡ŒçŠ¶æ€ï¼Œåœ¨è¿œç«¯ä¸åšä»»ä½•ä¿®æ”¹ connection è¿žæŽ¥æ–¹å¼ delay ç­‰å¾…å¤šå°‘ç§’ï¼Œæ‰æ‰§è¡Œä»»åŠ¡ delegate_facts å§”æ‰˜facts delegate_to ä»»åŠ¡å§”æ´¾ environment å®šä¹‰è¿œç«¯çš„çŽ¯å¢ƒå˜é‡ failed_when æ¡ä»¶è¡¨è¾¾å¼ä¸ºTrueæ—¶ï¼Œä½¿ä»»åŠ¡ä¸ºå¤±è´¥çŠ¶æ€ ignore_errors æ˜¯å¦å¿½ç•¥é”™è¯¯ local_action æœ¬åœ°æ‰§è¡Œ loop loop_args loop_control æ”¹å˜å¾ªçŽ¯çš„å˜é‡é¡¹ name å®šä¹‰äººç‰©çš„åç§° no_log ä¸è®°å½•æ—¥å¿— notify ç”¨äºŽä»»åŠ¡æ‰§è¡Œå®Œï¼Œæ‰§è¡Œhandlersé‡Œçš„ä»»åŠ¡ poll è½®è¯¢æ—¶é—´ port å®šä¹‰sshçš„è¿žæŽ¥ç«¯å£ register æ³¨å†Œå˜é‡ remote_user è¿œç«¯ç³»ç»Ÿçš„æ‰§è¡Œç”¨æˆ· retries é‡è¯•æ¬¡æ•° run_once åªè¿è¡Œä¸€æ¬¡ tags æ ‡è®°ä¸ºæ ‡ç­¾ until ç›´åˆ°ä¸ºçœŸæ—¶ï¼Œæ‰ç»§ç»­æ‰§è¡Œä»»åŠ¡ vars å®šä¹‰å˜é‡ when æ¡ä»¶è¡¨è¾¾å¼ï¼Œç»“æžœä¸ºTrueåˆ™æ‰§è¡Œtask with_&lt;lookup_plugin&gt; å¾ªçŽ¯ å‚è€ƒé“¾æŽ¥ðŸŒ [Ansible å°æ‰‹å†Œç³»åˆ— åä¹ï¼ˆå¸¸è§æŒ‡ä»¤è¡¨ï¼‰ ]]]></content>
      <categories>
        <category>Ansible</category>
      </categories>
      <tags>
        <tag>Ansible</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[GlusterFSå­¦ä¹ ç¬”è®°-éƒ¨ç½²ä¸Žç®¡ç†]]></title>
    <url>%2F2018%2F08%2F31%2FGlusterFS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E9%83%A8%E7%BD%B2%E4%B8%8E%E7%AE%A1%E7%90%86%2F</url>
    <content type="text"><![CDATA[GlusterFSé›†ç¾¤æ­å»ºç®€ä»‹Glusterfsæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚å…·æœ‰å¼ºå¤§çš„æ¨ªå‘æ‰©å±•èƒ½åŠ›ï¼Œé€šè¿‡æ‰©å±•èƒ½å¤Ÿæ”¯æŒæ•°PBå­˜å‚¨å®¹é‡å’Œå¤„ç†æ•°åƒå®¢æˆ·ç«¯ã€‚ GlusterFSå€ŸåŠ©TCP/IPæˆ–InfiniBand RDMAï¼ˆä¸€ç§æ”¯æŒå¤šå¹¶å‘é“¾æŽ¥çš„â€œè½¬æ¢çº¿ç¼†â€æŠ€æœ¯ï¼‰ç½‘ç»œå°†ç‰©ç†åˆ†å¸ƒçš„å­˜å‚¨èµ„æºèšé›†åœ¨ä¸€èµ·ï¼Œä½¿ç”¨å•ä¸€å…¨å±€å‘½åç©ºé—´æ¥ç®¡ç†æ•°æ®ã€‚ éƒ¨ç½²Glusterfså±žäºŽC/Sæž¶æž„ï¼Œå³å®¢æˆ·ç«¯ã€æœåŠ¡ç«¯ï¼Œåˆ†åˆ«å®‰è£…ã€‚ è¯•éªŒçŽ¯å¢ƒï¼š GFSèŠ‚ç‚¹ IP ç£ç›˜ gfs-node1 192.168.198.22 sdb:2G gfs-node2 192.168.198.23 sdb:2G gfs-client 192.168.198.21 æœåŠ¡ç«¯é…ç½®hostæ–‡ä»¶åœ¨gfs-node1å’Œgfs-node2åšä»¥ä¸‹æ“ä½œï¼š 123&gt; vi /etc/hosts192.168.198.22 gfs-node1192.168.198.23 gfs-node2 åˆå§‹åŒ–ç£ç›˜åœ¨gfs-node1å’Œgfs-node2åšä»¥ä¸‹æ“ä½œï¼š æ¯å°ä¸»æœºæ·»åŠ ä¸€å—2Gç£ç›˜ã€‚ åˆå§‹åŒ–ç£ç›˜ï¼š 123456789101112# æ ¼å¼åŒ–ç£ç›˜&gt; mkfs.xfs -i size=512 /dev/sdb# åˆ›å»ºå—ç›®å½•&gt; mkdir -p /bricks/brick1# æ·»åŠ è®¾å¤‡&gt; vi /etc/fstab/dev/sdb /bricks/brick1 xfs defaults 1 2# æŒ‚è½½ç£ç›˜&gt; mount -a &amp;&amp; mount# æŸ¥çœ‹ç£ç›˜&gt; df -Th/dev/sdb xfs 2.0G 33M 2.0G 2% /bricks/brick1 CentOS 6ï¼š éœ€è¦å®‰è£…xfsprogsæ”¯æŒxfsæ–‡ä»¶ç³»ç»Ÿã€‚ å®‰è£…å¯åŠ¨åœ¨gfs-node1å’Œgfs-node2åšä»¥ä¸‹æ“ä½œï¼š å®‰è£… 1234# ä½¿ç”¨Storage SIG Yum Repos&gt; yum -y install centos-release-gluster# å®‰è£…GlusterFSæœåŠ¡&gt; yum -y install glusterfs-server 12345# ä½¿ç”¨epelï¼ŒåŒæ ·æ¥è‡ªäºŽStorage SIG&gt; yum search centos-release-glustercentos-release-gluster41.noarch : Gluster 4.1 (Long Term Stable) packages from the CentOS Storage SIG&gt; yum -y install centos-release-gluster41.noarch&gt; yum -y install glusterfs-server Storage SIGè¿˜ä¸ºGlsuterFSæä¾›å…¶ä»–ç”Ÿæ€ç³»ç»ŸåŒ…ï¼ˆä¾‹å¦‚Sambaï¼‰ï¼š ðŸŒ Other ecosystem packages for GlusterFS in Storage SIG å¯åŠ¨ 12&gt; systemctl start glusterd&gt; systemctl enable glusterd å…³é—­é˜²ç«å¢™åœ¨gfs-node1å’Œgfs-node2åšä»¥ä¸‹æ“ä½œï¼š 12&gt; systemctl stop firewalld&gt; systemctl disable firewalld é…ç½®ä¿¡ä»»æ± åœ¨gfs-node1æˆ–gfs-node2åšä»¥ä¸‹æ“ä½œï¼š 12345678910111213# å°†åˆ†å¸ƒå¼å­˜å‚¨ä¸»æœºåŠ å…¥åˆ°ä¿¡ä»»ä¸»æœºæ± # gfs-node1ä¸»æœºä¸Šæ“ä½œ&gt; gluster peer probe gfs-node2peer probe: success.# æŸ¥çœ‹ä¿¡ä»»ä¸»æœºæ± # æ­¤æ—¶æ˜¯åœ¨gfs-node1ä¸ŠæŸ¥çœ‹çš„ï¼Œå¦‚æžœåœ¨gfs-node2ä¸»æœºä¸ŠæŸ¥çœ‹ä¼šå‘çŽ°gfs-node2ä¹Ÿä¿¡ä»»äº†gfs-node1&gt; gluster peer statusNumber of Peers: 1Hostname: gfs-node2Uuid: 6fd442f2-7dbb-4c09-9655-cfab606ad397State: Peer in Cluster (Connected) åˆ›å»ºå¤åˆ¶å·åœ¨gfs-node1æˆ–gfs-node2åšä»¥ä¸‹æ“ä½œï¼š 1234567891011121314151617181920212223242526272829303132333435363738# åˆ›å»ºå¤åˆ¶å·# gfs-node1ä¸»æœºä¸Šæ“ä½œ&gt; gluster volume create datastore replica 2 transport tcp gfs-node1:/bricks/brick1 gfs-node2:/bricks/brick1 forcevolume create: datastore: success: please start the volume to access data# å¯åŠ¨å·&gt; gluster volume start datastore volume start: datastore: success# æŸ¥çœ‹å·ä¿¡æ¯&gt; gluster volume info datastoreVolume Name: datastoreType: ReplicateVolume ID: 8404aecb-7ead-431d-b163-3bb3e40442d6Status: StartedSnapshot Count: 0Number of Bricks: 1 x 2 = 2Transport-type: tcpBricks:Brick1: gfs-node1:/bricks/brick1Brick2: gfs-node2:/bricks/brick1Options Reconfigured:transport.address-family: inetnfs.disable: onperformance.client-io-threads: off# æŸ¥çœ‹å·çŠ¶æ€&gt; gluster volume status datastoreStatus of volume: datastoreGluster process TCP Port RDMA Port Online Pid------------------------------------------------------------------------------Brick gfs-node1:/bricks/brick1 49152 0 Y 1985 Brick gfs-node2:/bricks/brick1 49152 0 Y 1742 Self-heal Daemon on localhost N/A N/A Y 2008 Self-heal Daemon on gfs-node2 N/A N/A Y 1765 Task Status of Volume datastore------------------------------------------------------------------------------ å®¢æˆ·ç«¯é…ç½®hostæ–‡ä»¶123&gt; vi /etc/hosts192.168.198.22 gfs-node1192.168.198.23 gfs-node2 å…³é—­é˜²ç«å¢™12&gt; systemctl stop firewalld&gt; systemctl disable firewalld å®‰è£…æŒ‚è½½ å®‰è£… 1234# ä½¿ç”¨Storage SIG Yum Repos&gt; yum -y install centos-release-gluster# å®‰è£…GlusterFSæœåŠ¡&gt; yum -y install glusterfs glusterfs-fuse æŒ‚è½½ 123456789# æ‰‹åŠ¨æŒ‚è½½&gt; mount -t glusterfs gfs-node1:/datastore /opt/test # è‡ªåŠ¨æŒ‚è½½&gt; vi /etc/fstabgfs-node1:/datastore /opt/test glusterfs defaults,_netdev,log-level=WARNING,log-file=/var/log/gluster.log 0 0&gt; mount -a &amp;&amp; mountgfs-node1:/datastore on /opt/test type fuse.glusterfs (rw,relatime,user_id=0,group_id=0,default_permissions,allow_other,max_read=131072) ç®¡ç†èŠ‚ç‚¹ç®¡ç†èŠ‚ç‚¹çŠ¶æ€1gluster peer status æ·»åŠ èŠ‚ç‚¹1gluster peer probe &lt;server&gt; åˆ é™¤èŠ‚ç‚¹1gluster peer detach &lt;server&gt; å·ç®¡ç†åˆ›å»ºå·1gluster volume create [stripe | replica | disperse] [transport tcp | rdma | tcp,rdma] åˆ†å¸ƒå¼å·åˆ†å¸ƒå¼å·ï¼ˆDistributed Glusterfs Volumeï¼Œåˆç§°DHTï¼‰ï¼Œé»˜è®¤åˆ›å»ºå³ä¸ºåˆ†å¸ƒå¼å·ã€‚ 1gluster volume create NEW-VOLNAME [transport tcp | rdma | tcp,rdma] NEW-BRICK... ç‰¹ç‚¹ï¼š æ ¹æ®hashç®—æ³•ï¼Œå°†å¤šä¸ªæ–‡ä»¶åˆ†å¸ƒåˆ°å·ä¸­çš„å¤šä¸ªbrick serverä¸Šï¼Œç±»ä¼¼ï¼ˆä¸æ˜¯ï¼‰raid0ï¼Œä½†æ–‡ä»¶æ— åˆ†ç‰‡ã€‚ æ–¹ä¾¿æ‰©å±•ç©ºé—´ï¼Œä½†æ— å†—ä½™ä¿æŠ¤ã€‚ ç”±äºŽä½¿ç”¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå­˜å‚¨ï¼ˆbrick server çš„æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š å­˜å–æ•ˆçŽ‡å¹¶æ²¡æœ‰ä»€ä¹ˆæ²¡æœ‰æé«˜ï¼Œåè€Œä¼šå› ä¸ºç½‘ç»œé€šä¿¡çš„åŽŸå› è€Œæœ‰æ‰€é™ä½Žã€‚ æ”¯æŒè¶…å¤§åž‹æ–‡ä»¶ä¼šæœ‰ä¸€å®šçš„éš¾åº¦ã€‚è™½ç„¶ext4å·²ç»å¯ä»¥æ”¯æŒæœ€å¤§16Tçš„å•ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯æœ¬åœ°å­˜å‚¨è®¾å¤‡çš„å®¹é‡å®žåœ¨æœ‰é™ã€‚ æ‰€ä»¥å¦‚æžœæœ‰å¤§é‡çš„å¤§æ–‡ä»¶å­˜å‚¨éœ€æ±‚ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨Stripeæ¨¡å¼æ¥å®žçŽ°ï¼Œå¦‚è€ƒè™‘æ–°å»ºä¸“é—¨å­˜å‚¨è¶…å¤§åž‹æ–‡ä»¶çš„stripeå·ã€‚ åŠŸèƒ½ï¼š åˆ†å¸ƒå¼å·å°†æ•°æ®ä»¥å“ˆå¸Œç®—æ³•æ–¹å¼åˆ†å¸ƒåˆ°å„ä¸ªbrickä¸Šï¼Œæ•°æ®æ˜¯ä»¥æ–‡ä»¶ä¸ºå•ä½å­˜å–ï¼ŒåŸºæœ¬è¾¾åˆ°åˆ†å¸ƒå‡è¡¡ï¼Œæä¾›çš„å®¹é‡å’Œä¸ºå„ä¸ªbrickå®¹é‡çš„æ€»å’Œã€‚ å‰¯æœ¬å·å‰¯æœ¬å·ï¼ˆReplicated Glusterfs Volumeï¼‰åˆç§°AFRï¼ˆAuto File Replicationï¼‰ã€‚ 12# å‰ææ˜¯å¿…é¡»åˆ›å»ºä¿¡ä»»ä¸»æœºæ± gluster volume create NEW-VOLNAME [replica COUNT] [transport tcp | rdma | tcp,rdma] NEW-BRICK... ç‰¹ç‚¹ï¼š æ¯ä¸ªæ–‡ä»¶åŒæ­¥å¤åˆ¶é•œåƒåˆ°å¤šä¸ªbrickï¼Œç›¸å½“äºŽæ–‡ä»¶çº§raid1ã€‚ å‰¯æœ¬æ•°é‡é€šå¸¸è®¾ç½®ä¸º2æˆ–3ï¼Œè®¾ç½®çš„å‰¯æœ¬æ•°é‡éœ€è¦æ˜¯brickæ•°é‡ï¼ˆè‡³å°‘ä¸º2ï¼‰çš„å€æ•°ï¼ˆå¦‚2å°brick serverï¼Œå¯è®¾ç½®å‰¯æœ¬æ•°ä¸º2/4/6/â€¦ï¼›å¦‚3å°brick serverï¼Œå¯è®¾ç½®å‰¯æœ¬æ•°ä¸º3/6/9/â€¦ï¼›ä¾æ¬¡ç±»æŽ¨ï¼‰ï¼Œä¸”æ¯ä¸ªbrickçš„å®¹é‡ç›¸ç­‰ã€‚ è¯»æ€§èƒ½æå‡ï¼Œå†™æ€§èƒ½ä¸‹é™ã€‚å› ä¸ºglusterfsçš„å¤åˆ¶æ˜¯åŒæ­¥äº‹åŠ¡æ“ä½œï¼Œå³å†™æ–‡ä»¶æ—¶ï¼Œå…ˆæŠŠè¿™ä¸ªæ–‡ä»¶é”ä½ï¼Œç„¶åŽåŒæ—¶å†™ä¸¤ä¸ªæˆ–å¤šä¸ªå‰¯æœ¬ï¼Œå†™å®ŒåŽè§£é”ï¼Œæ“ä½œç»“æŸï¼ˆcephé‡‡ç”¨å¼‚æ­¥å†™å‰¯æœ¬ï¼Œå³å†™åˆ°ä¸€ä¸ªä¸»OSDä¾¿è¿”å›žï¼Œè¿™ä¸ªOSDå†é€šè¿‡å†…éƒ¨ç½‘ç»œå¼‚æ­¥å†™åˆ°å…¶ä½™OSDï¼‰ã€‚ é€šå¸¸ä¸Žåˆ†å¸ƒå¼å·æˆ–æ¡å¸¦å·ç»„åˆä½¿ç”¨ï¼Œè§£å†³å‰ä¸¤è€…çš„å†—ä½™é—®é¢˜ï¼› æå‡æ•°æ®å¯é æ€§ï¼Œä½†ç£ç›˜åˆ©ç”¨çŽ‡ä½Žï¼› å‰¯æœ¬æ•°è®¾ç½®ä¸º2æ—¶ï¼Œå¯èƒ½ä¼šæœ‰è„‘è£‚ï¼ˆSplit-brainï¼‰çš„é£Žé™©ï¼ˆé£Žé™©æç¤ºï¼Œä½†å¯é…ç½®ï¼‰ï¼Œä¸»è¦å› åœ¨ä¸¤ä¸ªå‰¯æœ¬ä¸ä¸€è‡´æ—¶ï¼Œæ— æ³•ä»²è£ä»¥å“ªä¸ªå‰¯æœ¬ä¸ºå‡†ï¼Œè§£å†³æ–¹æ¡ˆæ˜¯åŠ å…¥ä»²è£æˆ–è€…è®¾ç½®3å‰¯æœ¬ã€‚ åŠŸèƒ½ï¼š å‰¯æœ¬å·æä¾›æ•°æ®å‰¯æœ¬ï¼Œå‰¯æœ¬æ•°ä¸ºreplicaçš„å€¼ï¼Œå³æ¯ä¸ªæ–‡ä»¶å­˜å‚¨replicaä»½æ•°ï¼Œæ–‡ä»¶ä¸åˆ†å‰²ã€‚ä»¥æ–‡ä»¶ä¸ºå•ä½å­˜å‚¨ï¼Œå‰¯æœ¬æ•°éœ€è¦ç­‰äºŽbrickæ•°ï¼Œå½“brcikæ•°æ˜¯å‰¯æœ¬æ•°çš„å€æ•°æ—¶ï¼Œåˆ™è‡ªåŠ¨è½¬åŒ–ä¸ºreplicated-distributedå·ã€‚ AFRæ¢å¤åŽŸç†ï¼š æ•°æ®æ¢å¤åªé’ˆå¯¹å¤åˆ¶å·ï¼ŒAFRæ•°æ®ä¿®å¤ä¸»è¦æ¶‰åŠä¸‰ä¸ªæ–¹é¢ï¼šENTRYï¼ŒMETAï¼ŒDATAã€‚ è®°å½•æè¿°å‰¯æœ¬çŠ¶æ€çš„ç§°ä¹‹ä¸ºChangeLogï¼Œè®°å½•åœ¨æ¯ä¸ªå‰¯æœ¬æ–‡ä»¶æ‰©å±•å±žæ€§é‡Œï¼Œè¯»å…¥å†…å­˜åŽä»¥çŸ©é˜µå½¢å¼åˆ¤æ–­æ˜¯å¦éœ€è¦ä¿®å¤ä»¥åŠè¦ä»¥å“ªä¸ªå‰¯æœ¬ä¸ºSourceè¿›è¡Œä¿®å¤ï¼›åˆå§‹å€¼ä»¥åŠæ­£å¸¸å€¼ä¸º0ï¼ˆæ³¨ï¼šENTRYå’ŒMETA,DATAåˆ†å¸ƒå¯¹åº”ç€ä¸€ä¸ªæ•°å€¼ï¼‰ã€‚ ä»¥å†—ä½™åº¦ä¸º2ï¼Œå³å«æœ‰2ä¸ªå‰¯æœ¬Aå’ŒBçš„DATAä¿®å¤ä¸ºä¾‹ï¼Œwriteçš„æ­¥éª¤åˆ†è§£ä¸ºï¼š ä¸‹å‘Writeæ“ä½œï¼› åŠ é”Lockï¼› å‘Aï¼ŒBå‰¯æœ¬çš„ChangeLogåˆ†åˆ«åŠ 1ï¼Œè®°å½•åˆ°å„å‰¯æœ¬çš„æ‰©å±•å±žæ€§ä¸­ï¼› å¯¹Aï¼ŒBå‰¯æœ¬è¿›è¡Œå†™æ“ä½œï¼› è‹¥å‰¯æœ¬å†™æˆåŠŸåˆ™ChangeLogå‡1ï¼Œè‹¥è¯¥å‰¯æœ¬å†™å¤±è´¥åˆ™ChangLogå€¼ä¸å˜ï¼Œè®°å½•åˆ°å„ä¸ªå‰¯æœ¬çš„æ‰©å±•å±žæ€§ä¸­ï¼› è§£é”UnLockï¼› å‘ä¸Šå±‚è¿”å›žï¼Œåªè¦æœ‰ä¸€ä¸ªå‰¯æœ¬å†™æˆåŠŸå°±è¿”å›žæˆåŠŸã€‚ ä¸Šè¿°æ“ä½œåœ¨AFRä¸­æ˜¯å®Œæ•´çš„ä¸€ä¸ªtransactionåŠ¨ä½œï¼Œæ ¹æ®ä¸¤ä¸ªå‰¯æœ¬è®°å½•çš„ChangeLogçš„æ•°å€¼ç¡®å®šäº†å‰¯æœ¬çš„å‡ ç§çŠ¶æ€ï¼š WISEï¼šæ™ºæ…§çš„ï¼Œå³è¯¥å‰¯æœ¬çš„ChangeLogä¸­å¯¹åº”çš„å€¼æ˜¯0ï¼Œè€Œå¦ä¸€å‰¯æœ¬å¯¹åº”çš„æ•°å€¼å¤§äºŽ0ï¼› INNOCENTï¼šæ— è¾œçš„ï¼Œå³ä¸¤å‰¯æœ¬çš„ChangeLogå¯¹åº”çš„å€¼éƒ½æ˜¯0ï¼› FOOLï¼šæ„šè ¢çš„ï¼Œå³è¯¥å‰¯æœ¬çš„ChangeLogå¯¹åº”çš„å€¼å¤§äºŽæ˜¯0ï¼Œè€Œå¦ä¸€å‰¯æœ¬å¯¹åº”çš„æ•°å€¼æ˜¯0ï¼› IGNORANTï¼Œå¿½ç•¥çš„ï¼Œå³è¯¥å‰¯æœ¬çš„ChangeLogä¸¢å¤±ã€‚ æ¢å¤åˆ†ä»¥ä¸‹åœºæ™¯ï¼š 1ä¸ªèŠ‚ç‚¹changelogçŠ¶æ€ä¸ºWISEï¼Œå…¶ä½™èŠ‚ç‚¹ä¸ºFOOLæˆ–å…¶ä»–éžWISEçŠ¶æ€ï¼Œä»¥WISEèŠ‚ç‚¹åŽ»æ¢å¤å…¶ä»–èŠ‚ç‚¹ï¼› æ‰€æœ‰èŠ‚ç‚¹æ˜¯IGNORANTçŠ¶æ€ï¼Œæ‰‹åŠ¨è§¦å‘healï¼Œé€šè¿‡å‘½ä»¤ä»¥UIDæœ€å°çš„æ–‡ä»¶ä½œä¸ºsourceï¼ŒåŽ»æ¢å¤å¤§å°ä¸º0çš„å…¶ä»–æ–‡ä»¶ï¼› å¤šä¸ªçŠ¶æ€æ˜¯WISEæ—¶ï¼Œå³å‡ºçŽ°è„‘è£‚çŠ¶æ€ï¼Œè„‘è£‚çš„æ–‡ä»¶é€šå¸¸è¯»ä¸å‡ºæ¥ï¼ŒæŠ¥â€Input/Output errorâ€ï¼Œå¯æŸ¥çœ‹æ—¥å¿—/var/log/glusterfs/glustershd.logã€‚ 123# é€šè¿‡å‘½ä»¤æŸ¥çœ‹å‰¯æœ¬æ–‡ä»¶çš„æ‰©å±•å±žæ€§ï¼šgetfattr -m . -d -e hex [filename]# â€œtrusted.afr.xxxâ€éƒ¨åˆ†å³æ‰©å±•å±žæ€§ï¼Œå€¼æ˜¯24bitï¼Œåˆ†3éƒ¨åˆ†ï¼Œä¾æ¬¡æ ‡è¯†DATA ï¼ŒMETAï¼Œ ENTRY 3è€…çš„changelog&gt; getfattr -m . -d -e hex /brick1/repl_volume/replica1.txt å‰¯æœ¬å·ä»²è£èŠ‚ç‚¹ï¼š 1gluster volume create &lt;VOLNAME&gt; replica 3 arbiter 1 host1:brick1 host2:brick2 host3:brick3 è„‘è£‚è§£å†³æ–¹æ¡ˆï¼š :globe_with_meridians:Split brain and the ways to deal with it æ¡å¸¦å·ï¼ˆå·²å¼ƒç”¨ï¼‰æ¡å¸¦å·ï¼ˆStriped Glusterfs Volumeï¼‰ã€‚ 1gluster volume create NEW-VOLNAME [stripe COUNT] [transport [tcp | dma | tcp,rdma]] NEW-BRICK... ç‰¹ç‚¹ï¼š æ¯ä¸ªæ–‡ä»¶è¢«åˆ†ç‰‡æˆç­‰åŒäºŽbrickæ•°é‡çš„chunksï¼Œç„¶åŽä»¥round robinçš„æ–¹å¼å°†æ¯ä¸ªchunkå­˜å‚¨åˆ°1ä¸ªbrickï¼Œç›¸å½“äºŽraid0ã€‚ å•ä¸€è¶…å¤§å®¹é‡æ–‡ä»¶å¯è¢«åˆ†ç‰‡ï¼Œä¸å—brick serveræœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„é™åˆ¶ã€‚ æ–‡ä»¶åˆ†ç‰‡åŽï¼Œå¹¶å‘ç²’åº¦æ˜¯chunksï¼Œåˆ†å¸ƒå¼è¯»å†™æ€§èƒ½è¾ƒé«˜ï¼Œä½†åˆ†ç‰‡éšæœºè¯»å†™å¯èƒ½ä¼šå¯¼è‡´ç¡¬ç›˜iopsè¾ƒé«˜ã€‚ æ— å†—ä½™ï¼Œ1ä¸ªserverèŠ‚ç‚¹æ•…éšœä¼šå¯¼è‡´æ‰€æœ‰æ•°æ®ä¸¢å¤±ã€‚ åŠŸèƒ½ï¼š Stripeå·ç±»ä¼¼Raid0ï¼Œå°†æ•°æ®æ¡å¸¦åŒ–ï¼Œåˆ†å¸ƒåœ¨ä¸åŒçš„brickï¼Œè¯¥æ–¹å¼å°†æ–‡ä»¶åˆ†æˆstripeå—ï¼Œåˆ†åˆ«è¿›è¡Œå­˜å‚¨ã€‚åœ¨å¤§æ–‡ä»¶è¯»å–æ—¶æœ‰ä¼˜åŠ¿ã€‚Stripeéœ€è¦ç­‰äºŽbrcikæ•°ï¼Œå½“brickæ•°ç­‰äºŽstripeæ•°çš„å€æ•°æ—¶ï¼Œåˆ™è‡ªåŠ¨è½¬åŒ–ä¸ºstripe-distributedå·ã€‚ åˆ†å¸ƒå¼å‰¯æœ¬å·åˆ†å¸ƒå¼å‰¯æœ¬å·ï¼ˆDistributed Replicated Glusterfs Volumeï¼‰æ˜¯å‰¯æœ¬å·å’Œåˆ†å¸ƒå·çš„ç»„åˆã€‚ 12# å¿…é¡»æŒ‡å®šå·ç±»åž‹ï¼ˆé»˜è®¤ä¸ºåˆ†å¸ƒå¼å·ï¼‰ä¸Žå¯¹åº”çš„å‰¯æœ¬æ•°é‡ï¼Œbrick serveræ•°é‡æ˜¯å‰¯æœ¬æ•°é‡çš„å€æ•°ï¼Œä¸”&gt;=2å€gluster volume create NEW-VOLNAME [replica COUNT] [transport [tcp | rdma | tcp,rdma]] NEW-BRICK... ç‰¹ç‚¹ï¼š è‹¥å¹²brickç»„æˆ1ä¸ªå¤åˆ¶å·ï¼Œå¦å¤–è‹¥å¹²brickç»„æˆå…¶ä»–å¤åˆ¶å·ï¼›å•ä¸ªæ–‡ä»¶åœ¨å¤åˆ¶å·å†…æ•°æ®ä¿æŒå‰¯æœ¬ï¼Œä¸åŒæ–‡ä»¶åœ¨ä¸åŒå¤åˆ¶å·ä¹‹é—´è¿›è¡Œå“ˆå¸Œåˆ†å¸ƒï¼›å³åˆ†å¸ƒå¼å·è·¨å¤åˆ¶å·é›†ï¼ˆreplicated sets ï¼‰ã€‚ brick serveræ•°é‡æ˜¯å‰¯æœ¬æ•°é‡çš„å€æ•°ï¼Œä¸”&gt;=2å€ï¼Œå³æœ€å°‘éœ€è¦4å°brick serverï¼ŒåŒæ—¶ç»„å»ºå¤åˆ¶å·é›†çš„brickå®¹é‡ç›¸ç­‰ã€‚ åˆ†å¸ƒå¼æ¡å¸¦å·ï¼ˆå·²å¼ƒç”¨ï¼‰åˆ†å¸ƒå¼æ¡å¸¦å·ï¼ˆDistributed Striped Glusterfs Volumeï¼‰ï¼Œæ˜¯åˆ†å¸ƒå¼å·ä¸Žæ¡å¸¦å·çš„ç»„åˆã€‚ 12# å¿…é¡»æŒ‡å®šå·ç±»åž‹ï¼ˆé»˜è®¤ä¸ºåˆ†å¸ƒå¼å·ï¼‰ä¸Žå¯¹åº”çš„æ¡å¸¦æ•°ï¼Œbrick serveræ•°é‡æ˜¯æ¡å¸¦æ•°é‡çš„å€æ•°ï¼Œä¸”&gt;=2å€gluster volume create NEW-VOLNAME [stripe COUNT] [transport [tcp | rdma | tcp,rdma]] NEW-BRICK... ç‰¹ç‚¹ï¼š è‹¥å¹²brickç»„æˆ1ä¸ªæ¡å¸¦å·ï¼Œå¦å¤–è‹¥å¹²brickç»„æˆå…¶ä»–æ¡å¸¦å·ï¼›å•ä¸ªæ–‡ä»¶åœ¨æ¡å¸¦å·å†…æ•°æ®ä»¥æ¡å¸¦çš„å½¢å¼å­˜å‚¨ï¼Œä¸åŒæ–‡ä»¶åœ¨ä¸åŒæ¡å¸¦å·ä¹‹é—´è¿›è¡Œå“ˆå¸Œåˆ†å¸ƒï¼›å³åˆ†å¸ƒå¼å·è·¨æ¡å¸¦å·ã€‚ brick serveræ•°é‡æ˜¯æ¡å¸¦æ•°çš„å€æ•°ï¼Œä¸”&gt;=2å€ï¼Œå³æœ€å°‘éœ€è¦4å°brick serverã€‚ æ¡å¸¦å‰¯æœ¬å·ï¼ˆå·²å¼ƒç”¨ï¼‰æ¡å¸¦å¤åˆ¶å·ï¼ˆSTRIPE REPLICA Volumeï¼‰ï¼Œæ˜¯æ¡å¸¦ä¸Žå¤åˆ¶å·çš„ç»„åˆã€‚ 1gluster volume create NEW-VOLNAME [stripe COUNT] [replica COUNT] [transport tcp | rdma | tcp,rdma] NEW-BRICK... ç‰¹ç‚¹ï¼š è‹¥å¹²brickç»„æˆ1ä¸ªå¤åˆ¶å·ï¼Œå¦å¤–è‹¥å¹²brickç»„æˆå…¶ä»–å¤åˆ¶å·ï¼›å•ä¸ªæ–‡ä»¶ä»¥æ¡å¸¦çš„å½¢å¼å­˜å‚¨åœ¨2ä¸ªæˆ–å¤šä¸ªå¤åˆ¶é›†ï¼ˆreplicated sets ï¼‰ï¼Œå¤åˆ¶é›†å†…æ–‡ä»¶åˆ†ç‰‡ä»¥å‰¯æœ¬çš„å½¢å¼ä¿å­˜ï¼›ç›¸å½“äºŽæ–‡ä»¶çº§raid01ï¼› brick serveræ•°é‡æ˜¯å‰¯æœ¬æ•°çš„å€æ•°ï¼Œä¸”&gt;=2å€ï¼Œå³æœ€å°‘éœ€è¦4å°brick serverã€‚ åˆ†å¸ƒå¼æ¡å¸¦é•œåƒå·ï¼ˆå·²å¼ƒç”¨ï¼‰åˆ†å¸ƒå¼æ¡å¸¦å¤åˆ¶å·ï¼ˆDISTRIBUTE STRIPE REPLICA VOLUMEï¼‰ï¼Œæ˜¯åˆ†å¸ƒå¼å·ï¼Œæ¡å¸¦ä¸Žå¤åˆ¶å·çš„ç»„åˆã€‚ ç‰¹ç‚¹ï¼š å¤šä¸ªæ–‡ä»¶å“ˆå¸Œåˆ†å¸ƒåˆ°åˆ°å¤šä¸ªæ¡å¸¦é›†ä¸­ï¼Œå•ä¸ªæ–‡ä»¶åœ¨æ¡å¸¦é›†ä¸­ä»¥æ¡å¸¦çš„å½¢å¼å­˜å‚¨åœ¨2ä¸ªæˆ–å¤šä¸ªå¤åˆ¶é›†ï¼ˆreplicated sets ï¼‰ï¼Œå¤åˆ¶é›†å†…æ–‡ä»¶åˆ†ç‰‡ä»¥å‰¯æœ¬çš„å½¢å¼ä¿å­˜ï¼›brick serveræ•°é‡æ˜¯å‰¯æœ¬æ•°çš„å€æ•°ï¼Œä¸”&gt;=2å€ï¼Œå³æœ€å°‘éœ€è¦4å°brick serverã€‚ çº åˆ å·çº åˆ å·ï¼ˆDispersed Volumesï¼‰æ˜¯v3.6ç‰ˆæœ¬åŽå‘å¸ƒçš„ä¸€ç§volumeã€‚ 1gluster volume create [disperse [&lt;count&gt;]] [redundancy &lt;count&gt;] [transport tcp | rdma | tcp,rdma] NEW-BRICK... åˆ†å¸ƒå¼çº åˆ å·åˆ†å¸ƒå¼çº åˆ å·ï¼ˆDistributed Dispersed Volumesï¼‰ç­‰æ•ˆäºŽåˆ†å¸ƒå¼å¤åˆ¶å·ï¼Œä½†ä½¿ç”¨çš„æ˜¯çº åˆ å­å·ï¼Œè€Œéžå¤åˆ¶å­å·ã€‚ åˆ é™¤å·12345# åˆ é™¤å·æ“ä½œï¼Œå¿…é¡»å…ˆåœç”¨å·ï¼›# æœ€åŽå¯æ¸…ç©ºbrick serverèŠ‚ç‚¹å¯¹åº”ç›®å½•ä¸‹çš„å†…å®¹gluster volume stop distributed-volumegluster volume delete distributed-volumerm -f /brick1/dis_volume å‡è¡¡å·12# æ¯åšä¸€æ¬¡æ‰©å®¹åŽéƒ½éœ€è¦åšä¸€æ¬¡ç£ç›˜å¹³è¡¡ã€‚ ç£ç›˜å¹³è¡¡æ˜¯åœ¨ä¸‡ä¸å¾—å·²çš„æƒ…å†µä¸‹å†åšçš„ï¼Œä¸€èˆ¬å†åˆ›å»ºä¸€ä¸ªå·å°±å¯ä»¥äº†gluster volume VOLNAME rebalance [fix-layout start | start | startforce | status | stop] ä¿®å¤å·12345678# ä¿®å¤å·ï¼ˆåªé’ˆå¯¹å¤åˆ¶å·ï¼‰# åªä¿®å¤æœ‰é—®é¢˜çš„æ–‡ä»¶ gluster volume heal REPLICATE-VOLNAME/DISPERSE-VOLNAME# ä¿®å¤æ‰€æœ‰æ–‡ä»¶gluster volume heal REPLICATE-VOLNAME/DISPERSE-VOLNAME full # æŸ¥çœ‹è‡ªæ„ˆè¯¦æƒ…gluster volume heal REPLICATE-VOLNAME/DISPERSE-VOLNAME info gluster volume heal REPLICATE-VOLNAME/DISPERSE-VOLNAME info healed|heal-failed|split-brain è®¾ç½®å·1gluster volume set options å¸¸ç”¨é€‰é¡¹ï¼š Auth.allowï¼šIPè®¿é—®æŽˆæƒï¼Œç¼ºçœå€¼ï¼ˆ*.allow allï¼‰ã€‚åˆæ³•å€¼ï¼šIpåœ°å€ã€‚ Cluster.min-free-diskï¼šå‰©ä½™ç£ç›˜ç©ºé—´é˜€å€¼ï¼Œç¼ºçœå€¼ï¼ˆ10%ï¼‰ã€‚åˆæ³•å€¼ï¼šç™¾åˆ†æ¯”ã€‚ Cluster.stripe-block-sizeï¼šæ¡å¸¦å¤§å°ï¼Œç¼ºçœå€¼ï¼ˆ128KBï¼‰ã€‚åˆæ³•å€¼ï¼šå­—èŠ‚ã€‚ Network.frame-timeoutï¼šè¯·æ±‚ç­‰å¾…æ—¶é—´ï¼Œç¼ºçœå€¼ï¼ˆ1800sï¼‰ã€‚åˆæ³•å€¼ï¼š1-1800ã€‚ Network.ping-timeoutï¼šå®¢æˆ·ç«¯ç­‰å¾…æ—¶é—´ï¼Œç¼ºçœå€¼ï¼ˆ42sï¼‰ã€‚åˆæ³•å€¼ï¼š0-42ã€‚ Nfs.disabledï¼šå…³é—­NFSæœåŠ¡ï¼Œç¼ºçœå€¼ï¼ˆOffï¼‰ã€‚åˆæ³•å€¼ï¼šOff|onã€‚ Performance.io-thread-countï¼šIOçº¿ç¨‹æ•°ï¼Œç¼ºçœå€¼ï¼ˆ16ï¼‰ã€‚åˆæ³•å€¼ï¼š0-65ã€‚ Performance.cache-refresh-timeoutï¼šç¼“å­˜æ ¡éªŒæ—¶é—´ï¼Œç¼ºçœå€¼ï¼ˆ1sï¼‰ã€‚åˆæ³•å€¼ï¼š0-61ã€‚ Performance.cache-sizeï¼šè¯»ç¼“å­˜å¤§å°ï¼Œç¼ºçœå€¼ï¼ˆ32MBï¼‰ã€‚åˆæ³•å€¼ï¼šå­—èŠ‚ã€‚ Performance.quick-readï¼šä¼˜åŒ–è¯»å–å°æ–‡ä»¶çš„æ€§èƒ½ã€‚ Performance.read-aheadï¼šç”¨é¢„è¯»çš„æ–¹å¼æé«˜è¯»å–çš„æ€§èƒ½ï¼Œæœ‰åˆ©äºŽåº”ç”¨é¢‘ç¹æŒç»­æ€§çš„è®¿é—®æ–‡ä»¶ï¼Œå½“åº”ç”¨å®Œæˆå½“å‰æ•°æ®å—è¯»å–çš„æ—¶å€™ï¼Œä¸‹ä¸€ä¸ªæ•°æ®å—å°±å·²ç»å‡†å¤‡å¥½äº†ã€‚ Performance.write-behindï¼šå…ˆå†™å…¥ç¼“å­˜å†…ï¼Œåœ¨å†™å…¥ç¡¬ç›˜ï¼Œä»¥æé«˜å†™å…¥çš„æ€§èƒ½ã€‚ Performance.io-cacheï¼šç¼“å­˜å·²ç»è¢«è¯»è¿‡çš„ã€‚ å—ç®¡ç†æ·»åŠ å—12# è‹¥æ˜¯å‰¯æœ¬å·æˆ–è€…æ¡å¸¦åŒ–å·ï¼Œåˆ™ä¸€æ¬¡æ·»åŠ çš„brickæ•°å¿…é¡»ä¸ºreplicaæˆ–stripeçš„æ•´æ•°å€gluster volume add-brick VOLNAME NEW-BRICK ç§»é™¤å—12345678910# è‹¥æ˜¯å‰¯æœ¬å·æˆ–è€…æ¡å¸¦åŒ–å·ï¼Œåˆ™ç§»é™¤çš„brickæ•°å¿…é¡»ä¸ºreplicaæˆ–stripeçš„æ•´æ•°å€# æ‰§è¡Œç§»é™¤brickçš„æ—¶å€™ä¼šå°†æ•°æ®è¿ç§»åˆ°å…¶ä»–å¯ç”¨çš„brickä¸Šï¼Œå½“æ•°æ®è¿ç§»ç»“æŸåŽæ‰å°†brickç§»é™¤# æ‰§è¡Œstartå‘½ä»¤ï¼Œå¼€å§‹è¿ç§»æ•°æ®ï¼Œæ­£å¸¸ç§»é™¤brick# æ‰§è¡Œstatuså¯ä»¥æŸ¥çœ‹ç§»é™¤ä»»åŠ¡çš„çŠ¶æ€# æ‰§è¡Œcommitå‘½ä»¤åˆ™ä¸ä¸ä¼šè¿›è¡Œæ•°æ®è¿ç§»è€Œç›´æŽ¥åˆ é™¤brick# æ‰©å®¹æ—¶ï¼Œå¯ä»¥å…ˆå¢žåŠ ç³»ç»ŸèŠ‚ç‚¹ï¼Œç„¶åŽæ·»åŠ æ–°å¢žèŠ‚ç‚¹ä¸Šçš„brickå³å¯# ç¼©å®¹æ—¶ï¼Œå…ˆç§»é™¤brickï¼Œå†è¿›è¡ŒèŠ‚ç‚¹åˆ é™¤gluster volume remove-brick VOLNAME BRICK start/status/commit æ›¿æ¢å—12345# æ‰§è¡Œstartå¯åŠ¨å‘½ä»¤åŽï¼Œå¼€å§‹å°†åŽŸå§‹brickçš„æ•°æ®è¿ç§»åˆ°å³å°†éœ€è¦æ›¿æ¢çš„brickä¸Šã€‚# æ‰§è¡Œstatuså¯æŸ¥çœ‹æ›¿æ¢ä»»åŠ¡æ˜¯å¦å®Œæˆã€‚# æ‰§è¡Œabortå¯ç»ˆæ­¢brickæ›¿æ¢ã€‚# æ‰§è¡Œcommitmiå‘½ä»¤ç»“æŸä»»åŠ¡è¿›è¡Œbrickæ›¿æ¢ã€‚gluster volume replace-brick VOLNAME BRICK NEW-BRICK start/pause/abort/status/commit å‚è€ƒæ–‡çŒ®ðŸŒ[gluster-Quickstart] :globe_with_meridians:[Setting up GlusterFS Volumes] :globe_with_meridians:[Managing Volumes] :globe_with_meridians:[Setting Up Clients] :globe_with_meridians:[GlusterFSä¼ä¸šçº§åŠŸèƒ½ä¹‹ECçº åˆ ç ] :globe_with_meridians:[GlusterFSåˆ†å¸ƒå¼å­˜å‚¨é›†ç¾¤] :globe_with_meridians:[GlusterFS Dispersed Volumeæ€»ç»“] :globe_with_meridians:[glusterfsåˆ†å¸ƒå¼å­˜å‚¨éƒ¨ç½²]]]></content>
      <categories>
        <category>GlusterFS</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>GlusterFS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MongoDBå­¦ä¹ ç¬”è®°-é…ç½®]]></title>
    <url>%2F2018%2F08%2F29%2FMongoDB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E9%85%8D%E7%BD%AE%2F</url>
    <content type="text"><![CDATA[MongoDBé…ç½®æ–‡ä»¶è§£æžðŸŒ[MongoDB Configuration File Options] systemLog ï¼ˆç³»ç»Ÿæ—¥å¿—ï¼‰ç³»ç»Ÿæ—¥å¿—ç›¸å…³é€‰é¡¹ï¼š 123456789101112131415systemLog: verbosity: &lt;int&gt; quiet: &lt;boolean&gt; traceAllExceptions: &lt;boolean&gt; syslogFacility: &lt;string&gt; path: &lt;string&gt; logAppend: &lt;boolean&gt; logRotate: &lt;string&gt; destination: &lt;string&gt; timeStampFormat: &lt;string&gt; component: accessControl: verbosity: &lt;int&gt; command: verbosity: &lt;int&gt; systemLog.verbosityé»˜è®¤ï¼š0 æ—¥å¿—å†—é•¿çº§åˆ«ã€‚ è¯¦ç»†ç¨‹åº¦å¯ä»¥æ˜¯0åˆ°5ï¼š 0ï¼šMongoDBçš„é»˜è®¤æ—¥å¿—è¯¦ç»†çº§åˆ«ï¼ŒåŒ…æ‹¬Informationalæ¶ˆæ¯ã€‚ 1åˆ°5ï¼šå¢žåŠ è¯¦ç»†çº§åˆ«ï¼Œéƒ½åŒ…æ‹¬Debugä¿¡æ¯ã€‚ æ—¥å¿—çº§åˆ«ï¼šLog Messages systemLog.quietè¿è¡Œmongosæˆ–è€…mongodæ˜¯å¦å¤„äºŽé™é»˜æ¨¡å¼ï¼Œç”¨æ¥é™åˆ¶è¾“å‡ºä¿¡æ¯ã€‚ ç”Ÿäº§çŽ¯å¢ƒä¸å»ºè®®ä½¿ç”¨ã€‚ systemLog.traceAllExceptionsæ‰“å°è¯¦ç»†ä¿¡æ¯ä»¥è¿›è¡Œè°ƒè¯•ï¼Œç”¨æ¥æ”¯æŒç›¸å…³æ•…éšœæŽ’é™¤çš„å…¶ä»–æ—¥å¿—è®°å½•ã€‚ systemLog.syslogFacilityé»˜è®¤ï¼šuser å°†æ¶ˆæ¯è®°å½•åˆ°syslogæ—¶ä½¿ç”¨çš„è®¾å¤‡çº§åˆ«ã€‚æŒ‡å®šçš„å€¼å¿…é¡»è¢«æ“ä½œç³»ç»Ÿçš„syslogæ‰€æ”¯æŒã€‚ è¦ä½¿ç”¨æ­¤é€‰é¡¹ï¼Œå¿…é¡»è®¾ç½®systemLog.destinationä¸ºsyslogã€‚ systemLog.pathæ—¥å¿—æ–‡ä»¶è·¯å¾„ã€‚ systemLog.logAppendé»˜è®¤ï¼šFalse Trueï¼šå½“å®žä¾‹é‡æ–°å¯åŠ¨æ—¶ï¼Œå°†æ—¥å¿—æ·»åŠ åˆ°çŽ°æœ‰æ—¥å¿—æ–‡ä»¶çš„æœ«å°¾ã€‚ Falseï¼šå½“å®žä¾‹é‡æ–°å¯åŠ¨æ—¶ï¼Œå°†å¤‡ä»½çŽ°æœ‰æ—¥å¿—å¹¶åˆ›å»ºæ–°æ–‡ä»¶æ¥è®°å½•æ—¥å¿—ã€‚ systemLog.logRotateé»˜è®¤ï¼šrename ä½¿ç”¨æ—¥å¿—åˆ†å‰²æ—¶çš„è¡Œä¸ºï¼š renameï¼šé‡å‘½åæ—¥å¿—æ–‡ä»¶ã€‚ reopenï¼šæŒ‰ç…§Linux/Unixæ—¥å¿—è½®æ¢è¡Œä¸ºå…³é—­å¹¶é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ã€‚å¦‚æžœæŒ‡å®šreopenï¼Œåˆ™è¿˜å¿…é¡»è®¾ç½®systemLog.logAppendä¸ºtrueã€‚ systemLog.destinationæŒ‡å®šæ—¥å¿—ç±»åž‹ã€‚ fileï¼šæ—¥å¿—ä¸ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚æžœæŒ‡å®šfileï¼Œåˆ™è¿˜å¿…é¡»æŒ‡å®šsystemLog.pathã€‚ syslogï¼šè®°å½•åˆ°ç³»ç»Ÿæ—¥å¿—ã€‚ æœªæŒ‡å®šï¼šæ‰€æœ‰æ—¥å¿—è¾“å‡ºä¸ºæ ‡å‡†è¾“å‡ºã€‚ systemLog.timeStampFormaté»˜è®¤ï¼šiso8601-local æ—¥å¿—æ¶ˆæ¯ä¸­æ—¶é—´æˆ³çš„æ—¶é—´æ ¼å¼ã€‚æŒ‡å®šä»¥ä¸‹å€¼ä¹‹ä¸€ï¼š ctimeï¼šå°†æ—¶é—´æˆ³æ˜¾ç¤ºä¸ºWed Dec 31 18:17:54.811ã€‚ iso8601-utcï¼šä»¥ISO-8601æ ¼å¼æ˜¾ç¤ºåè°ƒä¸–ç•Œæ—¶ï¼ˆUTCï¼‰çš„æ—¶é—´æˆ³ã€‚ä¾‹å¦‚ï¼Œåœ¨å¤§çºªå…ƒå¼€å§‹çš„çº½çº¦ï¼š1970-01-01T00:00:00.000Zã€‚ iso8601-localï¼šä»¥ISO-8601æ ¼å¼æ˜¾ç¤ºæœ¬åœ°æ—¶é—´çš„æ—¶é—´æˆ³ã€‚ä¾‹å¦‚ï¼Œåœ¨å¤§çºªå…ƒå¼€å§‹çš„çº½çº¦ï¼š 1969-12-31T19:00:00.000-0500ã€‚ systemLog.componentç›¸å…³ç»„ä»¶çš„æ—¥å¿—çº§åˆ«ã€‚ processManagement ï¼ˆè¿›ç¨‹ç®¡ç†ï¼‰1234processManagement: fork: &lt;boolean&gt; pidFilePath: &lt;string&gt; timeZoneInfo: &lt;string&gt; processManagement.forké»˜è®¤ï¼šFalse Trueï¼šä»¥å®ˆæŠ¤è¿›ç¨‹è¿è¡Œmongosæˆ–mongodã€‚ Falseï¼šä¸ä»¥å®ˆæŠ¤è¿›ç¨‹è¿è¡Œmongosæˆ–mongodã€‚ processManagement.pidFilePathPidæ–‡ä»¶è·¯å¾„ã€‚é…åˆprocessManagement.forkä¸ºTrueä¸€èµ·ä½¿ç”¨ã€‚ å¦‚æžœä¸æŒ‡å®šï¼Œå°†ä¸ä¼šåˆ›å»ºPIDæ–‡ä»¶ã€‚ processManagement.timeZoneInfoLinuxå’ŒMacOSç³»ç»Ÿé»˜è®¤ï¼š/usr/share/zoneinfo æ—¶åŒºæ•°æ®åº“çš„å®Œæ•´è·¯å¾„ã€‚å¦‚æžœæœªæä¾›æ­¤é€‰é¡¹ï¼Œåˆ™MongoDBå°†ä½¿ç”¨å…¶å†…ç½®æ—¶åŒºæ•°æ®åº“ã€‚ net ï¼ˆç½‘ç»œï¼‰1234567891011121314151617181920212223242526272829net: port: &lt;int&gt; bindIp: &lt;string&gt; bindIpAll: &lt;boolean&gt; maxIncomingConnections: &lt;int&gt; wireObjectCheck: &lt;boolean&gt; ipv6: &lt;boolean&gt; unixDomainSocket: enabled: &lt;boolean&gt; pathPrefix: &lt;string&gt; filePermissions: &lt;int&gt; ssl: sslOnNormalPorts: &lt;boolean&gt; # deprecated since 2.6 mode: &lt;string&gt; PEMKeyFile: &lt;string&gt; PEMKeyPassword: &lt;string&gt; clusterFile: &lt;string&gt; clusterPassword: &lt;string&gt; CAFile: &lt;string&gt; CRLFile: &lt;string&gt; allowConnectionsWithoutCertificates: &lt;boolean&gt; allowInvalidCertificates: &lt;boolean&gt; allowInvalidHostnames: &lt;boolean&gt; disabledProtocols: &lt;string&gt; FIPSMode: &lt;boolean&gt; compression: compressors: &lt;string&gt; transportLayer: &lt;string&gt; serviceExecutor: &lt;string&gt; net.porté»˜è®¤ï¼š27017 ç«¯å£å·ã€‚ net.bindIpé»˜è®¤ï¼šlocalhost ç»‘å®šç½‘ç»œæŽ¥å£ã€‚è¦ç»‘å®šåˆ°å¤šä¸ªåœ°å€ï¼Œè¯·è¾“å…¥é€—å·åˆ†éš”å€¼åˆ—è¡¨ã€‚ 1bindIp: 127.0.0.1,/tmp/mongod.sock net.bindIpAllé»˜è®¤ï¼šFalse Trueï¼šç»‘å®šåˆ°æ‰€æœ‰çš„IPåœ°å€ã€‚ ç­‰åŒäºŽbindIp: 0.0.0.0,:: æ³¨æ„ï¼š net.bindIpå’Œnet.bindIpAllæ˜¯ç›¸äº’æŽ’æ–¥çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥æŒ‡å®šå…¶ä¸­ä¸€ä¸ªï¼Œä½†ä¸èƒ½åŒæ—¶æŒ‡å®šä¸¤è€…ã€‚ net.maxIncomingConnectionsé»˜è®¤ï¼š65536 mongod/mongosè¿›ç¨‹å…è®¸çš„æœ€å¤§è¿žæŽ¥æ•°ï¼Œå¦‚æžœæ­¤å€¼è¶…è¿‡æ“ä½œç³»ç»Ÿé…ç½®çš„è¿žæŽ¥æ•°é˜€å€¼ï¼Œå°†ä¸ä¼šç”Ÿæ•ˆ(ulimit)ï¼›é»˜è®¤å€¼ä¸º65536ã€‚é€šå¸¸å®¢æˆ·ç«¯å°†ä¼šä½¿ç”¨è¿žæŽ¥æ± æœºåˆ¶ï¼Œå¯ä»¥æœ‰æ•ˆçš„æŽ§åˆ¶æ¯ä¸ªå®¢æˆ·ç«¯çš„é“¾æŽ¥ä¸ªæ•°ã€‚ net.wireObjectChecké»˜è®¤ï¼šTrue Trueï¼šå½“å®¢æˆ·ç«¯å†™å…¥æ•°æ®æ—¶ï¼Œmongos/mongodæ˜¯å¦æ£€æµ‹æ•°æ®çš„æœ‰æ•ˆæ€§(BSON)ï¼Œå¦‚æžœæ•°æ®æ ¼å¼ä¸è‰¯ï¼Œæ­¤insertã€updateæ“ä½œå°†ä¼šè¢«æ‹’ç»ã€‚ä¼šç¨å¾®å½±å“æ€§èƒ½ã€‚ Falseï¼šä¸éªŒè¯æœ‰æ•ˆæ€§ã€‚ net.ipv6é»˜è®¤ï¼šFalse å¯ç”¨æˆ–ç¦ç”¨ipv6æ”¯æŒï¼Œæ­¤å€¼éœ€è¦åœ¨æ•´ä¸ªclusterä¸­ä¿æŒä¸€è‡´ã€‚ net.unixDomainSocket12345net: unixDomainSocket: enabled: &lt;boolean&gt; pathPrefix: &lt;string&gt; filePermissions: &lt;int&gt; net.unixDomainSocket.enabledé»˜è®¤ï¼šTrue å¯ç”¨æˆ–ç¦ç”¨UNIX socketç›‘å¬ã€‚ å‡ºçŽ°ä»¥ä¸‹ä»»æ„ä¸€ç§æƒ…å†µä¸ä¼šå¯ç”¨UNIX domain socketç›‘å¬ï¼š net.unixDomainSocket.enabledä¸ºfalseã€‚ å¯åŠ¨æ—¶æ·»åŠ --nounixsocketã€‚å‘½ä»¤è¡Œé€‰é¡¹ä¼˜å…ˆäºŽé…ç½®æ–‡ä»¶è®¾ç½®ã€‚ net.bindIp æ²¡æœ‰è®¾ç½®ã€‚ net.bindIp æ²¡æœ‰è®¾ç½®ä¸º127.0.0.1ã€‚ net.unixDomainSocket.pathPrefixé»˜è®¤ï¼š/tmp Socketæ–‡ä»¶è·¯å¾„ã€‚ net.unixDomainSocket.filePermissionsé»˜è®¤ï¼š0700 Socketæ–‡ä»¶æƒé™ã€‚ net.ssl123456789101112131415net: ssl: sslOnNormalPorts: &lt;boolean&gt; # deprecated since 2.6 mode: &lt;string&gt; PEMKeyFile: &lt;string&gt; PEMKeyPassword: &lt;string&gt; clusterFile: &lt;string&gt; clusterPassword: &lt;string&gt; CAFile: &lt;string&gt; CRLFile: &lt;string&gt; allowConnectionsWithoutCertificates: &lt;boolean&gt; allowInvalidCertificates: &lt;boolean&gt; allowInvalidHostnames: &lt;boolean&gt; disabledProtocols: &lt;string&gt; FIPSMode: &lt;boolean&gt; é…ç½®TLS/SSLå‚è€ƒï¼š ðŸŒConfigure mongod and mongos for TLS/SSL ðŸŒTLS/SSL Configuration for Clients net.ssl.sslOnNormalPortsä»Ž2.6ç‰ˆå¼€å§‹ä¸æŽ¨èä½¿ç”¨ï¼šæ”¹ä¸ºä½¿ç”¨net.ssl.modeã€‚ net.ssl.modeå¯ç”¨æˆ–ç¦ç”¨ç”¨äºŽæ‰€æœ‰ç½‘ç»œè¿žæŽ¥çš„TLS/SSLæˆ–æ··åˆTLS/SSLã€‚ disabledï¼šæœåŠ¡å™¨ä¸ä½¿ç”¨TLS/SSLã€‚ allowSSLï¼šæœåŠ¡å™¨ä¹‹é—´çš„è¿žæŽ¥ä¸ä½¿ç”¨TLS/SSLã€‚å¯¹äºŽä¼ å…¥è¿žæŽ¥ï¼ŒæœåŠ¡å™¨æŽ¥å—TLS/SSLå’ŒéžTLS/éžSSLã€‚ preferSSLï¼šæœåŠ¡å™¨ä¹‹é—´çš„è¿žæŽ¥ä½¿ç”¨TLS/SSLã€‚å¯¹äºŽä¼ å…¥è¿žæŽ¥ï¼ŒæœåŠ¡å™¨æŽ¥å—TLS/SSLå’ŒéžTLS/éžSSLã€‚ requireSSLï¼šæœåŠ¡å™¨ä»…ä½¿ç”¨å’ŒæŽ¥å—TLS/SSLåŠ å¯†è¿žæŽ¥ã€‚ ä»Žç‰ˆæœ¬3.4å¼€å§‹ï¼Œå¦‚æžœ--sslCAFileæˆ–æœªssl.CAFileæŒ‡å®šä¸”æœªä½¿ç”¨x.509èº«ä»½éªŒè¯ï¼Œåˆ™åœ¨è¿žæŽ¥åˆ°å¯ç”¨TLS / SSLçš„æœåŠ¡å™¨æ—¶å°†ä½¿ç”¨ç³»ç»ŸèŒƒå›´çš„CAè¯ä¹¦å­˜å‚¨ã€‚ å¦‚æžœä½¿ç”¨x.509èº«ä»½éªŒè¯ï¼Œ--sslCAFileæˆ–ssl.CAFile å¿…é¡»æŒ‡å®šã€‚ net.ssl.PEMKeyFilepemæ–‡ä»¶åã€‚ net.ssl.PEMKeyPasswordpemæ–‡ä»¶å¯†ç ã€‚ net.ssl.clusterFileclusteræ–‡ä»¶åã€‚ net.ssl.clusterPasswordclusteræ–‡ä»¶å¯†ç ã€‚ net.ssl.CAFileCAæ–‡ä»¶åã€‚ net.ssl.CRLFileCRLæ–‡ä»¶åã€‚ net.compression123net: compression: compressors: &lt;string&gt; net.compression.compressorsé»˜è®¤ï¼šsnappy ç½‘ç»œé€šä¿¡åŽ‹ç¼©ã€‚ snappy zlib å½“åŒæ–¹éƒ½å¯ç”¨ç½‘ç»œåŽ‹ç¼©æ—¶ï¼Œå°†åŽ‹ç¼©æ¶ˆæ¯ã€‚å¦åˆ™ï¼Œå„æ–¹ä¹‹é—´çš„æ¶ˆæ¯å°†è¢«è§£åŽ‹ç¼©ã€‚ net.transportLayeré»˜è®¤å€¼ï¼šasio é™¤éžMongoDBæ”¯æŒå›¢é˜Ÿè¦æ±‚æ‚¨æ›´æ”¹æ­¤è®¾ç½®ï¼Œå¦åˆ™è¯·å‹¿æ›´æ”¹æ­¤è®¾ç½®ã€‚ net.serviceExecutormongos/mongodç”¨äºŽæ‰§è¡Œå®¢æˆ·ç«¯è¯·æ±‚çš„çº¿ç¨‹æ¨¡åž‹ã€‚ synchronous adaptive å…¶ä»–é€‰é¡¹ä»¥åŽå†è®°å½•ã€‚]]></content>
      <categories>
        <category>MongoDB</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>MongoDB</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MongoDBå­¦ä¹ ç¬”è®°-å‰¯æœ¬é›†]]></title>
    <url>%2F2018%2F08%2F28%2FMongoDB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%89%AF%E6%9C%AC%E9%9B%86%2F</url>
    <content type="text"><![CDATA[MongoDBå‰¯æœ¬é›†åŸºæœ¬æ¦‚å¿µMongoDBçš„replica setæ˜¯ä¸€ä¸ªmongodè¿›ç¨‹å®žä¾‹ç°‡ï¼Œæ•°æ®åœ¨è¿™ä¸ªç°‡ä¸­ç›¸äº’å¤åˆ¶ï¼Œå¹¶è‡ªåŠ¨è¿›è¡Œæ•…éšœåˆ‡æ¢ã€‚ MongoDBçš„æ•°æ®åº“å¤åˆ¶å¢žåŠ äº†å†—ä½™ï¼Œç¡®ä¿äº†é«˜å¯ç”¨æ€§ï¼Œç®€åŒ–äº†ç®¡ç†ä»»åŠ¡å¦‚å¤‡ä»½ï¼Œå¹¶ä¸”å¢žåŠ äº†è¯»èƒ½åŠ›ã€‚å¤§å¤šæ•°äº§å“éƒ¨ç½²éƒ½ä½¿ç”¨äº†å¤åˆ¶ã€‚MongoDBä¸­primaryå¤„ç†å†™æ“ä½œï¼Œå…¶å®ƒè¿›è¡Œå¤åˆ¶çš„æˆå‘˜åˆ™æ˜¯secondariesã€‚ ä¸€ä¸ªå‰¯æœ¬é›†å¯ä»¥æœ€å¤šæ”¯æŒ12ä¸ªæˆå‘˜ï¼Œä½†æ˜¯åªæœ‰7ä¸ªæˆå‘˜å¯ä»¥å‚ä¸ŽæŠ•ç¥¨ã€‚ æ³¨ï¼šMongoDBåŒæ—¶æä¾›äº†ä¼ ç»Ÿçš„master/slaveå¤åˆ¶ï¼Œè¿™ç§å¤åˆ¶çš„æ“ä½œæ–¹æ³•ä¸Žå‰¯æœ¬é›†ç›¸åŒï¼Œä½†æ˜¯master/slaveå¤åˆ¶ä¸æ”¯æŒè‡ªåŠ¨æ•…éšœåˆ‡æ¢ã€‚å¾ˆå®¹æ˜“ç†è§£ï¼Œä¸»å¤‡æ¨¡å¼ä¸‹ï¼Œcliç«¯æ˜¯æŒ‡å®šäº†åœ°å€å’Œç«¯å£è¿›è¡Œmongodbçš„è®¿é—®çš„ï¼Œè€Œå‰¯æœ¬é›†æ¨¡å¼åˆ™æ˜¯é€šè¿‡è®¿é—®mongosæ¥éšè—åŠ¨æ€åˆ‡æ¢çš„ã€‚ æˆå‘˜é…ç½®æˆå‘˜å¯ä»¥æ˜¯ä»¥ä¸‹æŸç§è§’è‰²ï¼š æˆä¸ºprimary å¯¹å®¢æˆ·ç«¯å¯è§ å‚ä¸ŽæŠ•ç¥¨ å»¶è¿ŸåŒæ­¥ å¤åˆ¶æ•°æ® Default âˆš âˆš âˆš âˆ• âˆš Secondary-Only âˆ• âˆš âˆš âˆ• âˆš Hidden âˆ• âˆ• âˆš âˆ• âˆš Delayed âˆ• âˆš âˆš âˆš âˆš Arbiters âˆ• âˆ• âˆš âˆ• âˆ• Non-Voting âˆš âˆš âˆ• âˆ• âˆš Secondary-Only:è¿™ç§ç±»åž‹çš„èŠ‚ç‚¹å’ŒsecondaryèŠ‚ç‚¹ä¸€æ ·æ‹¥æœ‰æ•°æ®å‰¯æœ¬ï¼Œä½†æ˜¯å®ƒä»¬åœ¨ä»»ä½•æƒ…å½¢ä¸‹éƒ½æˆä¸ºä¸äº†primaryèŠ‚ç‚¹ã€‚ Hidden:è¿™ç§ç±»åž‹çš„èŠ‚ç‚¹å¯¹å®¢æˆ·ç«¯ç¨‹åºæ¥è¯´æ˜¯ä¸å¯è§çš„ï¼ŒåŒæ ·ä¹Ÿä¸èƒ½æˆä¸ºprimaryèŠ‚ç‚¹ï¼Œä½†æ˜¯Hiddenæˆå‘˜èƒ½å¤Ÿå‚ä¸Žé€‰ä¸¾æŠ•ç¥¨ã€‚ Delayedï¼šè¿™ç§ç±»åž‹çš„æˆå‘˜é€šè¿‡äººä¸ºçš„è®¾ç½®ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªæ—¶é—´æ¥å»¶è¿Ÿä»ŽprimaryèŠ‚ç‚¹åŒæ­¥æ•°æ®ã€‚Delayedæˆå‘˜çš„ä½œç”¨åœ¨äºŽå¸®åŠ©é›†ç¾¤ä»Žä¸€äº›è¯¯æ“ä½œä¸­æ¢å¤ï¼Œæ¯”å¦‚ç®¡ç†å‘˜è¯¯åˆ é™¤äº†æŸä¸ªé›†åˆã€‚ä¸è‡³äºŽè¿…é€Ÿæ‰©æ•£åˆ°æ•´ä¸ªé›†ç¾¤ä¸­ã€‚å› æ­¤DelayedèŠ‚ç‚¹å¿…é¡»ä¸èƒ½æˆä¸ºprimaryèŠ‚ç‚¹ï¼ˆpriorityä¸º0ï¼‰å¹¶ä¸”æ˜¯Hiddençš„ã€‚ Non-Votingï¼šè¿™å°±æ˜¯ä¸Šé¢æåˆ°äº†æ²¡æœ‰é€‰ä¸¾æƒçš„secondaryèŠ‚ç‚¹ã€‚è¿™ç§ç±»åž‹çš„èŠ‚ç‚¹ä¸€èˆ¬å½“é›†ç¾¤èŠ‚ç‚¹æ•°è¶…è¿‡12æ‰ä¼šéœ€è¦ã€‚ Arbitersï¼šä»²è£è€…åªå‚ä¸ŽæŠ•ç¥¨ä¸æ‹¥æœ‰å®žé™…çš„æ•°æ®ï¼Œå› æ­¤å®ƒå¯¹ç‰©ç†èµ„æºè¦æ±‚ä¸ä¸¥æ ¼ã€‚ æ•…éšœåˆ‡æ¢å‰¯æœ¬é›†èƒ½å¤Ÿè‡ªåŠ¨è¿›è¡Œæ•…éšœåˆ‡æ¢æ¢å¤ã€‚å¦‚æžœprimaryæŽ‰çº¿æˆ–è€…æ— ååº”ä¸”å¤šæ•°çš„å‰¯æœ¬é›†æˆå‘˜èƒ½å¤Ÿç›¸äº’è¿žæŽ¥ï¼Œåˆ™é€‰å‡ºä¸€ä¸ªæ–°çš„primaryã€‚ åœ¨å¤šæ•°æƒ…å†µä¸‹ï¼Œå½“primaryå®•æœºã€ä¸å¯ç”¨æˆ–è€…æ˜¯ä¸é€‚åˆåšprimaryæ—¶ï¼Œåœ¨æ²¡æœ‰ç®¡ç†è€…å¹²é¢„çš„å‡ ç§’åŽä¼šè¿›è¡Œæ•…éšœåˆ‡æ¢ã€‚ å¦‚æžœMongoDBéƒ¨ç½²æ²¡æœ‰å¦‚é¢„æœŸé‚£æ ·è¿›è¡Œæ•…éšœåˆ‡æ¢ï¼Œåˆ™å¯èƒ½æ˜¯ä¸‹é¢çš„é—®é¢˜ï¼š å‰©ä½™çš„æˆå‘˜ä¸ªæ•°å°‘äºŽå‰¯æœ¬é›†çš„ä¸€åŠ æ²¡æœ‰æˆå‘˜æœ‰èµ„æ ¼æˆä¸ºprimary æ•°æ®å›žæ»šå¤šæ•°æƒ…å†µä¸‹ï¼Œå›žæ»šæ“ä½œå¯ä»¥ä¼˜é›…çš„å¯¹ä¸èƒ½è¿›è¡Œæ•…éšœåˆ‡æ¢æ¢å¤çš„æƒ…å†µè¿›è¡Œæ¢å¤ã€‚ Rollbacksæ“ä½œå‘ç”Ÿåœ¨primaryå¤„ç†å†™æ“ä½œï¼Œä½†å…¶å®ƒæˆå‘˜æ²¡æœ‰æˆåŠŸçš„è¿›è¡Œå¤åˆ¶ä¹‹å‰primaryæŽ‰çº¿æ—¶ã€‚å½“å…ˆå‰çš„primaryå¼€å§‹å¤åˆ¶æ—¶ï¼Œåˆ™è¡¨çŽ°å‡ºrollbackã€‚å¦‚æžœæ“ä½œå¤åˆ¶åˆ°å…¶å®ƒæˆå‘˜ï¼Œè¯¥æˆå‘˜å¯ç”¨ï¼Œå¹¶ä¸”å¯ä»¥å’Œå¤§å¤šæ•°çš„å‰¯æœ¬é›†è¿žæŽ¥ï¼Œåˆ™æ²¡æœ‰rollbackã€‚ Rollbacksåˆ é™¤äº†é‚£äº›æ²¡æœ‰è¿›è¡Œå¤åˆ¶çš„æ“ä½œï¼Œä»¥ä¿è¯æ•°æ®é›†çš„ä¸€è‡´æ€§ã€‚ æŠ•ç¥¨é€‰ä¸¾å½“ä»»æ„çš„æ•…éšœåˆ‡æ¢å‘ç”Ÿï¼Œéƒ½ä¼šä¼´éšç€ä¸€ä¸ªé€‰ä¸¾çš„å‡ºçŽ°ï¼Œä»¥æ­¤æ¥å†³å®šå“ªä¸ªæˆå‘˜æˆä¸ºprimaryã€‚ é€‰ä¸¾æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œç”¨äºŽå‰¯æœ¬é›†ä¸­çš„æˆå‘˜æ— éœ€ç®¡ç†å‘˜çš„å¹²é¢„ï¼Œè‡ªåŠ¨çš„é€‰å‡ºä¸€ä¸ªæ–°çš„primaryã€‚é€‰ä¸¾å¯ä»¥è®©å‰¯æœ¬é›†å¿«é€Ÿå’Œåšå†³çš„ä»Žæ•…éšœä¸­æ¢å¤ã€‚ å½“primaryå˜ä¸ºä¸å¯è¾¾æ—¶ï¼Œsecondaryæˆå‘˜å‘èµ·é€‰ä¸¾ï¼Œç¬¬ä¸€ä¸ªæ”¶åˆ°å¤§å¤šæ•°é€‰ç¥¨çš„æˆå‘˜æˆä¸ºæ–°çš„primaryã€‚ æˆå‘˜ä¼˜å…ˆçº§åœ¨å‰¯æœ¬é›†ä¸­ï¼Œæ¯ä¸ªæˆå‘˜éƒ½æœ‰ä¼˜å…ˆçº§ï¼Œå®ƒå¯ä»¥å¸®åŠ©å†³å®šé€‰ä¸¾å‡ºprimaryã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„æˆå‘˜çš„ä¼˜å…ˆçº§éƒ½ä¸º1ã€‚ ä¸€è‡´æ€§åœ¨MongoDBä¸­ï¼Œæ‰€æœ‰é’ˆå¯¹äºŽprimaryçš„è¯»æ“ä½œéƒ½ä¸Žæœ€åŽçš„å†™æ“ä½œç»“æžœç›¸ä¸€è‡´ã€‚ å¦‚æžœå®¢æˆ·ç«¯é…ç½®äº†è¯»é€‰é¡¹ä»¥å…è®¸secondaryè¯»ï¼Œè¯»æ“ä½œèƒ½ä»Žæ²¡æœ‰è¿‘æœŸå¤åˆ¶æ›´æ–°æˆ–æ“ä½œçš„secondaryæˆå‘˜è¿”å›žç»“æžœã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæŸ¥è¯¢æ“ä½œå¯èƒ½è¿”å›žä¹‹å‰çš„çŠ¶æ€ã€‚ è¿™ç§è¡Œä¸ºæœ‰æ—¶ç§°ä¸ºæœ€ç»ˆä¸€è‡´æ€§ï¼Œå› ä¸ºsecodaryæˆå‘˜çš„çŠ¶æ€æœ€ç»ˆéƒ½ä¼šæ˜¯primaryçš„çŠ¶æ€ã€‚MongoDBä¸èƒ½ä¿è¯ä»Žsecondaryæˆå‘˜çš„è¯»æ“ä½œçš„å¼ºä¸€è‡´æ€§ã€‚ æ²¡æœ‰åŠžæ³•ä¿è¯ä»Žsecondaryæˆå‘˜è¯»çš„ä¸€è‡´æ€§ï¼Œé™¤éžåœ¨é…ç½®æ—¶ä¿è¯å†™æ“ä½œæˆåŠŸçš„åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šéƒ½æ‰§è¡ŒæˆåŠŸåŽæ‰è¿”å›žæˆåŠŸã€‚ éƒ¨ç½²æž¶æž„æž¶æž„ä¸å­˜åœ¨ä¸€ä¸ªç†æƒ³çš„å‰¯æœ¬é›†æž¶æž„å¯ä»¥æ»¡è¶³ä»»æ„éƒ¨ç½²çŽ¯å¢ƒã€‚ æœ€å°çš„å‰¯æœ¬é›†æŽ¨èæž¶æž„ä¸ºä¸‰æˆå‘˜é›†åˆï¼Œå…¶ä¸­ä¸€ä¸ªä¸ºprimaryï¼Œå¦å¤–ä¸¤ä¸ªä¸ºsecondaryï¼Œsecondaryåœ¨ä¸€å®šæƒ…å†µä¸‹å¯ä»¥æˆä¸ºprimaryã€‚ å¦‚æžœå‰¯æœ¬é›†ä¸­çš„æˆå‘˜å¤šäºŽä¸‰ä¸ªï¼Œåˆ™éœ€è¦éµç…§ä¸‹é¢çš„æž¶æž„æ¡ä»¶ï¼š é›†åˆä¸­æœ‰å¥‡æ•°ä¸ªå‚ä¸ŽæŠ•ç¥¨çš„æˆå‘˜ã€‚å¦‚æžœæœ‰å¶æ•°ä¸ªæŠ•ç¥¨æˆå‘˜ï¼Œåˆ™éƒ¨ç½²ä¸€ä¸ªä»²è£è€…å°†ä¸ªæ•°å˜ä¸ºå¥‡æ•°ã€‚ é›†åˆä¸­åŒä¸€æ—¶åˆ»ä¸å¤šäºŽ7ä¸ªå‚ä¸ŽæŠ•ç¥¨çš„æˆå‘˜ å¦‚æžœä¸æƒ³è®©æŸäº›æˆå‘˜åœ¨æ•…éšœåˆ‡æ¢æ—¶æˆä¸ºprimaryï¼Œåˆ™å°†å®ƒä»¬çš„ä¼˜å…ˆçº§è®¾ä¸º0ã€‚ é›†åˆçš„å¤šæ•°æˆå‘˜è¿è¡Œåœ¨ä¸»è¦çš„æ•°æ®ä¸­å¿ƒ åœ°ç†ä¸Šçš„åˆ†å¸ƒå¼é›†ä¸€ä¸ªåŸºäºŽåœ°ç†çš„åˆ†å¸ƒå¼å‰¯æœ¬é›†å¯ä»¥åº”å¯¹ä¸€ä¸ªæ•°æ®ä¸­å¿ƒæ¢å¤å¤±è´¥çš„æƒ…å†µã€‚è¿™ç§é›†åˆè‡³å°‘åŒ…å«äº†ä¸€ä¸ªåœ¨å¤‡ä»½æ•°æ®ä¸­å¿ƒçš„é›†åˆæˆå‘˜ã€‚ å›¾ï¼šåŸºäºŽåœ°ç†ä¸Šçš„åˆ†å¸ƒå¼å‰¯æœ¬é›† å¦‚æžœprimaryæŽ‰çº¿ï¼Œåˆ™å‰¯æœ¬é›†é€‰å‡ºä¸€ä¸ªæ–°çš„primaryï¼›å¦‚æžœä¸»æ•°æ®ä¸­å¿ƒå’Œå¤‡æ•°æ®ä¸­å¿ƒè¿žæŽ¥å¤±è´¥ï¼Œå¤‡æ•°æ®ä¸­å¿ƒçš„secondaryä¸èƒ½æˆä¸ºprimaryã€‚å¦‚æžœä¸»æ•°æ®ä¸­å¿ƒå¤±è´¥ï¼Œåˆ™éœ€è¦äººä¸ºçš„ä»Žå¤‡æ•°æ®ä¸­å¿ƒæ¢å¤æ•°æ®ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§æž¶æž„ä¸‹ï¼Œå¿…é¡»æ³¨æ„åœ¨ä¸»æ•°æ®ä¸­å¿ƒè¦ä¿æŒå¥‡æ•°ä¸ªå‚ä¸ŽæŠ•ç¥¨çš„æˆå‘˜ï¼Œä¸Šå›¾ä¸­åˆ™éœ€è¦åœ¨ä¸»æ•°æ®ä¸­å¿ƒæ·»åŠ ä¸€ä¸ªä»²è£è€…ã€‚ éžç”Ÿäº§è€…æˆå‘˜åœ¨æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½æƒ³æœ‰ä¸€ä¸ªæˆå‘˜èƒ½å¤Ÿæ‹·è´æ•´ä¸ªçš„æ•°æ®é›†ï¼Œä½†å¹¶ä¸ä½¿å…¶æˆä¸ºprimaryã€‚è¿™ç§æˆå‘˜å¯ä»¥ä½œä¸ºå¤‡ä»½ã€æ”¯æŒæŠ¥å‘Šæ“ä½œæˆ–è€…ä½œä¸ºä¸€ä¸ªå†·å¤‡ã€‚è¿™ç§æˆå‘˜è¢«åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š ä½Žä¼˜å…ˆçº§ï¼šé€šè¿‡local.system.replset.members[n].priorityè®¾ç½®æˆå‘˜çš„ä½Žä¼˜å…ˆçº§ï¼Œä»Žè€Œä½¿å…¶ä¸å¯èƒ½æˆä¸ºprimaryã€‚ éšè—ï¼ˆHiddenï¼‰ï¼šè¿™ç§æˆå‘˜ä¸å¯èƒ½primaryï¼Œå¯¹å®¢æˆ·ç«¯ä¸å¯è§ã€‚ æŠ•ç¥¨ï¼ˆVotingï¼‰ï¼šè¿™ä¼šæ”¹å˜è¿›è¡Œé€‰ä¸¾çš„å‰¯æœ¬é›†çš„ç¥¨æ•°ã€‚ å‰¯æœ¬é›†é…ç½®12345replication: oplogSizeMB: &lt;int&gt; replSetName: &lt;string&gt; secondaryIndexPrefetch: &lt;string&gt; enableMajorityReadConcern: &lt;boolean&gt; ## Deprecated in 3.6 replication.oplogSizeMBï¼šoplogæœ€å¤§å€¼ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥mongodè¿›ç¨‹åŸºäºŽå¯ç”¨çš„æœ€å¤§ç©ºé—´é‡åˆ›å»ºoplogã€‚å¯¹äºŽ64ä½ç³»ç»Ÿï¼Œoplogé€šå¸¸å å¯ç”¨ç£ç›˜ç©ºé—´çš„5ï¼…ã€‚ ä¸€æ—¦mongodç¬¬ä¸€æ¬¡åˆ›å»ºäº†oplogï¼Œæ›´æ”¹replication.oplogSizeMBé€‰é¡¹å°†ä¸ä¼šå½±å“oplogçš„å¤§å°ã€‚ è¦æ›´æ”¹æ­£åœ¨è¿è¡Œçš„å‰¯æœ¬é›†æˆå‘˜çš„oplogå¤§å°ï¼Œè¯·ä½¿ç”¨replSetResizeOplogç®¡ç†å‘½ä»¤ã€‚replSetResizeOplogå¯ä»¥åŠ¨æ€è°ƒæ•´oplogçš„å¤§å°ï¼Œè€Œæ— éœ€é‡æ–°å¯åŠ¨mongodã€‚ replication.replSetNameï¼šå‰¯æœ¬é›†åç§°ã€‚ å¦‚æžœåº”ç”¨ç¨‹åºè¿žæŽ¥åˆ°å¤šä¸ªå‰¯æœ¬é›†ï¼Œåˆ™æ¯ä¸ªå‰¯æœ¬é›†éƒ½åº”å…·æœ‰ä¸åŒçš„åç§°ã€‚æŸäº›é©±åŠ¨ç¨‹åºæŒ‰å‰¯æœ¬é›†åç§°å¯¹å‰¯æœ¬é›†è¿›è¡Œè¿žæŽ¥ã€‚ replication.secondaryIndexPrefetchï¼šå‰¯æœ¬é›†æˆå‘˜åœ¨æŽ¥å—oplogä¹‹å‰æ˜¯å¦åŠ è½½ç´¢å¼•åˆ°å†…å­˜ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œsecondaryä¼šå°†æ‰€æœ‰ç´¢å¼•éƒ½åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ é€‰é¡¹æœ‰ï¼š noneï¼šsecondaryèŠ‚ç‚¹ä¸ä¼šå°†ç´¢å¼•åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ allï¼šåŠ è½½æ‰€æœ‰ç´¢å¼•åˆ°å†…å­˜ä¸­ã€‚ _id_onlyï¼šå€¼åŠ è½½_idç´¢å¼•åˆ°å†…å­˜ä¸­ã€‚ å‰¯æœ¬é›†å®žä¾‹çŽ¯å¢ƒä¸‰å°æœåŠ¡å™¨ï¼š 123192.168.198.21192.168.198.22192.168.198.23 é…ç½®æ–‡ä»¶ä¸‰å°æœåŠ¡å™¨æ·»åŠ ç›¸åŒçš„replicationé…ç½®ï¼š 1234567# /etc/mongod.confnet: port: 27017 bindIp: 192.168.198.21 # æ ¹æ®ä¸»æœºIPæ›´æ”¹ï¼Œæˆ–è€…ä½¿ç”¨0.0.0.0replication: replSetName: mongo.test é‡å¯mongodï¼š 1systemctl restart mongod åˆå§‹åŒ–å‰¯æœ¬é›†åœ¨ä»»æ„ä¸€å°ä¸Šè¿žæŽ¥mongodbï¼Œåˆå§‹åŒ–ï¼š 123# mongo&gt; use admin&gt; rs.initiate() 12345&#123; &quot;info2&quot; : &quot;no configuration specified. Using a default configuration for the set&quot;, &quot;me&quot; : &quot;192.168.198.21:27017&quot;, &quot;ok&quot; : 1&#125; ç¡®è®¤é…ç½®ï¼š 1&gt; rs.conf() 1234567891011121314151617181920212223242526272829303132333435&#123; &quot;_id&quot; : &quot;mongo.test&quot;, &quot;version&quot; : 1, &quot;protocolVersion&quot; : NumberLong(1), &quot;members&quot; : [ &#123; &quot;_id&quot; : 0, &quot;host&quot; : &quot;192.168.198.21:27017&quot;, &quot;arbiterOnly&quot; : false, &quot;buildIndexes&quot; : true, &quot;hidden&quot; : false, &quot;priority&quot; : 1, &quot;tags&quot; : &#123; &#125;, &quot;slaveDelay&quot; : NumberLong(0), &quot;votes&quot; : 1 &#125; ], &quot;settings&quot; : &#123; &quot;chainingAllowed&quot; : true, &quot;heartbeatIntervalMillis&quot; : 2000, &quot;heartbeatTimeoutSecs&quot; : 10, &quot;electionTimeoutMillis&quot; : 10000, &quot;catchUpTimeoutMillis&quot; : 60000, &quot;getLastErrorModes&quot; : &#123; &#125;, &quot;getLastErrorDefaults&quot; : &#123; &quot;w&quot; : 1, &quot;wtimeout&quot; : 0 &#125;, &quot;replicaSetId&quot; : ObjectId(&quot;5b864c759be9fb9508a68f6e&quot;) &#125;&#125; æ·»åŠ æˆå‘˜12&gt; rs.add(&#123;host: "192.168.198.22:27017"&#125;)&gt; rs.add(&#123;host: "192.168.198.23:27017", priority: 5&#125;) # ä¼˜å…ˆçº§å¤§çš„ä¼˜å…ˆè¢«é€‰å–ä¸ºä¸»åº“ æŸ¥çœ‹å‰¯æœ¬é›†çŠ¶æ€1&gt; rs.status() 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103&#123; &quot;set&quot; : &quot;mongo.test&quot;, &quot;date&quot; : ISODate(&quot;2018-08-29T07:47:42.016Z&quot;), &quot;myState&quot; : 2, &quot;term&quot; : NumberLong(2), &quot;syncingTo&quot; : &quot;192.168.198.23:27017&quot;, &quot;syncSourceHost&quot; : &quot;192.168.198.23:27017&quot;, &quot;syncSourceId&quot; : 2, &quot;heartbeatIntervalMillis&quot; : NumberLong(2000), &quot;optimes&quot; : &#123; &quot;lastCommittedOpTime&quot; : &#123; &quot;ts&quot; : Timestamp(1535528853, 1), &quot;t&quot; : NumberLong(2) &#125;, &quot;appliedOpTime&quot; : &#123; &quot;ts&quot; : Timestamp(1535528853, 1), &quot;t&quot; : NumberLong(2) &#125;, &quot;durableOpTime&quot; : &#123; &quot;ts&quot; : Timestamp(1535528853, 1), &quot;t&quot; : NumberLong(2) &#125; &#125;, &quot;members&quot; : [ &#123; &quot;_id&quot; : 0, &quot;name&quot; : &quot;192.168.198.21:27017&quot;, &quot;health&quot; : 1, &quot;state&quot; : 2, &quot;stateStr&quot; : &quot;SECONDARY&quot;, &quot;uptime&quot; : 844, &quot;optime&quot; : &#123; &quot;ts&quot; : Timestamp(1535528853, 1), &quot;t&quot; : NumberLong(2) &#125;, &quot;optimeDate&quot; : ISODate(&quot;2018-08-29T07:47:33Z&quot;), &quot;syncingTo&quot; : &quot;192.168.198.23:27017&quot;, &quot;syncSourceHost&quot; : &quot;192.168.198.23:27017&quot;, &quot;syncSourceId&quot; : 2, &quot;infoMessage&quot; : &quot;&quot;, &quot;configVersion&quot; : 3, &quot;self&quot; : true, &quot;lastHeartbeatMessage&quot; : &quot;&quot; &#125;, &#123; &quot;_id&quot; : 1, &quot;name&quot; : &quot;192.168.198.22:27017&quot;, &quot;health&quot; : 1, &quot;state&quot; : 2, &quot;stateStr&quot; : &quot;SECONDARY&quot;, &quot;uptime&quot; : 577, &quot;optime&quot; : &#123; &quot;ts&quot; : Timestamp(1535528853, 1), &quot;t&quot; : NumberLong(2) &#125;, &quot;optimeDurable&quot; : &#123; &quot;ts&quot; : Timestamp(1535528853, 1), &quot;t&quot; : NumberLong(2) &#125;, &quot;optimeDate&quot; : ISODate(&quot;2018-08-29T07:47:33Z&quot;), &quot;optimeDurableDate&quot; : ISODate(&quot;2018-08-29T07:47:33Z&quot;), &quot;lastHeartbeat&quot; : ISODate(&quot;2018-08-29T07:47:41.366Z&quot;), &quot;lastHeartbeatRecv&quot; : ISODate(&quot;2018-08-29T07:47:40.250Z&quot;), &quot;pingMs&quot; : NumberLong(0), &quot;lastHeartbeatMessage&quot; : &quot;&quot;, &quot;syncingTo&quot; : &quot;192.168.198.23:27017&quot;, &quot;syncSourceHost&quot; : &quot;192.168.198.23:27017&quot;, &quot;syncSourceId&quot; : 2, &quot;infoMessage&quot; : &quot;&quot;, &quot;configVersion&quot; : 3 &#125;, &#123; &quot;_id&quot; : 2, &quot;name&quot; : &quot;192.168.198.23:27017&quot;, &quot;health&quot; : 1, &quot;state&quot; : 1, &quot;stateStr&quot; : &quot;PRIMARY&quot;, &quot;uptime&quot; : 571, &quot;optime&quot; : &#123; &quot;ts&quot; : Timestamp(1535528853, 1), &quot;t&quot; : NumberLong(2) &#125;, &quot;optimeDurable&quot; : &#123; &quot;ts&quot; : Timestamp(1535528853, 1), &quot;t&quot; : NumberLong(2) &#125;, &quot;optimeDate&quot; : ISODate(&quot;2018-08-29T07:47:33Z&quot;), &quot;optimeDurableDate&quot; : ISODate(&quot;2018-08-29T07:47:33Z&quot;), &quot;lastHeartbeat&quot; : ISODate(&quot;2018-08-29T07:47:41.366Z&quot;), &quot;lastHeartbeatRecv&quot; : ISODate(&quot;2018-08-29T07:47:40.128Z&quot;), &quot;pingMs&quot; : NumberLong(0), &quot;lastHeartbeatMessage&quot; : &quot;&quot;, &quot;syncingTo&quot; : &quot;&quot;, &quot;syncSourceHost&quot; : &quot;&quot;, &quot;syncSourceId&quot; : -1, &quot;infoMessage&quot; : &quot;&quot;, &quot;electionTime&quot; : Timestamp(1535528302, 1), &quot;electionDate&quot; : ISODate(&quot;2018-08-29T07:38:22Z&quot;), &quot;configVersion&quot; : 3 &#125; ], &quot;ok&quot; : 1&#125; å‰¯æœ¬é›†ä¼˜åŒ–è¯»å†™åˆ†ç¦»å®˜ç½‘ä¸­å»ºè®®ä¸ä½¿ç”¨å‘ä»ŽèŠ‚ç‚¹å–æ•°æ®ã€‚åŽŸå› ï¼š æ‰€æœ‰çš„ä»ŽèŠ‚ç‚¹æ‹¥æœ‰ä¸Žä¸»èŠ‚ç‚¹ä¸€æ ·çš„å†™å…¥è´Ÿè½½ï¼Œè¯»çš„åŠ å…¥ä¼šå¢žåŠ å…¶è´Ÿè½½ å¯¹äºŽåˆ†ç‰‡çš„é›†åˆï¼Œåœ¨å¹³è¡¡å™¨çš„å…³ç³»ä¸‹ï¼Œæ•°æ®çš„è¿”å›žç»“æžœå¯èƒ½ä¼šç¼ºå¤±æˆ–è€…é‡å¤æŸéƒ¨åˆ†æ•°æ®ã€‚ ç›¸å¯¹è€Œè¨€ï¼Œå®˜æ–¹å»ºè®®ä½¿ç”¨åˆ†ç‰‡ï¼ˆshardï¼‰æ¥åˆ†æ•£è¯»å†™è¯·æ±‚ã€‚ ä½¿ç”¨çš„åœºæ™¯ï¼› æ“ä½œä¸å½±å“å‰ç«¯åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚å¤‡ä»½æˆ–è€…æŠ¥è¡¨ï¼› åœ¨ä¸€ä¸ªç‰©ç†ä¸Šåˆ†å¸ƒçš„å‰¯æœ¬é›†ç¾¤ä¸­ï¼Œä¸ºäº†å‡å°‘åº”ç”¨ç¨‹åºçš„å»¶è¿Ÿï¼Œå¯èƒ½ä¼šä¼˜å…ˆé€‰æ‹©ç¦»åº”ç”¨ç¨‹åºæ›´è¿‘çš„secondaryèŠ‚ç‚¹è€Œä¸æ˜¯è¿œåœ¨åƒé‡Œä¹‹å¤–æœºæˆ¿çš„ä¸»èŠ‚ç‚¹ï¼› æ•…éšœå‘ç”Ÿæ—¶å€™èƒ½å¤Ÿæä¾›ä¸€ä¸ªä¼˜é›…çš„é™çº§ã€‚å‰¯æœ¬é›†primaryèŠ‚ç‚¹å®•æœºåŽå†é€‰å‡ºæ–°çš„primaryèŠ‚ç‚¹è¿™æ®µæ—¶é—´å†…ï¼ˆ10ç§’æˆ–æ›´é•¿æ—¶é—´ï¼‰èƒ½å¤Ÿä¾ç„¶å“åº”å®¢æˆ·ç«¯åº”ç”¨çš„è¯»è¯·æ±‚ï¼› åº”ç”¨èƒ½å¤Ÿå®¹å¿ä¸€å®šç¨‹åº¦çš„æ•°æ®ä¸ä¸€è‡´æ€§ã€‚ å‰¯æœ¬é›†ä¸æ˜¯ä¸ºäº†æé«˜è¯»æ€§èƒ½å­˜åœ¨çš„ï¼Œåœ¨è¿›è¡Œoplogçš„æ—¶å€™ï¼Œè¯»æ“ä½œæ—¶è¢«é˜»å¡žçš„ã€‚æé«˜è¯»å–æ€§èƒ½åº”è¯¥ä½¿ç”¨åˆ†ç‰‡å’Œç´¢å¼•ï¼Œå®ƒçš„å­˜åœ¨æ›´å¤šæ˜¯ä½œä¸ºæ•°æ®å†—ä½™ï¼Œå¤‡ä»½ã€‚å°¤å…¶å½“ä¸»åº“æœ¬æ¥å°±é¢ä¸´ç€å¤§é‡çš„å†™å…¥åŽ‹åŠ›ï¼Œå¯¹äºŽå‰¯æœ¬é›†çš„èŠ‚ç‚¹ï¼Œä¹ŸåŒæ ·ä¼šé¢ä¸´å†™çš„åŽ‹åŠ›ã€‚ Read References: åº”ç”¨ç¨‹åºé©±åŠ¨é€šè¿‡read referenceæ¥è®¾å®šå¦‚ä½•å¯¹å‰¯æœ¬é›†è¿›è¡Œè¯»å–æ“ä½œï¼Œé»˜è®¤çš„,å®¢æˆ·ç«¯é©±åŠ¨æ‰€æœ‰çš„è¯»æ“ä½œéƒ½æ˜¯ç›´æŽ¥è®¿é—®primaryèŠ‚ç‚¹çš„ï¼Œä»Žè€Œä¿è¯äº†æ•°æ®çš„ä¸¥æ ¼ä¸€è‡´æ€§ã€‚ ä½†æœ‰æ—¶ä¸ºäº†ç¼“è§£ä¸»èŠ‚ç‚¹çš„åŽ‹åŠ›ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ç›´æŽ¥ä»ŽsecondaryèŠ‚ç‚¹è¯»å–ï¼Œåªéœ€è¦ä¿è¯æœ€ç»ˆä¸€è‡´æ€§å°±å¯ä»¥äº†ã€‚ MongoDB 2.0ä¹‹åŽæ”¯æŒäº”ç§çš„read preferenceæ¨¡å¼ï¼š Primaryï¼šé»˜è®¤ï¼Œåªä»Žä¸»èŠ‚ç‚¹ä¸Šè¿›è¡Œè¯»å–æ“ä½œã€‚ primaryPreferredï¼šåœ¨ç»å¤§éƒ¨åˆ†çš„æƒ…å½¢éƒ½æ˜¯ä»Žä¸»èŠ‚ç‚¹ä¸Šè¯»å–æ•°æ®çš„,åªæœ‰å½“ä¸»èŠ‚ç‚¹ä¸å¯ç”¨çš„æ—¶å€™ï¼Œæ¯”å¦‚åœ¨è¿›è¡Œfailoverçš„10ç§’æˆ–æ›´é•¿çš„æ—¶é—´å†…ä¼šä»ŽsecondaryèŠ‚ç‚¹è¯»å–æ•°æ®ã€‚ secondaryï¼šåªä»ŽsecondaryèŠ‚ç‚¹ä¸Šè¿›è¡Œè¯»å–æ“ä½œï¼Œå­˜åœ¨çš„é—®é¢˜æ˜¯secondaryèŠ‚ç‚¹çš„æ•°æ®ä¼šæ¯”primaryèŠ‚ç‚¹æ•°æ®â€œæ—§â€ã€‚ secondaryPreferredï¼šä¼˜å…ˆä»ŽsecondaryèŠ‚ç‚¹è¿›è¡Œè¯»å–æ“ä½œã€‚ nearestï¼šæ—¢æœ‰å¯èƒ½ä»Žprimaryï¼Œä¹Ÿæœ‰å¯èƒ½ä»ŽsecondaryèŠ‚ç‚¹è¯»å–ï¼Œè¿™ä¸ªå†³ç­–æ˜¯é€šè¿‡ä¸€ä¸ªå«member selectionè¿‡ç¨‹å¤„ç†çš„ã€‚ï¼ˆç½‘ç»œå»¶è¿Ÿï¼‰ åŸºæœ¬ä¸Šå¸¸ç”¨çš„æ˜¯ï¼ŒPrimaryï¼Œsecondaryï¼Œnearest å‰¯æœ¬é›†çš„è®¾å®šä¸­å¯ä»¥é€šè¿‡TagæŠŠæˆå‘˜å½’ç±»ï¼Œé€šè¿‡ä¸‹é¢æ–¹æ³•æŒ‡å®šè¯»çš„ç±»åž‹ï¼š ç¨‹åºè¿žæŽ¥çš„æ—¶å€™ï¼ŒæŒ‡å®šè¯»çš„ç±»åž‹ReadPreference ç”¨mongoå‘½ä»¤è¿žæŽ¥ï¼Œåªå¯¹å½“å‰è¿žæŽ¥æœ‰æ•ˆ 1&gt; db.getMongo().setReadPref(``'secondaryPreferred'``) OpLogoplogæ˜¯ä¸€ç§ç‰¹æ®Šçš„capped collection,ç”¨æ¥æ»šåŠ¨çš„ä¿å­˜MongoDBä¸­æ‰€æœ‰æ•°æ®æ“ä½œçš„æ—¥å¿—ã€‚å‰¯æœ¬é›†ä¸­secondaryèŠ‚ç‚¹å¼‚æ­¥çš„ä»ŽprimaryèŠ‚ç‚¹åŒæ­¥oplogç„¶åŽé‡æ–°æ‰§è¡Œå®ƒè®°å½•çš„æ“ä½œï¼Œä»¥æ­¤è¾¾åˆ°äº†æ•°æ®åŒæ­¥çš„ä½œç”¨ã€‚è¿™å°±è¦æ±‚oplogå¿…é¡»æ˜¯å¹‚ç­‰çš„ï¼Œä¹Ÿå°±æ˜¯é‡å¤æ‰§è¡Œç›¸åŒçš„oplogè®°å½•å¾—åˆ°çš„æ•°æ®ç»“æž„å¿…é¡»æ˜¯ç›¸åŒçš„ã€‚ äº‹å®žä¸Šå‰¯æœ¬é›†ä¸­æ‰€æœ‰èŠ‚ç‚¹ä¹‹é—´éƒ½ç›¸äº’è¿›è¡Œheartbeatæ¥ç»´æŒè”ç³»ï¼Œä»»ä½•èŠ‚ç‚¹éƒ½èƒ½ä»Žå…¶å®ƒèŠ‚ç‚¹å¤åˆ¶oplogã€‚ capped collectionæ˜¯MongoDBä¸­ä¸€ç§æä¾›é«˜æ€§èƒ½æ’å…¥ã€è¯»å–å’Œåˆ é™¤æ“ä½œçš„å›ºå®šå¤§å°é›†åˆã€‚å½“é›†åˆè¢«å¡«æ»¡çš„æ—¶å€™ï¼Œæ–°çš„æ’å…¥çš„æ–‡æ¡£ä¼šè¦†ç›–è€çš„æ–‡æ¡£ã€‚å› ä¸ºoplogæ˜¯capped collectionæ‰€ä»¥æŒ‡å®šå®ƒçš„å¤§å°éžå¸¸é‡è¦ã€‚å¦‚æžœå¤ªå°é‚£ä¹ˆè€çš„æ–‡æ¡£å¾ˆå¿«å°±è¢«è¦†ç›–äº†ï¼Œé‚£ä¹ˆå®•æœºçš„èŠ‚ç‚¹å°±å¾ˆå®¹æ˜“å‡ºçŽ°æ— æ³•åŒæ­¥æ•°æ®çš„ç»“æžœï¼Œä½†ä¹Ÿä¸æ˜¯è¶Šå¤§è¶Šå¥½ï¼ŒMongoDBåœ¨åˆå§‹åŒ–å‰¯æœ¬é›†çš„æ—¶å€™éƒ½ä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„oplogå¤§å°ï¼š åœ¨64ä½çš„Linux,Solaris,FreeBSDä»¥åŠWindowsç³»ç»Ÿä¸Šï¼ŒMongoDBä¼šåˆ†é…ç£ç›˜å‰©ä½™ç©ºé—´çš„5%ä½œä¸ºoplogçš„å¤§å°ï¼Œå¦‚æžœè¿™éƒ¨åˆ†å°äºŽ1GBåˆ™åˆ†é…1GBçš„ç©ºé—´ã€‚ åœ¨64çš„OS Xç³»ç»Ÿä¸Šä¼šåˆ†é…183MBã€‚ åœ¨32ä½çš„ç³»ç»Ÿä¸Šåˆ™åªåˆ†é…48MBã€‚ é¦–å…ˆç”Ÿäº§çŽ¯å¢ƒä½¿ç”¨MongoDBæ¯«æ— ç–‘é—®å¿…é¡»çš„æ˜¯64ä¸ºæ“ä½œç³»ç»Ÿã€‚å…¶æ¬¡å¤§å¤šæ•°æƒ…å†µä¸‹é»˜è®¤çš„å¤§å°æ˜¯æ¯”è¾ƒé€‚åˆçš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æžœoplogå¤§å°ä¸ºç©ºé—²ç£ç›˜çš„5%ï¼Œå®ƒåœ¨24Hå†…èƒ½è¢«å¡«æ»¡ï¼Œä¹Ÿå°±æ˜¯è¯´secondaryèŠ‚ç‚¹å¯ä»¥åœæ­¢å¤åˆ¶oplogè¾¾24HåŽä»ç„¶èƒ½å¤Ÿcatch upä¸ŠprimaryèŠ‚ç‚¹ã€‚è€Œä¸”é€šå¸¸çš„MongoDBå‰¯æœ¬é›†çš„æ“ä½œé‡è¦æ¯”è¿™ä½Žå¾—å¤šã€‚ oplogæ•°æ®ç»“æž„ï¼š oplogçš„æ•°æ®ç»“æž„å¦‚ä¸‹æ‰€ç¤ºï¼š { ts : â€¦, op: â€¦, ns: â€¦, o: â€¦ o2: â€¦ } tsï¼š8å­—èŠ‚çš„æ—¶é—´æˆ³ï¼Œç”±4å­—èŠ‚unix timestamp + 4å­—èŠ‚è‡ªå¢žè®¡æ•°è¡¨ç¤ºã€‚è¿™ä¸ªå€¼å¾ˆé‡è¦ï¼Œåœ¨é€‰ä¸¾(å¦‚masterå®•æœºæ—¶)æ–°primaryæ—¶ï¼Œä¼šé€‰æ‹©tsæœ€å¤§çš„é‚£ä¸ªsecondaryä½œä¸ºæ–°primaryã€‚ opï¼š1å­—èŠ‚çš„æ“ä½œç±»åž‹ï¼Œä¾‹å¦‚iè¡¨ç¤ºinsertï¼Œdè¡¨ç¤ºdeleteã€‚ nsï¼šæ“ä½œæ‰€åœ¨çš„namespaceã€‚ oï¼šæ“ä½œæ‰€å¯¹åº”çš„document,å³å½“å‰æ“ä½œçš„å†…å®¹ï¼ˆæ¯”å¦‚æ›´æ–°æ“ä½œæ—¶è¦æ›´æ–°çš„çš„å­—æ®µå’Œå€¼ï¼‰ã€‚ o2: åœ¨æ‰§è¡Œæ›´æ–°æ“ä½œæ—¶çš„whereæ¡ä»¶ï¼Œä»…é™äºŽupdateæ—¶æ‰æœ‰è¯¥å±žæ€§ã€‚ å…¶ä¸­opæœ‰ä»¥ä¸‹å‡ ä¸ªå€¼ï¼š â€œiâ€œï¼š insertã€‚ â€œuâ€œï¼š updateã€‚ â€œdâ€œï¼š deleteã€‚ â€œcâ€œï¼š db cmdã€‚ â€œdbâ€œï¼šå£°æ˜Žå½“å‰æ•°æ®åº“ (å…¶ä¸­ns è¢«è®¾ç½®æˆä¸º=&gt;æ•°æ®åº“åç§°+ â€˜.â€™)ã€‚ â€œnâ€œ: no op,å³ç©ºæ“ä½œï¼Œå…¶ä¼šå®šæœŸæ‰§è¡Œä»¥ç¡®ä¿æ—¶æ•ˆæ€§ã€‚ æŸ¥çœ‹oplogå¤§å°ï¼š é€šè¿‡db.printReplicationInfo() å¯ä»¥æŸ¥çœ‹å‰¯æœ¬é›†èŠ‚ç‚¹çš„oplogçŠ¶æ€ï¼š 1234567mongo.test:PRIMARY&gt; db.printReplicationInfo() configured oplog size: 990MBlog length start to end: 2409secs (0.67hrs)oplog first event time: Wed Aug 29 2018 15:38:04 GMT+0800 (CST)oplog last event time: Wed Aug 29 2018 16:18:13 GMT+0800 (CST)now: Wed Aug 29 2018 16:18:19 GMT+0800 (CST) ä¿®æ”¹oplogå¤§å°ï¼š è‹¥é›†ç¾¤æœªå¯åŠ¨è¿‡ï¼Œåˆ™å¯ä»¥é€šè¿‡é…ç½®å‚æ•°æ¥æŒ‡å®šoplogå¤§å°ï¼š 12replication: oplogSizeMB: &lt;int&gt; è‹¥å·²ç»å¯åŠ¨é›†ç¾¤ï¼Œå¯ä»¥åŠ¨æ€ä¿®æ”¹oplogå¤§å°ï¼š 123use localdb.oplog.rs.stats().maxSizedb.adminCommand(&#123;replSetResizeOplog: 1, size: 16000&#125;) å»ºè®®ï¼š åœ¨çŽ°æœ‰çš„å‰¯æœ¬é›†ä¸­ä¿®æ”¹oplogçš„å¤§å°æ˜¯ç›¸å½“éº»çƒ¦çš„è€Œä¸”å½±å“å‰¯æœ¬é›†æ€§èƒ½ï¼Œå› æ­¤æˆ‘ä»¬æœ€å¥½æ˜¯é¢„å…ˆæ ¹æ®åº”ç”¨çš„æƒ…å†µè¯„ä¼°å¥½oplogçš„å¤§å°ï¼šå¦‚æžœåº”ç”¨ç¨‹åºæ˜¯è¯»å¤šå†™å°‘ï¼Œé‚£ä¹ˆé»˜è®¤çš„å¤§å°å·²ç»è¶³å¤Ÿäº†ã€‚ å¦‚æžœä½ çš„åº”ç”¨ä¸‹é¢å‡ ç§åœºæ™¯å¾ˆå¤šå¯èƒ½è€ƒè™‘éœ€è¦æ›´å¤§çš„oplog: åœ¨åŒä¸€ä¸ªæ—¶åˆ»æ›´æ–°å¤šä¸ªæ–‡æ¡£ï¼šoplogä¸ºäº†ç»´æŒå¹‚ç­‰æ€§å¿…é¡»å°†mutil-updatesç¿»è¯‘æˆä¸€ä¸ªä¸ªç‹¬ç«‹çš„æ“ä½œï¼Œè¿™ä¼šç”¨åŽ»å¤§é‡çš„oplogç©ºé—´ï¼Œä½†æ•°æ®åº“ä¸­çš„æ•°æ®é‡å´æ²¡æœ‰ç›¸å¯¹ç§°çš„å¢žåŠ ã€‚ å¤šæ–‡æ¡£åŒæ—¶æ›´æ–°ä»Ž1.1.3å°±æœ‰çš„ç‰¹æ€§ï¼Œåœ¨mongo shellæ‰§è¡Œç±»ä¼¼å¦‚ä¸‹çš„å‘½ä»¤ï¼Œç¬¬å››ä¸ªå‚æ•°å¿…é¡»åˆ¶å®šä¸ºtrueï¼šdb.test.update({foo: &quot;bar&quot;}, {$set: {test: &quot;success!&quot;}}, false, true); åœ¨æ’å…¥æ—¶åŒæ—¶åˆ é™¤ç›¸åŒå¤§å°æ•°æ®ï¼šå’Œä¸Šé¢çš„ç»“æžœä¸€æ ·åœ¨æ•°æ®é‡æ²¡æœ‰å¢žåŠ çš„æƒ…å†µä¸‹å´æ¶ˆè€—äº†å¤§é‡çš„oplogç©ºé—´ã€‚ å¤§é‡çš„In-Placeæ›´æ–°æ“ä½œï¼šIn-Placeæ›´æ–°æ˜¯æŒ‡æ›´æ–°æ–‡æ¡£ä¸­åŽŸæœ‰çš„éƒ¨åˆ†ï¼Œä½†å¹¶ä¸å¢žåŠ æ–‡æ¡£çš„å¤§å°ã€‚ ä¸Šé¢ä¸‰ç‚¹æ€»ç»“èµ·æ¥å°±æ˜¯æ¶ˆè€—äº†å¤§é‡çš„oplogä½†æ˜¯æ•°æ®é‡å´æ²¡æœ‰ç­‰é‡çš„å¢žåŠ ã€‚ æ•°æ®åŒæ­¥æ•°æ®æ»žåŽ: å‰é¢å·²ç»æåˆ°MongoDBå‰¯æœ¬é›†ä¸­secondaryèŠ‚ç‚¹æ˜¯é€šè¿‡oplogæ¥åŒæ­¥primaryèŠ‚ç‚¹æ•°æ®çš„ï¼Œé‚£å…·ä½“çš„ç»†èŠ‚æ˜¯æ€Žä¹ˆæ ·çš„ï¼Ÿåœ¨è¯´æ•°æ®å¦‚ä½•åŒæ­¥ä¹‹é—´å…ˆä»‹ç»ä¸€ä¸‹replication lagï¼Œå› ä¸ºå­˜åœ¨æ•°æ®åŒæ­¥é‚£å¿…ç„¶å­˜åœ¨ä¸€å®šç¨‹åº¦çš„è½åŽã€‚è¿™ä¸ªé—®é¢˜å¯¹äºŽæ•´ä¸ªMongoDBå‰¯æœ¬é›†çš„éƒ¨ç½²æ˜¯è‡³å…³é‡è¦çš„ã€‚ â€œæ»žåŽâ€æ˜¯ä¸å¯é¿å…çš„ï¼Œéœ€è¦åšçš„å°±æ˜¯å°½å¯èƒ½å‡å°è¿™ç§æ»žåŽï¼Œä¸»è¦æ¶‰åŠåˆ°ä»¥ä¸‹å‡ ç‚¹ï¼š ç½‘ç»œå»¶è¿Ÿï¼šè¿™æ˜¯æ‰€æœ‰åˆ†å¸ƒå¼ç³»ç»Ÿéƒ½å­˜åœ¨çš„é—®é¢˜ã€‚æˆ‘ä»¬èƒ½åšçš„å°±æ˜¯å°½å¯èƒ½å‡å°å‰¯æœ¬é›†èŠ‚ç‚¹ä¹‹é—´çš„ç½‘ç»œå»¶è¿Ÿã€‚ ç£ç›˜åžåé‡ï¼šsecondaryèŠ‚ç‚¹ä¸Šæ•°æ®åˆ·å…¥ç£ç›˜çš„é€Ÿåº¦æ¯”primaryèŠ‚ç‚¹ä¸Šæ…¢çš„è¯ä¼šå¯¼è‡´secondaryèŠ‚ç‚¹å¾ˆéš¾è·Ÿä¸ŠprimaryèŠ‚ç‚¹çš„èŠ‚å¥ã€‚ å¹¶å‘ ï¼šå¹¶å‘å¤§çš„æƒ…å†µä¸‹ï¼ŒprimaryèŠ‚ç‚¹ä¸Šçš„ä¸€äº›è€—æ—¶æ“ä½œä¼šé˜»å¡žsecondaryèŠ‚ç‚¹çš„å¤åˆ¶æ“ä½œï¼Œå¯¼è‡´å¤åˆ¶æ“ä½œè·Ÿä¸ä¸Šä¸»èŠ‚ç‚¹çš„å†™å…¥è´Ÿè·ã€‚è§£å†³æ–¹æ³•æ˜¯é€šè¿‡è®¾ç½®æ“ä½œçš„write concerné»˜è®¤çš„å‰¯æœ¬é›†ä¸­å†™å…¥æ“ä½œåªå…³å¿ƒprimaryèŠ‚ç‚¹ï¼Œä½†æ˜¯å¯ä»¥æŒ‡å®šå†™å…¥æ“ä½œåŒæ—¶ä¼ æ’­åˆ°å…¶ä»–secondaryèŠ‚ç‚¹ï¼Œä»£ä»·å°±æ˜¯ä¸¥é‡å½±å“é›†ç¾¤çš„å¹¶å‘æ€§ã€‚ æ³¨æ„ï¼šè€Œä¸”è¿™é‡Œè¿˜å­˜åœ¨ä¸€ä¸ªé—®é¢˜å¦‚æžœï¼Œå¦‚æžœå†™å…¥æ“ä½œå…³å¿ƒçš„æŸä¸ªèŠ‚ç‚¹å®•æœºäº†ï¼Œé‚£ä¹ˆæ“ä½œå°†ä¼šä¸€ç›´è¢«é˜»å¡žç›´åˆ°èŠ‚ç‚¹æ¢å¤ã€‚ é€‚å½“çš„write concernï¼šæˆ‘ä»¬ä¸ºäº†æé«˜é›†ç¾¤å†™æ“ä½œçš„åžåé‡ç»å¸¸ä¼šå°†writer concernè®¾ç½®ä¸ºunacknowledged write concernï¼Œè¿™å¯¼è‡´primaryèŠ‚ç‚¹çš„å†™æ“ä½œå¾ˆå¿«è€ŒsecondaryèŠ‚ç‚¹å¤åˆ¶æ“ä½œè·Ÿä¸ä¸Šã€‚è§£å†³æ–¹æ³•å’Œç¬¬ä¸‰ç‚¹æ˜¯ç±»ä¼¼çš„å°±æ˜¯åœ¨æ€§èƒ½å’Œä¸€è‡´æ€§ä¹‹é—´åšæƒè¡¡ã€‚ æ•°æ®åŒæ­¥: å‰¯æœ¬é›†ä¸­æ•°æ®åŒæ­¥æœ‰ä¸¤ä¸ªé˜¶æ®µã€‚ åˆå§‹åŒ–(initial sync):è¿™ä¸ªè¿‡ç¨‹å‘ç”Ÿåœ¨å½“å‰¯æœ¬é›†ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“æˆ–å…¶ä¸­æŸä¸ªèŠ‚ç‚¹åˆšä»Žå®•æœºä¸­æ¢å¤,æˆ–è€…å‘å‰¯æœ¬é›†ä¸­æ·»åŠ æ–°çš„æˆå‘˜çš„æ—¶å€™,é»˜è®¤çš„,å‰¯æœ¬é›†ä¸­çš„èŠ‚ç‚¹ä¼šä»Žç¦»å®ƒæœ€è¿‘çš„èŠ‚ç‚¹å¤åˆ¶oplogæ¥åŒæ­¥æ•°æ®,è¿™ä¸ªæœ€è¿‘çš„èŠ‚ç‚¹å¯ä»¥æ˜¯primaryä¹Ÿå¯ä»¥æ˜¯æ‹¥æœ‰æœ€æ–°oplogå‰¯æœ¬çš„secondaryèŠ‚ç‚¹ã€‚è¿™å¯ä»¥é˜²æ­¢ä¸¤ä¸ªsecondaryèŠ‚ç‚¹ä¹‹é—´ç›¸äº’è¿›è¡ŒåŒæ­¥æ“ä½œã€‚ å¤åˆ¶(replication):åœ¨åˆå§‹åŒ–åŽè¿™ä¸ªæ“ä½œä¼šä¸€ç›´æŒç»­çš„è¿›è¡Œç€,ä»¥ä¿æŒå„ä¸ªsecondaryèŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®åŒæ­¥ã€‚ åœ¨MongoDB2.0ä»¥åŽçš„ç‰ˆæœ¬ä¸­,ä¸€æ—¦åˆå§‹åŒ–ä¸­ç¡®å®šäº†ä¸€ä¸ªåŒæ­¥çš„ç›®æ ‡èŠ‚ç‚¹åŽï¼Œåªæœ‰å½“å’ŒåŒæ­¥èŠ‚ç‚¹ä¹‹é—´çš„è¿žæŽ¥æ–­å¼€æˆ–è¿žæŽ¥è¿‡ç¨‹ä¸­äº§ç”Ÿå¼‚å¸¸æ‰å¯èƒ½ä¼šå¯¼è‡´åŒæ­¥ç›®æ ‡çš„å˜åŠ¨ï¼Œå¹¶ä¸”å…·æœ‰å°±è¿‘åŽŸåˆ™ã€‚è€ƒè™‘ä¸¤ç§åœºæ™¯ï¼š æœ‰ä¸¤ä¸ªsecondaryèŠ‚ç‚¹åœ¨ä¸€ä¸ªæœºæˆ¿ï¼Œprimaryåœ¨å¦å¤–ä¸€ä¸ªæœºæˆ¿ã€‚å‡è®¾å‡ ä¹Žåœ¨åŒä¸€æ—¶é—´å¯åŠ¨è¿™ä¸‰ä¸ªå®žä¾‹(ä¹‹å‰éƒ½æ²¡æœ‰æ•°æ®å’Œoplog)ï¼Œé‚£ä¹ˆä¸¤ä¸ªsecondaryèŠ‚ç‚¹åº”è¯¥éƒ½æ˜¯ä»ŽprimaryèŠ‚ç‚¹åŒæ­¥æ•°æ®ï¼Œå› ä¸ºä»–ä»¬ä¹‹å‰è§éƒ½ä¸ä¼šæ‹¥æœ‰æ¯”å¯¹æ–¹æ›´æ–°çš„oplogã€‚å¦‚æžœé‡å¯å…¶ä¸­ä¸€ä¸ªsecondaryï¼Œé‚£ä¹ˆå®ƒçš„åŒæ­¥ç›®æ ‡å°†ä¼šå˜æˆå¦ä¸€ä¸ªsecondaryï¼Œå› ä¸ºå°±è¿‘åŽŸåˆ™ã€‚ å¦‚æžœæœ‰ä¸€ä¸ªprimaryå’Œä¸€ä¸ªsecondaryåˆ†åˆ«åœ¨ä¸åŒçš„æœºæˆ¿ï¼Œé‚£ä¹ˆåœ¨ä¹‹å‰secondaryæ‰€åœ¨çš„æœºæˆ¿ä¸­å‘å‰¯æœ¬é›†ä¸­æ–°åŠ ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œé‚£ä¹ˆæ–°èŠ‚ç‚¹å¿…ç„¶æ˜¯ä»ŽåŽŸå…ˆçš„é‚£ä¸ªsecondaryèŠ‚ç‚¹åŒæ­¥æ•°æ®çš„ã€‚ åœ¨2.2ç‰ˆæœ¬ä»¥åŽï¼Œæ•°æ®åŒæ­¥å¢žåŠ äº†ä¸€äº›é¢å¤–çš„è¡Œä¸ºï¼š secondaryèŠ‚ç‚¹åªæœ‰å½“é›†ç¾¤ä¸­æ²¡æœ‰å…¶ä»–é€‰æ‹©çš„æ—¶å€™æ‰ä¼šä»ŽdelayedèŠ‚ç‚¹åŒæ­¥æ•°æ®ï¼› secondaryèŠ‚ç‚¹ç»ä¸ä¼šä»ŽhiddenèŠ‚ç‚¹åŒæ­¥æ•°æ®ï¼› å½“ä¸€ä¸ªèŠ‚ç‚¹æ–°åŠ å…¥å‰¯æœ¬é›†ä¸­ä¼šæœ‰ä¸€ä¸ªrecoveringè¿‡ç¨‹ï¼Œåœ¨è¿™æ®µæ—¶é—´å†…secondaryä¸ä¼šè¿›è¡Œæ•°æ®åŒæ­¥æ“ä½œï¼› å½“ä¸€ä¸ªèŠ‚ç‚¹ä»Žå¦ä¸€ä¸ªèŠ‚ç‚¹åŒæ­¥æ•°æ®çš„æ—¶å€™ï¼Œéœ€è¦ä¿è¯ä¸¤ä¸ªèŠ‚ç‚¹çš„local.system.replset.members[n].buildIndexeså€¼æ˜¯ä¸€æ ·çš„ï¼Œè¦ä¸éƒ½æ˜¯falseï¼Œè¦ä¸éƒ½æ˜¯trueã€‚ æ³¨ï¼šbuildIndexesæŒ‡å®šå‰¯æœ¬é›†ä¸­æˆå‘˜æ˜¯å¦å¯ä»¥åˆ›å»ºç´¢å¼•(æŸäº›æƒ…å†µä¸‹æ¯”å¦‚æ²¡æœ‰è¯»æ“ä½œæˆ–è€…ä¸ºäº†æé«˜å†™æ€§èƒ½å¯ä»¥çœç•¥ç´¢å¼•çš„åˆ›å»º)ã€‚å½“ç„¶å³ä½¿è¯¥å€¼ä¸ºfalseï¼ŒMongoDBè¿˜æ˜¯å¯ä»¥åœ¨_idä¸Šåˆ›å»ºç´¢å¼•ä»¥ä¸ºå¤åˆ¶æ“ä½œæœåŠ¡ã€‚ å‚è€ƒé“¾æŽ¥ðŸŒ[MongoDBçš„å‰¯æœ¬é›†Replica Set] ðŸŒ[MongoDB Configuration File Options] ðŸŒ[MongoDBå‰¯æœ¬é›†å­¦ä¹ ï¼ˆä¸‰ï¼‰ï¼šæ€§èƒ½å’Œä¼˜åŒ–ç›¸å…³]]]></content>
      <categories>
        <category>MongoDB</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>MongoDB</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Rediså­¦ä¹ ç¬”è®°-ä¸»ä»Ž]]></title>
    <url>%2F2018%2F08%2F23%2FRedis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%B8%BB%E4%BB%8E%2F</url>
    <content type="text"><![CDATA[Redisä¸»ä»Žå¤åˆ¶Redis æ”¯æŒç®€å•ä¸”æ˜“ç”¨çš„ä¸»ä»Žå¤åˆ¶ï¼ˆmaster-slave replicationï¼‰åŠŸèƒ½ï¼Œ è¯¥åŠŸèƒ½å¯ä»¥è®©ä»ŽæœåŠ¡å™¨(slave server)æˆä¸ºä¸»æœåŠ¡å™¨(master server)çš„ç²¾ç¡®å¤åˆ¶å“ã€‚ ä»¥ä¸‹æ˜¯å…³äºŽ Redis å¤åˆ¶åŠŸèƒ½çš„å‡ ä¸ªé‡è¦æ–¹é¢ï¼š Redis ä½¿ç”¨å¼‚æ­¥å¤åˆ¶ã€‚ ä»Ž Redis 2.8 å¼€å§‹ï¼Œ ä»ŽæœåŠ¡å™¨ä¼šä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘çŽ‡å‘ä¸»æœåŠ¡å™¨æŠ¥å‘Šå¤åˆ¶æµï¼ˆreplication streamï¼‰çš„å¤„ç†è¿›åº¦ã€‚ ä¸€ä¸ªä¸»æœåŠ¡å™¨å¯ä»¥æœ‰å¤šä¸ªä»ŽæœåŠ¡å™¨ã€‚ ä¸ä»…ä¸»æœåŠ¡å™¨å¯ä»¥æœ‰ä»ŽæœåŠ¡å™¨ï¼Œ ä»ŽæœåŠ¡å™¨ä¹Ÿå¯ä»¥æœ‰è‡ªå·±çš„ä»ŽæœåŠ¡å™¨ï¼Œ å¤šä¸ªä»ŽæœåŠ¡å™¨ä¹‹é—´å¯ä»¥æž„æˆä¸€ä¸ªå›¾çŠ¶ç»“æž„ã€‚ å¤åˆ¶åŠŸèƒ½ä¸ä¼šé˜»å¡žä¸»æœåŠ¡å™¨ï¼š å³ä½¿æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªä»ŽæœåŠ¡å™¨æ­£åœ¨è¿›è¡Œåˆæ¬¡åŒæ­¥ï¼Œ ä¸»æœåŠ¡å™¨ä¹Ÿå¯ä»¥ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ã€‚ å¤åˆ¶åŠŸèƒ½ä¹Ÿä¸ä¼šé˜»å¡žä»ŽæœåŠ¡å™¨ï¼š åªè¦åœ¨ redis.conf æ–‡ä»¶ä¸­è¿›è¡Œäº†ç›¸åº”çš„è®¾ç½®ï¼Œ å³ä½¿ä»ŽæœåŠ¡å™¨æ­£åœ¨è¿›è¡Œåˆæ¬¡åŒæ­¥ï¼Œ æœåŠ¡å™¨ä¹Ÿå¯ä»¥ä½¿ç”¨æ—§ç‰ˆæœ¬çš„æ•°æ®é›†æ¥å¤„ç†å‘½ä»¤æŸ¥è¯¢ã€‚ ä¸è¿‡ï¼Œ åœ¨ä»ŽæœåŠ¡å™¨åˆ é™¤æ—§ç‰ˆæœ¬æ•°æ®é›†å¹¶è½½å…¥æ–°ç‰ˆæœ¬æ•°æ®é›†çš„é‚£æ®µæ—¶é—´å†…ï¼Œ è¿žæŽ¥è¯·æ±‚ä¼šè¢«é˜»å¡žã€‚ ä½ è¿˜å¯ä»¥é…ç½®ä»ŽæœåŠ¡å™¨ï¼Œ è®©å®ƒåœ¨ä¸Žä¸»æœåŠ¡å™¨ä¹‹é—´çš„è¿žæŽ¥æ–­å¼€æ—¶ï¼Œ å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªé”™è¯¯ã€‚ å¤åˆ¶åŠŸèƒ½å¯ä»¥å•çº¯åœ°ç”¨äºŽæ•°æ®å†—ä½™ï¼ˆdata redundancyï¼‰ï¼Œ ä¹Ÿå¯ä»¥é€šè¿‡è®©å¤šä¸ªä»ŽæœåŠ¡å™¨å¤„ç†åªè¯»å‘½ä»¤è¯·æ±‚æ¥æå‡æ‰©å±•æ€§ï¼ˆscalabilityï¼‰ï¼š æ¯”å¦‚è¯´ï¼Œ ç¹é‡çš„ SORT å‘½ä»¤å¯ä»¥äº¤ç»™é™„å±žèŠ‚ç‚¹åŽ»è¿è¡Œã€‚ å¯ä»¥é€šè¿‡å¤åˆ¶åŠŸèƒ½æ¥è®©ä¸»æœåŠ¡å™¨å…äºŽæ‰§è¡ŒæŒä¹…åŒ–æ“ä½œï¼š åªè¦å…³é—­ä¸»æœåŠ¡å™¨çš„æŒä¹…åŒ–åŠŸèƒ½ï¼Œ ç„¶åŽç”±ä»ŽæœåŠ¡å™¨åŽ»æ‰§è¡ŒæŒä¹…åŒ–æ“ä½œå³å¯ã€‚ åŽŸç†å¤åˆ¶æµç¨‹æ— è®ºæ˜¯åˆæ¬¡è¿žæŽ¥è¿˜æ˜¯é‡æ–°è¿žæŽ¥ï¼Œ å½“å»ºç«‹ä¸€ä¸ªä»ŽæœåŠ¡å™¨æ—¶ï¼Œ ä»ŽæœåŠ¡å™¨éƒ½å°†å‘ä¸»æœåŠ¡å™¨å‘é€ä¸€ä¸ª SYNC å‘½ä»¤ã€‚ æŽ¥åˆ° SYNC å‘½ä»¤çš„ä¸»æœåŠ¡å™¨å°†å¼€å§‹æ‰§è¡Œ BGSAVE ï¼Œ å¹¶åœ¨ä¿å­˜æ“ä½œæ‰§è¡ŒæœŸé—´ï¼Œ å°†æ‰€æœ‰æ–°æ‰§è¡Œçš„å†™å…¥å‘½ä»¤éƒ½ä¿å­˜åˆ°ä¸€ä¸ªç¼“å†²åŒºé‡Œé¢ã€‚ å½“ BGSAVE æ‰§è¡Œå®Œæ¯•åŽï¼Œ ä¸»æœåŠ¡å™¨å°†æ‰§è¡Œä¿å­˜æ“ä½œæ‰€å¾—çš„ .rdb æ–‡ä»¶å‘é€ç»™ä»ŽæœåŠ¡å™¨ï¼Œ ä»ŽæœåŠ¡å™¨æŽ¥æ”¶è¿™ä¸ª .rdb æ–‡ä»¶ï¼Œ å¹¶å°†æ–‡ä»¶ä¸­çš„æ•°æ®è½½å…¥åˆ°å†…å­˜ä¸­ã€‚ ä¹‹åŽä¸»æœåŠ¡å™¨ä¼šä»¥ Redis å‘½ä»¤åè®®çš„æ ¼å¼ï¼Œ å°†å†™å‘½ä»¤ç¼“å†²åŒºä¸­ç§¯ç´¯çš„æ‰€æœ‰å†…å®¹éƒ½å‘é€ç»™ä»ŽæœåŠ¡å™¨ã€‚ ä½ å¯ä»¥é€šè¿‡ telnet å‘½ä»¤æ¥äº²è‡ªéªŒè¯è¿™ä¸ªåŒæ­¥è¿‡ç¨‹ï¼š é¦–å…ˆè¿žä¸Šä¸€ä¸ªæ­£åœ¨å¤„ç†å‘½ä»¤è¯·æ±‚çš„ Redis æœåŠ¡å™¨ï¼Œ ç„¶åŽå‘å®ƒå‘é€ SYNC å‘½ä»¤ï¼Œ è¿‡ä¸€é˜µå­ï¼Œ ä½ å°†çœ‹åˆ° telnet ä¼šè¯ï¼ˆsessionï¼‰æŽ¥æ”¶åˆ°æœåŠ¡å™¨å‘æ¥çš„å¤§æ®µæ•°æ®ï¼ˆ.rdb æ–‡ä»¶ï¼‰ï¼Œ ä¹‹åŽè¿˜ä¼šçœ‹åˆ°ï¼Œ æ‰€æœ‰åœ¨æœåŠ¡å™¨æ‰§è¡Œè¿‡çš„å†™å‘½ä»¤ï¼Œ éƒ½ä¼šé‡æ–°å‘é€åˆ° telnet ä¼šè¯æ¥ã€‚ å³ä½¿æœ‰å¤šä¸ªä»ŽæœåŠ¡å™¨åŒæ—¶å‘ä¸»æœåŠ¡å™¨å‘é€ SYNC ï¼Œ ä¸»æœåŠ¡å™¨ä¹Ÿåªéœ€æ‰§è¡Œä¸€æ¬¡ BGSAVE å‘½ä»¤ï¼Œ å°±å¯ä»¥å¤„ç†æ‰€æœ‰è¿™äº›ä»ŽæœåŠ¡å™¨çš„åŒæ­¥è¯·æ±‚ã€‚ ä»ŽæœåŠ¡å™¨å¯ä»¥åœ¨ä¸»ä»ŽæœåŠ¡å™¨ä¹‹é—´çš„è¿žæŽ¥æ–­å¼€æ—¶è¿›è¡Œè‡ªåŠ¨é‡è¿žï¼Œ åœ¨ Redis 2.8 ç‰ˆæœ¬ä¹‹å‰ï¼Œ æ–­çº¿ä¹‹åŽé‡è¿žçš„ä»ŽæœåŠ¡å™¨æ€»è¦æ‰§è¡Œä¸€æ¬¡å®Œæ•´é‡åŒæ­¥ï¼ˆfull resynchronizationï¼‰æ“ä½œï¼Œ ä½†æ˜¯ä»Ž Redis 2.8 ç‰ˆæœ¬å¼€å§‹ï¼Œ ä»ŽæœåŠ¡å™¨å¯ä»¥æ ¹æ®ä¸»æœåŠ¡å™¨çš„æƒ…å†µæ¥é€‰æ‹©æ‰§è¡Œå®Œæ•´é‡åŒæ­¥è¿˜æ˜¯éƒ¨åˆ†é‡åŒæ­¥ï¼ˆpartial resynchronizationï¼‰ã€‚ éƒ¨åˆ†é‡åŒæ­¥ä»Ž Redis 2.8 å¼€å§‹ï¼Œ åœ¨ç½‘ç»œè¿žæŽ¥çŸ­æš‚æ€§å¤±æ•ˆä¹‹åŽï¼Œ ä¸»ä»ŽæœåŠ¡å™¨å¯ä»¥å°è¯•ç»§ç»­æ‰§è¡ŒåŽŸæœ‰çš„å¤åˆ¶è¿›ç¨‹ï¼ˆprocessï¼‰ï¼Œ è€Œä¸ä¸€å®šè¦æ‰§è¡Œå®Œæ•´é‡åŒæ­¥æ“ä½œã€‚ è¿™ä¸ªç‰¹æ€§éœ€è¦ä¸»æœåŠ¡å™¨ä¸ºè¢«å‘é€çš„å¤åˆ¶æµåˆ›å»ºä¸€ä¸ªå†…å­˜ç¼“å†²åŒºï¼ˆin-memory backlogï¼‰ï¼Œ å¹¶ä¸”ä¸»æœåŠ¡å™¨å’Œæ‰€æœ‰ä»ŽæœåŠ¡å™¨ä¹‹é—´éƒ½è®°å½•ä¸€ä¸ªå¤åˆ¶åç§»é‡ï¼ˆreplication offsetï¼‰å’Œä¸€ä¸ªä¸»æœåŠ¡å™¨ ID ï¼ˆmaster run idï¼‰ï¼Œ å½“å‡ºçŽ°ç½‘ç»œè¿žæŽ¥æ–­å¼€æ—¶ï¼Œ ä»ŽæœåŠ¡å™¨ä¼šé‡æ–°è¿žæŽ¥ï¼Œ å¹¶ä¸”å‘ä¸»æœåŠ¡å™¨è¯·æ±‚ç»§ç»­æ‰§è¡ŒåŽŸæ¥çš„å¤åˆ¶è¿›ç¨‹ï¼š å¦‚æžœä»ŽæœåŠ¡å™¨è®°å½•çš„ä¸»æœåŠ¡å™¨ ID å’Œå½“å‰è¦è¿žæŽ¥çš„ä¸»æœåŠ¡å™¨çš„ ID ç›¸åŒï¼Œ å¹¶ä¸”ä»ŽæœåŠ¡å™¨è®°å½•çš„åç§»é‡æ‰€æŒ‡å®šçš„æ•°æ®ä»ç„¶ä¿å­˜åœ¨ä¸»æœåŠ¡å™¨çš„å¤åˆ¶æµç¼“å†²åŒºé‡Œé¢ï¼Œ é‚£ä¹ˆä¸»æœåŠ¡å™¨ä¼šå‘ä»ŽæœåŠ¡å™¨å‘é€æ–­çº¿æ—¶ç¼ºå¤±çš„é‚£éƒ¨åˆ†æ•°æ®ï¼Œ ç„¶åŽå¤åˆ¶å·¥ä½œå¯ä»¥ç»§ç»­æ‰§è¡Œã€‚ å¦åˆ™çš„è¯ï¼Œ ä»ŽæœåŠ¡å™¨å°±è¦æ‰§è¡Œå®Œæ•´é‡åŒæ­¥æ“ä½œã€‚ Redis 2.8 çš„è¿™ä¸ªéƒ¨åˆ†é‡åŒæ­¥ç‰¹æ€§ä¼šç”¨åˆ°ä¸€ä¸ªæ–°å¢žçš„ PSYNC å†…éƒ¨å‘½ä»¤ï¼Œ è€Œ Redis 2.8 ä»¥å‰çš„æ—§ç‰ˆæœ¬åªæœ‰ SYNC å‘½ä»¤ï¼Œ ä¸è¿‡ï¼Œ åªè¦ä»ŽæœåŠ¡å™¨æ˜¯ Redis 2.8 æˆ–ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œ å®ƒå°±ä¼šæ ¹æ®ä¸»æœåŠ¡å™¨çš„ç‰ˆæœ¬æ¥å†³å®šåˆ°åº•æ˜¯ä½¿ç”¨ PSYNC è¿˜æ˜¯ SYNC ï¼š å¦‚æžœä¸»æœåŠ¡å™¨æ˜¯ Redis 2.8 æˆ–ä»¥ä¸Šç‰ˆæœ¬ï¼Œé‚£ä¹ˆä»ŽæœåŠ¡å™¨ä½¿ç”¨ PSYNC å‘½ä»¤æ¥è¿›è¡ŒåŒæ­¥ã€‚ å¦‚æžœä¸»æœåŠ¡å™¨æ˜¯ Redis 2.8 ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œé‚£ä¹ˆä»ŽæœåŠ¡å™¨ä½¿ç”¨ SYNC å‘½ä»¤æ¥è¿›è¡ŒåŒæ­¥ã€‚ é…ç½®åœ¨ä»ŽæœåŠ¡å™¨ä¸Šæ·»åŠ REPLICATIONç›¸å…³é…ç½®ï¼š 123slaveof &lt;masterip&gt; &lt;masterport&gt;# å¦‚æžœä¸»æœåŠ¡å™¨è®¾ç½®äº†è¿žæŽ¥å¯†ç åˆ™æ·»åŠ ï¼š# masterauth &lt;master-password&gt; å…¶ä»–ç›¸å…³é…ç½®å‚ç…§Rediså­¦ä¹ ç¬”è®°-é…ç½® ä¸»æœåŠ¡å™¨åªè¯»æ¨¡å¼ä»Ž Redis 2.6 å¼€å§‹ï¼Œ ä»ŽæœåŠ¡å™¨æ”¯æŒåªè¯»æ¨¡å¼ï¼Œ å¹¶ä¸”è¯¥æ¨¡å¼ä¸ºä»ŽæœåŠ¡å™¨çš„é»˜è®¤æ¨¡å¼ã€‚ åªè¯»æ¨¡å¼ç”± redis.conf æ–‡ä»¶ä¸­çš„ slave-read-only é€‰é¡¹æŽ§åˆ¶ï¼Œ ä¹Ÿå¯ä»¥é€šè¿‡ CONFIG SET å‘½ä»¤æ¥å¼€å¯æˆ–å…³é—­è¿™ä¸ªæ¨¡å¼ã€‚ åªè¯»ä»ŽæœåŠ¡å™¨ä¼šæ‹’ç»æ‰§è¡Œä»»ä½•å†™å‘½ä»¤ï¼Œ æ‰€ä»¥ä¸ä¼šå‡ºçŽ°å› ä¸ºæ“ä½œå¤±è¯¯è€Œå°†æ•°æ®ä¸å°å¿ƒå†™å…¥åˆ°äº†ä»ŽæœåŠ¡å™¨çš„æƒ…å†µã€‚ å³ä½¿ä»ŽæœåŠ¡å™¨æ˜¯åªè¯»çš„ï¼Œ DEBUG å’Œ CONFIG ç­‰ç®¡ç†å¼å‘½ä»¤ä»ç„¶æ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œ æ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯ä¸åº”è¯¥å°†æœåŠ¡å™¨æš´éœ²ç»™äº’è”ç½‘æˆ–è€…ä»»ä½•ä¸å¯ä¿¡ç½‘ç»œã€‚ ä¸è¿‡ï¼Œ ä½¿ç”¨ redis.conf ä¸­çš„å‘½ä»¤æ”¹åé€‰é¡¹ï¼Œ æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¦æ­¢æ‰§è¡ŒæŸäº›å‘½ä»¤æ¥æå‡åªè¯»ä»ŽæœåŠ¡å™¨çš„å®‰å…¨æ€§ã€‚ ä½ å¯èƒ½ä¼šæ„Ÿåˆ°å¥½å¥‡ï¼Œ æ—¢ç„¶ä»ŽæœåŠ¡å™¨ä¸Šçš„å†™æ•°æ®ä¼šè¢«é‡åŒæ­¥æ•°æ®è¦†ç›–ï¼Œ ä¹Ÿå¯èƒ½åœ¨ä»ŽæœåŠ¡å™¨é‡å¯æ—¶ä¸¢å¤±ï¼Œ é‚£ä¹ˆä¸ºä»€ä¹ˆè¦è®©ä¸€ä¸ªä»ŽæœåŠ¡å™¨å˜å¾—å¯å†™å‘¢ï¼Ÿ åŽŸå› æ˜¯ï¼Œ ä¸€äº›ä¸é‡è¦çš„ä¸´æ—¶æ•°æ®ï¼Œ ä»ç„¶æ˜¯å¯ä»¥ä¿å­˜åœ¨ä»ŽæœåŠ¡å™¨ä¸Šé¢çš„ã€‚ æ¯”å¦‚è¯´ï¼Œ å®¢æˆ·ç«¯å¯ä»¥åœ¨ä»ŽæœåŠ¡å™¨ä¸Šä¿å­˜ä¸»æœåŠ¡å™¨çš„å¯è¾¾æ€§ï¼ˆreachabilityï¼‰ä¿¡æ¯ï¼Œ ä»Žè€Œå®žçŽ°æ•…éšœè½¬ç§»ï¼ˆfailoverï¼‰ç­–ç•¥ã€‚]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Rediså­¦ä¹ ç¬”è®°-å“¨å…µ]]></title>
    <url>%2F2018%2F08%2F23%2FRedis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%93%A8%E5%85%B5%2F</url>
    <content type="text"><![CDATA[:globe_with_meridians:Sentinel 123456789101112131415161718192021222324252627282930# åŽå°è¿è¡Œdaemonize yes# ä¿æŠ¤æ¨¡å¼ï¼Œå¼€å¯ä¿æŠ¤æ¨¡å¼åŽéœ€è¦æ·»åŠ å¯†ç å’Œbindã€‚protected-mode &#123;&#123; redis_sentinel_protected_mode &#125;&#125;# ç»‘å®šç½‘å¡bind &#123;&#123; redis_sentinel_bind_interface &#125;&#125;# sentinelç›‘å¬ç«¯å£port &#123;&#123; redis_sentinel_port &#125;&#125;# è¿™ä¸€è¡Œä»£è¡¨sentinelç›‘æŽ§çš„masterçš„åå­—å«åšmymasterï¼Œåœ°å€ä¸ºredis_master_hostï¼Œç«¯å£å·ä¸ºredis_master_portã€‚# è¡Œå°¾æœ€åŽçš„ä¸€ä¸ª2ä»£è¡¨ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼Œç½‘ç»œæ˜¯ä¸å¯é çš„ï¼Œæœ‰æ—¶å€™ä¸€ä¸ªsentinelä¼šå› ä¸ºç½‘ç»œå µå¡žè€Œè¯¯ä»¥ä¸ºä¸€ä¸ªmaster rediså·²ç»æ­»æŽ‰äº†ï¼Œå½“sentinelé›†ç¾¤å¼ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•å°±å˜å¾—å¾ˆç®€å•ï¼Œåªéœ€è¦å¤šä¸ªsentineläº’ç›¸æ²Ÿé€šæ¥ç¡®è®¤æŸä¸ªmasteræ˜¯å¦çœŸçš„æ­»äº†ï¼Œè¿™ä¸ª2ä»£è¡¨ï¼Œå½“é›†ç¾¤ä¸­æœ‰2ä¸ªsentinelè®¤ä¸ºmasteræ­»äº†æ—¶ï¼Œæ‰èƒ½çœŸæ­£è®¤ä¸ºè¯¥masterå·²ç»ä¸å¯ç”¨äº†ã€‚ï¼ˆsentinelé›†ç¾¤ä¸­å„ä¸ªsentinelä¹Ÿæœ‰äº’ç›¸é€šä¿¡ï¼Œé€šè¿‡gossipåè®®ï¼‰ã€‚sentinel monitor mymaster &#123;&#123; redis_master_host &#125;&#125; &#123;&#123; redis_master_port &#125;&#125; &#123;&#123; redis_sentinel_quorum &#125;&#125;# down-after-milliseconds# sentinelä¼šå‘masterå‘é€å¿ƒè·³PINGæ¥ç¡®è®¤masteræ˜¯å¦å­˜æ´»ï¼Œå¦‚æžœmasteråœ¨â€œä¸€å®šæ—¶é—´èŒƒå›´â€å†…ä¸å›žåº”PONG æˆ–è€…æ˜¯å›žå¤äº†ä¸€ä¸ªé”™è¯¯æ¶ˆæ¯ï¼Œé‚£ä¹ˆè¿™ä¸ªsentinelä¼šä¸»è§‚åœ°(å•æ–¹é¢åœ°)è®¤ä¸ºè¿™ä¸ªmasterå·²ç»ä¸å¯ç”¨äº†(subjectively down, ä¹Ÿç®€ç§°ä¸ºSDOWN)ã€‚è€Œè¿™ä¸ªdown-after-millisecondså°±æ˜¯ç”¨æ¥æŒ‡å®šè¿™ä¸ªâ€œä¸€å®šæ—¶é—´èŒƒå›´â€çš„ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚# ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªæ—¶å€™sentinelå¹¶ä¸ä¼šé©¬ä¸Šè¿›è¡Œfailoverä¸»å¤‡åˆ‡æ¢ï¼Œè¿™ä¸ªsentinelè¿˜éœ€è¦å‚è€ƒsentinelé›†ç¾¤ä¸­å…¶ä»–sentinelçš„æ„è§ï¼Œå¦‚æžœè¶…è¿‡æŸä¸ªæ•°é‡çš„sentinelä¹Ÿä¸»è§‚åœ°è®¤ä¸ºè¯¥masteræ­»äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªmasterå°±ä¼šè¢«å®¢è§‚åœ°(æ³¨æ„å“¦ï¼Œè¿™æ¬¡ä¸æ˜¯ä¸»è§‚ï¼Œæ˜¯å®¢è§‚ï¼Œä¸Žåˆšæ‰çš„subjectively downç›¸å¯¹ï¼Œè¿™æ¬¡æ˜¯objectively downï¼Œç®€ç§°ä¸ºODOWN)è®¤ä¸ºå·²ç»æ­»äº†ã€‚éœ€è¦ä¸€èµ·åšå‡ºå†³å®šçš„sentinelæ•°é‡åœ¨ä¸Šä¸€æ¡é…ç½®ä¸­è¿›è¡Œé…ç½®ã€‚sentinel down-after-milliseconds mymaster &#123;&#123; redis_down_after_milliseconds &#125;&#125;sentinel failover-timeout mymaster &#123;&#123; redis_sentinel_failover_timeout &#125;&#125;# parallel-syncs# åœ¨å‘ç”Ÿfailoverä¸»å¤‡åˆ‡æ¢æ—¶ï¼Œè¿™ä¸ªé€‰é¡¹æŒ‡å®šäº†æœ€å¤šå¯ä»¥æœ‰å¤šå°‘ä¸ªslaveåŒæ—¶å¯¹æ–°çš„masterè¿›è¡ŒåŒæ­¥ï¼Œè¿™ä¸ªæ•°å­—è¶Šå°ï¼Œå®Œæˆfailoveræ‰€éœ€çš„æ—¶é—´å°±è¶Šé•¿ï¼Œä½†æ˜¯å¦‚æžœè¿™ä¸ªæ•°å­—è¶Šå¤§ï¼Œå°±æ„å‘³ç€è¶Šå¤šçš„slaveå› ä¸ºreplicationè€Œä¸å¯ç”¨ã€‚å¯ä»¥é€šè¿‡å°†è¿™ä¸ªå€¼è®¾ä¸º 1 æ¥ä¿è¯æ¯æ¬¡åªæœ‰ä¸€ä¸ªslaveå¤„äºŽä¸èƒ½å¤„ç†å‘½ä»¤è¯·æ±‚çš„çŠ¶æ€ã€‚sentinel parallel-syncs mymaster &#123;&#123; redis_sentinel_parallel_syncs &#125;&#125;# masterå¯†ç &#123;% if redis_masterauth %&#125;sentinel auth-pass mymaster &#123;&#123; redis_masterauth &#125;&#125;&#123;% endif %&#125;# æ—¥å¿—è®¾ç½®loglevel &#123;&#123; redis_sentinel_loglevel &#125;&#125;logfile &#123;&#123; redis_logdir &#125;&#125;/&#123;&#123; redis_sentinel_logfile &#125;&#125;]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Rediså­¦ä¹ ç¬”è®°-æŒä¹…åŒ–]]></title>
    <url>%2F2018%2F08%2F23%2FRedis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E6%8C%81%E4%B9%85%E5%8C%96%2F</url>
    <content type="text"><![CDATA[Redisçš„ä¸¤ç§æŒä¹…åŒ–æ–¹å¼åŠåŽŸç†:globe_with_meridians:Redisæ–‡æ¡£ SNAPSHOTTINGå¿«ç…§æ¨¡å¼ã€‚ é»˜è®¤redisæ˜¯ä¼šä»¥å¿«ç…§çš„å½¢å¼å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜çš„ï¼ˆä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œdump.rdbï¼Œåå­—å¯ä»¥æŒ‡å®šï¼‰ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­çš„æ ¼å¼æ˜¯ï¼šsave N M ï¼Œè¡¨ç¤ºåœ¨Nç§’ä¹‹å†…ï¼Œredisè‡³å°‘å‘ç”ŸMæ¬¡ä¿®æ”¹åˆ™redisæŠ“å¿«ç…§åˆ°ç£ç›˜ã€‚æ¯”å¦‚ï¼š 123456# 900ç§’å†…å¦‚æžœè‡³å°‘æœ‰1ä¸ªkeyçš„å€¼å‘ç”Ÿå˜åŒ–ï¼Œåˆ™ä¿å­˜åˆ°ç£ç›˜ã€‚# 300ç§’å†…å¦‚æžœè‡³å°‘æœ‰10ä¸ªkeyçš„å€¼å‘ç”Ÿå˜åŒ–ï¼Œåˆ™ä¿å­˜åˆ°ç£ç›˜ã€‚# 60ç§’å†…å¦‚æžœè‡³å°‘æœ‰10000ä¸ªkeyçš„å€¼å‘ç”Ÿå˜åŒ–ï¼Œåˆ™ä¿å­˜åˆ°ç£ç›˜ã€‚save 900 1save 300 10save 60 10000 è¿™ç§æŒä¹…åŒ–æ–¹å¼è¢«ç§°ä¸ºå¿«ç…§ï¼ˆsnapshotï¼‰ã€‚ å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œsaveæˆ–bgsaveï¼ˆå¼‚æ­¥ï¼‰åšå¿«ç…§ï¼š clientä¹Ÿå¯ä»¥ä½¿ç”¨saveæˆ–è€…bgsaveå‘½ä»¤é€šçŸ¥redisåšä¸€æ¬¡å¿«ç…§æŒä¹…åŒ–ã€‚ saveæ“ä½œæ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­ä¿å­˜å¿«ç…§çš„ï¼Œç”±äºŽredisæ˜¯ç”¨ä¸€ä¸ªä¸»çº¿ç¨‹æ¥å¤„ç†æ‰€æœ‰çš„clientçš„è¯·æ±‚ï¼Œè¿™ç§æ–¹å¼ä¼šé˜»å¡žæ‰€æœ‰clientè¯·æ±‚ã€‚æ‰€ä»¥ä¸æŽ¨èä½¿ç”¨ã€‚ å·¥ä½œåŽŸç†å½“rediséœ€è¦åšæŒä¹…åŒ–æ—¶ï¼Œredisä¼šforkä¸€ä¸ªå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹å°†æ•°æ®å†™åˆ°ç£ç›˜ä¸Šä¸€ä¸ªä¸´æ—¶RDBæ–‡ä»¶ä¸­ï¼Œå½“å­è¿›ç¨‹å®Œæˆå†™ä¸´æ—¶æ–‡ä»¶åŽï¼Œå°†åŽŸæ¥çš„RDBæ–‡ä»¶æ›¿æ¢æŽ‰ã€‚ è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥copy-on-writeï¼ˆå†™æ—¶å¤åˆ¶ï¼‰ã€‚ å¿«ç…§ä¿å­˜è¿‡ç¨‹ redisè°ƒç”¨forkï¼ŒçŽ°åœ¨æœ‰äº†å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹ã€‚ çˆ¶è¿›ç¨‹ç»§ç»­å¤„ç†clientè¯·æ±‚ï¼Œå­è¿›ç¨‹è´Ÿè´£å°†å†…å­˜å†…å®¹å†™å…¥åˆ°ä¸´æ—¶æ–‡ä»¶ã€‚ç”±äºŽOSçš„å†™æ—¶å¤åˆ¶æœºåˆ¶ï¼ˆcopy on writeï¼‰çˆ¶å­è¿›ç¨‹ä¼šå…±äº«ç›¸åŒçš„ç‰©ç†é¡µé¢ï¼Œå½“çˆ¶è¿›ç¨‹å¤„ç†å†™è¯·æ±‚æ—¶osä¼šä¸ºçˆ¶è¿›ç¨‹è¦ä¿®æ”¹çš„é¡µé¢åˆ›å»ºå‰¯æœ¬ï¼Œè€Œä¸æ˜¯å†™å…±äº«çš„é¡µé¢ï¼Œæ‰€ä»¥å­è¿›ç¨‹çš„åœ°å€ç©ºé—´å†…çš„æ•°æ®æ˜¯forkæ—¶åˆ»æ•´ä¸ªæ•°æ®åº“çš„ä¸€ä¸ªå¿«ç…§ã€‚ å½“å­è¿›ç¨‹å°†å¿«ç…§å†™å…¥ä¸´æ—¶æ–‡ä»¶å®Œæ¯•åŽï¼Œç”¨ä¸´æ—¶æ–‡ä»¶æ›¿æ¢åŽŸæ¥çš„å¿«ç…§æ–‡ä»¶ï¼Œç„¶åŽå­è¿›ç¨‹é€€å‡ºï¼ˆforkä¸€ä¸ªè¿›ç¨‹å†…åœ¨ä¹Ÿè¢«å¤åˆ¶äº†ï¼Œå³å†…å­˜ä¼šæ˜¯åŽŸæ¥çš„ä¸¤å€å·¦å³ï¼‰ã€‚ RDBä¼˜ç‚¹ RDB æ˜¯ä¸€ä¸ªéžå¸¸ç´§å‡‘ï¼ˆcompactï¼‰çš„æ–‡ä»¶ï¼Œå®ƒä¿å­˜äº† Redis åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šçš„æ•°æ®é›†ã€‚ è¿™ç§æ–‡ä»¶éžå¸¸é€‚åˆç”¨äºŽè¿›è¡Œå¤‡ä»½ï¼š æ¯”å¦‚è¯´ï¼Œä½ å¯ä»¥åœ¨æœ€è¿‘çš„ 24 å°æ—¶å†…ï¼Œæ¯å°æ—¶å¤‡ä»½ä¸€æ¬¡ RDB æ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨æ¯ä¸ªæœˆçš„æ¯ä¸€å¤©ï¼Œä¹Ÿå¤‡ä»½ä¸€ä¸ª RDB æ–‡ä»¶ã€‚ è¿™æ ·çš„è¯ï¼Œå³ä½¿é‡ä¸Šé—®é¢˜ï¼Œä¹Ÿå¯ä»¥éšæ—¶å°†æ•°æ®é›†è¿˜åŽŸåˆ°ä¸åŒçš„ç‰ˆæœ¬ã€‚ RDB éžå¸¸é€‚ç”¨äºŽç¾éš¾æ¢å¤ï¼ˆdisaster recoveryï¼‰ï¼šå®ƒåªæœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”å†…å®¹éƒ½éžå¸¸ç´§å‡‘ï¼Œå¯ä»¥ï¼ˆåœ¨åŠ å¯†åŽï¼‰å°†å®ƒä¼ é€åˆ°åˆ«çš„æ•°æ®ä¸­å¿ƒï¼Œæˆ–è€…äºšé©¬é€Š S3 ä¸­ã€‚ RDB å¯ä»¥æœ€å¤§åŒ– Redis çš„æ€§èƒ½ï¼šçˆ¶è¿›ç¨‹åœ¨ä¿å­˜ RDB æ–‡ä»¶æ—¶å”¯ä¸€è¦åšçš„å°±æ˜¯ fork å‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œç„¶åŽè¿™ä¸ªå­è¿›ç¨‹å°±ä¼šå¤„ç†æŽ¥ä¸‹æ¥çš„æ‰€æœ‰ä¿å­˜å·¥ä½œï¼Œçˆ¶è¿›ç¨‹æ— é¡»æ‰§è¡Œä»»ä½•ç£ç›˜ I/O æ“ä½œã€‚ RDB åœ¨æ¢å¤å¤§æ•°æ®é›†æ—¶çš„é€Ÿåº¦æ¯” AOF çš„æ¢å¤é€Ÿåº¦è¦å¿«ã€‚ RDBç¼ºç‚¹ å¦‚æžœä½ éœ€è¦å°½é‡é¿å…åœ¨æœåŠ¡å™¨æ•…éšœæ—¶ä¸¢å¤±æ•°æ®ï¼Œé‚£ä¹ˆ RDB ä¸é€‚åˆä½ ã€‚ è™½ç„¶ Redis å…è®¸ä½ è®¾ç½®ä¸åŒçš„ä¿å­˜ç‚¹ï¼ˆsave pointï¼‰æ¥æŽ§åˆ¶ä¿å­˜ RDB æ–‡ä»¶çš„é¢‘çŽ‡ï¼Œ ä½†æ˜¯ï¼Œ å› ä¸ºRDB æ–‡ä»¶éœ€è¦ä¿å­˜æ•´ä¸ªæ•°æ®é›†çš„çŠ¶æ€ï¼Œ æ‰€ä»¥å®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªè½»æ¾çš„æ“ä½œã€‚ å› æ­¤ä½ å¯èƒ½ä¼šè‡³å°‘ 5 åˆ†é’Ÿæ‰ä¿å­˜ä¸€æ¬¡ RDB æ–‡ä»¶ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ ä¸€æ—¦å‘ç”Ÿæ•…éšœåœæœºï¼Œ ä½ å°±å¯èƒ½ä¼šä¸¢å¤±å¥½å‡ åˆ†é’Ÿçš„æ•°æ®ã€‚ æ¯æ¬¡ä¿å­˜ RDB çš„æ—¶å€™ï¼ŒRedis éƒ½è¦ fork() å‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶ç”±å­è¿›ç¨‹æ¥è¿›è¡Œå®žé™…çš„æŒä¹…åŒ–å·¥ä½œã€‚ åœ¨æ•°æ®é›†æ¯”è¾ƒåºžå¤§æ—¶ï¼Œ fork() å¯èƒ½ä¼šéžå¸¸è€—æ—¶ï¼Œé€ æˆæœåŠ¡å™¨åœ¨æŸæŸæ¯«ç§’å†…åœæ­¢å¤„ç†å®¢æˆ·ç«¯ï¼› å¦‚æžœæ•°æ®é›†éžå¸¸å·¨å¤§ï¼Œå¹¶ä¸” CPU æ—¶é—´éžå¸¸ç´§å¼ çš„è¯ï¼Œé‚£ä¹ˆè¿™ç§åœæ­¢æ—¶é—´ç”šè‡³å¯èƒ½ä¼šé•¿è¾¾æ•´æ•´ä¸€ç§’ã€‚ è™½ç„¶ AOF é‡å†™ä¹Ÿéœ€è¦è¿›è¡Œ fork() ï¼Œä½†æ— è®º AOF é‡å†™çš„æ‰§è¡Œé—´éš”æœ‰å¤šé•¿ï¼Œæ•°æ®çš„è€ä¹…æ€§éƒ½ä¸ä¼šæœ‰ä»»ä½•æŸå¤±ã€‚ AOFAOFï¼ˆAppend-only-fileï¼‰æ¨¡å¼ã€‚ filesnapshottingæ–¹å¼åœ¨rediså¼‚å¸¸æ­»æŽ‰æ—¶ï¼Œæœ€è¿‘çš„æ•°æ®ä¼šä¸¢å¤±ï¼ˆä¸¢å¤±çš„æ•°æ®å¤šå°‘è§†ä½ saveç­–ç•¥çš„é…ç½®ï¼‰ï¼Œæ‰€ä»¥è¿™æ˜¯å®ƒæœ€å¤§çš„ç¼ºç‚¹ï¼Œå½“ä¸šåŠ¡é‡å¾ˆå¤§æ—¶ï¼Œä¸¢å¤±çš„æ•°æ®æ˜¯å¾ˆå¤šçš„ã€‚ append-onlyæ–¹æ³•å¯ä»¥åšåˆ°å…¨éƒ¨æ•°æ®ä¸ä¸¢å¤±ï¼Œä½†redisçš„æ€§èƒ½å°±è¦å·®äº›ã€‚ AOFå¯ä»¥åšåˆ°å…¨æŒä¹…åŒ–ï¼Œåªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯ï¼Œappendonly yeså¼€å¯AOFä¹‹åŽï¼Œredisæ¯æ‰§è¡Œä¸€ä¸ªä¿®æ”¹æ•°æ®çš„å‘½ä»¤ï¼Œéƒ½ä¼šæŠŠå®ƒæ·»åŠ åˆ°aofæ–‡ä»¶ä¸­ï¼Œå½“redisé‡å¯æ—¶ï¼Œå°†ä¼šè¯»å–AOFæ–‡ä»¶è¿›è¡Œâ€é‡æ”¾â€ä»¥æ¢å¤åˆ°rediså…³é—­å‰çš„æœ€åŽæ—¶åˆ»ã€‚ AOFæ–‡ä»¶åˆ·æ–°æ–¹å¼æœ‰ä¸‰ç§ï¼šalwayï¼Œeverysecï¼Œnoã€‚è¯¦è§£è¯·å‚è€ƒredisé…ç½®æ–‡ä»¶ç¬”è®°ã€‚ AOFé‡å†™éšç€ä¿®æ”¹æ•°æ®çš„æ‰§è¡ŒAOFæ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ï¼Œå…¶ä¸­å¾ˆå¤šå†…å®¹è®°å½•æŸä¸€ä¸ªkeyå˜åŒ–æƒ…å†µã€‚å› æ­¤redisæœ‰äº†ä¸€ç§æ¯”è¾ƒæœ‰æ„æ€çš„ç‰¹æ€§ï¼šåœ¨åŽå°é‡å»ºAOFæ–‡ä»¶ï¼Œè€Œä¸ä¼šå½±å“clientç«¯æ“ä½œã€‚åœ¨ä»»ä½•æ—¶å€™æ‰§è¡ŒBGREWRITEAOFå‘½ä»¤ï¼Œéƒ½ä¼šæŠŠå½“å‰å†…å­˜ä¸­æœ€çŸ­åºåˆ—çš„å‘½ä»¤å†™åˆ°ç£ç›˜ï¼Œè¿™äº›å‘½ä»¤å¯ä»¥å®Œå…¨æž„å»ºå½“å‰çš„æ•°æ®æƒ…å†µï¼Œè€Œä¸ä¼šå­˜åœ¨å¤šä½™çš„å˜åŒ–æƒ…å†µï¼ˆæ¯”å¦‚çŠ¶æ€å˜åŒ–ï¼Œè®¡æ•°å™¨å˜åŒ–ç­‰ï¼‰ï¼Œç¼©å°AOFæ–‡ä»¶çš„å¤§å°ã€‚ æ‰€ä»¥å½“ä½¿ç”¨AOFæ—¶ï¼ŒredisæŽ¨èä½¿ç”¨BGREWRITEAOFåŠŸèƒ½ã€‚ AOFä¿®å¤å¯èƒ½ç”±äºŽç³»ç»ŸåŽŸå› å¯¼è‡´äº†AOFæŸåï¼Œredisæ— æ³•å†åŠ è½½è¿™ä¸ªAOFï¼Œå¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤æ¥ä¿®å¤ï¼š ä¸ºçŽ°æœ‰çš„ AOF æ–‡ä»¶åˆ›å»ºä¸€ä¸ªå¤‡ä»½ã€‚ ä½¿ç”¨ Redis é™„å¸¦çš„ redis-check-aof ç¨‹åºâ€”redis-check-aof --fixå¯¹åŽŸæ¥çš„ AOF æ–‡ä»¶è¿›è¡Œä¿®å¤ã€‚ ï¼ˆå¯é€‰ï¼‰ä½¿ç”¨ diff -u å¯¹æ¯”ä¿®å¤åŽçš„ AOF æ–‡ä»¶å’ŒåŽŸå§‹ AOF æ–‡ä»¶çš„å¤‡ä»½ï¼ŒæŸ¥çœ‹ä¸¤ä¸ªæ–‡ä»¶ä¹‹é—´çš„ä¸åŒä¹‹å¤„ã€‚ é‡å¯ Redis æœåŠ¡å™¨ï¼Œç­‰å¾…æœåŠ¡å™¨è½½å…¥ä¿®å¤åŽçš„ AOF æ–‡ä»¶ï¼Œå¹¶è¿›è¡Œæ•°æ®æ¢å¤ã€‚ å·¥ä½œåŽŸç†LOG RewriteåŒæ ·ç”¨åˆ°äº†copy-on-writeï¼š redisä¼šforkä¸€ä¸ªå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹å°†æœ€æ–°çš„AOFå†™å…¥ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œ çˆ¶è¿›ç¨‹å¢žé‡çš„æŠŠå†…å­˜ä¸­çš„æœ€æ–°æ‰§è¡Œçš„ä¿®æ”¹å†™å…¥ï¼ˆè¿™æ—¶ä»å†™å…¥æ—§çš„AOFï¼Œrewriteå¦‚æžœå¤±è´¥ä¹Ÿæ˜¯å®‰å…¨çš„ï¼‰ å½“å­è¿›ç¨‹å®Œæˆrewriteä¸´æ—¶æ–‡ä»¶åŽï¼Œçˆ¶è¿›ç¨‹ä¼šå—åˆ°ä¸€ä¸ªä¿¡å·ï¼Œå¹¶æŠŠä¹‹å‰çš„å†…å­˜ä¸­çš„å¢žé‡çš„ä¿®æ”¹å†™å…¥ä¸´æ—¶æ–‡ä»¶æœ«å°¾ï¼Œè¿™æ—¶rediså°†æ—§AOFæ–‡ä»¶é‡å‘½åï¼Œä¸´æ—¶æ–‡ä»¶é‡å‘½åï¼Œå¼€å§‹å‘æ–°çš„AOFä¸­å†™å…¥ã€‚ å…·ä½“è¿‡ç¨‹ï¼š redisè°ƒç”¨forkï¼ŒçŽ°åœ¨æœ‰çˆ¶å­ä¸¤ä¸ªè¿›ç¨‹ã€‚ å­è¿›ç¨‹æ ¹æ®å†…å­˜ä¸­çš„æ•°æ®åº“å¿«ç…§ï¼Œå¾€ä¸´æ—¶æ–‡ä»¶ä¸­å†™å…¥é‡å»ºæ•°æ®åº“çŠ¶æ€çš„å‘½ä»¤ã€‚ çˆ¶è¿›ç¨‹ç»§ç»­å¤„ç†clientè¯·æ±‚ï¼Œé™¤äº†æŠŠå†™å‘½ä»¤å†™å…¥åˆ°åŽŸæ¥çš„aofæ–‡ä»¶ä¸­ï¼ŒåŒæ—¶æŠŠæ”¶åˆ°çš„å†™å‘½ä»¤ç¼“å­˜èµ·æ¥ã€‚è¿™æ ·å°±èƒ½ä¿è¯å¦‚æžœå­è¿›ç¨‹é‡å†™å¤±è´¥çš„è¯å¹¶ä¸ä¼šå‡ºé—®é¢˜ã€‚ å½“å­è¿›ç¨‹æŠŠå¿«ç…§å†…å®¹å†™å…¥ä»¥å‘½ä»¤æ–¹å¼å†™åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­åŽï¼Œå­è¿›ç¨‹å‘ä¿¡å·é€šçŸ¥çˆ¶è¿›ç¨‹ã€‚ç„¶åŽçˆ¶è¿›ç¨‹æŠŠç¼“å­˜çš„å†™å‘½ä»¤ä¹Ÿå†™å…¥åˆ°ä¸´æ—¶æ–‡ä»¶ã€‚ çŽ°åœ¨çˆ¶è¿›ç¨‹å¯ä»¥ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶æ›¿æ¢æ—§çš„aofæ–‡ä»¶ï¼Œå¹¶é‡å‘½åã€‚åŽé¢æ”¶åˆ°çš„å†™å‘½ä»¤ä¹Ÿå¼€å§‹å¾€æ–°çš„aofæ–‡ä»¶ä¸­è¿½åŠ ã€‚ AOFä¼˜ç‚¹ ä½¿ç”¨ AOF æŒä¹…åŒ–ä¼šè®© Redis å˜å¾—éžå¸¸è€ä¹…ï¼ˆmuch more durableï¼‰ï¼šä½ å¯ä»¥è®¾ç½®ä¸åŒçš„ fsync ç­–ç•¥ï¼Œæ¯”å¦‚æ—  fsync ï¼Œæ¯ç§’é’Ÿä¸€æ¬¡ fsync ï¼Œæˆ–è€…æ¯æ¬¡æ‰§è¡Œå†™å…¥å‘½ä»¤æ—¶ fsync ã€‚ AOF çš„é»˜è®¤ç­–ç•¥ä¸ºæ¯ç§’é’Ÿ fsync ä¸€æ¬¡ï¼Œåœ¨è¿™ç§é…ç½®ä¸‹ï¼ŒRedis ä»ç„¶å¯ä»¥ä¿æŒè‰¯å¥½çš„æ€§èƒ½ï¼Œå¹¶ä¸”å°±ç®—å‘ç”Ÿæ•…éšœåœæœºï¼Œä¹Ÿæœ€å¤šåªä¼šä¸¢å¤±ä¸€ç§’é’Ÿçš„æ•°æ®ï¼ˆ fsync ä¼šåœ¨åŽå°çº¿ç¨‹æ‰§è¡Œï¼Œæ‰€ä»¥ä¸»çº¿ç¨‹å¯ä»¥ç»§ç»­åŠªåŠ›åœ°å¤„ç†å‘½ä»¤è¯·æ±‚ï¼‰ã€‚ AOF æ–‡ä»¶æ˜¯ä¸€ä¸ªåªè¿›è¡Œè¿½åŠ æ“ä½œçš„æ—¥å¿—æ–‡ä»¶ï¼ˆappend only logï¼‰ï¼Œ å› æ­¤å¯¹ AOF æ–‡ä»¶çš„å†™å…¥ä¸éœ€è¦è¿›è¡Œ seek ï¼Œ å³ä½¿æ—¥å¿—å› ä¸ºæŸäº›åŽŸå› è€ŒåŒ…å«äº†æœªå†™å…¥å®Œæ•´çš„å‘½ä»¤ï¼ˆæ¯”å¦‚å†™å…¥æ—¶ç£ç›˜å·²æ»¡ï¼Œå†™å…¥ä¸­é€”åœæœºï¼Œç­‰ç­‰ï¼‰ï¼Œ redis-check-aof å·¥å…·ä¹Ÿå¯ä»¥è½»æ˜“åœ°ä¿®å¤è¿™ç§é—®é¢˜ã€‚ Redis å¯ä»¥åœ¨ AOF æ–‡ä»¶ä½“ç§¯å˜å¾—è¿‡å¤§æ—¶ï¼Œè‡ªåŠ¨åœ°åœ¨åŽå°å¯¹ AOF è¿›è¡Œé‡å†™ï¼š é‡å†™åŽçš„æ–° AOF æ–‡ä»¶åŒ…å«äº†æ¢å¤å½“å‰æ•°æ®é›†æ‰€éœ€çš„æœ€å°å‘½ä»¤é›†åˆã€‚ æ•´ä¸ªé‡å†™æ“ä½œæ˜¯ç»å¯¹å®‰å…¨çš„ï¼Œå› ä¸º Redis åœ¨åˆ›å»ºæ–° AOF æ–‡ä»¶çš„è¿‡ç¨‹ä¸­ï¼Œä¼šç»§ç»­å°†å‘½ä»¤è¿½åŠ åˆ°çŽ°æœ‰çš„ AOF æ–‡ä»¶é‡Œé¢ï¼Œå³ä½¿é‡å†™è¿‡ç¨‹ä¸­å‘ç”Ÿåœæœºï¼ŒçŽ°æœ‰çš„ AOF æ–‡ä»¶ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚ è€Œä¸€æ—¦æ–° AOF æ–‡ä»¶åˆ›å»ºå®Œæ¯•ï¼ŒRedis å°±ä¼šä»Žæ—§ AOF æ–‡ä»¶åˆ‡æ¢åˆ°æ–° AOF æ–‡ä»¶ï¼Œå¹¶å¼€å§‹å¯¹æ–° AOF æ–‡ä»¶è¿›è¡Œè¿½åŠ æ“ä½œã€‚ AOF æ–‡ä»¶æœ‰åºåœ°ä¿å­˜äº†å¯¹æ•°æ®åº“æ‰§è¡Œçš„æ‰€æœ‰å†™å…¥æ“ä½œï¼Œ è¿™äº›å†™å…¥æ“ä½œä»¥ Redis åè®®çš„æ ¼å¼ä¿å­˜ï¼Œ å› æ­¤ AOF æ–‡ä»¶çš„å†…å®¹éžå¸¸å®¹æ˜“è¢«äººè¯»æ‡‚ï¼Œ å¯¹æ–‡ä»¶è¿›è¡Œåˆ†æžï¼ˆparseï¼‰ä¹Ÿå¾ˆè½»æ¾ã€‚ å¯¼å‡ºï¼ˆexportï¼‰ AOF æ–‡ä»¶ä¹Ÿéžå¸¸ç®€å•ï¼š ä¸¾ä¸ªä¾‹å­ï¼Œ å¦‚æžœä½ ä¸å°å¿ƒæ‰§è¡Œäº† FLUSHALL å‘½ä»¤ï¼Œ ä½†åªè¦ AOF æ–‡ä»¶æœªè¢«é‡å†™ï¼Œ é‚£ä¹ˆåªè¦åœæ­¢æœåŠ¡å™¨ï¼Œ ç§»é™¤ AOF æ–‡ä»¶æœ«å°¾çš„ FLUSHALL å‘½ä»¤ï¼Œ å¹¶é‡å¯ Redis ï¼Œ å°±å¯ä»¥å°†æ•°æ®é›†æ¢å¤åˆ° FLUSHALL æ‰§è¡Œä¹‹å‰çš„çŠ¶æ€ã€‚ AOFç¼ºç‚¹ å¯¹äºŽç›¸åŒçš„æ•°æ®é›†æ¥è¯´ï¼ŒAOF æ–‡ä»¶çš„ä½“ç§¯é€šå¸¸è¦å¤§äºŽ RDB æ–‡ä»¶çš„ä½“ç§¯ã€‚ æ ¹æ®æ‰€ä½¿ç”¨çš„ fsync ç­–ç•¥ï¼ŒAOF çš„é€Ÿåº¦å¯èƒ½ä¼šæ…¢äºŽ RDB ã€‚ åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ æ¯ç§’ fsync çš„æ€§èƒ½ä¾ç„¶éžå¸¸é«˜ï¼Œ è€Œå…³é—­ fsync å¯ä»¥è®© AOF çš„é€Ÿåº¦å’Œ RDB ä¸€æ ·å¿«ï¼Œ å³ä½¿åœ¨é«˜è´Ÿè·ä¹‹ä¸‹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ ä¸è¿‡åœ¨å¤„ç†å·¨å¤§çš„å†™å…¥è½½å…¥æ—¶ï¼ŒRDB å¯ä»¥æä¾›æ›´æœ‰ä¿è¯çš„æœ€å¤§å»¶è¿Ÿæ—¶é—´ï¼ˆlatencyï¼‰ã€‚ AOF åœ¨è¿‡åŽ»æ›¾ç»å‘ç”Ÿè¿‡è¿™æ ·çš„ bug ï¼š å› ä¸ºä¸ªåˆ«å‘½ä»¤çš„åŽŸå› ï¼Œå¯¼è‡´ AOF æ–‡ä»¶åœ¨é‡æ–°è½½å…¥æ—¶ï¼Œæ— æ³•å°†æ•°æ®é›†æ¢å¤æˆä¿å­˜æ—¶çš„åŽŸæ ·ã€‚ ï¼ˆä¸¾ä¸ªä¾‹å­ï¼Œé˜»å¡žå‘½ä»¤ BRPOPLPUSH å°±æ›¾ç»å¼•èµ·è¿‡è¿™æ ·çš„ bug ã€‚ï¼‰ æµ‹è¯•å¥—ä»¶é‡Œä¸ºè¿™ç§æƒ…å†µæ·»åŠ äº†æµ‹è¯•ï¼š å®ƒä»¬ä¼šè‡ªåŠ¨ç”Ÿæˆéšæœºçš„ã€å¤æ‚çš„æ•°æ®é›†ï¼Œ å¹¶é€šè¿‡é‡æ–°è½½å…¥è¿™äº›æ•°æ®æ¥ç¡®ä¿ä¸€åˆ‡æ­£å¸¸ã€‚ è™½ç„¶è¿™ç§ bug åœ¨ AOF æ–‡ä»¶ä¸­å¹¶ä¸å¸¸è§ï¼Œ ä½†æ˜¯å¯¹æ¯”æ¥è¯´ï¼Œ RDB å‡ ä¹Žæ˜¯ä¸å¯èƒ½å‡ºçŽ°è¿™ç§ bug çš„ã€‚ RDB å’Œ AOF ï¼Œæˆ‘åº”è¯¥ç”¨å“ªä¸€ä¸ªï¼Ÿä¸€èˆ¬æ¥è¯´ï¼Œ å¦‚æžœæƒ³è¾¾åˆ°è¶³ä»¥åª²ç¾Ž PostgreSQL çš„æ•°æ®å®‰å…¨æ€§ï¼Œ ä½ åº”è¯¥åŒæ—¶ä½¿ç”¨ä¸¤ç§æŒä¹…åŒ–åŠŸèƒ½ã€‚ å¦‚æžœä½ éžå¸¸å…³å¿ƒä½ çš„æ•°æ®ï¼Œ ä½†ä»ç„¶å¯ä»¥æ‰¿å—æ•°åˆ†é’Ÿä»¥å†…çš„æ•°æ®ä¸¢å¤±ï¼Œ é‚£ä¹ˆä½ å¯ä»¥åªä½¿ç”¨ RDB æŒä¹…åŒ–ã€‚ æœ‰å¾ˆå¤šç”¨æˆ·éƒ½åªä½¿ç”¨ AOF æŒä¹…åŒ–ï¼Œ ä½†æˆ‘ä»¬å¹¶ä¸æŽ¨èè¿™ç§æ–¹å¼ï¼š å› ä¸ºå®šæ—¶ç”Ÿæˆ RDB å¿«ç…§ï¼ˆsnapshotï¼‰éžå¸¸ä¾¿äºŽè¿›è¡Œæ•°æ®åº“å¤‡ä»½ï¼Œ å¹¶ä¸” RDB æ¢å¤æ•°æ®é›†çš„é€Ÿåº¦ä¹Ÿè¦æ¯” AOF æ¢å¤çš„é€Ÿåº¦è¦å¿«ï¼Œ é™¤æ­¤ä¹‹å¤–ï¼Œ ä½¿ç”¨ RDB è¿˜å¯ä»¥é¿å…ä¹‹å‰æåˆ°çš„ AOF ç¨‹åºçš„ bug ã€‚ RDB æŒä¹…åŒ–åˆ‡æ¢åˆ° AOF æŒä¹…åŒ–åœ¨ Redis 2.2 æˆ–ä»¥ä¸Šç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨ä¸é‡å¯çš„æƒ…å†µä¸‹ï¼Œä»Ž RDB åˆ‡æ¢åˆ° AOF ï¼š ä¸ºæœ€æ–°çš„ dump.rdb æ–‡ä»¶åˆ›å»ºä¸€ä¸ªå¤‡ä»½ã€‚ å°†å¤‡ä»½æ”¾åˆ°ä¸€ä¸ªå®‰å…¨çš„åœ°æ–¹ã€‚ æ‰§è¡Œä»¥ä¸‹ä¸¤æ¡å‘½ä»¤ï¼š 123redis-cli&gt; CONFIG SET appendonly yes redis-cli&gt; CONFIG SET save "" ç¡®ä¿å‘½ä»¤æ‰§è¡Œä¹‹åŽï¼Œæ•°æ®åº“çš„é”®çš„æ•°é‡æ²¡æœ‰æ”¹å˜ã€‚ ç¡®ä¿å†™å‘½ä»¤ä¼šè¢«æ­£ç¡®åœ°è¿½åŠ åˆ° AOF æ–‡ä»¶çš„æœ«å°¾ã€‚ æ­¥éª¤ 3 æ‰§è¡Œçš„ç¬¬ä¸€æ¡å‘½ä»¤å¼€å¯äº† AOF åŠŸèƒ½ï¼š Redis ä¼šé˜»å¡žç›´åˆ°åˆå§‹ AOF æ–‡ä»¶åˆ›å»ºå®Œæˆä¸ºæ­¢ï¼Œ ä¹‹åŽ Redis ä¼šç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ï¼Œ å¹¶å¼€å§‹å°†å†™å…¥å‘½ä»¤è¿½åŠ åˆ° AOF æ–‡ä»¶æœ«å°¾ã€‚ æ­¥éª¤ 3 æ‰§è¡Œçš„ç¬¬äºŒæ¡å‘½ä»¤ç”¨äºŽå…³é—­ RDB åŠŸèƒ½ã€‚ è¿™ä¸€æ­¥æ˜¯å¯é€‰çš„ï¼Œ å¦‚æžœä½ æ„¿æ„çš„è¯ï¼Œ ä¹Ÿå¯ä»¥åŒæ—¶ä½¿ç”¨ RDB å’Œ AOF è¿™ä¸¤ç§æŒä¹…åŒ–åŠŸèƒ½ã€‚ åˆ«å¿˜äº†åœ¨ redis.conf ä¸­æ‰“å¼€ AOF åŠŸèƒ½ï¼ å¦åˆ™çš„è¯ï¼Œ æœåŠ¡å™¨é‡å¯ä¹‹åŽï¼Œ ä¹‹å‰é€šè¿‡ CONFIG SET è®¾ç½®çš„é…ç½®å°±ä¼šè¢«é—å¿˜ï¼Œ ç¨‹åºä¼šæŒ‰åŽŸæ¥çš„é…ç½®æ¥å¯åŠ¨æœåŠ¡å™¨ã€‚ RDB å’Œ AOF ä¹‹é—´çš„ç›¸äº’ä½œç”¨åœ¨ç‰ˆæœ¬å·å¤§äºŽç­‰äºŽ 2.4 çš„ Redis ä¸­ï¼Œ BGSAVE æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œ ä¸å¯ä»¥æ‰§è¡Œ BGREWRITEAOF ã€‚ åè¿‡æ¥è¯´ï¼Œ åœ¨ BGREWRITEAOF æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œ ä¹Ÿä¸å¯ä»¥æ‰§è¡Œ BGSAVE ã€‚ è¿™å¯ä»¥é˜²æ­¢ä¸¤ä¸ª Redis åŽå°è¿›ç¨‹åŒæ—¶å¯¹ç£ç›˜è¿›è¡Œå¤§é‡çš„ I/O æ“ä½œã€‚ å¦‚æžœ BGSAVE æ­£åœ¨æ‰§è¡Œï¼Œ å¹¶ä¸”ç”¨æˆ·æ˜¾ç¤ºåœ°è°ƒç”¨ BGREWRITEAOF å‘½ä»¤ï¼Œ é‚£ä¹ˆæœåŠ¡å™¨å°†å‘ç”¨æˆ·å›žå¤ä¸€ä¸ª OK çŠ¶æ€ï¼Œ å¹¶å‘ŠçŸ¥ç”¨æˆ·ï¼ŒBGREWRITEAOF å·²ç»è¢«é¢„å®šæ‰§è¡Œï¼š ä¸€æ—¦ BGSAVE æ‰§è¡Œå®Œæ¯•ï¼Œ BGREWRITEAOF å°±ä¼šæ­£å¼å¼€å§‹ã€‚ å½“ Redis å¯åŠ¨æ—¶ï¼Œ å¦‚æžœ RDB æŒä¹…åŒ–å’Œ AOF æŒä¹…åŒ–éƒ½è¢«æ‰“å¼€äº†ï¼Œ é‚£ä¹ˆç¨‹åºä¼šä¼˜å…ˆä½¿ç”¨ AOF æ–‡ä»¶æ¥æ¢å¤æ•°æ®é›†ï¼Œ å› ä¸º AOF æ–‡ä»¶æ‰€ä¿å­˜çš„æ•°æ®é€šå¸¸æ˜¯æœ€å®Œæ•´çš„ã€‚ å¤‡ä»½ Redis æ•°æ®Redis å¯¹äºŽæ•°æ®å¤‡ä»½æ˜¯éžå¸¸å‹å¥½çš„ï¼Œ å› ä¸ºä½ å¯ä»¥åœ¨æœåŠ¡å™¨è¿è¡Œçš„æ—¶å€™å¯¹ RDB æ–‡ä»¶è¿›è¡Œå¤åˆ¶ï¼š RDB æ–‡ä»¶ä¸€æ—¦è¢«åˆ›å»ºï¼Œ å°±ä¸ä¼šè¿›è¡Œä»»ä½•ä¿®æ”¹ã€‚ å½“æœåŠ¡å™¨è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ RDB æ–‡ä»¶æ—¶ï¼Œ å®ƒå…ˆå°†æ–‡ä»¶çš„å†…å®¹ä¿å­˜åœ¨ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶é‡Œé¢ï¼Œ å½“ä¸´æ—¶æ–‡ä»¶å†™å…¥å®Œæ¯•æ—¶ï¼Œ ç¨‹åºæ‰ä½¿ç”¨ rename(2) åŽŸå­åœ°ç”¨ä¸´æ—¶æ–‡ä»¶æ›¿æ¢åŽŸæ¥çš„ RDB æ–‡ä»¶ã€‚ è¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œ æ— è®ºä½•æ—¶ï¼Œ å¤åˆ¶ RDB æ–‡ä»¶éƒ½æ˜¯ç»å¯¹å®‰å…¨çš„ã€‚ å»ºè®®ï¼š åˆ›å»ºä¸€ä¸ªå®šæœŸä»»åŠ¡ï¼ˆcron jobï¼‰ï¼Œ æ¯å°æ—¶å°†ä¸€ä¸ª RDB æ–‡ä»¶å¤‡ä»½åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œ å¹¶ä¸”æ¯å¤©å°†ä¸€ä¸ª RDB æ–‡ä»¶å¤‡ä»½åˆ°å¦ä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚ ç¡®ä¿å¿«ç…§çš„å¤‡ä»½éƒ½å¸¦æœ‰ç›¸åº”çš„æ—¥æœŸå’Œæ—¶é—´ä¿¡æ¯ï¼Œ æ¯æ¬¡æ‰§è¡Œå®šæœŸä»»åŠ¡è„šæœ¬æ—¶ï¼Œ ä½¿ç”¨ find å‘½ä»¤æ¥åˆ é™¤è¿‡æœŸçš„å¿«ç…§ï¼š æ¯”å¦‚è¯´ï¼Œ ä½ å¯ä»¥ä¿ç•™æœ€è¿‘ 48 å°æ—¶å†…çš„æ¯å°æ—¶å¿«ç…§ï¼Œ è¿˜å¯ä»¥ä¿ç•™æœ€è¿‘ä¸€ä¸¤ä¸ªæœˆçš„æ¯æ—¥å¿«ç…§ã€‚ è‡³å°‘æ¯å¤©ä¸€æ¬¡ï¼Œ å°† RDB å¤‡ä»½åˆ°ä½ çš„æ•°æ®ä¸­å¿ƒä¹‹å¤–ï¼Œ æˆ–è€…è‡³å°‘æ˜¯å¤‡ä»½åˆ°ä½ è¿è¡Œ Redis æœåŠ¡å™¨çš„ç‰©ç†æœºå™¨ä¹‹å¤–ã€‚ å®¹ç¾å¤‡ä»½Redis çš„å®¹ç¾å¤‡ä»½åŸºæœ¬ä¸Šå°±æ˜¯å¯¹æ•°æ®è¿›è¡Œå¤‡ä»½ï¼Œ å¹¶å°†è¿™äº›å¤‡ä»½ä¼ é€åˆ°å¤šä¸ªä¸åŒçš„å¤–éƒ¨æ•°æ®ä¸­å¿ƒã€‚ å®¹ç¾å¤‡ä»½å¯ä»¥åœ¨ Redis è¿è¡Œå¹¶äº§ç”Ÿå¿«ç…§çš„ä¸»æ•°æ®ä¸­å¿ƒå‘ç”Ÿä¸¥é‡çš„é—®é¢˜æ—¶ï¼Œ ä»ç„¶è®©æ•°æ®å¤„äºŽå®‰å…¨çŠ¶æ€ã€‚ å› ä¸ºå¾ˆå¤š Redis ç”¨æˆ·éƒ½æ˜¯åˆ›ä¸šè€…ï¼Œ ä»–ä»¬æ²¡æœ‰å¤§æŠŠå¤§æŠŠçš„é’±å¯ä»¥æµªè´¹ï¼Œ æ‰€ä»¥ä¸‹é¢ä»‹ç»çš„éƒ½æ˜¯ä¸€äº›å®žç”¨åˆä¾¿å®œçš„å®¹ç¾å¤‡ä»½æ–¹æ³•ï¼š Amazon S3 ï¼Œä»¥åŠå…¶ä»–ç±»ä¼¼ S3 çš„æœåŠ¡ï¼Œæ˜¯ä¸€ä¸ªæž„å»ºç¾éš¾å¤‡ä»½ç³»ç»Ÿçš„å¥½åœ°æ–¹ã€‚ æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯å°†ä½ çš„æ¯å°æ—¶æˆ–è€…æ¯æ—¥ RDB å¤‡ä»½åŠ å¯†å¹¶ä¼ é€åˆ° S3 ã€‚ å¯¹æ•°æ®çš„åŠ å¯†å¯ä»¥é€šè¿‡ gpg -c å‘½ä»¤æ¥å®Œæˆï¼ˆå¯¹ç§°åŠ å¯†æ¨¡å¼ï¼‰ã€‚ è®°å¾—æŠŠä½ çš„å¯†ç æ”¾åˆ°å‡ ä¸ªä¸åŒçš„ã€å®‰å…¨çš„åœ°æ–¹åŽ»ï¼ˆæ¯”å¦‚ä½ å¯ä»¥æŠŠå¯†ç å¤åˆ¶ç»™ä½ ç»„ç»‡é‡Œæœ€é‡è¦çš„äººç‰©ï¼‰ã€‚ åŒæ—¶ä½¿ç”¨å¤šä¸ªå‚¨å­˜æœåŠ¡æ¥ä¿å­˜æ•°æ®æ–‡ä»¶ï¼Œå¯ä»¥æå‡æ•°æ®çš„å®‰å…¨æ€§ã€‚ ä¼ é€å¿«ç…§å¯ä»¥ä½¿ç”¨ SCP æ¥å®Œæˆï¼ˆSSH çš„ç»„ä»¶ï¼‰ã€‚ ä»¥ä¸‹æ˜¯ç®€å•å¹¶ä¸”å®‰å…¨çš„ä¼ é€æ–¹æ³•ï¼š ä¹°ä¸€ä¸ªç¦»ä½ çš„æ•°æ®ä¸­å¿ƒéžå¸¸è¿œçš„ VPS ï¼Œ è£…ä¸Š SSH ï¼Œ åˆ›å»ºä¸€ä¸ªæ— å£ä»¤çš„ SSH å®¢æˆ·ç«¯ key ï¼Œ å¹¶å°†è¿™ä¸ª key æ·»åŠ åˆ° VPS çš„ authorized_keys æ–‡ä»¶ä¸­ï¼Œ è¿™æ ·å°±å¯ä»¥å‘è¿™ä¸ª VPS ä¼ é€å¿«ç…§å¤‡ä»½æ–‡ä»¶äº†ã€‚ ä¸ºäº†è¾¾åˆ°æœ€å¥½çš„æ•°æ®å®‰å…¨æ€§ï¼Œè‡³å°‘è¦ä»Žä¸¤ä¸ªä¸åŒçš„æä¾›å•†é‚£é‡Œå„è´­ä¹°ä¸€ä¸ª VPS æ¥è¿›è¡Œæ•°æ®å®¹ç¾å¤‡ä»½ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ è¿™ç±»å®¹ç¾ç³»ç»Ÿå¦‚æžœæ²¡æœ‰å°å¿ƒåœ°è¿›è¡Œå¤„ç†çš„è¯ï¼Œ æ˜¯å¾ˆå®¹æ˜“å¤±æ•ˆçš„ã€‚ æœ€ä½Žé™åº¦ä¸‹ï¼Œ ä½ åº”è¯¥åœ¨æ–‡ä»¶ä¼ é€å®Œæ¯•ä¹‹åŽï¼Œ æ£€æŸ¥æ‰€ä¼ é€å¤‡ä»½æ–‡ä»¶çš„ä½“ç§¯å’ŒåŽŸå§‹å¿«ç…§æ–‡ä»¶çš„ä½“ç§¯æ˜¯å¦ç›¸åŒã€‚ å¦‚æžœä½ ä½¿ç”¨çš„æ˜¯ VPS ï¼Œ é‚£ä¹ˆè¿˜å¯ä»¥é€šè¿‡æ¯”å¯¹æ–‡ä»¶çš„ SHA1 æ ¡éªŒå’Œæ¥ç¡®è®¤æ–‡ä»¶æ˜¯å¦ä¼ é€å®Œæ•´ã€‚ å¦å¤–ï¼Œ ä½ è¿˜éœ€è¦ä¸€ä¸ªç‹¬ç«‹çš„è­¦æŠ¥ç³»ç»Ÿï¼Œ è®©å®ƒåœ¨è´Ÿè´£ä¼ é€å¤‡ä»½æ–‡ä»¶çš„ä¼ é€å™¨ï¼ˆtransferï¼‰å¤±çµæ—¶é€šçŸ¥ä½ ã€‚]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Rediså­¦ä¹ ç¬”è®°-é…ç½®]]></title>
    <url>%2F2018%2F08%2F22%2FRedis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E9%85%8D%E7%BD%AE%2F</url>
    <content type="text"><![CDATA[Redisé…ç½®æ–‡ä»¶è§£æžNETWORK ï¼ˆç½‘ç»œï¼‰NETWORKç›¸å…³é…ç½®ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041421. ç›‘å¬åœ°å€# é»˜è®¤ç›‘å¬æ‰€æœ‰ç½‘å¡ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šç›‘å¬ä¸€ä¸ªæˆ–å¤šä¸ªã€‚# ç½‘ç»œä¸­çš„æœåŠ¡æ˜¯é€šè¿‡ip+è¿›ç¨‹æ¥è¿›è¡ŒåŒºåˆ†çš„ï¼Œå½“ä¸€ä¸ªæœåŠ¡å™¨æ‹¥æœ‰ä¸¤ä¸ªipæ—¶ï¼Œè‡ªç„¶å°±åœ¨ç½‘ç»œä¸­æ‹¥æœ‰ä¸¤ä¸ªäººèº«ä»½ï¼Œå¦‚å†…ç½‘ï¼Œå¤–ç½‘ï¼Œå½“ä½ æŒ‡å‘è®©redisåœ¨ä¸€ä¸ªç½‘ç»œä¸Šç›‘å¬æ—¶ï¼Œå°±å¯ä»¥ç”¨æ­¤é…ç½®ã€‚bind 127.0.0.1 192.168.198.222. ä¿æŠ¤æ¨¡å¼# é»˜è®¤ä¸ºå¼€å¯ã€‚# ä¿æŠ¤æ¨¡å¼å¼€å¯æ—¶å‡ºçŽ°ä»¥ä¸‹ä¸¤ç§æƒ…å†µåªèƒ½ä»¥127.0.0.1ï¼ˆipv4ï¼‰ã€::1ï¼ˆipv6ï¼‰æˆ–socketè¿žæŽ¥ï¼š# 1. æ²¡æœ‰è®¾ç½®bindç»‘å®šç½‘å¡ã€‚# 2. æ²¡æœ‰è®¾ç½®å¯†ç ã€‚protected-mode yes3. ç›‘å¬ç«¯å£# æŒ‡å®šredisç›‘å¬ç«¯å£ï¼Œé»˜è®¤ç«¯å£ä¸º6379ã€‚# å¦‚æžœç«¯å£ä¸º0ï¼Œåˆ™redisä¸ä¼šå†TCP socketä¸Šè¿›è¡Œç›‘å¬ï¼ˆä¸åœ¨TCP socketä¸Šè¿›è¡Œç›‘å¬ï¼Œä¸ä»£è¡¨æ²¡æ³•è¿žæŽ¥ï¼Œåªæ˜¯æ— æ³•ä½¿ç”¨ç½‘ç»œè¿žæŽ¥è€Œå·²ï¼‰ã€‚port 63794. TCPè¿žæŽ¥é˜Ÿåˆ—é•¿åº¦# æ­¤å‚æ•°ç¡®å®šäº†TCPè¿žæŽ¥ä¸­å·²å®Œæˆé˜Ÿåˆ—ï¼ˆå®Œæˆä¸‰æ¬¡æ¡æ‰‹ä¹‹åŽï¼‰çš„é•¿åº¦ï¼Œå½“ç„¶æ­¤å€¼å¿…é¡»ä¸å¤§äºŽlinuxç³»ç»Ÿå®šä¹‰çš„/proc/sys/net/core/somaxconnå€¼ï¼Œå¦‚æžœè¶…è¿‡somaxconnå€¼ï¼Œåˆ™linuxç³»ç»Ÿä¼šå°†å…¶æˆªæ–­ï¼Œé»˜è®¤ä¸º511ã€‚# æ­¤å€¼éœ€è¦å‚è€ƒlinuxç³»ç»Ÿçš„ä¸¤ä¸ªå†…æ ¸å‚æ•°ï¼š# 1. /proc/sys/net/core/somaxconn æœåŠ¡ç«¯æ‰€èƒ½æŽ¥å—æœ€å¤§å®¢æˆ·ç«¯æ•°é‡ï¼Œå³å®Œæˆè¿žæŽ¥ä¸Šé™ã€‚# 2. /proc/sys/net/ipv4/tcp_max_syn_backlog æœåŠ¡ç«¯æ‰€èƒ½æŽ¥å—SYNåŒæ­¥åŒ…çš„æœ€å¤§å®¢æˆ·ç«¯æ•°é‡ï¼Œå³åŠè¿žæŽ¥ä¸Šé™ã€‚# æ‰€ä»¥éœ€è¦æé«˜somaxconnä¸Žtcp_max_syn_backlogçš„å€¼æ¥è¾¾åˆ°é¢„æœŸçš„æ•ˆæžœã€‚tcp-backlog 5115. Socketè¿žæŽ¥# æŒ‡å®šunix sockçš„è·¯å¾„æ¥è¿›è¡Œè¿žæŽ¥ç›‘å¬ï¼Œé»˜è®¤æ˜¯ä¸æŒ‡å®šï¼Œå› æ­¤redisä¸ä¼šå†unix socketä¸Šè¿›è¡Œç›‘å¬ã€‚# æœ¬åœ°è¿è¡Œæ—¶ï¼Œå»ºè®®æ‰“å¼€ socket è¿žæŽ¥æ–¹å¼ã€‚unixsocket /tmp/redis.sockunixsocketperm 7556. è¿žæŽ¥è¶…æ—¶æ—¶é—´# å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„è¿žæŽ¥è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºä¸è¶…æ—¶ã€‚timeout 07. è¿žæŽ¥ä¿æ´»ç­–ç•¥# å•ä½ä¸ºç§’ã€‚# ä»Ž3.2.1ç‰ˆæœ¬ä¹‹åŽï¼Œå®˜æ–¹ç»™å‡ºçš„åˆç†å€¼ä¸º300ï¼Œé»˜è®¤å€¼ä¸º300sã€‚# 1. å¦‚æžœè®¾ç½®ä¸º300ç§’ï¼Œåˆ™æœåŠ¡ç«¯ä¼šæ¯300ç§’å‘è¿žæŽ¥ç©ºé—²çš„å®¢æˆ·ç«¯å‘èµ·ä¸€æ¬¡ACKè¯·æ±‚ï¼Œä»¥æ£€æŸ¥å®¢æˆ·ç«¯æ˜¯å¦å·²ç»æŒ‚æŽ‰ã€‚# 2. å¯¹äºŽæ— å“åº”çš„å®¢æˆ·ç«¯åˆ™ä¼šå…³é—­å…¶è¿žæŽ¥ã€‚# å¦‚æžœè®¾ç½®ä¸º0ï¼Œåˆ™ä¸ä¼šè¿›è¡Œè¿žæŽ¥æ£€æµ‹ã€‚tcp-keepalive 300 GENRAL ï¼ˆé€šç”¨ï¼‰GENRALç›¸å…³é…ç½®ï¼š 1234567891011121314151617181920212223242526272829303132331. å®ˆæŠ¤è¿›ç¨‹# redisé»˜è®¤ä¸æ˜¯ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œï¼Œå¯ä»¥é€šè¿‡è¯¥é…ç½®é¡¹ä¿®æ”¹ï¼Œä½¿ç”¨yeså¯åŠ¨å®ˆæŠ¤è¿›ç¨‹ã€‚daemonize no# é€‰æ‹©æ˜¯upstartè¿˜æ˜¯systemdç®¡ç†redisè¿›ç¨‹ã€‚æ­¤å‚æ•°å’Œæ“ä½œç³»ç»Ÿç›¸å…³ï¼š# 1. supervised no æ²¡æœ‰ç›‘ç£äº’åŠ¨# 2. supervised upstart upstartä¿¡å·é€šè¿‡å°†Redisç½®äºŽSIGSTOPæ¨¡å¼å‘é€# 3. supervised systemd systemdä¿¡å·é€šè¿‡READY=1å†™å…¥NOTIFY_SOCKETçŽ¯å¢ƒå˜é‡# 4. supervised auto é€šè¿‡UPSTART_JOBæˆ–NOTIFY_SOCKETçŽ¯å¢ƒå˜é‡æ¥è‡ªåŠ¨é€‰æ‹©supervised no# å½“redisä»¥å®ˆæŠ¤è¿›ç¨‹æ–¹å¼è¿è¡Œæ—¶ï¼ŒæŒ‡å®špidæ–‡ä»¶è·¯å¾„ã€‚redisé»˜è®¤ä¼šæŠŠpidå†™å…¥/var/run/redis.pidã€‚pidfile /var/run/redis_6379.pid2. æ—¥å¿—ç›¸å…³# redisæ€»å…±æ”¯æŒå››ä¸ªæ—¥å¿—çº§åˆ«ï¼š# 1. debugï¼šè®°å½•å¾ˆå¤šä¿¡æ¯ï¼Œç”¨äºŽå¼€å‘å’Œæµ‹è¯•ã€‚# 2. varboseï¼šå°‘ä½†æœ‰ç”¨çš„ä¿¡æ¯ï¼Œä¸åƒdebugä¼šè®°å½•é‚£ä¹ˆå¤šä¿¡æ¯ã€‚# 3. noticeï¼šé€‚é‡çš„ä¿¡æ¯ï¼Œå¸¸ç”¨äºŽç”Ÿäº§çŽ¯å¢ƒã€‚# 4. warningï¼šåªæœ‰éžå¸¸é‡è¦æˆ–è€…ä¸¥é‡çš„ä¿¡æ¯ä¼šè®°å½•åˆ°æ—¥å¿—ã€‚# é»˜è®¤çº§åˆ«æ˜¯noticeã€‚loglevel notice# æ—¥å¿—æ–‡ä»¶ä½ç½®ã€‚# å½“æŒ‡å®šä¸ºç©ºå­—ç¬¦ä¸²æ—¶ï¼Œä¸ºæ ‡å‡†è¾“å‡ºï¼Œå¦‚æžœrediså·²å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼è¿è¡Œï¼Œé‚£ä¹ˆæ—¥å¿—å°†ä¼šè¾“å‡ºåˆ°/dev/nullã€‚logfile /var/log/redis/redis.log# å¦‚æžœæƒ³æŠŠæ—¥å¿—è®°å½•åˆ°ç³»ç»Ÿæ—¥å¿—syslogä¸­ï¼Œå°±æŠŠå®ƒæ”¹æˆ yesã€‚è¿˜å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‚æ•°æ¥è¾¾åˆ°ç¬¦åˆçš„è¦æ±‚ã€‚syslog-enabled no# æŒ‡å®šsyslogçš„æ ‡ç¤ºç¬¦ï¼ˆç³»ç»Ÿæ—¥å¿—ä¸­çš„èº«ä»½ï¼‰ï¼Œå¦‚æžœsyslog-enabledä¸ºnoï¼Œåˆ™è¿™ä¸ªé€‰é¡¹æ— æ•ˆã€‚syslog-ident redis# æŒ‡å®šsyslogè®¾å¤‡ï¼ˆfacilityï¼‰ï¼Œå¿…é¡»æ˜¯USERæˆ–è€…LOCAL0åˆ°LOCAL7ã€‚å…·ä½“å¯ä»¥å‚è€ƒsyslogæœåŠ¡æœ¬èº«çš„ç”¨æ³•ã€‚syslog-facility local03. æ•°æ®åº“æ•°é‡# å¯ç”¨çš„æ•°æ®åº“æ•°ï¼Œé»˜è®¤å€¼ä¸º16ã€‚é»˜è®¤æ•°æ®åº“ä¸º0ï¼Œæ•°æ®åº“èŒƒå›´åœ¨0-ï¼ˆdatabase-1ï¼‰ä¹‹é—´ã€‚databases 16 SNAPSHOTTING ï¼ˆå¿«ç…§ï¼‰SNAPSHOTTINGç›¸å…³é…ç½®ï¼š 1234567891011121314151617181920212223242526272829303132333435363738391. å¿«ç…§æŒä¹…åŒ–ç­–ç•¥# è¿™ä¸ªå‚æ•°æ˜¯redisæŒä¹…åŒ–çš„æ”¯æŒï¼ŒåŸºäºŽsnapshotæœºåˆ¶ ï¼Œå®šæœŸæ‰§è¡ŒæŒä¹…åŒ–å­˜å‚¨ï¼Œç”Ÿæˆrdbæ–‡ä»¶ã€‚# æ ¼å¼ä¸ºï¼šsave &lt;seconds&gt; &lt;changes&gt; # &lt;seconds&gt;å’Œ&lt;changes&gt;éƒ½æ»¡è¶³æ—¶å°±ä¼šè§¦å‘æ•°æ®ä¿å­˜åŠ¨ä½œã€‚# ä»¥ä¸‹ä¸ºé»˜è®¤ç­–ç•¥ï¼š# 900ç§’å†…å¦‚æžœè‡³å°‘æœ‰1ä¸ªkeyçš„å€¼å‘ç”Ÿå˜åŒ–ï¼Œåˆ™ä¿å­˜åˆ°ç£ç›˜ã€‚# 300ç§’å†…å¦‚æžœè‡³å°‘æœ‰10ä¸ªkeyçš„å€¼å‘ç”Ÿå˜åŒ–ï¼Œåˆ™ä¿å­˜åˆ°ç£ç›˜ã€‚# 60ç§’å†…å¦‚æžœè‡³å°‘æœ‰10000ä¸ªkeyçš„å€¼å‘ç”Ÿå˜åŒ–ï¼Œåˆ™ä¿å­˜åˆ°ç£ç›˜ã€‚# å¦‚æžœä¸æƒ³è®©redisè‡ªåŠ¨ä¿å­˜æ•°æ®ï¼Œå°±æŠŠä»¥ä¸‹é…ç½®æ³¨é‡ŠæŽ‰ã€‚ä¹Ÿå¯ä»¥ç›´æŽ¥é…ç½®ç©ºå­—ç¬¦æ¥å®žçŽ°åœç”¨ï¼šsave ""ã€‚save 900 1save 300 10save 60 100002. æŒä¹…åŒ–é”™è¯¯ç­–ç•¥# å¦‚æžœç”¨æˆ·å¼€å¯äº†RDBå¿«ç…§åŠŸèƒ½ï¼Œé‚£ä¹ˆåœ¨redisæŒä¹…åŒ–æ•°æ®åˆ°ç£ç›˜æ—¶å¦‚æžœå‡ºçŽ°å¤±è´¥ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œredisä¼šåœæ­¢æŽ¥å—æ‰€æœ‰çš„å†™è¯·æ±‚ã€‚# è¿™æ ·åšçš„å¥½å¤„åœ¨äºŽå¯ä»¥è®©ç”¨æˆ·å¾ˆæ˜Žç¡®çš„çŸ¥é“å†…å­˜ä¸­çš„æ•°æ®å’Œç£ç›˜ä¸Šçš„æ•°æ®å·²ç»å­˜åœ¨ä¸ä¸€è‡´äº†ã€‚# å¦‚æžœredisä¸é¡¾è¿™ç§ä¸ä¸€è‡´ï¼Œä¸€æ„å­¤è¡Œçš„ç»§ç»­æŽ¥æ”¶å†™è¯·æ±‚ï¼Œå°±å¯èƒ½ä¼šå¼•èµ·ä¸€äº›ç¾éš¾æ€§çš„åŽæžœã€‚# å¦‚æžœä¸‹ä¸€æ¬¡RDBæŒä¹…åŒ–æˆåŠŸï¼Œredisä¼šè‡ªåŠ¨æ¢å¤æŽ¥å—å†™è¯·æ±‚ã€‚# å¦‚æžœä¸åœ¨ä¹Žè¿™ç§æ•°æ®ä¸ä¸€è‡´æˆ–è€…æœ‰å…¶ä»–çš„æ‰‹æ®µå‘çŽ°å’ŒæŽ§åˆ¶è¿™ç§ä¸ä¸€è‡´çš„è¯ï¼Œå¯ä»¥å…³é—­è¿™ä¸ªåŠŸèƒ½ï¼Œä»¥ä¾¿åœ¨å¿«ç…§å†™å…¥å¤±è´¥æ—¶ï¼Œä¹Ÿèƒ½ç¡®ä¿redisç»§ç»­æŽ¥å—æ–°çš„å†™è¯·æ±‚ã€‚stop-writes-on-bgsave-error yes3. å¿«ç…§åŽ‹ç¼©# å­˜å‚¨åˆ°ç£ç›˜ä¸­çš„å¿«ç…§ï¼Œå¯ä»¥è®¾ç½®æ˜¯å¦è¿›è¡ŒåŽ‹ç¼©å­˜å‚¨ã€‚# é»˜è®¤ä¸ºyesï¼Œredisä¼šé‡‡ç”¨LZFç®—æ³•è¿›è¡ŒåŽ‹ç¼©ã€‚# å¦‚æžœä½ ä¸æƒ³æ¶ˆè€—CPUæ¥è¿›è¡ŒåŽ‹ç¼©çš„è¯ï¼Œå¯ä»¥è®¾ç½®ä¸ºå…³é—­æ­¤åŠŸèƒ½ï¼Œä½†æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„å¿«ç…§ä¼šæ¯”è¾ƒå¤§ã€‚rdbcompression yes4. å¿«ç…§æ ¡éªŒ# åœ¨å­˜å‚¨å¿«ç…§åŽï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è®©redisä½¿ç”¨CRC64ç®—æ³•æ¥è¿›è¡Œæ•°æ®æ ¡éªŒï¼Œä½†æ˜¯è¿™æ ·åšä¼šå¢žåŠ å¤§çº¦10%çš„æ€§èƒ½æ¶ˆè€—ã€‚# å¦‚æžœå¸Œæœ›èŽ·å–åˆ°æœ€å¤§çš„æ€§èƒ½æå‡ï¼Œå¯ä»¥å…³é—­æ­¤åŠŸèƒ½ã€‚rdbchecksum yes5. å¿«ç…§åç§°# è®¾ç½®å¿«ç…§æ–‡ä»¶çš„åç§°dbfilename dump.rdb6. å¿«ç…§è·¯å¾„# è®¾ç½®è¿™ä¸ªå¿«ç…§æ–‡ä»¶å­˜æ”¾çš„è·¯å¾„dir /var/lib/redis REPLICATION ï¼ˆå¤åˆ¶ï¼‰REPLICATIONç›¸å…³è®¾ç½®ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485861. ä¸»ä»Žå¤åˆ¶# ä¸»ä»Žå¤åˆ¶åŠŸèƒ½ï¼Œè®¾ç½®è¯¥æ•°æ®åº“ä¸ºå…¶ä»–æ•°æ®åº“çš„ä»Žæ•°æ®åº“ã€‚åªéœ€åœ¨slaveè§’è‰²ä¸­æ·»åŠ æ­¤é€‰é¡¹ã€‚# å»ºè®®ç”¨æˆ·ä¸ºslaveè®¾ç½®ä¸€ä¸ªä¸åŒé¢‘çŽ‡çš„å¿«ç…§æŒä¹…åŒ–çš„å‘¨æœŸï¼ˆåŒºåˆ«äºŽmasterï¼‰ï¼Œæˆ–è€…ä¸ºä»Žredisé…ç½®ä¸€ä¸ªä¸åŒçš„æœåŠ¡ç«¯å£ã€‚slaveof &lt;masterip&gt; &lt;masterport&gt;2. å¯†ç æ ¡éªŒ# å¦‚æžœmasterè®¾ç½®äº†éªŒè¯å¯†ç çš„è¯ï¼ˆä½¿ç”¨requirepassæ¥è®¾ç½®ï¼‰ï¼Œåˆ™åœ¨slaveçš„é…ç½®ä¸­è¦ä½¿ç”¨masterauthæ¥è®¾ç½®æ ¡éªŒå¯†ç ï¼Œå¦åˆ™çš„è¯ï¼Œä¸»redisä¼šæ‹’ç»ä»Žredisçš„è®¿é—®è¯·æ±‚ã€‚masterauth &lt;master-password&gt;3. Slaveå“åº”è¯·æ±‚ç­–ç•¥# å½“slaveä¸¢å¤±ä¸Žmasterçš„è¿žæŽ¥æ—¶ï¼Œæˆ–è€…slaveä»åœ¨åœ¨äºŽmasterè¿›è¡Œæ•°æ®åŒæ­¥æ—¶ï¼ˆè¿˜æ²¡æœ‰ä¸Žmasteræ•°æ®ä¿æŒä¸€è‡´ï¼‰ï¼Œslaveå¯ä»¥ç”¨ä¸¤ç§æ–¹å¼æ¥å“åº”å®¢æˆ·ç«¯è¯·æ±‚ï¼š# 1. å¦‚æžœslave-serve-stale-dataè®¾ç½®ä¸ºyesï¼Œåˆ™slaveä»ä¼šç»§ç»­å“åº”å®¢æˆ·ç«¯çš„è¯»å†™è¯·æ±‚ï¼Œæ­¤æ—¶å¯èƒ½ä¼šæœ‰é—®é¢˜ã€‚# 2. å¦‚æžœslave-serve-stale-dataè®¾ç½®ä¸ºnoï¼Œåˆ™slaveä¼šå¯¹å®¢æˆ·ç«¯çš„è¯·æ±‚è¿”å›žâ€œSYNC with master in progressâ€ã€‚å½“ç„¶ä¹Ÿæœ‰ä¾‹å¤–ï¼Œå½“å®¢æˆ·ç«¯å‘æ¥INFOè¯·æ±‚å’ŒSLAVEOFè¯·æ±‚ï¼Œslaveè¿˜æ˜¯ä¼šè¿›è¡Œå¤„ç†ã€‚slave-serve-stale-data yes4. Slaveè¯»å†™ç­–ç•¥# 2.6ç‰ˆæœ¬ä¹‹åŽï¼Œé»˜è®¤slaveä¸ºåªè¯»ã€‚# å¯ä»¥æŽ§åˆ¶ä¸€ä¸ªslaveæ˜¯å¦å¯ä»¥æŽ¥å—å†™è¯·æ±‚ã€‚å°†æ•°æ®ç›´æŽ¥å†™å…¥slaveï¼Œä¸€èˆ¬åªé€‚ç”¨äºŽé‚£äº›ç”Ÿå‘½å‘¨æœŸéžå¸¸çŸ­çš„æ•°æ®ï¼Œå› ä¸ºåœ¨ä¸»ä»ŽåŒæ­¥æ—¶ï¼Œè¿™äº›ä¸´æ—¶æ•°æ®å°±ä¼šè¢«æ¸…ç†æŽ‰ã€‚# åªè¯»çš„slaveå¹¶ä¸é€‚åˆç›´æŽ¥æš´éœ²ç»™ä¸å¯ä¿¡çš„å®¢æˆ·ç«¯ã€‚ä¸ºäº†å°½é‡é™ä½Žé£Žé™©ï¼Œå¯ä»¥ä½¿ç”¨rename-commandæŒ‡ä»¤æ¥å°†ä¸€äº›å¯èƒ½æœ‰ç ´ååŠ›çš„å‘½ä»¤é‡å‘½åï¼Œé¿å…å¤–éƒ¨ç›´æŽ¥è°ƒç”¨ã€‚æ¯”å¦‚ï¼š# rename-command CONFIG 73e99d350a4aa6f1a5af04ec29173f73slave-read-only yes5. æ— ç¡¬ç›˜å¤åˆ¶# å¤‡ä»½åŒæ­¥ç­–ç•¥ï¼šç¡¬ç›˜è¿˜æ˜¯å¥—æŽ¥å­—# æ–°slaveæœåŠ¡è¿žæŽ¥æˆ–è€…æ—§slaveé‡æ–°è¿žæŽ¥æ—¶ä¸èƒ½åªå¤åˆ¶ä¸Žmasteræœ‰å·®å¼‚çš„æ•°æ®ï¼Œå¿…é¡»åšä¸€ä¸ªå…¨éƒ¨åŒæ­¥ã€‚éœ€è¦ä¸€ä¸ªæ–°RDBæ–‡ä»¶dumpå‡ºæ¥ï¼Œç„¶åŽä»Žmasterä¼ è¾“åˆ°slaveã€‚æœ‰ä¸¤ç§æ–¹å¼ï¼š# 1. åŸºäºŽç¡¬ç›˜ï¼ˆdisk-backedï¼‰ï¼šmasteråˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹dump RDBï¼Œåˆ›å»ºå®ŒæˆåŽç”±çˆ¶è¿›ç¨‹ï¼ˆå³ä¸»è¿›ç¨‹ï¼‰å¢žé‡ä¼ ç»™slavesã€‚# 2. åŸºäºŽsocketï¼ˆdisklessï¼‰ï¼šmasteråˆ›å»ºä¸€ä¸ªè¿›ç¨‹ç›´æŽ¥dump RDBåˆ°slaveçš„socketï¼Œä¸ç»è¿‡ä¸»è¿›ç¨‹ï¼Œä¸ç»è¿‡ç£ç›˜ã€‚# åŸºäºŽç¡¬ç›˜çš„è¯ï¼ŒRDBæ–‡ä»¶åˆ›å»ºå®Œæ¯•åŽï¼Œå¯ä»¥åŒæ—¶æœåŠ¡æ›´å¤šçš„slaveã€‚# åŸºäºŽsocketçš„è¯ï¼Œæ–°slaveå»ºç«‹è¿žæŽ¥åŽéœ€è¦æŽ’é˜Ÿã€‚åŒæ­¥å®Œä¸€ä¸ªåœ¨è¿›è¡Œä¸‹ä¸€ä¸ªã€‚repl-diskless-sync no# å½“ä½¿ç”¨disklessæ—¶ï¼Œmasteræ”¶åˆ°ç¬¬ä¸€ä¸ªslaveåŒæ­¥è¯·æ±‚æ—¶ï¼Œä¼šç­‰å¾…å¤šä¸ªslaveè¯·æ±‚ï¼Œå¯ä»¥ä¸€èµ·åŒæ­¥æ•°æ®ã€‚è¯·æ±‚é—´éš”ä¸ºrepl-disk-sync-delayçš„é…ç½®æ—¶é—´ã€‚è¶…è¿‡äº†repl-disk-sync-delayé—´éš”æ—¶é—´ï¼ŒåŽæ¥çš„slaveéœ€è¦æŽ’é˜Ÿã€‚# å¯ä»¥é…ç½®å½“æ”¶åˆ°ç¬¬ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œç­‰å¾…å¤šä¸ªslaveä¸€èµ·æ¥è¯·æ±‚ä¹‹é—´çš„é—´éš”æ—¶é—´ã€‚# å¦‚æžœä¸º0ï¼Œåˆ™ç«‹å³å¯åŠ¨åŒæ­¥repl-diskless-sync-delay 56. Slave Pingç›‘æµ‹# slaveä¼šæŒ‰ç…§ä¸€ä¸ªæ—¶é—´é—´éš”å‘masterå‘é€PINGè¯·æ±‚ï¼Œé»˜è®¤ä¸º10ç§’ã€‚repl-ping-slave-period 107. åŒæ­¥è¶…æ—¶æ—¶é—´# åœ¨ä¸»ä»ŽåŒæ­¥æ—¶ï¼Œå¯èƒ½åœ¨è¿™äº›æƒ…å†µä¸‹ä¼šæœ‰è¶…æ—¶å‘ç”Ÿï¼š# 1. ä»¥slaveçš„è§’åº¦æ¥çœ‹ï¼Œå½“æœ‰å¤§è§„æ¨¡IOä¼ è¾“æ—¶ã€‚# 2. ä»¥slaveçš„è§’åº¦æ¥çœ‹ï¼Œå½“æ•°æ®ä¼ è¾“æˆ–PINGæ—¶ï¼Œmasterè¶…æ—¶# 3. ä»¥masterçš„è§’åº¦æ¥çœ‹ï¼Œåœ¨å›žå¤ä»Žredisçš„PINGæ—¶ï¼Œslaveè¶…æ—¶# å¯ä»¥è®¾ç½®ä¸Šè¿°è¶…æ—¶çš„æ—¶é™ï¼Œä¸è¿‡è¦ç¡®ä¿è¿™ä¸ªæ—¶é™æ¯”repl-ping-slave-periodçš„å€¼è¦å¤§ï¼Œå¦åˆ™æ¯æ¬¡masteréƒ½ä¼šè®¤ä¸ºslaveè¶…æ—¶ã€‚repl-timeout 608. åŒæ­¥å»¶è¿Ÿç­–ç•¥# å¦‚æžœä¸ºyesï¼Œåˆ™ç¦ç”¨NO_DELAYï¼Œredisä¼šä½¿ç”¨è¾ƒå°‘é‡çš„TCPåŒ…å’Œå¸¦å®½å‘slaveå‘é€æ•°æ®ã€‚ä½†è¿™ä¼šå¯¼è‡´åœ¨slaveå¢žåŠ ä¸€ç‚¹æ•°æ®çš„å»¶æ—¶ã€‚ï¼ˆLinuxå†…æ ¸é»˜è®¤é…ç½®æƒ…å†µä¸‹æœ€å¤š40æ¯«ç§’çš„å»¶æ—¶ã€‚ï¼‰# å¦‚æžœä¸ºnoï¼Œåˆ™å¯ç”¨NO_DELAYï¼Œslaveçš„æ•°æ®å»¶æ—¶ä¸ä¼šé‚£ä¹ˆå¤šï¼Œä½†åŒæ­¥éœ€è¦çš„å¸¦å®½ç›¸å¯¹è¾ƒå¤šã€‚repl-disable-tcp-nodelay no9. åŒæ­¥ç¼“å­˜# é˜Ÿåˆ—é•¿åº¦ï¼ˆbacklog)æ˜¯masterä¸­çš„ä¸€ä¸ªç¼“å†²åŒºï¼Œåœ¨ä¸Žslaveæ–­å¼€è¿žæŽ¥æœŸé—´ï¼Œmasterä¼šç”¨è¿™ä¸ªç¼“å†²åŒºæ¥ç¼“å­˜åº”è¯¥å‘ç»™slaveçš„æ•°æ®ã€‚è¿™æ ·çš„è¯ï¼Œå½“slaveé‡æ–°è¿žæŽ¥ä¸Šä¹‹åŽï¼Œå°±ä¸å¿…é‡æ–°å…¨é‡åŒæ­¥æ•°æ®ï¼Œåªéœ€è¦åŒæ­¥è¿™éƒ¨åˆ†å¢žé‡æ•°æ®å³å¯ã€‚repl-backlog-zise 1mb# å¦‚æžœmasterç­‰äº†ä¸€æ®µæ—¶é—´ä¹‹åŽï¼Œè¿˜æ˜¯æ— æ³•è¿žæŽ¥åˆ°slaveï¼Œé‚£ä¹ˆç¼“å†²é˜Ÿåˆ—ä¸­çš„æ•°æ®å°†è¢«æ¸…ç†æŽ‰ã€‚# å¯ä»¥è®¾ç½®masterè¦ç­‰å¾…çš„æ—¶é—´ï¼Œé»˜è®¤æ˜¯1å°æ—¶ã€‚# å¦‚æžœè®¾ç½®ä¸º0ï¼Œåˆ™è¡¨ç¤ºæ°¸è¿œä¸æ¸…ç†ã€‚repl-backlog-ttl 360010. Slaveä¼˜å…ˆçº§# ç¼–å·è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜# åœ¨ä¸æ­¢1ä¸ªslaveå­˜åœ¨çš„éƒ¨ç½²çŽ¯å¢ƒä¸‹ï¼Œå½“masterå®•æœºæ—¶ï¼ŒRedis Sentinelä¼šå°†priorityå€¼æœ€å°çš„slaveæå‡ä¸ºmasterã€‚# è‹¥é…ç½®ä¸º0ï¼Œåˆ™å¯¹åº”çš„slaveæ°¸è¿œä¸ä¼šè‡ªåŠ¨æå‡ä¸ºmasterã€‚slave-priority 10011. MasteræŽ¥æ”¶å†™è¯·æ±‚æ¡ä»¶# å¦‚æžœmasteræœ‰è‡³å°‘Nä¸ªslaveï¼Œå¹¶ä¸”pingå¿ƒè·³çš„è¶…æ—¶ä¸è¶…è¿‡Mç§’ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šæŽ¥æ”¶å†™è¯·æ±‚ã€‚# å¦‚æžœNå’ŒMçš„æ¡ä»¶éƒ½æ— æ³•è¾¾åˆ°ï¼Œé‚£ä¹ˆmasterä¼šå›žå¤ä¸€ä¸ªé”™è¯¯ä¿¡æ¯ã€‚å†™è¯·æ±‚ä¹Ÿä¸ä¼šè¢«å¤„ç†ã€‚# é»˜è®¤min-slaves-to-writeä¸º0ï¼Œè¡¨ç¤ºå¯¹slavesæ•°é‡æ— é™åˆ¶ï¼Œç½‘ç»œå»¶è¿Ÿä¸º10sã€‚# ä¸¤ä¸ªé…ç½®ä¸­æœ‰ä¸€ä¸ªè¢«ç½®ä¸º0ï¼Œåˆ™è¿™ä¸ªç‰¹æ€§å°†è¢«å…³é—­ã€‚# éœ€è¦è‡³å°‘3ä¸ªslaveé“¾æŽ¥ï¼Œä¸”å»¶è¿Ÿå°äºŽç­‰äºŽ10ç§’æ—¶ï¼Œmasteræ‰èƒ½å†™æ•°æ®ã€‚min-slaves-to-write 3min-slaves-max-lag 1012. Slaveä¿¡æ¯# masterèƒ½å¤Ÿä»¥ä¸åŒçš„æ–¹å¼åˆ—å‡ºæ‰€è¿žæŽ¥slaveçš„åœ°å€å’Œç«¯å£ã€‚# ä¾‹å¦‚ï¼Œâ€œINFO replicationâ€éƒ¨åˆ†æä¾›æ­¤ä¿¡æ¯ï¼Œé™¤äº†å…¶ä»–å·¥å…·ä¹‹å¤–ï¼ŒRedis Sentinelè¿˜ä½¿ç”¨è¯¥ä¿¡æ¯æ¥å‘çŽ°slaveå®žä¾‹ã€‚# æ­¤ä¿¡æ¯å¯ç”¨çš„å¦ä¸€ä¸ªåœ°æ–¹åœ¨masterserçš„â€œROLEâ€å‘½ä»¤çš„è¾“å‡ºä¸­ã€‚# é€šå¸¸ç”±slaveæŠ¥å‘Šçš„åˆ—å‡ºçš„IPå’Œåœ°å€,é€šè¿‡ä»¥ä¸‹æ–¹å¼èŽ·å¾—ï¼š# 1. IPï¼šé€šè¿‡æ£€æŸ¥slaveä¸Žmasterè¿žæŽ¥ä½¿ç”¨çš„å¥—æŽ¥å­—çš„å¯¹ç­‰ä½“åœ°å€è‡ªåŠ¨æ£€æµ‹åœ°å€ã€‚# 2. ç«¯å£ï¼šç«¯å£åœ¨å¤åˆ¶æ¡æ‰‹æœŸé—´ç”±slaveté€šä¿¡ï¼Œå¹¶ä¸”é€šå¸¸æ˜¯slaveæ­£åœ¨ä½¿ç”¨åˆ—å‡ºè¿žæŽ¥çš„ç«¯å£ã€‚# ç„¶è€Œï¼Œå½“ä½¿ç”¨ç«¯å£è½¬å‘æˆ–ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰æ—¶ï¼Œslaveå®žé™…ä¸Šå¯ä»¥é€šè¿‡(ä¸åŒçš„IPå’Œç«¯å£å¯¹)æ¥åˆ°è¾¾ã€‚ slaveå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ä¸ªé€‰é¡¹ï¼Œä»¥ä¾¿å‘masteræŠ¥å‘Šä¸€ç»„ç‰¹å®šçš„IPå’Œç«¯å£ï¼Œä»¥ä¾¿INFOå’ŒROLEå°†æŠ¥å‘Šè¿™äº›å€¼ã€‚# å¦‚æžœä½ éœ€è¦ä»…è¦†ç›–ç«¯å£æˆ–IPåœ°å€ï¼Œåˆ™æ²¡å¿…è¦ä½¿ç”¨è¿™ä¸¤ä¸ªé€‰é¡¹ã€‚slave-announce-ip 5.5.5.5slave-announce-port 1234 SECURITY ï¼ˆå®‰å…¨ï¼‰SECURITYç›¸å…³é…ç½®ï¼š 123456789101. è¿žæŽ¥å¯†ç # è®¾ç½®å®¢æˆ·ç«¯è¿žæŽ¥åŽè¿›è¡Œä»»ä½•å…¶ä»–æŒ‡ä»¤å‰éœ€è¦ä½¿ç”¨çš„å¯†ç ã€‚# è­¦å‘Šï¼šå› ä¸ºredisé€Ÿåº¦ç›¸å½“å¿«ï¼Œæ‰€ä»¥åœ¨ä¸€å°æ¯”è¾ƒå¥½çš„æœåŠ¡å™¨ä¸‹ï¼Œä¸€ä¸ªå¤–éƒ¨ç”¨æˆ·å¯ä»¥åœ¨ä¸€ç§’é’Ÿè¿›è¡Œ150kæ¬¡çš„å¯†ç å°è¯•ï¼Œè¿™æ„å‘³ç€éœ€è¦æŒ‡å®šéžå¸¸éžå¸¸å¼ºå¤§çš„å¯†ç æ¥é˜²æ­¢æš´åŠ›ç ´è§£ã€‚requirepass foobared2. æŒ‡ä»¤é‡å‘½å# æ¯”å¦‚å°†ä¸€äº›æ¯”è¾ƒå±é™©çš„å‘½ä»¤æ”¹ä¸ªåå­—ï¼Œé¿å…è¢«è¯¯æ‰§è¡Œã€‚æ¯”å¦‚å¯ä»¥æŠŠCONFIGå‘½ä»¤æ”¹æˆä¸€ä¸ªå¾ˆå¤æ‚çš„åå­—ï¼Œè¿™æ ·å¯ä»¥é¿å…å¤–éƒ¨çš„è°ƒç”¨ï¼ŒåŒæ—¶è¿˜å¯ä»¥æ»¡è¶³å†…éƒ¨è°ƒç”¨çš„éœ€è¦ï¼Œæ¯”å¦‚ï¼š# rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52# å¦‚æžœæƒ³ç¦ç”¨ä¸€ä¸ªå‘½ä»¤ï¼Œç›´æŽ¥æŠŠå®ƒé‡å‘½åä¸ºä¸€ä¸ªç©ºå­—ç¬¦""å³å¯ã€‚rename-command CONFIG "" LIMITS ï¼ˆé™åˆ¶ï¼‰LIMITSç›¸å…³é…ç½®ï¼š 12345678910111213141516171819202122232425262728291. å®¢æˆ·ç«¯æœ€å¤§è¿žæŽ¥æ•°# è®¾ç½®åŒä¸€æ—¶é—´æœ€å¤§å®¢æˆ·ç«¯è¿žæŽ¥æ•°ï¼Œé»˜è®¤ä¸º10000ã€‚# Rediså¯ä»¥åŒæ—¶æ‰“å¼€çš„å®¢æˆ·ç«¯è¿žæŽ¥æ•°ä¸ºredisè¿›ç¨‹å¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°-32ï¼ˆredis serverè‡ªèº«ä¼šä½¿ç”¨ä¸€äº›ï¼‰ã€‚# å¦‚æžœè®¾ç½®maxclients 0ï¼Œè¡¨ç¤ºä¸ä½œé™åˆ¶ã€‚# å½“å®¢æˆ·ç«¯è¿žæŽ¥æ•°åˆ°è¾¾é™åˆ¶æ—¶ï¼ŒRedisä¼šå…³é—­æ–°çš„è¿žæŽ¥å¹¶å‘å®¢æˆ·ç«¯è¿”å›žmax number of clients reachedé”™è¯¯ä¿¡æ¯ã€‚maxclients 100002. å†…å­˜é™åˆ¶åŠæ¸…é™¤ç­–ç•¥# æŒ‡å®šredisæœ€å¤§å†…å­˜é™åˆ¶ï¼Œredisåœ¨å¯åŠ¨æ—¶ä¼šæŠŠæ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè¾¾åˆ°æœ€å¤§å†…å­˜åŽï¼Œredisä¼šæŒ‰ç…§æ¸…é™¤ç­–ç•¥å°è¯•æ¸…é™¤å·²åˆ°æœŸçš„keyã€‚# å¦‚æžœredisæ— æ³•æ ¹æ®ç§»é™¤è§„åˆ™æ¥ç§»é™¤å†…å­˜ä¸­çš„æ•°æ®ï¼Œæˆ–è€…æˆ‘ä»¬è®¾ç½®äº†â€œä¸å…è®¸ç§»é™¤â€ï¼Œé‚£ä¹ˆredisåˆ™ä¼šé’ˆå¯¹é‚£äº›éœ€è¦ç”³è¯·å†…å­˜çš„æŒ‡ä»¤è¿”å›žé”™è¯¯ä¿¡æ¯ï¼Œæ¯”å¦‚SETã€LPUSHç­‰ã€‚ä½†æ˜¯å¯¹äºŽæ— å†…å­˜ç”³è¯·çš„æŒ‡ä»¤ï¼Œä»ç„¶ä¼šæ­£å¸¸å“åº”ï¼Œæ¯”å¦‚GETç­‰ã€‚# æ³¨æ„ï¼šredisæ–°çš„vmæœºåˆ¶ï¼Œä¼šæŠŠkeyå­˜æ”¾å†…å­˜ï¼Œvalueä¼šå­˜æ”¾åœ¨swapåˆ†åŒºã€‚# æ³¨æ„ï¼šå¦‚æžœredisæœ‰slaveçš„è¯ï¼Œmaxmemoryæœ€å¥½è®¾ç½®ä¸ºmasterå†…å­˜çš„ä¸€åŠåŠä»¥ä¸‹ï¼Œå› ä¸ºmasteréœ€è¦å¯åŠ¨æ–°è¿›ç¨‹åŽ»dump rdbæ–‡ä»¶ã€‚maxmemory &lt;bytes&gt;# å½“å†…å­˜è¾¾åˆ°æœ€å¤§å€¼çš„æ—¶å€™redisä¼šé€‰æ‹©æ¸…é™¤ä¸€äº›æ•°æ®ï¼Œæ¸…é™¤è§„åˆ™æœ‰ï¼š# 1. volatile-lruï¼šåˆ©ç”¨LRUç®—æ³•ç§»é™¤è®¾ç½®è¿‡è¿‡æœŸæ—¶é—´çš„keyã€‚# 2. allkeys-lruï¼šåˆ©ç”¨LRUç®—æ³•ç§»é™¤ä»»ä½•keyã€‚# 3. volatile-randomï¼šéšæœºåœ°åˆ é™¤è¿‡æœŸsetä¸­çš„keyã€‚# 4. allkeys-randomï¼šéšæœºåˆ é™¤ä»»æ„ä¸€ä¸ªkeyã€‚# 5. volatile-ttlï¼šç§»é™¤é‚£äº›TTLå€¼æœ€å°çš„keyï¼Œå³é‚£äº›æœ€è¿‘æ‰è¿‡æœŸçš„keyã€‚# 6. noevictionï¼šä¸åˆ é™¤ä»»ä½•keyï¼Œå†™æ“ä½œä¼šæŠ¥é”™ã€‚# æ³¨æ„ï¼šå¯¹äºŽä¸Šé¢çš„ç­–ç•¥ï¼Œå¦‚æžœæ²¡æœ‰åˆé€‚çš„keyå¯ä»¥ç§»é™¤ï¼Œå½“å†™çš„æ—¶å€™redisä¼šè¿”å›žä¸€ä¸ªé”™è¯¯ã€‚# é»˜è®¤å€¼ä¸ºï¼šnoevictionmaxmemory-policy noeviction# LRU å’Œ minimal TTL ç®—æ³•éƒ½ä¸æ˜¯ç²¾å‡†çš„ç®—æ³•ï¼Œä½†æ˜¯ç›¸å¯¹ç²¾ç¡®çš„ç®—æ³•(ä¸ºäº†èŠ‚çœå†…å­˜)ã€‚# æ‰€ä»¥å¯ä»¥å¯¹å®ƒè¿›è¡Œä¼˜åŒ–ï¼Œä»¥èŽ·å¾—é€Ÿåº¦æˆ–å‡†ç¡®æ€§ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒRedisä¼šæ£€æŸ¥5ä¸ªé”®ï¼Œå¹¶é€‰æ‹©æœ€è¿‘ä½¿ç”¨è¾ƒå°‘çš„é”®ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„é…ç½®æŒ‡ä»¤æ›´æ”¹æ ·æœ¬å¤§å°ã€‚# é»˜è®¤å€¼ä¸º5ä¸ªæ ·æœ¬é€šå¸¸æƒ…å†µä¸‹èƒ½å¤Ÿè¾¾åˆ°å¾ˆå¥½çš„æ•ˆæžœã€‚10ä¸ªæ ·æœ¬ç²¾ç¡®åº¦æ›´é«˜ï¼Œä½†æ˜¯èŠ±è´¹æ›´å¤šçš„CPUã€‚3ä¸ªæ ·æœ¬æ˜¯éžå¸¸å¿«çš„ï¼Œä½†ä¸æ˜¯å¾ˆå‡†ç¡®ã€‚maxmemory-samples 5 APPEND ONLY MODE ï¼ˆAOFï¼‰APPEND ONLY MODEç›¸å…³é…ç½®ï¼š 1234567891011121314151617181920212223242526272829303132333435363738391. AOFæŒä¹…åŒ–åŠŸèƒ½# é»˜è®¤æƒ…å†µä¸‹ï¼Œredisä¼šå¼‚æ­¥çš„å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚è¿™ç§æ¨¡å¼åœ¨å¤§éƒ¨åˆ†åº”ç”¨ç¨‹åºä¸­å·²è¢«éªŒè¯æ˜¯å¾ˆæœ‰æ•ˆçš„ï¼Œä½†æ˜¯åœ¨ä¸€äº›é—®é¢˜å‘ç”Ÿæ—¶ï¼Œæ¯”å¦‚æ–­ç”µï¼Œåˆ™è¿™ç§æœºåˆ¶å¯èƒ½ä¼šå¯¼è‡´æ•°åˆ†é’Ÿçš„å†™è¯·æ±‚ä¸¢å¤±ã€‚# æ‰€ä»¥redisæä¾›äº†å¦å¤–ä¸€ç§æ›´åŠ é«˜æ•ˆçš„æ•°æ®åº“å¤‡ä»½åŠç¾éš¾æ¢å¤æ–¹å¼ï¼ŒAOF(Append Only File)ã€‚# å¼€å¯append onlyæ¨¡å¼ä¹‹åŽï¼Œredisä¼šæŠŠæ‰€æŽ¥æ”¶åˆ°çš„æ¯ä¸€æ¬¡å†™æ“ä½œè¯·æ±‚éƒ½è¿½åŠ åˆ°appendonly.aofæ–‡ä»¶ä¸­ï¼Œå½“# # # ä½†æ˜¯è¿™æ ·ä¼šé€ æˆappendonly.aofæ–‡ä»¶è¿‡å¤§ï¼Œæ‰€ä»¥redisè¿˜æ”¯æŒäº†BGREWRITEAOFæŒ‡ä»¤ï¼Œå¯¹appendonly.aofè¿›è¡Œé‡æ–°æ•´ç†ã€‚# é»˜è®¤æ˜¯ä¸å¼€å¯çš„ã€‚# æ³¨æ„ï¼šå¦‚æžœéœ€è¦ï¼Œå¯ä»¥åŒæ—¶å¼€å¯AOFæ¨¡å¼å’ŒRDBï¼ˆå¿«ç…§ï¼‰æ¨¡å¼ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œredisé‡å»ºæ•°æ®é›†æ—¶ä¼šä¼˜å…ˆä½¿ç”¨appendonly.aofè€Œå¿½ç•¥dump.rdbã€‚appendonly no# è®¾ç½®AOFæ–‡ä»¶åç§°ï¼Œé»˜è®¤ä¸ºappendonly.aofã€‚appendfilename "appendonly.aof"2. AOFæŒä¹…åŒ–ç­–ç•¥# redisæ”¯æŒä¸‰ç§åŒæ­¥AOFæ–‡ä»¶çš„ç­–ç•¥ï¼š# 1. alwaysï¼šæ¯ä¸€æ¬¡å†™æ“ä½œéƒ½ä¼šè°ƒç”¨ä¸€æ¬¡fsyncï¼Œè¿™æ—¶æ•°æ®æ˜¯æœ€å®‰å…¨çš„ã€‚å½“ç„¶ï¼Œç”±äºŽæ¯æ¬¡éƒ½ä¼šæ‰§è¡Œfsyncï¼Œæ‰€ä»¥å…¶æ€§èƒ½ä¹Ÿä¼šå—åˆ°å½±å“ã€‚è¿™ç§æ¨¡å¼ä¸‹ï¼Œredisä¼šç›¸å¯¹è¾ƒæ…¢ï¼Œä½†æ•°æ®æœ€å®‰å…¨ã€‚# 2. everysecï¼šredisä¼šé»˜è®¤æ¯éš”ä¸€ç§’è¿›è¡Œä¸€æ¬¡fsyncè°ƒç”¨ï¼Œå°†ç¼“å†²åŒºçš„æ•°æ®å†™å…¥ç£ç›˜ã€‚ä½†æ˜¯å½“è¿™ä¸€æ¬¡çš„fsyncè°ƒç”¨æ—¶é•¿è¶…è¿‡1ç§’é’Ÿæ—¶ï¼Œredisä¼šé‡‡å–å»¶è¿Ÿfsyncçš„ç­–ç•¥ï¼Œå†ç­‰ä¸€ç§’é’Ÿã€‚ä¹Ÿå°±æ˜¯åœ¨ä¸¤ç§’åŽåœ¨è¿›è¡Œfsyncï¼Œè¿™ä¸€æ¬¡çš„fsyncä¸ç®¡ä¼šæ‰§è¡Œå¤šé•¿æ—¶é—´éƒ½ä¼šè¿›è¡Œã€‚è¿™æ—¶å€™ç”±äºŽåœ¨fsyncæ—¶æ–‡ä»¶æè¿°ç¬¦ä¼šé˜»å¡žï¼Œæ‰€ä»¥å½“å‰çš„å†™æ“ä½œå°±ä¼šé˜»å¡žã€‚æ‰€ä»¥ï¼Œåœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œredisä¼šæ¯éš”ä¸€ç§’è¿›è¡Œä¸€æ¬¡fsyncã€‚åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œä¸¤ç§’é’Ÿä¼šè¿›è¡Œä¸€æ¬¡fsyncæ“ä½œã€‚è¿™ä¸€æ“ä½œåœ¨å¤§å¤šæ•°æ•°æ®åº“ç³»ç»Ÿä¸­è¢«ç§°ä¸ºgroup commitï¼Œå°±æ˜¯ç»„åˆå¤šæ¬¡å†™æ“ä½œçš„æ•°æ®ï¼Œä¸€æ¬¡æ€§å°†æ—¥å¿—å†™åˆ°ç£ç›˜ã€‚è¿™ç§æ¨¡å¼æ˜¯æ€§èƒ½å’Œå®‰å…¨çš„æŠ˜ä¸­ã€‚# 3. noï¼šredisä¸ä¼šä¸»åŠ¨è°ƒç”¨fsyncåŽ»å°†AOFæ—¥å¿—å†…å®¹åŒæ­¥åˆ°ç£ç›˜ï¼Œæ‰€ä»¥è¿™ä¸€åˆ‡å°±å®Œå…¨ä¾èµ–äºŽæ“ä½œç³»ç»Ÿçš„è°ƒè¯•äº†ã€‚å¯¹äºŽå¤§å¤šæ•°linuxç³»ç»Ÿï¼Œæ˜¯æ¯30ç§’è¿›è¡Œä¸€æ¬¡fsyncï¼Œå°†ç¼“å†²åŒºä¸­çš„æ•°æ®å†™åˆ°ç£ç›˜ä¸Šã€‚è¿™ç§æ¨¡å¼ä¸‹ï¼Œredisçš„æ€§èƒ½ä¼šæœ€å¿«ã€‚# é»˜è®¤ä¸ºï¼Œeverysecã€‚appendfsync everysec3. AOFé‡å†™ç­–ç•¥# å½“aofå¢žé•¿åˆ°ä¸€å®šè§„æ¨¡æ—¶ï¼Œredisä¼šéšå¼è°ƒç”¨BGREWRITEAOFæ¥é‡å†™logæ–‡ä»¶ï¼Œä»¥ç¼©å‡æ–‡ä»¶ä½“ç§¯ã€‚# è®¾ç½®ä¸ºnoæ—¶åœ¨åŽå°aofæ–‡ä»¶rewriteæœŸé—´è°ƒç”¨fsyncï¼Œé»˜è®¤ä¸ºnoï¼Œè¡¨ç¤ºè¦è°ƒç”¨fsyncã€‚# è®¾ç½®ä¸ºyesè¡¨ç¤ºrewriteæœŸé—´å¯¹æ–°å†™æ“ä½œä¸fsync,æš‚æ—¶å­˜åœ¨å†…å­˜ä¸­,ç­‰rewriteå®ŒæˆåŽå†å†™å…¥ã€‚ï¼ˆLinuxçš„é»˜è®¤fsyncç­–ç•¥æ˜¯30ç§’ã€‚å¯èƒ½ä¸¢å¤±30ç§’æ•°æ®ã€‚ï¼‰# redisåœ¨åŽå°å†™RDBæ–‡ä»¶æˆ–é‡å†™AOFæ–‡ä»¶æœŸé—´ä¼šå­˜åœ¨å¤§é‡ç£ç›˜IOï¼Œæ­¤æ—¶åœ¨æŸäº›linuxç³»ç»Ÿä¸­ï¼Œè°ƒç”¨fsyncå¯èƒ½ä¼šé˜»å¡žã€‚# å¦‚æžœå¯¹å»¶è¿Ÿè¦æ±‚å¾ˆé«˜çš„åº”ç”¨ï¼Œè¿™ä¸ªå­—æ®µå¯ä»¥è®¾ç½®ä¸ºyesï¼Œå¦åˆ™è¿˜æ˜¯è®¾ç½®ä¸ºnoï¼Œè¿™æ ·å¯¹æŒä¹…åŒ–ç‰¹æ€§æ¥è¯´è¿™æ˜¯æ›´å®‰å…¨çš„é€‰æ‹©ã€‚no-appendfsync-on-rewrite no# 1. auto-aof-rewrite-percentageï¼šæŒ‡å®šredisé‡å†™aofæ–‡ä»¶çš„æ¡ä»¶ï¼Œé»˜è®¤ä¸º100ï¼Œè¡¨ç¤ºä¸Žä¸Šæ¬¡rewriteçš„aofæ–‡ä»¶å¤§å°ç›¸æ¯”ï¼Œå½“å‰aofæ–‡ä»¶å¢žé•¿é‡è¶…è¿‡ä¸Šæ¬¡aofæ–‡ä»¶å¤§å°çš„100%æ—¶ï¼Œå°±ä¼šè§¦å‘backgroud rewriteã€‚# è‹¥auto-aof-rewrite-percentageé…ç½®ä¸º0ï¼Œåˆ™ä¼šç¦ç”¨è‡ªåŠ¨rewriteåŠŸèƒ½ã€‚# 2. auto-aof-rewrite-min-sizeï¼šæŒ‡å®šè§¦å‘rewriteçš„aofæ–‡ä»¶å¤§å°ã€‚è‹¥aofæ–‡ä»¶å°äºŽè¯¥å€¼ï¼Œå³æ—¶å½“å‰æ–‡ä»¶çš„å¢žé‡æ¯”ä¾‹è¾¾åˆ°auto-aof-rewrite-percentageçš„é…ç½®å€¼ï¼Œä¹Ÿä¸ä¼šè§¦å‘è‡ªåŠ¨rewriteã€‚# è¿™ä¸¤ä¸ªé…ç½®åŒæ—¶æ»¡è¶³æ—¶ï¼Œæ‰ä¼šè§¦å‘rewriteã€‚auto-aof-rewrite-percentage 100auto-aof-rewrite-min-size 64mb4. AOFæ–‡ä»¶ä¿®å¤# AOFæ–‡ä»¶å¯èƒ½åœ¨å°¾éƒ¨æ˜¯ä¸å®Œæ•´çš„ï¼ˆå°¤å…¶æ˜¯mount ext4æ–‡ä»¶ç³»ç»Ÿæ—¶æ²¡æœ‰åŠ ä¸Šdata=orderedé€‰é¡¹ï¼‰ã€‚é‚£redisé‡å¯æ—¶loadè¿›å†…å­˜çš„æ—¶å€™å°±å¯èƒ½å‡ºçŽ°é—®é¢˜ã€‚# é…ç½®aof-load-truncatedä¸ºyesæ—¶ï¼Œredisä¼šè‡ªåŠ¨å‘å¸ƒä¸€ä¸ªlogç»™å®¢æˆ·ç«¯ç„¶åŽloadã€‚# å¦‚æžœé…ç½®ä¸ºnoæ—¶ï¼Œç”¨æˆ·å¿…é¡»æ‰‹åŠ¨redis-check-aofä¿®å¤aofæ–‡ä»¶æ‰å¯ä»¥ã€‚aof-load-truncated yes LUA SCRIPTING ï¼ˆLUAè„šæœ¬ï¼‰LUA SCRIPTINGç›¸å…³é…ç½®ï¼š 12345671. è„šæœ¬æ‰§è¡Œæ—¶é—´é™åˆ¶# Redisä»¥æ¯«ç§’ä¸ºå•ä½é™å®šluaè„šæœ¬çš„æœ€å¤§æ‰§è¡Œæ—¶é—´ã€‚# å½“luaè„šæœ¬åœ¨è¶…å‡ºæœ€å¤§å…è®¸æ‰§è¡Œæ—¶é—´ä¹‹åŽï¼Œredisä¼šè®°å½•è¿™ä¸ªè„šæœ¬åˆ°æ—¥å¿—ä¸­ï¼Œå¹¶ä¸”ä¼šå‘è¿™ä¸ªè¯·æ±‚è¿”å›žerrorçš„é”™è¯¯ã€‚# ä»…å½“SCRIPT KILLå’ŒSHUTDOWN NOSAVEå‘½ä»¤å¯ç”¨çš„æ—¶å€™ï¼Œä¸€ä¸ªè¿è¡Œæ—¶é—´è¶…è¿‡æœ€å¤§é™å®šæ—¶é—´çš„è„šæœ¬æ‰ä¼šè¢«ç»§ç»­æ‰§è¡Œã€‚# SCRIPT KILLç”¨æ¥åœæ­¢ä¸€ä¸ªæ²¡æœ‰è°ƒç”¨å†™å…¥å‘½ä»¤çš„è„šæœ¬ã€‚å½“ç”¨æˆ·ä¸æƒ³ç­‰å¾…è„šæœ¬çš„è‡ªç„¶ä¸­æ­¢åˆåœ¨è¿›è¡Œå†™æ“ä½œçš„æ—¶å€™ï¼Œé‡‡ç”¨SHUTDOWN NOSAVEæ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„å”¯ä¸€æ–¹æ³•ã€‚å¯ä»¥ç«‹å³åœæŽ‰è¿™ä¸ªè„šæœ¬ã€‚# ä»¥ä¸‹é…ç½®ä¸ºä¸€ä¸ªluaè„šæœ¬æœ€é•¿çš„æ‰§è¡Œæ—¶é—´ä¸º5000æ¯«ç§’ï¼ˆ5ç§’ï¼‰ï¼Œå¦‚æžœä¸º0æˆ–è€…è´Ÿæ•°ï¼Œåˆ™è¡¨ç¤ºæ— é™æ‰§è¡Œæ—¶é—´ã€‚lua-time-limit 5000 REDIS CLUSTER ï¼ˆé›†ç¾¤ï¼‰REDIS CLUSTERç›¸å…³é…ç½®ï¼š 12345678910111213141516171819202122232425262728293031321. é›†ç¾¤æ¨¡å¼# é›†ç¾¤å¼€å…³ï¼Œé»˜è®¤æ˜¯ä¸å¼€å¯é›†ç¾¤æ¨¡å¼ã€‚cluster-enabled yes2. é›†ç¾¤é…ç½®æ–‡ä»¶# é›†ç¾¤é…ç½®æ–‡ä»¶çš„åç§°ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªé›†ç¾¤ç›¸å…³çš„é…ç½®æ–‡ä»¶ï¼ŒæŒä¹…åŒ–ä¿å­˜é›†ç¾¤çš„ä¿¡æ¯ã€‚# è¿™ä¸ªæ–‡ä»¶å¹¶ä¸éœ€è¦æ‰‹åŠ¨é…ç½®ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶æœ‰Redisç”Ÿæˆå¹¶æ›´æ–°ï¼Œæ¯ä¸ªRedisé›†ç¾¤èŠ‚ç‚¹éœ€è¦ä¸€ä¸ªå•ç‹¬çš„é…ç½®æ–‡ä»¶# ç¡®ä¿ä¸Žå®žä¾‹è¿è¡Œçš„ç³»ç»Ÿä¸­é…ç½®æ–‡ä»¶åç§°ä¸å†²çªcluster-config-file nodes-6379.conf3. èŠ‚ç‚¹è¶…æ—¶æ—¶é—´# èŠ‚ç‚¹äº’è¿žè¶…æ—¶çš„é˜€å€¼ï¼Œé›†ç¾¤èŠ‚ç‚¹è¶…æ—¶æ¯«ç§’æ•°ã€‚cluster-node-timeout 150004. æ•…éšœè½¬ç§»ç­–ç•¥ # åœ¨è¿›è¡Œæ•…éšœè½¬ç§»çš„æ—¶å€™ï¼Œå…¨éƒ¨slaveéƒ½ä¼šè¯·æ±‚ç”³è¯·ä¸ºmasterï¼Œä½†æ˜¯æœ‰äº›slaveå¯èƒ½ä¸Žmasteræ–­å¼€è¿žæŽ¥ä¸€æ®µæ—¶é—´äº†ï¼Œå¯¼è‡´æ•°æ®è¿‡äºŽé™ˆæ—§ï¼Œè¿™æ ·çš„slaveä¸åº”è¯¥è¢«æå‡ä¸ºmasterã€‚è¯¥å‚æ•°å°±æ˜¯ç”¨æ¥åˆ¤æ–­slaveèŠ‚ç‚¹ä¸Žmasteræ–­çº¿çš„æ—¶é—´æ˜¯å¦è¿‡é•¿ã€‚# åˆ¤æ–­æ–¹æ³•æ˜¯ï¼š# 1. slaveæ–­å¼€è¿žæŽ¥çš„æ—¶é—´# 2. (node-timeout * slave-validity-factor) + repl-ping-slave-period# å¦‚æžœèŠ‚ç‚¹è¶…æ—¶æ—¶é—´ä¸º30s, å¹¶ä¸”slave-validity-factorä¸º10,å³å¦‚æžœè¶…è¿‡310ç§’slaveå°†ä¸ä¼šå°è¯•è¿›è¡Œæ•…éšœè½¬ç§»ã€‚# é»˜è®¤ä¸º10cluster-slave-validity-factor 10# masterçš„slaveæ•°é‡å¤§äºŽè¯¥å€¼ï¼Œslaveæ‰èƒ½è¿ç§»åˆ°å…¶ä»–å­¤ç«‹masterä¸Šã€‚# å¦‚è¿™ä¸ªå‚æ•°è‹¥è¢«è®¾ä¸º2ï¼Œé‚£ä¹ˆåªæœ‰å½“ä¸€ä¸ªä¸»èŠ‚ç‚¹æ‹¥æœ‰2ä¸ªå¯å·¥ä½œçš„ä»ŽèŠ‚ç‚¹æ—¶ï¼Œå®ƒçš„ä¸€ä¸ªä»ŽèŠ‚ç‚¹ä¼šå°è¯•è¿ç§»ã€‚cluster-migration-barrier 15. é›†ç¾¤Slotç­–ç•¥# é»˜è®¤æƒ…å†µä¸‹ï¼Œé›†ç¾¤å…¨éƒ¨çš„slotæœ‰èŠ‚ç‚¹è´Ÿè´£ï¼Œé›†ç¾¤çŠ¶æ€æ‰ä¸ºokï¼Œæ‰èƒ½æä¾›æœåŠ¡ã€‚# è®¾ç½®ä¸ºnoï¼Œå¯ä»¥åœ¨slotæ²¡æœ‰å…¨éƒ¨åˆ†é…çš„æ—¶å€™æä¾›æœåŠ¡ã€‚# ä¸å»ºè®®æ‰“å¼€è¯¥é…ç½®ï¼Œè¿™æ ·ä¼šé€ æˆåˆ†åŒºçš„æ—¶å€™ï¼Œå°åˆ†åŒºçš„masterä¸€ç›´åœ¨æŽ¥å—å†™è¯·æ±‚ï¼Œè€Œé€ æˆå¾ˆé•¿æ—¶é—´æ•°æ®ä¸ä¸€è‡´ã€‚cluster-require-full-coverage yes SLOW LOG ï¼ˆæ…¢æ—¥å¿—ï¼‰SLOW LOG ç›¸å…³é…ç½®ï¼š 1234567891011121. æ…¢æ—¥å¿—ç­–ç•¥# Redis Slow Logè®°å½•è¶…è¿‡ç‰¹å®šæ‰§è¡Œæ—¶é—´çš„å‘½ä»¤ã€‚æ‰§è¡Œæ—¶é—´ä¸åŒ…æ‹¬I/Oè®¡ç®—æ¯”å¦‚è¿žæŽ¥å®¢æˆ·ç«¯ã€è¿”å›žç»“æžœç­‰ï¼Œåªæ˜¯å‘½ä»¤æ‰§è¡Œæ—¶é—´ï¼ˆçº¿ç¨‹å› ä¸ºæ‰§è¡Œè¿™ä¸ªå‘½ä»¤è€Œé”å®šä¸”æ— æ³•å¤„ç†å…¶ä»–è¯·æ±‚çš„é˜¶æ®µï¼‰ã€‚å³æ‰§è¡Œæ¯”è¾ƒæ…¢çš„å‘½ä»¤ã€‚# å¯ä»¥é€šè¿‡ä¸¤ä¸ªå‚æ•°è®¾ç½®slow logï¼š# 1. ä¸€ä¸ªæ˜¯æ…¢æŸ¥è¯¢çš„é˜ˆå€¼ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚# 2. å¦ä¸€ä¸ªæ˜¯slow logçš„é•¿åº¦ï¼ˆå³è®°å½•çš„æœ€å¤§æ•°é‡ï¼‰ï¼Œç›¸å½“äºŽä¸€ä¸ªé˜Ÿåˆ—ã€‚# é»˜è®¤é…ç½®è®°å½•redisæ‰§è¡Œè¶…è¿‡10000æ¯«ç§’çš„å‚æ•°ã€‚# è´Ÿæ•°åˆ™å…³é—­slow logï¼Œ0åˆ™ä¼šå¯¼è‡´æ¯ä¸ªå‘½ä»¤éƒ½è¢«è®°å½•ã€‚slowlog-log-slower-than 10000# ä¸è®¾ç½®ä¼šæ¶ˆè€—è¿‡å¤šå†…å­˜ã€‚å¯ä»¥é€šè¿‡SLOWLOG RESETå›žæ”¶æ…¢æ—¥å¿—æ¶ˆè€—çš„å†…å­˜ã€‚# é»˜è®¤å€¼ä¸º128ï¼Œå½“æ…¢æ—¥å¿—è¶…è¿‡128æ—¶ï¼Œæœ€å…ˆè¿›å…¥çš„é˜Ÿåˆ—çš„è®°å½•ä¼šè¢«è¸¢å‡ºã€‚slowlog-max-len 128 LATENCY MONITORï¼ˆå»¶è¿Ÿç›‘æŽ§ï¼‰LATENCY MONITORç›¸å…³é…ç½®ï¼š 123456781. å»¶è¿Ÿç›‘æŽ§# Rediså»¶è¿Ÿç›‘æŽ§å­ç³»ç»Ÿæ¡ˆä¾‹ä¸Žæ“ä½œç³»ç»Ÿæ”¶é›†çš„rediså®žä¾‹ç›¸å…³çš„æ•°æ®ä¸åŒã€‚# é€šè¿‡LATENCYå‘½ä»¤ï¼Œå¯ä»¥ä¸ºç”¨æˆ·æ‰“å°å‡ºç›¸å…³ä¿¡æ¯çš„å›¾å½¢å’ŒæŠ¥å‘Šã€‚# è¿™ä¸ªç³»ç»Ÿåªä¼šè®°å½•è¿è¡Œæ—¶é—´å’Œè¶…å‡ºæŒ‡å®šæ—¶é—´å€¼çš„å‘½ä»¤ï¼Œå¦‚æžœè®¾ç½®ä¸º0ï¼Œè¿™ä¸ªç›‘æŽ§ä¼šè¢«å…³é—­ã€‚# é»˜è®¤æƒ…å†µä¸‹æ˜¯å…³é—­å»¶è¿Ÿç›‘æŽ§ã€‚å› ä¸ºå¦‚æžœæ²¡æœ‰å»¶è¿Ÿçš„é—®é¢˜å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¸éœ€è¦ï¼Œå¹¶ä¸”æ”¶é›†æ•°æ®çš„è¡Œä¸ºä¼šå¯¹æ€§èƒ½é€ æˆå½±å“ã€‚# å»¶è¿Ÿç›‘æŽ§å¯ä»¥ä½¿ç”¨å‘½ä»¤æ¥æ‰“å¼€ï¼š# CONFIG SET latency-monitor-threshold &lt;milliseconds&gt;latency-monitor-threshold 0 EVENT NOTIFICATION ï¼ˆäº‹ä»¶é€šçŸ¥ï¼‰EVENT NOTIFICATIONç›¸å…³é…ç½®ï¼š 1234567891011121314151617181920212223241. äº‹ä»¶é€šçŸ¥# Rediså¯ä»¥åœ¨keyç©ºé—´ä¸­é‡‡ç”¨å‘å¸ƒ/è®¢é˜…æ¨¡å¼æ¥é€šçŸ¥æ—¶é—´çš„å‘ç”Ÿã€‚# å¯¹äºŽä¸€ä¸ªå®žä¾‹ï¼Œå¦‚æžœé”®ç©ºé—´äº‹ä»¶é€šçŸ¥æ˜¯å¯ç”¨çŠ¶æ€ï¼Œå½“ä¸€ä¸ªå®¢æˆ·ç«¯æ‰§è¡Œåœ¨ä¸€ä¸ªå­˜å‚¨åœ¨Database 0åä¸ºâ€œfooâ€çš„key DELæ“ä½œæ—¶ï¼Œæœ‰å¦‚ä¸‹ä¸¤æ¡ä¿¡æ¯å°†ä¼šé€šè¿‡å‘å¸ƒè®¢é˜…ç³»ç»Ÿäº§ç”Ÿï¼š# PUBLISH __keyspace@0__:foo del# PUBLISH __keyevent@0__:del foo# å¯ä»¥åœ¨ä¸‹è¡¨ä¸­é€‰æ‹©Redisè¦é€šçŸ¥çš„äº‹ä»¶ç±»åž‹ï¼Œäº‹ä»¶ç±»åž‹ç”±å•ä¸ªå­—ç¬¦æ¥æ ‡è¯†ï¼š# K keyspaceäº‹ä»¶ï¼Œä»¥__keyspace@__çš„å‰ç¼€æ–¹å¼å‘å¸ƒ# E keyeventäº‹ä»¶ï¼Œä»¥__keysevent@__çš„å‰ç¼€æ–¹å¼å‘å¸ƒ# g é€šç”¨äº‹ä»¶ï¼ˆä¸æŒ‡å®šç±»åž‹ï¼‰ï¼ŒåƒDELï¼ŒEXPIREï¼ŒRENAMEï¼Œ...# $ stringå‘½ä»¤# l listå‘½ä»¤# s setå‘½ä»¤# h hashå‘½ä»¤# z æœ‰åºé›†åˆå‘½ä»¤# x è¿‡æœŸæ—¶é—´ï¼ˆæ¯æ¬¡keyè¿‡æœŸæ—¶ç”Ÿæˆï¼‰# e æ¸…é™¤æ—¶é—´ï¼ˆå½“keyåœ¨å†…å­˜è¢«æ¸…é™¤æ—¶ç”Ÿæˆï¼‰# A g$shzxeçš„åˆ«ç§°ï¼Œæ„å‘³ç€é€šçŸ¥æ‰€æœ‰çš„äº‹ä»¶# ä¾‹å¦‚ï¼šå¯ç”¨listå’Œé€šç”¨äº‹ä»¶# notify-keyspace-events elg# é»˜è®¤æ‰€æœ‰çš„é€šçŸ¥è¢«ç¦ç”¨ï¼Œç©ºå­—ç¬¦ä¸²çš„æ„æ€æ˜¯é€šçŸ¥è¢«ç¦ç”¨ã€‚# æ³¨æ„å¦‚æžœä¸æŒ‡å®šè‡³å°‘Kæˆ–Eä¹‹ä¸€ï¼Œä¸ä¼šå‘é€ä»»ä½•äº‹ä»¶ã€‚notify-keyspace-events "" ADVANCED CONFIG ï¼ˆé«˜çº§é…ç½®ï¼‰ADVANCED CONFIGç›¸å…³é…ç½®ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081821. ç¼–ç ç­–ç•¥# åˆ›å»ºç©ºç™½å“ˆå¸Œè¡¨æ—¶ï¼Œç¨‹åºé»˜è®¤ä½¿ç”¨REDIS_ENCODING_ZIPLISTç¼–ç ï¼Œå½“ä»¥ä¸‹ä»»ä½•ä¸€ä¸ªæ¡ä»¶è¢«æ»¡è¶³æ—¶ï¼Œç¨‹åºå°†ç¼–ç åˆ‡æ¢ä¸ºREDIS_ENCODING_HTï¼š# 1. å“ˆå¸Œè¡¨ä¸­æŸä¸ªé”®æˆ–æŸä¸ªå€¼çš„é•¿åº¦å¤§äºŽserver.hash_max_ziplist_valueï¼ˆé»˜è®¤å€¼ä¸º64ï¼‰ã€‚# 2. åŽ‹ç¼©åˆ—è¡¨ä¸­çš„èŠ‚ç‚¹æ•°é‡å¤§äºŽserver.hash_max_ziplist_entriesï¼ˆé»˜è®¤å€¼ä¸º512ï¼‰ã€‚# ziplistæ˜¯ä¸€ä¸ªè§£å†³ç©ºé—´é—®é¢˜çš„ç´§å‡‘æ•°æ®åº“å­˜å‚¨ç»“æž„ï¼Œä½†æ˜¯å½“æ•°æ®è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå°†é‡‡ç”¨åŽŸç”Ÿçš„æ•°æ®å­˜å‚¨ç»“æž„ã€‚hash-max-ziplist-entries 512hash-max-ziplist-value 64# å½“å–æ­£å€¼çš„æ—¶å€™ï¼Œè¡¨ç¤ºæŒ‰ç…§æ•°æ®é¡¹ä¸ªæ•°æ¥é™å®šæ¯ä¸ªquicklistèŠ‚ç‚¹ä¸Šçš„ziplisté•¿åº¦ã€‚æ¯”å¦‚ï¼Œå½“è¿™ä¸ªå‚æ•°é…ç½®æˆ5çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯ä¸ªquicklistèŠ‚ç‚¹çš„ziplistæœ€å¤šåŒ…å«5ä¸ªæ•°æ®é¡¹ã€‚# å½“å–è´Ÿå€¼çš„æ—¶å€™ï¼Œè¡¨ç¤ºæŒ‰ç…§å ç”¨å­—èŠ‚æ•°æ¥é™å®šæ¯ä¸ªquicklistèŠ‚ç‚¹ä¸Šçš„ziplisté•¿åº¦ã€‚è¿™æ—¶ï¼Œå®ƒåªèƒ½å–-1åˆ°-5è¿™äº”ä¸ªå€¼ï¼Œæ¯ä¸ªå€¼å«ä¹‰å¦‚ä¸‹ï¼š# 5: æ¯ä¸ªquicklistèŠ‚ç‚¹ä¸Šçš„ziplistå¤§å°ä¸èƒ½è¶…è¿‡64 Kbã€‚ï¼ˆæ³¨ï¼š1kb =&gt; 1024 bytesï¼‰# 4: æ¯ä¸ªquicklistèŠ‚ç‚¹ä¸Šçš„ziplistå¤§å°ä¸èƒ½è¶…è¿‡32 Kbã€‚# 3: æ¯ä¸ªquicklistèŠ‚ç‚¹ä¸Šçš„ziplistå¤§å°ä¸èƒ½è¶…è¿‡16 Kbã€‚# 2: æ¯ä¸ªquicklistèŠ‚ç‚¹ä¸Šçš„ziplistå¤§å°ä¸èƒ½è¶…è¿‡8 Kbã€‚ï¼ˆ-2æ˜¯Redisç»™å‡ºçš„é»˜è®¤å€¼ï¼‰# 1: æ¯ä¸ªquicklistèŠ‚ç‚¹ä¸Šçš„ziplistå¤§å°ä¸èƒ½è¶…è¿‡4 Kbã€‚list-max-ziplist-size -2# æ•°æ®é‡å°äºŽç­‰äºŽset-max-intset-entriesç”¨intsetï¼Œå¤§äºŽset-max-intset-entriesç”¨setset-max-intset-entries 512# æ•°æ®é‡å°äºŽç­‰äºŽzset-max-ziplist-entriesç”¨ziplistï¼Œå¤§äºŽzset-max-ziplist-entriesç”¨zsetzset-max-ziplist-entries 128zset-max-ziplist-value 642. èŠ‚ç‚¹åŽ‹ç¼©# è¿™ä¸ªå‚æ•°è¡¨ç¤ºä¸€ä¸ªquicklistä¸¤ç«¯ä¸è¢«åŽ‹ç¼©çš„èŠ‚ç‚¹ä¸ªæ•°ã€‚# æ³¨ï¼šè¿™é‡Œçš„èŠ‚ç‚¹ä¸ªæ•°æ˜¯æŒ‡quickliståŒå‘é“¾è¡¨çš„èŠ‚ç‚¹ä¸ªæ•°ï¼Œè€Œä¸æ˜¯æŒ‡ziplisté‡Œé¢çš„æ•°æ®é¡¹ä¸ªæ•°ã€‚# å®žé™…ä¸Šï¼Œä¸€ä¸ªquicklistèŠ‚ç‚¹ä¸Šçš„ziplistï¼Œå¦‚æžœè¢«åŽ‹ç¼©ï¼Œå°±æ˜¯æ•´ä½“è¢«åŽ‹ç¼©çš„ã€‚# å‚æ•°list-compress-depthçš„å–å€¼å«ä¹‰å¦‚ä¸‹ï¼š# 0: æ˜¯ä¸ªç‰¹æ®Šå€¼ï¼Œè¡¨ç¤ºéƒ½ä¸åŽ‹ç¼©ã€‚è¿™æ˜¯Redisçš„é»˜è®¤å€¼ã€‚# 1: è¡¨ç¤ºquicklistä¸¤ç«¯å„æœ‰1ä¸ªèŠ‚ç‚¹ä¸åŽ‹ç¼©ï¼Œä¸­é—´çš„èŠ‚ç‚¹åŽ‹ç¼©ã€‚# 2: è¡¨ç¤ºquicklistä¸¤ç«¯å„æœ‰2ä¸ªèŠ‚ç‚¹ä¸åŽ‹ç¼©ï¼Œä¸­é—´çš„èŠ‚ç‚¹åŽ‹ç¼©ã€‚# 3: è¡¨ç¤ºquicklistä¸¤ç«¯å„æœ‰3ä¸ªèŠ‚ç‚¹ä¸åŽ‹ç¼©ï¼Œä¸­é—´çš„èŠ‚ç‚¹åŽ‹ç¼©ã€‚# ä¾æ­¤ç±»æŽ¨...# ç”±äºŽ0æ˜¯ä¸ªç‰¹æ®Šå€¼ï¼Œå¾ˆå®¹æ˜“çœ‹å‡ºquicklistçš„å¤´èŠ‚ç‚¹å’Œå°¾èŠ‚ç‚¹æ€»æ˜¯ä¸è¢«åŽ‹ç¼©çš„ï¼Œä»¥ä¾¿äºŽåœ¨è¡¨çš„ä¸¤ç«¯è¿›è¡Œå¿«é€Ÿå­˜å–ã€‚list-compress-depth 05. æ•°æ®ç»“æž„# valueå¤§å°å°äºŽç­‰äºŽhll-sparse-max-bytesä½¿ç”¨ç¨€ç–æ•°æ®ç»“æž„ï¼ˆsparseï¼‰ã€‚# å¤§äºŽhll-sparse-max-bytesä½¿ç”¨ç¨ å¯†çš„æ•°æ®ç»“æž„ï¼ˆdenseï¼‰ï¼Œä¸€ä¸ªæ¯”16000å¤§çš„valueæ˜¯å‡ ä¹Žæ²¡ç”¨çš„ã€‚# å»ºè®®çš„valueå¤§æ¦‚ä¸º3000ã€‚å¦‚æžœå¯¹CPUè¦æ±‚ä¸é«˜ï¼Œå¯¹ç©ºé—´è¦æ±‚è¾ƒé«˜çš„ï¼Œå»ºè®®è®¾ç½®åˆ°10000å·¦å³ã€‚hll-sparse-max-bytes 30006. å†…å­˜é‡Šæ”¾# Rediså°†åœ¨æ¯100æ¯«ç§’æ—¶ä½¿ç”¨1æ¯«ç§’çš„CPUæ—¶é—´æ¥å¯¹redisçš„hashè¡¨è¿›è¡Œé‡æ–°hashï¼Œå¯ä»¥é™ä½Žå†…å­˜çš„ä½¿ç”¨ã€‚# å½“ä½¿ç”¨åœºæ™¯ä¸­æœ‰ä¸¥æ ¼çš„å®žæ—¶æ€§éœ€è¦ï¼Œä¸èƒ½å¤ŸæŽ¥å—redisæ—¶ä¸æ—¶çš„å¯¹è¯·æ±‚æœ‰2æ¯«ç§’çš„å»¶è¿Ÿçš„è¯ï¼ŒæŠŠè¿™é¡¹é…ç½®ä¸ºnoã€‚# å¦‚æžœæ²¡æœ‰è¿™ä¹ˆä¸¥æ ¼çš„å®žæ—¶æ€§è¦æ±‚ï¼Œå¯ä»¥è®¾ç½®ä¸ºyesï¼Œä»¥ä¾¿èƒ½å¤Ÿå°½å¯èƒ½å¿«çš„é‡Šæ”¾å†…å­˜ã€‚activerehashing yes7. ç¼“å­˜é™åˆ¶# å®¢æˆ·ç«¯è¾“å‡ºç¼“å†²åŒºæ˜¾ç¤ºå¯ä»¥ç”¨æ¥è§£å†³ç”±äºŽæŸäº›åŽŸå› å¯¼è‡´çš„å¼ºåˆ¶æ–­çº¿è€Œé€ æˆçš„ä¸èƒ½è¯»åˆ°è¶³å¤Ÿçš„æ•°æ®ã€‚# ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„åŽŸå› æ˜¯ç”±äºŽå‘å¸ƒè®¢é˜…ä¸­ï¼Œå®¢æˆ·ç«¯ä¸èƒ½å¤Ÿè¶³å¤Ÿå¿«é€Ÿåœ°æ¶ˆè´¹å‘å¸ƒè€…ç”Ÿæˆçš„ä¿¡æ¯ã€‚# è¿™ä¸ªé™åˆ¶å¯ä»¥è®¾ç½®ä¸ºå¦‚ä¸‹çš„ä¸‰ç§ç±»åž‹ï¼š# 1. normalï¼šæ­£å¸¸æ™®é€šçš„å®¢æˆ·ç«¯ï¼ŒåŒ…å«ç›‘æŽ§å®¢æˆ·ç«¯# 2. slaveï¼šä¸»ä»ŽæœåŠ¡å™¨çš„ä»Žå®¢æˆ·ç«¯# 3. pubsubï¼šè®¢é˜…äº†æœ€å°‘ä¸€ä¸ªé¢‘é“çš„å®¢æˆ·ç«¯# æ¯ä¸€ä¸ªclient-output-buffer-limitæ ¼å¼å¦‚ä¸‹ï¼š# client-output-buffer-limit &lt;class&gt; &lt;hard limit&gt; &lt;soft limit&gt; &lt;soft seconds&gt;# åœ¨ä¸¤ç§æƒ…å†µä¸‹æœåŠ¡å™¨è®¤ä¸ºå®¢æˆ·ç«¯ä¸æ˜¯æ„å¤–ä¸´æ—¶æŽ‰çº¿ï¼š# 1. ç¼“å†²åŒºçš„æ•°æ®è¾¾åˆ°ç¡¬é™åˆ¶# 2. ç¼“å†²åŒºçš„æ•°æ®è¾¾åˆ°è½¯é™åˆ¶ï¼ŒåŒæ—¶æ—¶é—´è¶…è¿‡äº†æŒ‡å®šå€¼# å› ä¸ºä¸€ä¸ªå®¢æˆ·ç¦»çº¿ï¼Œæœ‰å¯èƒ½æ˜¯ä¸´æ—¶æ€§çš„ç½‘ç»œæ•…éšœæˆ–è€…ä¼ è¾“é—®é¢˜ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯æ°¸ä¹…æ€§ç¦»çº¿æˆ–è€…å¼ºåˆ¶æ€§ç¦»çº¿ï¼Œæ­¤æ—¶æœåŠ¡å™¨å°†ä¸ä¼šä¿ç•™å®ƒçš„ç¼“å­˜æ•°æ®ã€‚# ä»¥ä¸‹çš„è®¾ç½®å°±æ˜¯åˆ¤æ–­è¿™ä¸€æƒ…å†µçš„ã€‚# ç¡¬é™åˆ¶å’Œè½¯é™åˆ¶éƒ½å¯ä»¥é€šè¿‡å°†å…¶è®¾ç½®ä¸º0æ¥å…³é—­æŽ‰ã€‚# å¯¹äºŽnormal clientï¼Œç¬¬ä¸€ä¸ª0è¡¨ç¤ºå–æ¶ˆhard limitï¼Œç¬¬äºŒä¸ª0å’Œç¬¬ä¸‰ä¸ª0è¡¨ç¤ºå–æ¶ˆsoft limitï¼Œnormal clienté»˜è®¤å–æ¶ˆé™åˆ¶ï¼Œå› ä¸ºå¦‚æžœæ²¡æœ‰æŸ¥è¯¢ï¼Œä»–ä»¬æ˜¯ä¸ä¼šæŽ¥æ”¶æ•°æ®çš„ã€‚client-output-buffer-limit normal 0 0 0# å¯¹äºŽslave clientå’ŒMONITER clientï¼Œå¦‚æžœclient-output-bufferä¸€æ—¦è¶…è¿‡256mbï¼Œåˆæˆ–è€…è¶…è¿‡64mbæŒç»­60ç§’ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±ä¼šç«‹å³æ–­å¼€å®¢æˆ·ç«¯è¿žæŽ¥ã€‚client-output-buffer-limit slave 256mb 64mb 60# å¯¹äºŽpubsub clientï¼Œå¦‚æžœclient-output-bufferä¸€æ—¦è¶…è¿‡32mbï¼Œåˆæˆ–è€…è¶…è¿‡8mbæŒç»­60ç§’ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±ä¼šç«‹å³æ–­å¼€å®¢æˆ·ç«¯è¿žæŽ¥client-output-buffer-limit pubsub 32mb 8mb 608. æ‰§è¡Œä»»åŠ¡é¢‘çŽ‡# redisä¼šæŒ‰ç…§ä¸€å®šçš„é¢‘çŽ‡æ¥å¤„ç†è¯¸å¦‚å…³é—­è¶…æ—¶è¿žæŽ¥ï¼Œæ¸…ç†æ²¡æœ‰è¢«ä½¿ç”¨çš„è¿‡æœŸkeyç­‰ç­‰æ­¤ç±»åŽå°ä»»åŠ¡ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ä»»åŠ¡éƒ½æ˜¯ä»¥ç›¸åŒçš„é¢‘çŽ‡æ¥æ‰§è¡Œçš„ï¼Œredisé€šè¿‡ä¸€ä¸ªhzçš„å€¼æ‰§è¡Œæ£€æŸ¥ä»»åŠ¡ã€‚# æé«˜è¯¥å€¼å°†åœ¨redisç©ºé—²æ—¶ä½¿ç”¨æ›´å¤šçš„CPUï¼Œä½†åŒæ—¶å½“æœ‰å¤šä¸ªkeyåŒæ—¶åˆ°æœŸä¼šä½¿redisçš„ååº”æ›´çµæ•ï¼Œä»¥åŠè¶…æ—¶å¯ä»¥æ›´ç²¾å‡†åœ°å¤„ç†ã€‚# èŒƒå›´æ˜¯1åˆ°500ä¹‹é—´ï¼Œä½†æ˜¯å€¼è¶…è¿‡100é€šå¸¸ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚# é»˜è®¤æƒ…å†µä¸‹ï¼Œhzçš„å€¼è¢«è®¾å®šä¸º10ã€‚å¤§å¤šæ•°ç”¨æˆ·åº”è¯¥ä½¿ç”¨10è¿™ä¸ªé¢„è®¾å€¼ï¼Œåªæœ‰åœ¨éžå¸¸ä½Žçš„å»¶è¿Ÿæƒ…å†µä¸‹æœ‰å¿…è¦æé«˜æœ€å¤§åˆ°100ã€‚# è®¡ç®—æ–¹æ³•ï¼š1s / hzhz 109. fsyncå¢žé‡åŒæ­¥# åœ¨aofé‡å†™çš„æ—¶å€™ï¼Œå¦‚æžœæ‰“å¼€äº†aof-rewrite-incremental-fsyncå¼€å…³ï¼Œç³»ç»Ÿä¼šæ¯32MBæ•°æ®æ‰§è¡Œä¸€æ¬¡fsyncã€‚# è¿™å¯¹äºŽæŠŠæ–‡ä»¶å†™å…¥ç£ç›˜æ˜¯æœ‰å¸®åŠ©çš„ï¼Œå¯ä»¥å‡å°‘aofå¤§æ–‡ä»¶å†™å…¥å¯¹ç£ç›˜çš„æ“ä½œæ¬¡æ•°ï¼Œé¿å…è¿‡å¤§çš„å»¶è¿Ÿå³°å€¼ã€‚aof-rewrite-incremental-fsync yes]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ansibleå­¦ä¹ ç¬”è®°-Roles]]></title>
    <url>%2F2018%2F08%2F16%2FAnsible%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%9D%97%2F</url>
    <content type="text"><![CDATA[åˆ›å»ºè‡ªå·±çš„æ¨¡å—å‚ç…§ï¼šã€Šå¥”è·‘å§ ANSIBLE ã€‹ã€‚ ðŸŒ[Ansibleå®˜æ–¹æ–‡æ¡£] æ¨¡å—å­˜æ”¾ä½ç½®Ansibleä¼šåœ¨Playbookçš„libraryç›®å½•ä¸‹å¯»æ‰¾è‡ªå®šä¹‰æ¨¡å—ã€‚ 12345â”œâ”€â”€ hostsâ”œâ”€â”€ libraryâ”‚ â””â”€â”€ custom_module.pyâ”œâ”€â”€ rolesâ”œâ”€â”€ site.yml æ‰€ä»¥å°†è‡ªå®šä¹‰æ¨¡å—å­˜å…¥playbooks/library/ç›®å½•ä¸‹ã€‚ Ansible å¦‚ä½•è°ƒç”¨æ¨¡å— ç”Ÿæˆå¸¦æœ‰å‚æ•°çš„ç‹¬ç«‹Pythonè„šæœ¬ï¼ˆä»…é™Pythonæ¨¡å—ï¼‰ å¦‚æžœæ¨¡å—æ˜¯ä½¿ç”¨Pythonç¼–å†™çš„å¹¶ä¸”ä½¿ç”¨äº†Ansibleæä¾›çš„è¾…åŠ©ä»£ç ï¼Œé‚£ä¹ˆAnsibleå°†ä¼šç”Ÿæˆæ³¨å…¥äº†è¾…åŠ©ä»£ç å’Œæ¨¡å—å‚æ•°çš„è‡ªåŒ…å«Pythonè„šæœ¬ã€‚ å°†æ¨¡å—å¤åˆ¶åˆ°è¿œç¨‹ä¸»æœº Ansibleå°†æŠŠç”Ÿæˆçš„Pythonè„šæœ¬ï¼ˆå¯¹äºŽåŸºäºŽPythonçš„æ¨¡å—ï¼‰æˆ–è€…æœ¬åœ°æ–‡ä»¶playbooks/library/æ¨¡å—ï¼ˆéžåŸºäºŽPythonçš„æ¨¡å—ï¼‰å¤åˆ¶åˆ°è¿œç¨‹ä¸»æœºä¸­çš„ä¸´æ—¶ç›®å½•ä¸‹ åœ¨è¿œç¨‹ä¸»æœºä¸Šåˆ›å»ºå‚æ•°æ–‡ä»¶ï¼ˆä»…é™éžPythonæ¨¡å—ï¼‰ å¦‚æžœæ¨¡å—ä¸æ˜¯ä½¿ç”¨Pythonç¼–å†™çš„ï¼ŒAnsibleå°†ä¼šåœ¨è¿œç¨‹ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªå‚æ•°æ–‡ä»¶ã€‚ åœ¨è¿œç¨‹ä¸»æœºä¸Šè°ƒç”¨æ¨¡å—å¹¶ä¼ å…¥å‚æ•°æ–‡ä»¶ä½œä¸ºå‚æ•° åˆ†æžæ¨¡å—çš„æ ‡å‡†è¾“å‡º Ansibleé¢„æœŸçš„è¾“å‡ºå˜é‡è‡ªå®šä¹‰æ¨¡å—å¯ä»¥è¿”å›žä»»ä½•ä½ å®šä¹‰çš„å˜é‡ï¼Œä½†æ˜¯Ansibleä¼šå¯¹å‡ ä¸ªå¿…é¡»è¿”å›žçš„å˜é‡åšç‰¹æ®Šå¤„ç†ã€‚ changedæ‰€æœ‰çš„Ansibleæ¨¡å—éƒ½åº”è¯¥è¿”å›žchangedå˜é‡ã€‚ changedå˜é‡æ˜¯è¡¨ç¤ºæ¨¡å—çš„æ‰§è¡Œæ˜¯å¦ä¼šå¯¼è‡´ä¸»æœºçŠ¶æ€æ”¹å˜çš„å¸ƒå°”åž‹å˜é‡ã€‚ åœ¨Ansibleè¿è¡Œçš„æ—¶å€™ï¼Œä¸ç®¡çŠ¶æ€æ˜¯å¦å‘ç”Ÿæ”¹å˜ï¼Œå®ƒéƒ½ä¼šæŠŠè¿™ä¸ªå˜é‡æ˜¾ç¤ºåœ¨è¾“å‡ºä¸­ã€‚å¦‚æžœtaskä¸­å«æœ‰notifyè¯­å¥æ¥é€šçŸ¥handlerï¼Œnameåªæœ‰changedä¸ºtrueçš„æ—¶å€™é€šçŸ¥æ‰ä¼šè¢«è§¦å‘ã€‚ failedå¦‚æžœæ¨¡å—æœªèƒ½æ‰§è¡Œå®Œæˆï¼Œnameå®ƒåº”è¯¥è¿”å›žfailed=trueã€‚ Ansibleå°†ä¼šæŠŠè¿™ä¸ªtaskçœ‹åšæ‰§è¡Œå¤±è´¥å¹¶ä¸”ä¸ä¼šå¯¹å‘ç”Ÿå¤±è´¥çš„ä¸»æœºç»§ç»­æ‰§è¡ŒæŽ¥ä¸‹æ¥çš„taskï¼Œé™¤éžè¿™ä¸ªtaskå«æœ‰isgore_errorsæˆ–è€…failed_whenè¯­å¥ã€‚ å¦‚æžœæ¨¡å—æ‰§è¡ŒæˆåŠŸï¼Œå³å¯ä»¥è¿”å›žfailed=falseï¼Œä¹Ÿå¯ä»¥ç›´æŽ¥å¿½ç•¥è¿™ä¸ªå˜é‡ã€‚ msgmsgå˜é‡ç”¨æ¥æ·»åŠ æè¿°å¤±è´¥åŽŸå› çš„æè¿°ä¿¡æ¯ã€‚ å¦‚æžœtaskå¤±è´¥äº†å¹¶ä¸”æ¨¡å—è¿”å›žäº†msgå˜é‡ï¼Œé‚£ä¹ˆAnsibleå°†ä¼šä¸Žå…¶ä»–å˜é‡ç¨æœ‰ä¸åŒçš„è¾“å‡ºè¿™ä¸ªå˜é‡ã€‚ ä½¿ç”¨Pythonæ¥å®žçŽ°æ¨¡å—Ansibleæä¾›äº†AnsibleModuleçš„Pythonç±»æ¥ç®€åŒ–ä½ çš„å¦‚ä¸‹å·¥ä½œï¼š è§£æžè¾“å…¥ ä½¿ç”¨JSONæ ¼å¼è¿”å›žè¾“å‡º è°ƒç”¨å¤–éƒ¨ç¨‹åº å®žé™…ä¸Šï¼Œåœ¨ç¼–å†™Pythonæ¨¡å—æ—¶ï¼ŒAnsibleå°†ä¼šæŠŠå‚æ•°ç›´æŽ¥æ³¨å…¥ç”Ÿæˆçš„Pythonæ–‡ä»¶ä¸­ï¼Œè€Œä¸éœ€è¦ä½ åŽ»è§£æžå•ç‹¬çš„å‚æ•°æ–‡ä»¶ã€‚]]></content>
      <categories>
        <category>Ansible</category>
      </categories>
      <tags>
        <tag>Ansible</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linuxå­¦ä¹ ç¬”è®°-FirewallD]]></title>
    <url>%2F2018%2F08%2F09%2FLinux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-FirewallD%2F</url>
    <content type="text"><![CDATA[FirewallDç¬”è®°ç†è§£é…ç½®ï¼Œç†è§£åŒºåŸŸã€çŸ¥é“å¦‚ä½•é…ç½®è§„åˆ™ã€‚ ðŸŒ [readhatå®˜ç½‘æ–‡æ¡£] :globe_with_meridians: [firewalldå®˜ç½‘æ–‡æ¡£] æ¦‚å¿µfirewalldè‡ªèº«å¹¶ä¸å…·å¤‡é˜²ç«å¢™çš„åŠŸèƒ½ï¼Œè€Œæ˜¯å’Œiptablesä¸€æ ·éœ€è¦é€šè¿‡å†…æ ¸çš„netfilteræ¥å®žçŽ°ï¼Œä¹Ÿå°±æ˜¯è¯´ firewalldå’Œ iptablesä¸€æ ·ï¼Œä»–ä»¬çš„ä½œç”¨éƒ½æ˜¯ç”¨äºŽç»´æŠ¤è§„åˆ™ï¼Œè€ŒçœŸæ­£ä½¿ç”¨è§„åˆ™å¹²æ´»çš„æ˜¯å†…æ ¸çš„netfilterï¼Œåªä¸è¿‡firewalldå’Œiptablesçš„ç»“ æž„ä»¥åŠä½¿ç”¨æ–¹æ³•ä¸ä¸€æ ·ç½¢äº†ã€‚ åŽŸç†firewalldæœ‰ä¸¤å±‚è®¾è®¡ï¼šæ ¸å¿ƒå±‚å’Œé¡¶éƒ¨çš„D-Buså±‚ã€‚ æ ¸å¿ƒå±‚ï¼šæ ¸å¿ƒå±‚è´Ÿè´£å¤„ç†é…ç½®å’ŒåŽç«¯ï¼Œå¦‚iptablesï¼Œip6tablesï¼Œebtablesï¼Œipsetå’Œæ¨¡å—åŠ è½½å™¨ã€‚ D-Buså±‚ï¼šD-BusæŽ¥å£æ˜¯æ›´æ”¹å’Œåˆ›å»ºé˜²ç«å¢™é…ç½®çš„ä¸»è¦æ–¹å¼ã€‚ firewalldæä¾›çš„å·¥å…·éƒ½ä½¿ç”¨è¯¥æŽ¥å£ï¼Œä¾‹å¦‚firewall-cmdï¼Œfirewall-configå’Œfirewall-appletã€‚ firewalldæ­£åœ¨è¿è¡Œæ—¶å¯ä»¥ä½¿ç”¨firewall-offline-cmdï¼Œä½†ä¸æŽ¨èä½¿ç”¨å®ƒï¼Œå› ä¸ºæœ‰å¤§æ¦‚5ç§’é’Ÿçš„å»¶è¿Ÿã€‚ é…ç½®é…ç½®ç›®å½•firewalldæ”¯æŒä¸¤ä¸ªé…ç½®ç›®å½•ï¼š /etc/firewalld/ ï¼šç”¨æˆ·é…ç½®æ–‡ä»¶ç›®å½• /usr/lib/firewalldï¼šç³»ç»Ÿé…ç½®æ–‡ä»¶ç›®å½•ï¼Œå³é»˜è®¤é…ç½®æ–‡ä»¶ç›®å½• ä½¿ç”¨æ—¶ï¼Œå½“éœ€è¦ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œfirewalldä¼šé¦–å…ˆåˆ°ç¬¬ä¸€ä¸ªç›®å½•è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¦‚æžœå¯ä»¥æ‰¾åˆ°ï¼Œé‚£ä¹ˆå°±ç›´æŽ¥ä½¿ç”¨ï¼Œå¦åˆ™ä¼šç»§ç»­åˆ°ç¬¬äºŒä¸ªç›®å½•ä¸­æŸ¥æ‰¾ã€‚ è¿™ä¹ˆåšçš„å¥½å¤„ï¼š /usr/lib/firewalldå­˜æ”¾çš„æ˜¯firewalldæä¾›çš„é€šç”¨é…ç½®æ–‡ä»¶ï¼Œå¦‚æžœæƒ³ä¿®æ”¹é…ç½®ï¼Œå¯ä»¥ç›´æŽ¥æ‹·è´ä¸€ä»½åˆ°/etc/firewalld/ï¼Œå†è¿›è¡Œä¿®æ”¹ï¼ŒèŠ‚çœç¼–å†™é…ç½®çš„æ—¶é—´ã€‚ å¦‚æžœæƒ³æ¢å¤é»˜è®¤é…ç½®ï¼Œåªéœ€åˆ é™¤/etc/firewalld/ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶å³å¯ã€‚ é…ç½®çŠ¶æ€ é…ç½®çŠ¶æ€åˆ†ä¸ºä¸¤ç§ï¼š è¿è¡Œæ—¶é…ç½®ï¼šè¿è¡Œæ—¶é…ç½®æ˜¯å®žé™…æœ‰æ•ˆé…ç½®ï¼Œå¹¶åº”ç”¨äºŽå†…æ ¸é˜²ç«å¢™ã€‚åœ¨firewalldæœåŠ¡å¯ç”¨æ—¶ï¼Œæ°¸ä¹…é…ç½®å°†æˆä¸ºè¿è¡Œæ—¶é…ç½®ã€‚ä½†è¿è¡Œæ—¶é…ç½®çš„æ›´æ”¹ä¸ä¼šè‡ªåŠ¨ä¿å­˜åˆ°æ°¸ä¹…é…ç½®ä¸­ã€‚ æ°¸ä¹…é…ç½®ï¼šæ°¸ä¹…é…ç½®å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå¹¶å°†åœ¨æ¯æ¬¡æœåŠ¡å¯åŠ¨ã€é‡å¯ã€é‡è½½æ—¶æˆä¸ºæ–°çš„è¿è¡Œæ—¶é…ç½®ã€‚ å°†è¿è¡Œæ—¶é…ç½®æ›´æ”¹ä¸ºæ°¸ä¹…é…ç½®çš„å‘½ä»¤ï¼š 1firewall-cmd --runtime-to-permanent é…ç½®æ–‡ä»¶è¿™é‡Œè¯´çš„é…ç½®æ–‡ä»¶ä»…ä»…æ˜¯è¯´firewalld.confã€‚ firewalld.confæ˜¯/etc/firewalldç›®å½•ä¸‹æä¾›firewalldçš„åŸºæœ¬é…ç½®ï¼Œå¦‚æžœ/etc/firewalldç›®å½•ä¸‹ä¸å­˜åœ¨è¯¥æ–‡ä»¶ï¼Œå°†ä½¿ç”¨firewalldå†…éƒ¨é»˜è®¤å€¼ã€‚ 12345678910111213141516171819202122232425262728# é»˜è®¤åŒºåŸŸ# é»˜è®¤ï¼š publicDefaultZone=public# æ ‡è®°çš„æœ€å°å€¼ï¼Œlinuxå†…æ ¸ä¼šå¯¹æ¯ä¸ªè¿›å…¥çš„æ•°æ®åŒ…éƒ½è¿›è¡Œæ ‡è®°ï¼Œç›®çš„æ˜¯ä¸ºäº†å¯¹å®ƒä»¬è¿›è¡ŒåŒºåˆ†ã€‚# é»˜è®¤ï¼š100MinimalMark=100# é€€å‡ºfirewalldåŽæ˜¯å¦æ¸…é™¤é˜²ç«å¢™è§„åˆ™# é»˜è®¤ï¼šyesCleanupOnExit=yes# æ˜¯å¦é”å®šfirewalld D-BUSæŽ¥å£ï¼Œå½“Lockdownä¸ºyesæ—¶å¯ä»¥é€šè¿‡lockdown-whitelist.xmlæ–‡ä»¶æ¥é™åˆ¶éƒ½æœ‰å“ªäº›ç¨‹åºå¯ä»¥é€šè¿‡D-BUSæŽ¥å£å¯¹firewalldè¿›è¡Œæ“ä½œ# é»˜è®¤ï¼šnoï¼ˆæ²¡æœ‰é™åˆ¶ï¼‰Lockdown=no# åˆ¤æ–­æ‰€æŽ¥å—åˆ°çš„åŒ…æ˜¯å¦æ˜¯ä¼ªé€ çš„ï¼Œæ£€æŸ¥æ–¹å¼ä¸»è¦æ˜¯é€šè¿‡è·¯ç”±è¡¨ä¸­çš„è·¯ç”±æ¡ç›®å®žçŽ°çš„ï¼Œæ›´å¤šè¯¦ç»†çš„ä¿¡æ¯å¯ä»¥æœç´¢uRPFç›¸å…³çš„èµ„æ–™# é»˜è®¤ï¼šyesIPv6_rpfilter=yes# è®¾ç½®ä¸ºyesæ—¶ä¸ä½¿ç”¨combined-restoreè°ƒç”¨è€Œæ˜¯å•ç‹¬è°ƒç”¨ï¼Œå¢žåŠ äº†åº”ç”¨å’Œå¯ç”¨æœåŠ¡æ‰€éœ€çš„æ—¶é—´ï¼Œå¯¹è°ƒè¯•æœ‰å¸®åŠ©# é»˜è®¤ï¼šnoIndividualCalls=no# åœ¨æ‹’ç»ä¹‹å‰æ·»åŠ æ—¥å¿—è®°å½•è§„åˆ™# é»˜è®¤ï¼šoff# å¯é€‰ï¼šall unicast broadcast multicastLogDenied=off åŒºåŸŸé€šè¿‡å°†ç½‘ç»œåˆ’åˆ†æˆä¸åŒçš„åŒºåŸŸï¼Œåˆ¶å®šå‡ºä¸åŒåŒºåŸŸä¹‹é—´çš„è®¿é—®æŽ§åˆ¶ç­–ç•¥æ¥æŽ§åˆ¶ä¸åŒç¨‹åºåŒºåŸŸé—´ä¼ é€çš„æ•°æ®æµã€‚ firewalldé»˜è®¤æœ‰9ä¸ªZoneï¼š dropï¼ˆä¸¢å¼ƒåŒºåŸŸï¼‰ï¼šä»»ä½•æŽ¥æ”¶çš„ç½‘ç»œæ•°æ®åŒ…éƒ½è¢«ä¸¢å¼ƒï¼Œæ²¡æœ‰ä»»ä½•å›žå¤ï¼Œåªèƒ½ä¼ å‡ºç½‘ç»œè¿žæŽ¥ã€‚ blockï¼ˆé™åˆ¶åŒºåŸŸï¼‰ï¼šä»»ä½•æŽ¥å—çš„ç½‘ç»œè¿žæŽ¥éƒ½è¢«IPv4çš„icmp-host-prohibitedä¿¡æ¯å’ŒIPv6çš„icmp6-adm-prohibitedä¿¡æ¯æ‰€æ‹’ç»ã€‚ piblicï¼ˆå…¬å…±åŒºåŸŸï¼‰ï¼šåœ¨å…¬å…±åŒºåŸŸå†…ä½¿ç”¨ï¼Œä¸èƒ½ç›¸ä¿¡ç½‘ç»œå†…å…¶ä»–è®¡ç®—æœºä¸ä¼šå¯¹ä½ é€ æˆå±å®³ï¼Œåªèƒ½æŽ¥å—ç»è¿‡é€‰å–çš„è¿žæŽ¥ã€‚ externalï¼ˆå¤–éƒ¨åŒºåŸŸï¼‰ï¼šä¸èƒ½ä¿¡ä»»æ¥è‡ªç½‘ç»œçš„å…¶ä»–è®¡ç®—æœºï¼Œä¸èƒ½ç›¸ä¿¡å®ƒä»¬ä¸ä¼šå¯¹ä½ é€ æˆä¼¤å®³ï¼Œåªèƒ½æŽ¥å—ç»è¿‡é€‰å–çš„è¿žæŽ¥ã€‚ dmzï¼ˆéš”ç¦»åŒºåŸŸï¼‰ï¼š éš”ç¦»åŒºåŸŸä¹Ÿç§°ä¸ºéžå†›äº‹åŒºåŸŸï¼Œå†…å¤–ç½‘ç»œä¹‹é—´å¢žåŠ çš„ä¸€å±‚ç½‘ç»œï¼Œèµ·åˆ°ç¼“å†²ä½œç”¨ã€‚å¯¹äºŽéš”ç¦»åŒºåŸŸï¼Œåªèƒ½æŽ¥å—ç»è¿‡é€‰å–çš„è¿žæŽ¥ã€‚ workï¼ˆå·¥ä½œåŒºåŸŸï¼‰ï¼šç”¨äºŽå·¥ä½œåŒºï¼Œä½ å¯ä»¥åŸºæœ¬ä¿¡ä»»ç½‘ç»œå†…çš„å…¶ä»–ç”µè„‘ä¸ä¼šå¯¹ä½ é€ æˆå±å®³ï¼Œä»…ä»…æŽ¥æ”¶ç»è¿‡é€‰æ‹©çš„è¿žæŽ¥ã€‚ homeï¼ˆå®¶åº­åŒºåŸŸï¼‰ï¼šç”¨äºŽå†…éƒ¨ç½‘ç»œï¼Œä½ å¯ä»¥åŸºæœ¬ä¸Šä¿¡ä»»ç½‘ç»œå†…å…¶ä»–ç”µè„‘ä¸ä¼šå¯¹ä½ é€ æˆå±å®³ï¼Œä»…ä»…æŽ¥æ”¶ç»è¿‡é€‰æ‹©çš„è¿žæŽ¥ã€‚ internalï¼ˆå†…éƒ¨åŒºåŸŸï¼‰ï¼šç”¨äºŽå†…éƒ¨ç½‘ç»œï¼Œä½ å¯ä»¥åŸºæœ¬ä¸Šä¿¡ä»»ç½‘ç»œå†…å…¶ä»–ç”µè„‘ä¸ä¼šå¯¹ä½ é€ æˆå±å®³ï¼Œä»…ä»…æŽ¥æ”¶ç»è¿‡é€‰æ‹©çš„è¿žæŽ¥ã€‚ trustedï¼ˆä¿¡ä»»åŒºåŸŸï¼‰ï¼šå¯æŽ¥å—æ‰€æœ‰çš„ç½‘ç»œè¿žæŽ¥ã€‚ tagzoneè§„åˆ™ä¸­é¦–å…ˆæœ€é‡è¦çš„æ˜¯targetçš„è®¾ç½®ï¼Œå¯ä»¥å–å››ä¸ªå€¼ï¼šdefaultã€ACCEPTã€%%REJECT%%ã€DROPã€‚ 1234# æŸ¥çœ‹æŒ‡å®šZoneçš„target&gt; firewall-cmd --zone=work --get-target --permanent# æ›´æ”¹æŒ‡å®šZoneçš„target&gt; firewall-cmd --zone=work --set-target=ACCEPT --permanent â€“permanent è¡¨ç¤ºæ˜¯å¦å°†ä¿®æ”¹åŽçš„è§„åˆ™ä¿å­˜ä¸‹æ¥ï¼Œå¦‚æžœä¸åŠ è¿™ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆæ‰€åšçš„ä¿®æ”¹å½“æ—¶ä¼šç«‹å³ç”Ÿæ•ˆï¼Œä½†æ˜¯åœ¨firewalldé‡å¯ä¹‹åŽå°±ä¼šä¸¢å¤±ï¼Œè€ŒåŠ ä¸Šè¿™ä¸ªå‚æ•°åŽæ‰€åšçš„ä¿®æ”¹å°±ä¼šæ°¸ä¹…ä¿å­˜ä¸‹æ¥ï¼Œä¸è¿‡è¿™æ—¶çš„ä¿®æ”¹ä¸ä¼šç«‹å³ç”Ÿæ•ˆè€Œæ˜¯éœ€è¦reloadåŽæ‰å¯ä»¥ç”Ÿæ•ˆã€‚å…¶å®žè¿™ä¸ªä¹Ÿéžå¸¸å®¹æ˜“ç†è§£ï¼Œå½“ä¸åŠ --permanentä¿®æ”¹è§„åˆ™æ—¶firewalldä¼šå®žé™…ä¿®æ”¹è¿è¡Œæ—¶çš„è§„åˆ™ï¼Œè€Œå¦‚æžœåŠ äº†è¿™ä¸ªå‚æ•°firewalldå…¶å®žæ˜¯åŽ»ä¿®æ”¹çš„xmlé…ç½®æ–‡ä»¶ï¼Œå’Œæˆ‘ä»¬ç›´æŽ¥ç¼–è¾‘xmlæ–‡ä»¶ä¸€æ ·ï¼Œæ‰€ä»¥å°±éœ€è¦reloadæ‰å¯ä»¥ç”Ÿæ•ˆã€‚ 123456&lt;zone target="ACCEPT"&gt; &lt;short&gt;Work&lt;/short&gt; &lt;description&gt;For use in work areas. You mostly trust the other computers on networks to not harm your computer. Only selected incoming connections are accepted.&lt;/description&gt; &lt;service name="ssh"/&gt; &lt;service name="dhcpv6-client"/&gt;&lt;/zone&gt; æœåŠ¡æœåŠ¡å°±æ˜¯å¯¹ç«¯å£ã€åè®®å’Œç›®çš„åœ°å€çš„å°è£…ã€‚ è¿™æ ·åšçš„å¥½å¤„ï¼š é€šè¿‡æœåŠ¡åå­—æ¥ç®¡ç†è§„åˆ™æ›´åŠ äººæ€§åŒ– é€šè¿‡æœåŠ¡æ¥ç»„ç»‡ç«¯å£åˆ†ç»„çš„æ¨¡å¼æ›´åŠ é«˜æ•ˆï¼Œå¦‚æžœä¸€ä¸ªæœåŠ¡ä½¿ç”¨äº†è‹¥å¹²ä¸ªç½‘ç»œç«¯å£ï¼Œåˆ™æœåŠ¡çš„é…ç½®æ–‡ä»¶å°±ç›¸å½“äºŽæä¾›äº†åˆ°è¿™äº›ç«¯å£çš„è§„åˆ™ç®¡ç†çš„æ‰¹é‡æ“ä½œå¿«æ·æ–¹å¼ serviceé…ç½®æ–‡ä»¶çš„å‘½åè§„åˆ™æ˜¯&lt;æœåŠ¡å&gt;.xmlã€‚ é»˜è®¤ä¿å­˜åœ¨/usr/lib/firewalld/services/ç›®å½•ä¸‹ï¼Œå¸¸è§çš„æœåŠ¡å…¶ä¸­éƒ½å¯ä»¥æ‰¾åˆ°ï¼Œå¦‚æžœæˆ‘ä»¬æƒ³ä¿®æ”¹æŸä¸ªæœåŠ¡çš„é…ç½®ï¼Œé‚£ä¹ˆå¯ä»¥å¤åˆ¶ä¸€ä»½åˆ°/etc/firewalld/services/ç›®å½•ä¸‹ç„¶åŽè¿›è¡Œä¿®æ”¹å°±å¯ä»¥äº†ã€‚ 123456&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;service&gt; &lt;short&gt;MySQL&lt;/short&gt; &lt;description&gt;MySQL Database Server&lt;/description&gt; &lt;port protocol="tcp" port="3306"/&gt;&lt;/service&gt; ä¸ªäººè§‰å¾—ï¼Œfirewalldä¸­çš„serviceä¸Žiptablesçš„è‡ªå®šä¹‰é“¾æœ‰äº›ç±»ä¼¼ï¼Œéƒ½æ˜¯ç”¨æ¥åˆ†ç±»ã€æ–¹ä¾¿ç®¡ç†é’ˆå¯¹çš„æŸäº›æœåŠ¡çš„ã€‚ ipsetåˆ›å»ºåŒ¹é…æ•´ä¸ªåœ°å€çš„é›†åˆã€‚ 12345678&lt;?xml version="1.0" encoding="utf-8"?&gt; &lt;ipset type="hash:net"&gt; &lt;short&gt;white-list&lt;/short&gt; &lt;entry&gt;192.168.198.21&lt;/entry&gt; &lt;entry&gt;192.168.198.22&lt;/entry&gt; &lt;entry&gt;192.168.198.23&lt;/entry&gt; &lt;entry&gt;192.168.199.0/24&lt;/entry&gt; &lt;/ipset&gt; 12345&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;ipset type="hash:mac"&gt; &lt;short&gt;mac-list&lt;/short&gt; &lt;entry&gt;00:11:22:33:44:55&lt;/entry&gt;&lt;/ipset&gt; æ›´å¤šæ”¯æŒçš„ç±»åž‹æŸ¥çœ‹ 1ipset --help è§„åˆ™è¿‡æ»¤è§„åˆ™ sourceï¼šæ ¹æ®æºåœ°å€è¿‡æ»¤ interfaceï¼šæ ¹æ®ç½‘å¡è¿‡æ»¤ serviceï¼šæ ¹æ®æœåŠ¡åè¿‡æ»¤ portï¼šæ ¹æ®ç«¯å£è¿‡æ»¤ icmp-blockï¼šicmp æŠ¥æ–‡è¿‡æ»¤ï¼ŒæŒ‰ç…§ icmp ç±»åž‹é…ç½® masqueradeï¼šip åœ°å€ä¼ªè£… forward-portï¼šç«¯å£è½¬å‘ ruleï¼šè‡ªå®šä¹‰è§„åˆ™ ä¼˜å…ˆçº§è¿‡æ»¤è§„åˆ™çš„ä¼˜å…ˆçº§éµå¾ªå¦‚ä¸‹é¡ºåºï¼š source interface firewalld.confä¸­é…ç½®çš„é»˜è®¤zone å‘½ä»¤æŸ¥çœ‹è§„åˆ™ æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ 1&gt; firewall-cmd --state æŸ¥çœ‹å·²è¢«æ¿€æ´»çš„Zoneä¿¡æ¯ 123&gt; firewall-cmd --get-active-zonespublic interfaces: ens33 æŸ¥çœ‹æŒ‡å®šæŽ¥å£çš„Zoneä¿¡æ¯ 1&gt; firewall-cmd --get-zone-of-interface=ens33 æŸ¥çœ‹æŒ‡å®šZoneçš„æŽ¥å£ 1&gt; firewall-cmd --zone=public --list-interfaces æŸ¥çœ‹æŒ‡å®šZoneçš„æ‰€æœ‰ä¿¡æ¯ 1234567891011121314&gt; firewall-cmd --zone=public --list-allpublic (active) target: default icmp-block-inversion: no interfaces: ens33 sources: services: ssh dhcpv6-client ports: protocols: masquerade: no forward-ports: source-ports: icmp-blocks: rich rules: æŸ¥è¯¢æŒ‡å®šZoneè¢«æ”¾è¡Œçš„æœåŠ¡ï¼ˆå³è¿è¡Œæ—¶çŠ¶æ€ï¼‰ 12&gt; firewall-cmd --zone=public --list-servicesssh dhcpv6-client æŸ¥è¯¢æŒ‡å®šZoneæ°¸ä¹…æ”¾è¡Œçš„æœåŠ¡ï¼ˆå³æ°¸ä¹…çŠ¶æ€ï¼‰ 12&gt; firewall-cmd --zone=public --list-services --permanentssh dhcpv6-client é…ç½®è§„åˆ™sourceinterfaceserviceå¯¹æœåŠ¡è¿›è¡Œæ“ä½œã€‚ æœåŠ¡å°±æ˜¯å¯¹ç«¯å£ã€åè®®å’Œç›®çš„åœ°å€çš„å°è£…ã€‚ è¯¦ç»†å®šä¹‰ä¸€ä¸ªæœåŠ¡ï¼š 123&gt; cd /etc/firewalld/services/&gt; cp /usr/lib/firewalld/services/mysql.xml .&gt; vim mysql.xml åŠ --permanentç›¸å…³æ“ä½œæ˜¯å¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œï¼Œä¸åŠ --permanentå¯¹å½“å‰è¿è¡ŒçŠ¶æ€é…ç½®è¿›è¡Œæ“ä½œã€‚ 1234&lt;!-- é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šæœåŠ¡ --&gt;&lt;zone&gt; &lt;service name="string"/&gt;&lt;/zone&gt; 12345678910# æŸ¥çœ‹publicåŒºåŸŸæ°¸ä¹…æ”¾è¡Œçš„æœåŠ¡&gt; firewall-cmd --zone=public --list-services --permanent# æ·»åŠ ä¸€ä¸ªæ”¾è¡ŒæœåŠ¡&gt; firewall-cmd --zone=public --add-service=mysql# æ·»åŠ ä¸€ä¸ªæ”¾è¡ŒæœåŠ¡ï¼Œè®¾ç½®è¶…æ—¶æ—¶é—´ä¸º600sï¼Œæ³¨æ„--timeoutæ— æ³•ä¸Ž--permanentä¸€èµ·ä½¿ç”¨ï¼Œå³æ— æ³•å†™å…¥æŒ‡å®šzoneæ–‡ä»¶&gt; firewall-cmd --zone=public --add-service=vnc-server --timeout=600# ç§»é™¤æ”¾è¡ŒæœåŠ¡&gt; firewall-cmd --zone=public --remove-service=mysql --permanent# æ ¹æ®æŸä¸ªæ˜¯å¦æ”¾è¡Œè¿”å›žä¸€ä¸ªå¸ƒå°”å€¼&gt; firewall-cmd --zone=public --query-service=mysql portå¯¹ç«¯å£è¿›è¡Œæ“ä½œã€‚ 1234&lt;!-- é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šç«¯å£å· --&gt;&lt;zone&gt; &lt;port port="portid[-portid]" protocol="tcp|udp"/&gt;&lt;/zone&gt; 12345678# æŸ¥çœ‹æŒ‡å®špublicåŒºåŸŸæ”¾è¡Œçš„ç«¯å£å·&gt; firewall-cmd --zone=public --list-ports# æ·»åŠ ä¸€ä¸ªæ”¾è¡Œç«¯å£&gt; firewall-cmd --zone=public --add-port=47017/tcp# æ·»åŠ ä¸€ä¸ªæ”¾è¡Œç«¯å£ï¼Œè®¾ç½®è¶…æ—¶æ—¶é—´ä¸º600s&gt; firewall-cmd --zone=public --add-port=22/tcp --timeout=600s# ç§»é™¤æ”¾è¡Œç«¯å£&gt; firewall-cmd --zone=public --remove-port=22/tcp icmp-blockmasqueradeforward-portrule]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linuxå­¦ä¹ ç¬”è®°-Iptables]]></title>
    <url>%2F2018%2F08%2F09%2FLinux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Iptables%2F</url>
    <content type="text"><![CDATA[Iptablesç¬”è®°ç†è§£æµç¨‹ï¼Œç†è§£è¡¨é“¾ã€çŸ¥é“å¦‚ä½•åˆ¶å®šè§„åˆ™ã€‚ ðŸŒ[readhatå®˜ç½‘æ–‡æ¡£] æ¦‚å¿µiptableså¹¶ä¸æ˜¯çœŸæ­£çš„é˜²ç«å¢™ï¼Œåªæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯ä»£ç†ï¼Œç”¨æˆ·é€šè¿‡iptablesä»£ç†å°†ç”¨æˆ·çš„å®‰å…¨è®¾å®šæ‰§è¡Œåˆ°å¯¹åº”çš„å®‰å…¨æ¡†æž¶ä¸­ï¼Œè¿™ä¸ªå®‰å…¨æ¡†æž¶æ‰æ˜¯çœŸæ­£çš„é˜²ç«å¢™ï¼Œå«netfilterã€‚ netfilter/iptablesç»„æˆLinuxå¹³å°ä¸‹çš„åŒ…è¿‡æ»¤é˜²ç«å¢™ï¼Œå®Œæˆå°åŒ…è¿‡æ»¤ã€å°åŒ…é‡å®šå‘ã€ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰ç­‰åŠŸèƒ½ã€‚ netfilteræ‰æ˜¯é˜²ç«å¢™çœŸæ­£çš„å®‰å…¨æ¡†æž¶ï¼ˆframeworkï¼‰ï¼Œä½äºŽå†…æ ¸ç©ºé—´ã€‚ iptablesæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œä½äºŽç”¨æˆ·ç©ºé—´ã€‚ ç”¨iptableså‘½ä»¤è¡Œå·¥å…·æ“ä½œnetfilterå®‰å…¨æ¡†æž¶ã€‚ netfilteræ˜¯ä¸€ä¸ªLinuxæ“ä½œç³»ç»Ÿæ ¸å¿ƒå±‚å†…éƒ¨çš„ä¸€ä¸ªæ•°æ®åŒ…å¤„ç†æ¨¡å—ï¼Œå…·æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNetwork Address Translateï¼‰ æ•°æ®åŒ…å†…å®¹ä¿®æ”¹ æ•°æ®åŒ…è¿‡æ»¤ æ‰€ä»¥è¯´ï¼Œiptableså¯åŠ¨åŽå¹¶æ²¡æœ‰ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œä¸èƒ½ç®—æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„æœåŠ¡ï¼Œåº”è¯¥ç®—æ˜¯å†…æ ¸æä¾›çš„åŠŸèƒ½ã€‚ åŽŸç†ç®€å•çš„æ•°æ®æµå‘ï¼Œç¨åŽå†æµç¨‹ä¸­å†è¯¦ç»†è®²å®Œæ•´çš„æµç¨‹å›¾ã€‚ è¡¨é“¾IptablesåŒ…å«å››è¡¨äº”é“¾ï¼Œå…¶å®žæ˜¯å¯¹è§„åˆ™çš„åˆ†ç±»ã€‚ è¡¨æ˜¯å¯¹æ•°æ®åŒ…çš„æ“ä½œè¿›è¡Œåˆ†ç±»ï¼Œå¯ä»¥ç†è§£ä¸ºæ¯ä¸ªè¡¨ä»£è¡¨ä¸åŒçš„åŠŸèƒ½ã€‚ é“¾æ˜¯å¯¹ä¸åŒçš„hookç‚¹è¿›è¡Œåˆ†ç±»ï¼Œå¯ä»¥ç†è§£ä¸ºæ¯ä¸ªé“¾ä»£è¡¨ä¸åŒçš„å…³å¡ã€‚ è¡¨é“¾å®žé™…ä¸Šæ˜¯netfilterçš„ä¸¤ä¸ªç»´åº¦ã€‚ è¡¨å››è¡¨äº”é“¾ä¸­çš„å››è¡¨ï¼š filterï¼šè´Ÿè´£è¿‡æ»¤åŠŸèƒ½ï¼Œé˜²ç«å¢™ natï¼šè´Ÿè´£ç½‘ç»œåœ°å€è½¬æ¢åŠŸèƒ½ mangleï¼šæ‹†è§£æŠ¥æ–‡ï¼Œåšå‡ºä¿®æ”¹ï¼Œå¹¶é‡æ–°å°è£…åŠŸèƒ½ rawï¼šå…³é—­natè¡¨ä¸Šå¯ç”¨çš„è¿žæŽ¥è¿½è¸ªæœºåˆ¶ é“¾å››è¡¨äº”é“¾ä¸­çš„äº”é“¾ï¼š PREROUTINGï¼šæ•°æ®åŒ…è¿›å…¥è·¯ç”±è¡¨ä¹‹å‰ INPUTï¼šé€šè¿‡è·¯ç”±è¡¨åŽç›®çš„åœ°ä¸ºæœ¬æœº FORWARDï¼šé€šè¿‡è·¯ç”±è¡¨åŽï¼Œç›®çš„åœ°ä¸ä¸ºæœ¬æœº OUTPUTï¼šç”±æœ¬æœºäº§ç”Ÿï¼Œå‘å¤–è½¬å‘ å…³ç³»é“¾è¡¨å…³ç³»ï¼ˆæ–¹ä¾¿ç†è§£ï¼‰ åœ¨ç†è§£iptablesæ—¶ï¼Œé€šå¸¸ä¼šç”¨é“¾è¡¨å…³ç³»æ¥è¿›è¡Œç†è§£ã€‚ æ¯ä¸ªé“¾ä¸­çš„è§„åˆ™éƒ½å­˜åœ¨äºŽå“ªäº›è¡¨ä¸­ï¼ˆå³æ¯ä¸ªå…³å¡å¯ä»¥æ‹¥æœ‰å“ªäº›åŠŸèƒ½ï¼‰ï¼š PREROUTINGé“¾çš„è§„åˆ™å¯ä»¥å­˜åœ¨äºŽï¼šrawè¡¨ã€mangleè¡¨ã€natè¡¨ INPUTé“¾çš„è§„åˆ™å¯ä»¥å­˜åœ¨äºŽï¼šmangleè¡¨ã€filterè¡¨ã€natè¡¨ï¼ˆä»…é™CentOS 7ï¼ŒCentOS 6ä¸­æ²¡æœ‰ï¼‰ FORWORDé“¾çš„è§„åˆ™å¯ä»¥å­˜åœ¨äºŽï¼šmangleè¡¨ã€filterè¡¨ OUTPUTé“¾çš„è§„åˆ™å¯ä»¥å­˜åœ¨äºŽï¼šrawè¡¨ã€mangleè¡¨ã€natè¡¨ã€filterè¡¨ POSTROUTINGé“¾çš„è§„åˆ™å¯ä»¥å­˜åœ¨äºŽï¼šmangleè¡¨ï¼Œnatè¡¨ è¡¨é“¾å…³ç³»ï¼ˆæ–¹ä¾¿æ“ä½œï¼‰ å®žé™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¾€å¾€æ˜¯é€šè¿‡è¡¨ä¸ºæ“ä½œå…¥å£ï¼Œå¯¹è§„åˆ™è¿›è¡Œå®šä¹‰çš„ã€‚ æ¯ä¸ªè¡¨ä¸­çš„è§„åˆ™å¯ä»¥è¢«å“ªäº›é“¾åº”ç”¨ï¼ˆå³å“ªäº›åŠŸèƒ½å¯ä»¥è¢«å“ªä¸ªå…³å¡åº”ç”¨ï¼‰ï¼š rawè¡¨çš„è§„åˆ™å¯ä»¥è¢«å“ªäº›é“¾ä½¿ç”¨ï¼šPREROUTINGã€OUTPUT mangleè¡¨ä¸­çš„è§„åˆ™å¯ä»¥è¢«å“ªäº›é“¾ä½¿ç”¨ï¼šPREROUTINGã€INPUTã€FORWORDã€OUTPUTã€POSTROUTING natè¡¨ä¸­çš„è§„åˆ™å¯ä»¥è¢«å“ªäº›é“¾ä½¿ç”¨ï¼šPREROUTINGã€INPUTï¼ˆä»…é™CentOS 7ï¼ŒCentOS 6æ²¡æœ‰ï¼‰ã€OUTPUTã€POSTROUTING filterè¡¨ä¸­çš„è§„åˆ™å¯ä»¥è¢«å“ªäº›é“¾ä½¿ç”¨ï¼šINPUTã€FORWORDã€OUTPUTã€ é¡ºåºåœ¨æŸæ¡é“¾å­˜åœ¨å¤šä¸ªè¡¨æ—¶ï¼ˆå³æŸä¸ªå…³å¡å­˜åœ¨å¤šä¸ªåŠŸèƒ½ï¼‰ï¼Œæ‰§è¡Œçš„ä¼˜å…ˆçº§å¦‚ä¸‹ï¼š raw â†’ mangle â†’ nat â†’ filter è§„åˆ™æ¦‚å¿µåŒ¹é…å³åœï¼š æ ¹æ®æŒ‡å®šçš„åŒ¹é…æ¡ä»¶å°è¯•åŒ¹é…æ¯ä¸ªç»è¿‡æ­¤å¤„çš„æŠ¥æ–‡ï¼Œä¸€æ—¦åŒ¹é…æˆåŠŸï¼Œåˆ™ç”±è§„åˆ™åŽé¢çš„å¤„ç†åŠ¨ä½œè¿›è¡Œå¤„ç†ã€‚ åŒ¹é…æ¡ä»¶ï¼šåŽŸåœ°å€ã€ç›®çš„åœ°å€ã€æºç«¯å£ã€ç›®æ ‡ç«¯å£ç­‰ æ­¤å¤„ï¼šé“¾ï¼ˆå…³å¡ï¼‰ æŠ¥æ–‡ï¼šæ•°æ®å— å¤„ç†åŠ¨ä½œï¼šå…è®¸ã€æ‹’ç»ã€ä¸¢å¼ƒã€è½¬æ¢ã€æ˜ å°„ç­‰ åŒ¹é…æ¡ä»¶åŸºæœ¬åŒ¹é…æ¡ä»¶ï¼š æºåœ°å€ï¼šSource IP ç›®çš„åœ°å€ï¼šDestination IP æ‰©å±•åŒ¹é…æ¡ä»¶ï¼šï¼ˆéœ€è¦ä¾èµ–å¯¹åº”çš„æ‰©å±•æ¨¡å—ï¼‰ æºç«¯å£ï¼šSource Port ç›®æ ‡ç«¯å£ï¼šDestination Port å¤„ç†åŠ¨ä½œ ACCEPTï¼šå…è®¸æ•°æ®åŒ…é€šè¿‡ DROPï¼šç›´æŽ¥ä¸¢å¼ƒæ•°æ®åŒ…ï¼Œä¸ç»™ä»»ä½•å›žåº”ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯çš„è¯·æ±‚çŸ³æ²‰å¤§æµ·ï¼Œè¿‡äº†è¶…æ—¶æ—¶é—´æ‰ä¼šæœ‰ååº” REJECTï¼šæ‹’ç»æ•°æ®åŒ…é€šè¿‡ï¼Œå¿…è¦æ—¶ä¼šç»™æ•°æ®å‘é€ç«¯ä¸€ä¸ªå“åº”ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯åˆšè¯·æ±‚å°±ä¼šæ”¶åˆ°æ‹’ç»çš„ä¿¡æ¯ SNATï¼šæºåœ°å€è½¬æ¢ï¼Œè§£å†³å†…ç½‘ç”¨æˆ·ç”¨åŒä¸€ä¸ªå…¬ç½‘åœ°å€ä¸Šç½‘çš„é—®é¢˜ MASQUERADEï¼šæ˜¯SNATçš„ä¸€ç§ç‰¹æ®Šå½¢å¼ï¼Œé€‚ç”¨äºŽåŠ¨æ€çš„ï¼Œä¸´æ—¶ä¼šå˜çš„ipä¸Š DNATï¼šç›®æ ‡åœ°å€è½¬æ¢ REDIRECTï¼šæœ¬åœ°åšç«¯å£æ˜ å°„ LOGï¼šåœ¨/var/log/messagesæ–‡ä»¶ä¸­è®°å½•æ—¥å¿—ä¿¡æ¯ï¼Œç„¶åŽå°†æ•°æ®åŒ…ä¼ é€’ç»™ä¸‹ä¸€ä¸ªè§„åˆ™ã€‚å°±æ˜¯é™¤äº†è®°å½•ä»¥å¤–ä¸å¯¹æ•°æ®åŒ…åšä»»ä½•å…¶ä»–æ“ä½œï¼Œä»ç„¶è®©ä¸‹ä¸€æ¡è§„åˆ™åŽ»åŒ¹é… æ€»ç»“åŒ¹é…æµç¨‹]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linuxå­¦ä¹ ç¬”è®°-SSH]]></title>
    <url>%2F2018%2F08%2F09%2FLinux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-SSH%2F</url>
    <content type="text"><![CDATA[SSHå­¦ä¹ ç¬”è®°åªè®°å½•ç›¸å…³å‘½ä»¤ã€‚ SSHä½¿ç”¨ç§˜é’¥è®¤è¯ç›¸å…³å‘½ä»¤ äº¤äº’å¼ç”Ÿæˆç§˜é’¥å¯¹ 1ssh-keygen æŒ‡å®šç§˜é’¥å¯¹ç”Ÿæˆä½ç½®ä¸Žåç§° 1ssh-keygen -f /opt/ssh/id_rsa sshè¿žæŽ¥åˆ°å¯¹åº”ä¸»æœºæ—¶ï¼ŒæŒ‡å®šå¯¹åº”çš„ç§˜é’¥ 1ssh -i /opt/ssh/id_rsa ç›´æŽ¥ç”Ÿæˆç§˜é’¥å¯¹å¹¶è®¾ç½®å¯†ç  1ssh-keygen -P '123456' -f ~/.ssh/id_rsa ä¸ºç§é’¥æ·»åŠ å¯†ç ã€å–æ¶ˆå¯†ç ã€ä¿®æ”¹å¯†ç  1ssh-keygen -f ~/.ssh/id_rsa -p ç”ŸæˆæŒ‡å®šç±»åž‹çš„å¯†é’¥ 1ssh-keygen -t dsa -P '' -f ~/.ssh/id_rsa ç”ŸæˆæŒ‡å®šä½æ•°çš„å¯†é’¥ 1ssh-keygen -t rsa -b 1024 -P '' -f ~/.ssh/id_rsa æ ¹æ®ç§é’¥ç”Ÿæˆå…¬é’¥ 12ssh-keygen -f ~/.ssh/id_rsa -yssh-keygen -f ~/.ssh/id_rsa -y &gt; id_rsa.pub å°†å…¬é’¥åŠ å…¥åˆ°æŒ‡å®šè´¦æˆ·çš„è®¤è¯æ–‡ä»¶ä¸­ 123ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.198.22ssh-copy id -i ~/.ssh/id_rsa.pub root@192.168.198.22 -p 2222cat ~/.ssh/id_rsa.pub | ssh -p 22 root@192.168.198.22 "umask 077;mkdir -p ~/.ssh;cat - &gt;&gt; ~/.ssh/authorized_keys" ç›¸å…³é—®é¢˜ sshæœåŠ¡ç«¯ä¸æ”¯æŒåŸºäºŽå…¬é’¥è®¤è¯ï¼Œæˆ–è€…ä¿®æ”¹äº†é»˜è®¤çš„å…¬é’¥è®¤è¯æ–‡ä»¶ã€‚ æœåŠ¡ç«¯å¯ä»¥ç¦ç”¨ä½¿ç”¨å…¬é’¥è®¤è¯çš„æœºåˆ¶ï¼ŒPubkeyAuthenticationé…ç½®é¡¹ç”¨äºŽæŽ§åˆ¶æ˜¯å¦å¯ä»¥ä½¿ç”¨å…¬é’¥è¿›è¡Œè®¤è¯ï¼ŒPubkeyAuthenticationé»˜è®¤ä¸ºyesï¼Œè¡¨ç¤ºæ”¯æŒå…¬é’¥è®¤è¯ï¼Œé»˜è®¤ä½¿ç”¨authorized_keysä½œä¸ºå­˜å‚¨ç”¨æˆ·å…¬é’¥çš„æ–‡ä»¶ï¼Œåœ¨/etc/ssh/sshd_configé…ç½®æ–‡ä»¶ä¸­å¯ä»¥ä½¿ç”¨AuthorizedKeysFileé…ç½®é¡¹æŒ‡å®šå…¶ä»–æ–‡ä»¶ä¸ºè®¤è¯æ–‡ä»¶ã€‚ sshæœåŠ¡ç«¯ç›¸å…³ç›®å½•æˆ–è€…æ–‡ä»¶æƒé™è¿‡å¤§ã€‚ æœåŠ¡ç«¯ç”¨æˆ·å®¿ä¸»ç›®å½•.sshç›®å½•çš„æƒé™æ­£å¸¸ä¸º700ï¼Œauthorized_keysæ–‡ä»¶æƒé™é»˜è®¤ä¸º600 sshæœåŠ¡ç«¯çš„authorized_keysæ–‡ä»¶ä¸­åŒ…å«Windowså­—ç¬¦ã€‚ æ‰‹åŠ¨å¤åˆ¶ç²˜è´´å…¬é’¥å†…å®¹åˆ°authorized_keyså¹¶ä¸”æ“ä½œæ—¶ç»è¿‡Windowsç³»ç»Ÿå¤„ç†ï¼Œä¼šå‡ºçŽ°è¿™ç§æƒ…å†µã€‚ sshå®¢æˆ·ç«¯è¿žæŽ¥æœåŠ¡ç«¯æ—¶ï¼Œæ²¡æœ‰æŒ‡å®šå¯¹åº”è´¦æˆ·çš„ç”¨æˆ·åã€‚ è¿žæŽ¥æ—¶æœ€å¥½ç¡®è®¤å®¢æˆ·ç«¯çš„ç”¨æˆ·ï¼Œå¦åˆ™é»˜è®¤ä½¿ç”¨æœåŠ¡ç«¯çš„å½“å‰ç”¨æˆ·ã€‚ sshå®¢æˆ·ç«¯ç§é’¥æƒé™è¿‡å¤§ã€‚ æ­£å¸¸æƒ…å†µä¸‹ï¼Œå°†ç§é’¥è®¾ç½®ä¸º600å³å¯ã€‚ SSHä»£ç†ç›¸å…³å‘½ä»¤ å¯åŠ¨ssh-agent 1234567# æ–¹å¼ä¸€ï¼šåˆ›å»ºå­shellï¼Œé€€å‡ºå­shellè‡ªåŠ¨ç»“æŸä»£ç†ssh-agent $SHELL# é€šå¸¸æƒ…å†µï¼Œé»˜è®¤shellä¸ºbashï¼Œå¯ä»¥ç›´æŽ¥æŒ‡å®šbashssh-agent bash# æ–¹å¼äºŒï¼šå¯åŠ¨è¿›ç¨‹ï¼Œé€€å‡ºshellæ—¶æœ€å¥½å…³é—­å¯¹åº”ä»£ç†eval 'ssh-agent' å…³é—­ssh-agent 1ssh-agent -k å°†ç§é’¥æ·»åŠ åˆ°sshä»£ç† 12ssh-add ~/.ssh/id_rsassh-add &lt;ç§é’¥æ–‡ä»¶è·¯å¾„&gt; æŸ¥çœ‹ä»£ç†ä¸­çš„ç§é’¥ 1ssh-add -l æŸ¥çœ‹ä»£ç†ä¸­çš„ç§é’¥å¯¹åº”çš„å…¬é’¥ 1ssh-add -L ç§»é™¤ä»£ç†ä¸­æŒ‡å®šçš„ç§é’¥ 1ssh-add -d &lt;ç§é’¥æ–‡ä»¶è·¯å¾„&gt; ç§»é™¤ä»£ç†ä¸­æ‰€æœ‰ç§é’¥ 1ssh-add -D é”å®šsshä»£ç† 12# é”å®šæ—¶éœ€è¦æŒ‡å®šé”å®šå¯†ç ï¼Œé”å®šåŽsshä»£ç†æš‚æ—¶ä¸èƒ½ç®¡ç†ç§é’¥ssh-add -x è§£é”sshä»£ç† 12# è§£é”æ—¶éœ€è¦è¾“å…¥é”å®šæ—¶è®¾ç½®çš„å¯†ç ï¼Œè§£é”åŽsshä»£ç†å¯æ­£å¸¸å·¥ä½œssh-add -X ä»£ç†è½¬å‘ å®¢æˆ·ç«¯ï¼šä¿®æ”¹é…ç½® 12# ä¿®æ”¹ssh_configï¼ˆä¸æ˜¯sshd_configï¼‰ForwardAgent yes å®¢æˆ·ç«¯ï¼šå¯åŠ¨sshä»£ç† 12ssh-agent bashssh-add ~/.ssh/id_rsa ä»£ç†ç«¯ï¼šä¿®æ”¹é…ç½® 12# ä¿®æ”¹sshd_configï¼ˆä¸æ˜¯ssh_configï¼‰AllowAgentForwarding yes # ä¿æŒé»˜è®¤å³å¯ SSHéš§é“æœ¬åœ°è½¬å‘æœ¬åœ°ä¸»æœºï¼šsshå®¢æˆ·ç«¯ï¼Œåº”ç”¨å®¢æˆ·ç«¯ è¿œç¨‹ä¸»æœºï¼šsshæœåŠ¡ç«¯ï¼Œåº”ç”¨æœåŠ¡ç«¯ 12345# å»ºç«‹sshéš§é“ï¼Œåœ¨æœ¬åœ°å›žçŽ¯åœ°å€ç›‘å¬9999ssh -L 9999:192.168.198.22:3306 root@192.168.198.22ssh -f -N -L 9999:192.168.198.22:3306 root@192.168.198.22# é€šè¿‡sshéš§é“è¿žæŽ¥MySQLæœåŠ¡ç«¯mysql -h127.0.0.1 -P9999 -uroot è¿œç¨‹è½¬å‘æœ¬åœ°ä¸»æœºï¼šsshå®¢æˆ·ç«¯ï¼Œåº”ç”¨æœåŠ¡ç«¯ è¿œç¨‹ä¸»æœºï¼šsshæœåŠ¡ç«¯ï¼Œåº”ç”¨å®¢æˆ·ç«¯ ç†è§£ä¸ºsshåå‘éš§é“ã€sshé€†å‘éš§é“ 12345# å»ºç«‹sshéš§é“ï¼Œåœ¨æœ¬åœ°å›žçŽ¯åœ°å€ç›‘å¬9999ssh -f -N -R 9999:192.168.198.22:3306 root@192.168.198.21# é€šè¿‡sshéš§é“è¿žæŽ¥MySQLæœåŠ¡ç«¯mysql -h127.0.0.1 -P9999 -uroot ç›¸å…³å‘½ä»¤ æœ¬åœ°è½¬å‘ 1ssh -g -f -N -L forwardingPort:targetIP:targetPort user@sshServerIP è¿œç¨‹è½¬å‘ 1ssh -f -N -R forwardingPort:targetIP:targetPort user@sshServerIP å¸¸ç”¨é€‰é¡¹ï¼š -Lï¼šä½¿ç”¨æœ¬åœ°ç«¯å£è½¬å‘åˆ›å»ºé“¾æŽ¥ -Rï¼šä½¿ç”¨è¿œç¨‹ç«¯å£è½¬å‘åˆ›å»ºé“¾æŽ¥ -Nï¼šåˆ›å»ºéš§é“åŽä¸è¿žæŽ¥åˆ°SSHæœåŠ¡ç«¯ï¼Œé€šå¸¸ä¸Ž-fé€‰é¡¹è¿žç”¨ -fï¼šåœ¨åŽå°è¿è¡Œsshéš§é“ï¼Œé€šå¸¸ä¸Ž-Né€‰é¡¹è¿žç”¨ -gï¼šå¼€å¯ç½‘å…³æ¨¡å¼ï¼Œåœ¨è¿œç¨‹ç«¯å£è½¬å‘ä¸­ï¼Œæ— æ³•å¼€å¯ç½‘å…³åŠŸèƒ½]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ansibleå­¦ä¹ ç¬”è®°-Roles]]></title>
    <url>%2F2018%2F08%2F07%2FAnsible%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E8%A7%92%E8%89%B2%2F</url>
    <content type="text"><![CDATA[Ansible Roleså­¦ä¹ ç¬”è®°åœ¨Ansibleä¸­ï¼ŒRoleæ˜¯å°†Playbookåˆ†å‰²ä¸ºå¤šä¸ªæ–‡ä»¶çš„ä¸»è¦æœºåˆ¶ã€‚ roleå¹¶ä¸æ˜¯æŸä¸€ä¸ªå…·ä½“çš„ä¸œè¥¿ï¼Œè€Œæ˜¯ä¸€ä¸ªè§„èŒƒä¸ŽæŠ½è±¡ï¼ŒAnsibleå°†ç‹¬ç«‹çš„åŠŸèƒ½æŠ½è±¡æˆroleï¼Œå¹¶å°†è¯¥åŠŸèƒ½ä¾èµ–çš„æ–‡ä»¶ã€å˜é‡ã€æ¨¡æ¿ã€Playbookä»¥ç»Ÿä¸€çš„æ ¼å¼è¿›è¡Œè§„èŒƒåŒ–ç»„ç»‡ï¼Œä»¥æ­¤ç®€åŒ–äº†å¤æ‚çš„Playbookçš„ç¼–å†™ï¼ŒåŒæ ·å¢žåŠ äº†Playbookçš„å¯ç»´æŠ¤æ€§ã€‚ Galaxyç½‘ç«™ðŸŒ[Galaxy ]ç±»ä¼¼äºŽDocker Hubï¼Œæ˜¯ä¸€ä¸ªå¼€æºç½‘ç«™ã€‚ç”¨äºŽæŸ¥æ‰¾ï¼Œä¸‹è½½å’Œå…±äº«ç¤¾åŒºå¼€å‘çš„è§’è‰²ã€‚ä»ŽGalaxyä¸‹è½½è§’è‰²æ˜¯å¿«é€Ÿå¯åŠ¨è‡ªåŠ¨åŒ–é¡¹ç›®çš„å¥½æ–¹æ³•ã€‚ è¿˜å¯ä»¥ä½¿ç”¨è¯¥ç«™ç‚¹æ¥å…±äº«æ‚¨åˆ›å»ºçš„è§’è‰²ã€‚é€šè¿‡ä½¿ç”¨æ‚¨çš„GitHubå¸æˆ·å¯¹ç«™ç‚¹è¿›è¡Œèº«ä»½éªŒè¯ï¼Œæ‚¨å¯ä»¥å¯¼å…¥è§’è‰²ï¼Œä½¿å…¶å¯ä¾›Ansibleç¤¾åŒºä½¿ç”¨ã€‚å¯¼å…¥çš„è§’è‰²åœ¨Galaxyæœç´¢ç´¢å¼•ä¸­å¯ç”¨ï¼Œå¹¶åœ¨ç«™ç‚¹ä¸Šå¯è§ï¼Œå…è®¸ç”¨æˆ·å‘çŽ°å’Œä¸‹è½½å®ƒä»¬ã€‚ è¿˜å¯ä»¥åœ¨å…¬å¸æˆ–ä¸ªäººçš„GalaxyæœåŠ¡å™¨ä¸Šä¸‹è½½è§’è‰²ï¼Œé»˜è®¤ä½¿ç”¨æœåŠ¡å™¨åœ°å€https://galaxy.ansible.comä¸ŽGalaxyç½‘ç«™APIè¿›è¡Œé€šä¿¡ï¼Œéœ€è¦æ›´æ”¹ansible.cfgé…ç½®æ–‡ä»¶æ¥ä¿®æ”¹GalaxyæœåŠ¡å™¨åœ°å€ã€‚ ðŸŒ[Ansible Github]ä¹Ÿæä¾›äº†ä¸€äº›æœ€ä½³å®žè·µçš„ä¾‹å­ï¼Œå¯ä»¥åœ¨å­¦ä¹ æˆ–è€…å·¥ä½œçš„æ—¶å€™è¿›è¡Œå‚è€ƒã€‚ Galaxyå‘½ä»¤ç”¨æ³•Rolesç›®å½•ç»“æž„ 1234567891011121314151617181920212223242526272829303132.â”œâ”€â”€ group_varsâ”‚ â”œâ”€â”€ allâ”‚ â””â”€â”€ dbserversâ”œâ”€â”€ hostsâ”œâ”€â”€ LICENSE.mdâ”œâ”€â”€ README.mdâ”œâ”€â”€ rolesâ”‚ â”œâ”€â”€ commonâ”‚ â”‚ â”œâ”€â”€ handlersâ”‚ â”‚ â”‚ â””â”€â”€ main.ymlâ”‚ â”‚ â”œâ”€â”€ tasksâ”‚ â”‚ â”‚ â””â”€â”€ main.ymlâ”‚ â”‚ â””â”€â”€ templatesâ”‚ â”‚ â””â”€â”€ ntp.conf.j2â”‚ â”œâ”€â”€ dbâ”‚ â”‚ â”œâ”€â”€ handlersâ”‚ â”‚ â”‚ â””â”€â”€ main.ymlâ”‚ â”‚ â”œâ”€â”€ tasksâ”‚ â”‚ â”‚ â””â”€â”€ main.ymlâ”‚ â”‚ â””â”€â”€ templatesâ”‚ â”‚ â””â”€â”€ my.cnf.j2â”‚ â””â”€â”€ webâ”‚ â”œâ”€â”€ handlersâ”‚ â”‚ â””â”€â”€ main.ymlâ”‚ â”œâ”€â”€ tasksâ”‚ â”‚ â”œâ”€â”€ copy_code.ymlâ”‚ â”‚ â”œâ”€â”€ install_httpd.ymlâ”‚ â”‚ â””â”€â”€ main.ymlâ”‚ â””â”€â”€ templatesâ”‚ â””â”€â”€ index.php.j2â””â”€â”€ site.yml]]></content>
      <categories>
        <category>Ansible</category>
      </categories>
      <tags>
        <tag>Ansible</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ansibleå­¦ä¹ ç¬”è®°-å‰§æœ¬]]></title>
    <url>%2F2018%2F08%2F04%2FAnsible%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%89%A7%E6%9C%AC%2F</url>
    <content type="text"><![CDATA[Playbookç¬”è®°Ansibleæä¾›ä¸¤ç§å®Œæˆä»»åŠ¡çš„æ–¹å¼ï¼š ansible â€” Ad-hocï¼Œè§£å†³ä¸€äº›ç®€å•æˆ–è€…ä¸´æ—¶é‡åˆ°çš„ä»»åŠ¡ï¼Œç›¸å½“äºŽLinuxçš„ç³»ç»Ÿå‘½ä»¤è¡Œä¸‹çš„shellå‘½ä»¤ ansible-playbook â€” Playbookï¼Œè§£å†³å¤æ‚æˆ–è€…å›ºåŒ–ä¸‹æ¥çš„ä»»åŠ¡ï¼Œç›¸å½“äºŽLinuxç³»ç»Ÿçš„Shellè„šæœ¬ è¿™æ¬¡è®°å½•Palybookçš„ä½¿ç”¨æ–¹æ³•ã€‚ Playbookå‘½ä»¤ç”¨æ³•123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990Usage: ansible-playbook [options] playbook.yml [playbook2 ...]Options:# vaultå¯†ç  --ask-vault-pass# æ¨¡æ‹Ÿä»»åŠ¡è¿è¡Œï¼Œå¹¶ä¸ä¼šçœŸæ­£æ‰§è¡Œã€‚ -C, --check# å½“æ›´æ”¹ï¼ˆå°çš„ï¼‰æ–‡ä»¶å’Œæ¨¡æ¿æ—¶ï¼Œæ˜¾ç¤ºè¿™äº›æ–‡ä»¶çš„å·®å¼‚ï¼Œå¤§æ–‡ä»¶ä½¿ç”¨-- -D, --diff# è®¾ç½®å¤–éƒ¨å˜é‡ï¼Œå¦‚æžœæ˜¯å˜é‡æ–‡ä»¶åœ¨æ–‡ä»¶å‰é¢åŠ '@' -e EXTRA_VARS, --extra-vars=EXTRA_VARS# æ¸…é™¤æ¯ä¸ªè¿œç¨‹ä¸»æœºä¸Šçš„factsç¼“å­˜ --flush-cache# å³ä½¿ä»»åŠ¡å¤±è´¥ä¹Ÿå¼ºåˆ¶è¿è¡Œhandlersä»»åŠ¡ --force-handlers# æŒ‡å®šå¹¶å‘æ•°ï¼Œé»˜è®¤ä¸º5 -f FORKS, --forks=FORKS# å¸®åŠ©ä¿¡æ¯ -h, --help# æŒ‡å®šinventoryæ–‡ä»¶ -i INVENTORY, --inventory=INVENTORY, --inventory-file=INVENTORY# è¿›ä¸€æ­¥é™åˆ¶æ‰€é€‰ä¸»æœº/ç»„æ¨¡å¼ -l SUBSET, --limit=SUBSET# åˆ—å‡ºä¸»æœºåˆ—è¡¨ï¼Œä¸æ‰§è¡Œä»»åŠ¡ --list-hosts# åˆ—å‡ºæ‰€æœ‰å¯ç”¨æ ‡è®° --list-tags# åˆ—å‡ºæ‰€æœ‰å°†è¦æ‰§è¡Œçš„ä»»åŠ¡ --list-tasks# æ‰§è¡Œæ¨¡å—çš„å­˜æ”¾è·¯å¾„ -M MODULE_PATH, --module-path=MODULE_PATH# è·³è¿‡æŒ‡å®šæ ‡ç­¾çš„ä»»åŠ¡ --skip-tags=SKIP_TAGS# ä»ŽåŒ¹é…çš„ä»»åŠ¡åç§°å¼€å§‹è¿›è¡Œä»»åŠ¡ --start-at-task=START_AT_TASK# åœ¨è¿è¡Œå‰ç¡®è®¤æ¯ä¸ªè¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œä¸€æ­¥ä¸€æ­¥çš„æ‰§è¡Œ --step # ymlè¯­æ³•ç›‘æµ‹ --syntax-check# ä»…è¿è¡ŒæŒ‡å®šçš„tagsä»»åŠ¡ -t TAGS, --tags=TAGS# æŒ‡å®švault id --vault-id=VAULT_IDS# æŒ‡å®švault passwordæ–‡ä»¶ --vault-password-file# è¯¦ç»†æ¨¡å¼ï¼Œ-vvvè¡¨ç¤ºæ›´å¤šï¼Œ-vvvvè¡¨ç¤ºå¯ç”¨è¿žæŽ¥è°ƒè¯• -v, --verbose # ç‰ˆæœ¬ä¿¡æ¯ --version show program's version number and exit Connection Options:# sshè®¤è¯å¯†ç  -k, --ask-pass # æŒ‡å®šç§˜é’¥æ–‡ä»¶ --private-key=PRIVATE_KEY_FILE, --key-file=PRIVATE_KEY_FILE# æŒ‡å®šè¿œç¨‹ä¸»æœºè¿è¡Œå‘½ä»¤çš„ç”¨æˆ·ï¼Œé»˜è®¤Noneï¼ˆä»¥å½“å‰ç³»ç»Ÿç”¨æˆ·ï¼‰ -u REMOTE_USER, --user=REMOTE_USER# æŒ‡å®šè¿žæŽ¥æ–¹å¼ï¼Œé»˜è®¤smart -c CONNECTION, --connection=CONNECTION# è¿žæŽ¥è¿œç¨‹ä¸»æœºè¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’ï¼Œé»˜è®¤ä¸º10ç§’ -T TIMEOUT, --timeout=TIMEOUT# æŒ‡å®šsftp/scp/sshè¿žæŽ¥æ—¶çš„å‚æ•°ï¼ˆä¾‹å¦‚ProxyCommandï¼‰ --ssh-common-args=SSH_COMMON_ARGS# æŒ‡å®šsftpçš„é¢å¤–å‚æ•°ï¼ˆä¾‹å¦‚-f,-lï¼‰ --sftp-extra-args=SFTP_EXTRA_ARGS# æŒ‡å®šscpçš„é¢å¤–å‚æ•°ï¼ˆä¾‹å¦‚-lï¼‰ --scp-extra-args=SCP_EXTRA_ARGS# æŒ‡å®šsshçš„é¢å¤–å‚æ•°ï¼ˆä¾‹å¦‚-Rï¼‰ --ssh-extra-args=SSH_EXTRA_ARGS Privilege Escalation Options:# ç›¸å½“äºŽlinuxsuduå‘½ä»¤ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼Œå»ºè®®ä½¿ç”¨become -s, --sudo# æ‰€éœ€çš„sudoç”¨æˆ·ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼Œå»ºè®®ä½¿ç”¨become -U SUDO_USER, --sudo-user=SUDO_USER# ä½¿ç”¨suæ¥è¿è¡Œä»»åŠ¡ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼Œå»ºè®®ä½¿ç”¨become -S, --su # ä½¿ç”¨suæ¥ä½œä¸ºè¿™ä¸ªç”¨æˆ·è¿è¡Œä»»åŠ¡ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼Œå»ºè®®ä½¿ç”¨become -R SU_USER, --su-user=SU_USER# åœ¨è¿è¡Œå‘½ä»¤æ—¶å‘Šè¯‰å¯ä»¥æˆä¸ºå¦ä¸€ä¸ªç”¨æˆ·ï¼Œæ²¡æœ‰å¯†ç æç¤º -b, --become# æŒ‡å®šå‡çº§ç‰¹æƒæ—¶çš„æ–¹æ³•ï¼Œé»˜è®¤sudoï¼Œå¯ä»¥é€‰æ‹©çš„æœ‰[ sudo | su | pbrun | pfexec | doas | dzdo | ksu | runas | pmrun | enable | machinectl ] --become-method=BECOME_METHOD# æŒ‡å®šè¿è¡Œä»»åŠ¡çš„ç”¨æˆ·ï¼Œé»˜è®¤rootç”¨æˆ· --become-user=BECOME_USER# sudoå¯†ç ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼Œå»ºè®®ä½¿ç”¨become --ask-sudo-pass# suå¯†ç ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼Œå»ºè®®ä½¿ç”¨become --ask-su-pass# è¯·æ±‚æƒé™æå‡çš„å¯†ç ï¼Œå³ä½¿ç”¨becomeæ—¶æ‰€éœ€çš„å¯†ç  -K, --ask-become-pass æƒé™remote_useræŒ‡å®šPlayç”¨æˆ·ã€‚ 12345678---- hosts: test remove_user: root tasks: - name: test connection ping: # ä¸ºå•ä¸ªä»»åŠ¡ç»†åˆ†æ‰§è¡Œçš„ç”¨æˆ· remote_user: gaopeng ä¹Ÿå¯ä»¥åœ¨ansible.cfgä¸­é…ç½®è¿žæŽ¥è¿œç¨‹æœåŠ¡å™¨çš„é»˜è®¤ç”¨æˆ·ã€‚ becomeã€become_methodææƒã€‚ 1234567891011---- hosts: test remote_user: gaopeng become: yes tasks: - service: name: nginx state: started # ä¸ºå•ä¸ªä»»åŠ¡ä½¿ç”¨ç®¡ç†å‘˜æƒé™ become: yes become_method: sudo é€šçŸ¥handlersæ˜¯Ansibleæä¾›çš„æ¡ä»¶æœºåˆ¶ï¼Œä¸Žtasksæ¯”è¾ƒç±»ä¼¼ï¼Œéƒ½æ˜¯åŽ»æ‰§è¡ŒæŸäº›æ“ä½œã€‚ä½†æ˜¯ï¼Œhandleråªæœ‰åœ¨è¢«notifyè§¦å‘ä»¥åŽæ‰ä¼šæ‰§è¡Œï¼Œå¦‚æžœæ²¡æœ‰è¢«è§¦å‘ï¼Œåˆ™ä¸ä¼šæ‰§è¡Œã€‚ 12345678910111213141516---- hosts: env2 remote_user: root tasks: - name: Modify the Nginx configuration replace: path=/etc/nginx/nginx.conf regexp="listen(.*) 80 (.*)" replace="listen\1 8088 \2" backup=yes notify: restart nginx - name: Modify the MySQL configuration replace: path=/etc/my.cnf regexp="\b3306\b" replace="6033" backup=yes notify: restart mysql handlers: - name: restart nginx service: name=nginx state=restarted - name: restart mysql service: name=mysqld state=restarted åœ¨ä½¿ç”¨Handlerçš„è¿‡ç¨‹ä¸­ï¼Œæœ‰ä»¥ä¸‹å‡ ç‚¹éœ€è¦é¢å¤–æ³¨æ„ï¼š Handleråªæœ‰åœ¨å…¶æ‰€åœ¨çš„ä»»åŠ¡è¢«æ‰§è¡Œæ—¶ï¼Œæ‰ä¼šè¢«è¿è¡Œï¼›å¦‚æžœä¸€ä¸ªä»»åŠ¡ä¸­å®šä¹‰äº†notifyåŽ»è°ƒç”¨Handlerï¼Œä½†æ˜¯ç”±äºŽæ¡ä»¶åˆ¤æ–­ç­‰åŽŸå› ï¼Œè¯¥ä»»åŠ¡æœªè¢«æ‰§è¡Œï¼Œé‚£ä¹ˆHandleråŒæ ·ä¸ä¼šè¢«æ‰§è¡Œã€‚ Handleråªä¼šåœ¨Playçš„æœ«å°¾è¿è¡Œä¸€æ¬¡ï¼›å¦‚æžœæƒ³åœ¨ä¸€ä¸ªPlaybookçš„ä¸­é—´è¿è¡ŒHandlerï¼Œåˆšéœ€è¦ä½¿ç”¨metaæ¨¡å—æ¥å®žçŽ°ï¼Œä¾‹å¦‚ï¼š 1- meta: flush_handlers å¦‚æžœä¸€ä¸ªPlayåœ¨è¿è¡Œåˆ°è°ƒç”¨Handlerçš„è¯­å¥ä¹‹å‰å¤±è´¥äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªHandlerå°†ä¸ä¼šè¢«æ‰§è¡Œã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨megaæ¨¡å—çš„â€”force-handlersé€‰é¡¹æ¥å¼ºåˆ¶æ‰§è¡ŒHandlerï¼Œå³ä½¿æ˜¯Handleræ‰€åœ¨çš„Playä¸­é€”è¿è¡Œå¤±è´¥ã€‚ æ ‡ç­¾tagså¯ä»¥å¯¹ä»»åŠ¡è¿›è¡Œæ‰“æ ‡ç­¾çš„æ“ä½œï¼Œå½“ä»»åŠ¡å­˜åœ¨æ ‡ç­¾ä»¥åŽï¼Œå°±å¯ä»¥åœ¨æ‰§è¡Œplaybookæ—¶ï¼Œå€ŸåŠ©æ ‡ç­¾ï¼ŒæŒ‡å®šæ‰§è¡Œå“ªäº›ä»»åŠ¡ï¼Œæˆ–è€…æŒ‡å®šä¸æ‰§è¡Œå“ªäº›ä»»åŠ¡ã€‚ 12345678910111213141516171819---- name: Install ntp yum: name=ntp state=present tags: ntp- name: Configure ntp file template: src=ntp.conf.j2 dest=/etc/ntp.conf tags: ntp notify: restart ntp- name: Start the ntp service service: name=ntpd state=started enabled=yes # å¤šä¸ªæ ‡ç­¾ tags: ntp,service- name: test to see if selinux is running command: getenforce register: sestatus changed_when: false æ‰§è¡ŒåŒ…æ‹¬ntpæ ‡ç­¾çš„ä»»åŠ¡ï¼š 12&gt; ansible-playbook --tags ntp ntp.yml&gt; ansible-playbook --tags ntp,service ntp.yml ä¸æ‰§è¡ŒåŒ…æ‹¬ntpæ ‡ç­¾çš„ä»»åŠ¡ï¼š 1&gt; ansible-playbook --skip-tags ntp.yml ç‰¹æ®Šæ ‡ç­¾ alwaysï¼ˆyamlæ–‡ä»¶ä¸­ä½¿ç”¨ï¼‰ â€” å½“ä»»åŠ¡çš„tagså€¼æŒ‡å®šä¸ºalwaysæ—¶ï¼Œè¿™ä¸ªä»»åŠ¡æ€»æ˜¯ä¼šè¢«æ‰§è¡Œï¼Œé™¤éžä½¿ç”¨--skip-tagsæ˜Žç¡®æŒ‡å®šä¸æ‰§è¡Œå¯¹åº”çš„ä»»åŠ¡ never ï¼ˆyamlæ–‡ä»¶ä¸­ä½¿ç”¨ï¼‰â€” ä¸Žalwaysä½œç”¨ç›¸å taggedï¼ˆansible-playbookå‘½ä»¤ä½¿ç”¨ï¼‰â€” ä»…æ‰§è¡Œï¼ˆæˆ–è·³è¿‡ï¼‰æœ‰æ ‡ç­¾çš„ä»»åŠ¡ untaggedï¼ˆansible-playbookå‘½ä»¤ä½¿ç”¨ï¼‰â€” ä»…æ‰§è¡Œï¼ˆæˆ–è·³è¿‡ï¼‰æ²¡æœ‰æ ‡ç­¾çš„ä»»åŠ¡ allï¼ˆansible-playbookå‘½ä»¤ä½¿ç”¨ï¼‰â€” é»˜è®¤ä½¿ç”¨ï¼Œæ‰€æœ‰ä»»åŠ¡éƒ½ä¼šè¢«æ‰§è¡Œ å˜é‡ç”¨æˆ·è‡ªå®šä¹‰å˜é‡ å®šä¹‰å˜é‡ 1234---- hosts: env2 vars: login_port: 3306 æ”¾å…¥å•ç‹¬çš„æ–‡ä»¶ä¸­ 1234---- hosts: env2 vars: - vars/server_vars.yml Factså˜é‡ç›´æŽ¥ä½¿ç”¨ã€‚ 1&gt; ansible env2 -m setup å…³é—­Factsï¼š 123---- hosts: env2 gather_facts: no æ³¨å†Œå˜é‡æŠŠä»»åŠ¡æ‰§è¡Œç»“æžœå½“åšä¸€ä¸ªå˜é‡çš„å€¼ã€‚ 1234- name: Test database connection shell: mysql -P&#123;&#123; mysql_port &#125;&#125; -u&#123;&#123; mysql_root_user &#125;&#125; -p&#123;&#123; mysql_root_pass &#125;&#125; -e "use mysql;" register: mysql_connect_result ignore_errors: True å‘½ä»¤è¡Œå˜é‡æ‰§è¡Œæ—¶ä¼ å…¥çš„é¢å¤–å˜é‡ã€‚ 12345&gt; ansible-playbook test.yml --extra-vars "login_port=3306"# Jsonæ ¼å¼&gt; ansible-playbook test.yml --extra-vars "&#123;'login_port': '3306'&#125;"# Jsonæ–‡ä»¶&gt; ansible-playbook test.yml --extra-vars "@vars.json" å˜é‡ä¼˜å…ˆçº§ç”±ä½Žåˆ°é«˜ï¼š role defaults inventory file or script group vars inventory group_vars playbook group_vars inventory group_vars playbook group_vars inventory file or script host vars inventory host_vars playbook host_vars host facts / cached set_facts play vars play vars_prompt play vars_files role vars (defined in role/vars/main.yml) block vars (only for tasks in block) task vars (only for the task) include_vars set_facts / registered vars role (and include_role) params include params extra vars (always win precedence) role defaults åœ¨roles/x/defaults/main.ymlæ–‡ä»¶ä¸­å®šä¹‰çš„å˜é‡ã€‚ 123---# file roles/mysql/defaults/main.ymlmysql_port: 3306 inventory vars åœ¨inventoryæ–‡ä»¶ä¸­å®šä¹‰çš„å˜é‡ã€‚ 123# file: /etc/ansible/hosts[mysql]192.168.198.22 mysql_port=3306 ntp_server=192.168.198.21 role=master inventory group_vars æœ‰ä¸¤ä¸ªåœ°æ–¹å¯ä»¥å®šä¹‰group_varsï¼š inventoryæ–‡ä»¶ä¸­ç›´æŽ¥å®šä¹‰ã€‚ inventoryæ–‡ä»¶åŒçº§çš„å­æ–‡ä»¶å¤¹group_varsä¸‹å®šä¹‰ï¼Œæ”¾åœ¨groupåŒåçš„æ–‡ä»¶ä¸­ã€‚ 1234567# inventoryæ–‡ä»¶ä¸­ç›´æŽ¥å®šä¹‰[all:vars]ntp_server=192.168.198.21# inventoryæ–‡ä»¶åŒçº§çš„å­æ–‡ä»¶å¤¹group_varsä¸‹å®šä¹‰---ntp_server=192.168.198.21 å¾ªçŽ¯æ ‡å‡†å¾ªçŽ¯å¯ä»¥ç†è§£ä¸ºPythonä¸­çš„åˆ—è¡¨å¾ªçŽ¯ï¼Œä¹Ÿç­‰åŒäºŽæ—§ç‰ˆæœ¬çš„with_listã€‚ itemsä¸­å…ƒç´ ä¸ºå­—ç¬¦ä¸²ç”¨æ³• 1234567891011121314151617181920# loopç”¨æ³•---- hosts: env2 remote_user: root gather_facts: no tasks: - debug: msg: "&#123;&#123; item &#125;&#125;" loop: [1, 2, 3]# æ—§ç‰ˆæœ¬---- hosts: env2 remote_user: root gather_facts: no tasks: - debug: msg: "&#123;&#123; item &#125;&#125;" with_list: [1, 2, 3] 123# æ•ˆæžœç­‰åŒäºŽPythonä¸­çš„listå¾ªçŽ¯for i in [1, 2, 3]: print(i) è¾“å‡ºç»“æžœä¸ºï¼š 123456789ok: [env2] =&gt; (item=1) =&gt; &#123; &quot;msg&quot;: 1&#125;ok: [env2] =&gt; (item=2) =&gt; &#123; &quot;msg&quot;: 2&#125;ok: [env2] =&gt; (item=3) =&gt; &#123; &quot;msg&quot;: 3&#125; itemsä¸­å…ƒç´ ä¸ºå­—å…¸ç”¨æ³•ï¼š 1234567891011---- hosts: env2 gather_facts: False tasks: - name: yum install package yum: name=&#123;&#123; item.name &#125;&#125; state=&#123;&#123; item.state &#125;&#125; loop: - &#123;name: "tree", state: "latest"&#125; - &#123;name: "openssh-clients", state: "present"&#125; - &#123;name: "vim", state: "latest" &#125; - &#123;name: "mysql", state: "present" &#125; 12345# åŒæ ·ç›¸å½“äºŽPythonä¸­çš„listå¾ªçŽ¯items = [&#123;'name': 'tree', 'state': 'latest'&#125;, &#123;'name': 'vim', 'state': 'present'&#125;]for item in items: name = item['name'] state = item['state'] 1234567891011# æµ‹è¯•---- hosts: env2 remote_user: root gather_facts: no tasks: - debug: msg: "&#123;&#123; item.key &#125;&#125;, &#123;&#123; item.value &#125;&#125;" loop: - &#123;key: 1, value: 2&#125; - &#123;key: 3, value: 4&#125; è¾“å‡ºç»“æžœä¸ºï¼š 123456ok: [env2] =&gt; (item=&#123;u&apos;key&apos;: 1, u&apos;value&apos;: 2&#125;) =&gt; &#123; &quot;msg&quot;: &quot;1, 2&quot;&#125;ok: [env2] =&gt; (item=&#123;u&apos;key&apos;: 3, u&apos;value&apos;: 4&#125;) =&gt; &#123; &quot;msg&quot;: &quot;3, 4&quot;&#125; åµŒå¥—å¾ªçŽ¯å¯ä»¥ç†è§£ä¸ºPythonä¸­product(it1, â€¦ , iteN, repeat=1)ï¼Œç­‰åŒäºŽæ—§ç‰ˆæœ¬çš„with_nested/with_cartesianã€‚ 12345678910111213141516171819202122232425262728# productç”¨æ³•---- hosts: env2 gather_facts: no vars: list_one: - 1 - 2 - 3 list_two: - a - b - c tasks: - debug: msg: "&#123;&#123; item &#125;&#125;" loop: "&#123;&#123; list_one |product(list_two)|list &#125;&#125;" # æ—§ç‰ˆæœ¬---- hosts: env2 gather_facts: no tasks: - debug: msg: "&#123;&#123; item &#125;&#125;" with_cartesian: - [1, 2, 3] - ['a', 'b', 'c'] 12345678910111213141516# æ•ˆæžœç­‰åŒäºŽPythonä¸­çš„productï¼Œè®¡ç®—ç¬›å¡å°”ç§¯ï¼Œä»Žè¾“å…¥çš„å„ä¸ªå¯è¿­ä»£å¯¹è±¡ä¸­èŽ·å–å…ƒç´ ï¼Œåˆå¹¶æˆç”±Nä¸ªå…ƒç´ ç»„æˆçš„å…ƒç»„from itertools import productlist_one = [1, 2, 3]list_two = ['a', 'b', 'c']for i in product(list_one, list_two): print(i)# æ›´ç›´ç™½çš„æ–¹å¼ï¼Œä½¿ç”¨åˆ—è¡¨æŽ¨å¯¼æ¥è®¡ç®—ç¬›å¡å°”ç§¯list_one = [1, 2, 3]list_two = ['a', 'b', 'c']items = [(x, y) for x in list_one for y in list_two]for i in product(list_one, list_two): print(i) å¹¶è¡Œå¾ªçŽ¯å¯ä»¥ç†è§£ä¸ºPythonä¸­çš„zip(it1, â€¦, itN)ã€zip_longest(it1, â€¦, itN, fillvalue=None)ï¼Œç­‰åŒäºŽæ—§ç‰ˆæœ¬çš„with_togetherã€‚ with_togetherä»…ç­‰åŒäºŽzip_longestç”¨æ³•ï¼Œä¸€ä¸‹ä¼šä¸¾ä¾‹è¯´æ˜Žã€‚ zipç”¨æ³•ï¼š 123456789101112# zipç”¨æ³•ï¼Œæ—§ç‰ˆæœ¬æ²¡æœ‰æ­¤å¯¹åº”ç”¨æ³•---- hosts: env2 gather_facts: no vars: list_one: [1, 2, 3, 4, 5] list_two: [a, b, c] list_three: [x, y, z, d] tasks: - debug: msg: "&#123;&#123; item &#125;&#125;" loop: "&#123;&#123; list_one|zip(list_two, list_three)|list &#125;&#125;" è¾“å‡ºç»“æžœä¸ºï¼šï¼ˆæ³¨æ„list_oneä¸­çš„4ã€5ä¸Žlist_threeä¸­çš„déƒ½æ²¡æœ‰è¾“å‡ºï¼‰ 123456789101112131415161718192021ok: [env2] =&gt; (item=[1, u&apos;a&apos;, u&apos;x&apos;]) =&gt; &#123; &quot;msg&quot;: [ 1, &quot;a&quot;, &quot;x&quot; ]&#125;ok: [env2] =&gt; (item=[2, u&apos;b&apos;, u&apos;y&apos;]) =&gt; &#123; &quot;msg&quot;: [ 2, &quot;b&quot;, &quot;y&quot; ]&#125;ok: [env2] =&gt; (item=[3, u&apos;c&apos;, u&apos;z&apos;]) =&gt; &#123; &quot;msg&quot;: [ 3, &quot;c&quot;, &quot;z&quot; ]&#125; 1234567# æ•ˆæžœç­‰åŒäºŽPythonä¸­çš„zipï¼Œå¹¶è¡Œä»Žè¾“å…¥çš„å„ä¸ªå¯è¿­ä»£å¯¹è±¡ä¸­èŽ·å–å…ƒç´ ï¼Œäº§ç”Ÿç”±Nä¸ªå…ƒç´ ç»„æˆçš„å…ƒç»„ï¼Œåªè¦æœ‰ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡åˆ°å¤´äº†ï¼Œå°±é»˜é»˜åœæ­¢list_one = [1, 2, 3]list_two = ['a', 'b', 'c', 'd']items = zip(list_one, list_two)for i in zip(list_one, list_two): print(i) zip_longestç”¨æ³•ï¼š 123456789101112131415161718192021222324# zip_longestç”¨æ³•---- hosts: env2 gather_facts: no vars: list_one: [1, 2, 3, 4, 5] list_two: [a, b, c, d] list_three: [x, y, z] tasks: - debug: msg: "&#123;&#123; item &#125;&#125;" loop: "&#123;&#123; list_one|zip_longest(list_two, list_three)|list &#125;&#125;" # æ—§ç‰ˆæœ¬---- hosts: env2 gather_facts: no tasks: - debug: msg: "&#123;&#123; item &#125;&#125;" with_together: - [1, 2, 3, 4, 5] - [a, b, c, d] - [x, y, z] è¾“å‡ºç»“æžœä¸ºï¼šï¼ˆæ³¨æ„list_oneä¸­çš„4ã€5ä¸Žlist_threeä¸­çš„déƒ½è¢«è¾“å‡ºï¼‰ 1234567891011121314151617181920212223242526272829303132333435ok: [env2] =&gt; (item=[1, u&apos;a&apos;, u&apos;x&apos;]) =&gt; &#123; &quot;msg&quot;: [ 1, &quot;a&quot;, &quot;x&quot; ]&#125;ok: [env2] =&gt; (item=[2, u&apos;b&apos;, u&apos;y&apos;]) =&gt; &#123; &quot;msg&quot;: [ 2, &quot;b&quot;, &quot;y&quot; ]&#125;ok: [env2] =&gt; (item=[3, u&apos;c&apos;, u&apos;z&apos;]) =&gt; &#123; &quot;msg&quot;: [ 3, &quot;c&quot;, &quot;z&quot; ]&#125;ok: [env2] =&gt; (item=[4, u&apos;d&apos;, None]) =&gt; &#123; &quot;msg&quot;: [ 4, &quot;d&quot;, null ]&#125;ok: [env2] =&gt; (item=[5, None, None]) =&gt; &#123; &quot;msg&quot;: [ 5, null, null ]&#125; 123456789# æ•ˆæžœç­‰åŒäºŽPythonä¸­çš„zip_longestï¼Œå¹¶è¡Œä»Žè¾“å…¥çš„å„ä¸ªå¯è¿­ä»£å¯¹è±¡ä¸­èŽ·å–å…ƒç´ ï¼Œäº§ç”Ÿç”±Nä¸ªå…ƒç´ ç»„æˆçš„å…ƒç»„ï¼Œç­‰åˆ°æœ€é•¿çš„å¯è¿­ä»£å¯¹è±¡åˆ°å¤´åŽæ‰åœæ­¢ï¼Œç©ºç¼ºçš„å€¼ä½¿ç”¨fillvalueå¡«å……ï¼ˆé»˜è®¤ä¸ºNoneï¼‰from itertools import zip_longestlist_one = [1, 2, 3]list_two = ['a', 'b', 'c', 'd']items = zip(list_one, list_two)for i in zip_longest(list_one, list_two): print(i) å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨fillvalueä¿®æ”¹é»˜è®¤å€¼ 1234567891011---- hosts: env2 gather_facts: no vars: list_one: [1, 2, 3, 4, 5] list_two: [a, b, c, d] list_three: [x, y, z] tasks: - debug: msg: "&#123;&#123; item &#125;&#125;" loop: "&#123;&#123; list_one|zip_longest(list_two, list_three, fillvalue='ä¸çŸ¥é“')|list &#125;&#125;" æ­¤æ—¶è¾“å‡ºç»“æžœä¸­é»˜è®¤å€¼ä¸åœ¨æ˜¯nulläº†ï¼š 1234567891011121314ok: [env2] =&gt; (item=[4, u&apos;d&apos;, u&apos;\u4e0d\u77e5\u9053&apos;]) =&gt; &#123; &quot;msg&quot;: [ 4, &quot;d&quot;, &quot;ä¸çŸ¥é“&quot; ]&#125;ok: [env2] =&gt; (item=[5, u&apos;\u4e0d\u77e5\u9053&apos;, u&apos;\u4e0d\u77e5\u9053&apos;]) =&gt; &#123; &quot;msg&quot;: [ 5, &quot;ä¸çŸ¥é“&quot;, &quot;ä¸çŸ¥é“&quot; ]&#125; å±•å¼€å¾ªçŽ¯å¯ä»¥ç†è§£ä¸ºPythonä¸­çš„chain(it1, â€¦, itN)ä¸Žnumpy.flattenï¼Œä»…ä»…ç±»ä¼¼è€Œä¸æ˜¯ç”¨chainæˆ–numpy.flattenåŽ»å®žçŽ°çš„ã€‚æ—§ç‰ˆæœ¬ä¸ºwith_flattenedã€with_itemsã€‚ with_itemsç”¨æ³•ï¼š 123456789101112131415161718192021222324# flatten(levels=1)ç”¨æ³•---- hosts: env2 gather_facts: no vars: list_1: - [1, 2, [3, 4]] - [[a, b], [c, d]] tasks: - debug: msg: "&#123;&#123; item &#125;&#125;" loop: "&#123;&#123; list_1|flatten(levels=1) &#125;&#125;"# æ—§ç‰ˆæœ¬---- hosts: env2 remote_user: root gather_facts: no tasks: - debug: msg: "&#123;&#123; item &#125;&#125;" with_items: - [1, 2, [3, 4]] - [[a, b], [c, d]] with_flattenedç”¨æ³•ï¼š 123456789101112131415161718192021222324# flattenç”¨æ³•---- hosts: env2 gather_facts: no vars: list_1: - [1, 2, [3, 4]] - [[a, b], [c, d]] tasks: - debug: msg: "&#123;&#123; item &#125;&#125;" loop: "&#123;&#123; list_1|flatten &#125;&#125;"# æ—§ç‰ˆæœ¬ï¼š---- hosts: env2 remote_user: root gather_facts: no tasks: - debug: msg: "&#123;&#123; item &#125;&#125;" with_flattened: - [1, 2, [3, 4]] - [[a, b], [c, d]] æºç å®žçŽ°ï¼š 1234567891011121314151617181920212223242526272829from collections import MutableSequencedef flatten(mylist, levels=None): ret = [] for element in mylist: if element in (None, 'None', 'null'): # ignore undefined items break elif isinstance(element, MutableSequence): if levels is None: ret.extend(flatten(element)) elif levels &gt;= 1: levels = int(levels) - 1 ret.extend(flatten(element, levels=levels)) else: ret.append(element) else: ret.append(element) return retif __name__ == '__main__': list_1 = [[1, 2, [3, 4]],[['a', 'b'], ['c', 'd']]] for i in flatten(list_1, levels=1): print(i) for i in flatten(list_1): print(i) ç´¢å¼•å¾ªçŽ¯å¯ä»¥ç†è§£ä¸ºPythonä¸­çš„enumerate(sequence, [start=0])ï¼Œæ—§ç‰ˆæœ¬ä¸ºwith_indexed_itemsã€‚ 123456789101112131415161718192021# loop_controlä¸­index_varç”¨æ³•---- hosts: env2 gather_facts: no vars: list_1: [a, b, c] tasks: - debug: msg: "&#123;&#123; index &#125;&#125;-&#123;&#123; item &#125;&#125;" loop: "&#123;&#123; list_1|flatten(levels=1) &#125;&#125;" loop_control: index_var: index# æ—§ç‰ˆæœ¬---- hosts: env2 gather_facts: no tasks: - debug: msg: "&#123;&#123; item.0 &#125;&#125;-&#123;&#123; item.1 &#125;&#125;" with_indexed_items: [a, b, c] è¾“å‡ºç»“æžœä¸ºï¼š 123456789ok: [env2] =&gt; (item=a) =&gt; &#123; &quot;msg&quot;: &quot;0-a&quot;&#125;ok: [env2] =&gt; (item=b) =&gt; &#123; &quot;msg&quot;: &quot;1-b&quot;&#125;ok: [env2] =&gt; (item=c) =&gt; &#123; &quot;msg&quot;: &quot;2-c&quot;&#125; 1234# æ•ˆæžœç­‰åŒäºŽPythonçš„emumeratelist_1 = [a, b, c]for i in enumerate(list_1): print(i) æ•°åˆ—å¾ªçŽ¯å¯ä»¥ç†è§£ä¸ºPythonä¸­çš„range(start, stop[, step])ï¼Œæ—§ç‰ˆæœ¬ä¸ºwith_sequenceã€‚ 1234567891011121314151617# rangeç”¨æ³•ï¼Œä¸ºä»€ä¹ˆå†™4+1ï¼Œå› ä¸ºrange(4)ä¸ä¼šå¾ªçŽ¯åˆ°4---- hosts: env2 gather_facts: no tasks: - debug: msg: "&#123;&#123; 'test_%02x' | format(item) &#125;&#125;" loop: "&#123;&#123; range(0, 4 + 1, 2)|list &#125;&#125;"# æ—§ç‰ˆæœ¬ï¼Œä¸ºä»€ä¹ˆå†™4è¿˜èƒ½å¾ªçŽ¯åˆ°4ï¼Œæºç å¤„ç†è¿‡---- hosts: env2 gather_facts: no tasks: - debug: msg: "&#123;&#123; item &#125;&#125;" with_sequence: start=0 end=4 stride=2 format=test_%02x è¾“å‡ºç»“æžœä¸ºï¼š 123456789ok: [env2] =&gt; (item=test_00) =&gt; &#123; &quot;msg&quot;: &quot;test_00&quot;&#125;ok: [env2] =&gt; (item=test_02) =&gt; &#123; &quot;msg&quot;: &quot;test_02&quot;&#125;ok: [env2] =&gt; (item=test_04) =&gt; &#123; &quot;msg&quot;: &quot;test_04&quot;&#125; 123# æ•ˆæžœç­‰åŒäºŽPythonä¸­çš„rangeä¸Žformatçš„ç»„åˆfor i in range(4): print('test_%02x' % i) æ•£åˆ—å¾ªçŽ¯å¯ä»¥ç†è§£ä¸ºæŽ¥å—ä¸€ä¸ªPythonç»è¿‡yaml.loadçš„æ ¼å¼å˜é‡ï¼Œé€šè¿‡å­—å…¸æ¥è°ƒå–keyæˆ–valueã€‚æ—§ç‰ˆæœ¬ä¸ºwith_dictsã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041# dictsortç”¨æ³•---- hosts: env2 gather_facts: no vars: users: root: root gaopeng: root ansible: ansible tasks: - debug: msg: "&#123;&#123; item.0 &#125;&#125;-&#123;&#123; item.1 &#125;&#125;" loop: "&#123;&#123; users|dictsort &#125;&#125;"# dict2itemsç”¨æ³•---- hosts: env2 gather_facts: no vars: users: root: root gaopeng: root ansible: ansible tasks: - debug: msg: "&#123;&#123; item.key &#125;&#125;-&#123;&#123; item.value &#125;&#125;" loop: "&#123;&#123; users|dict2items &#125;&#125;"# è€ç‰ˆæœ¬---- hosts: env2 gather_facts: no vars: users: root: root gaopeng: root ansible: ansible tasks: - debug: msg: "&#123;&#123; item.key &#125;&#125;-&#123;&#123; item.value &#125;&#125;" with_dicts: "&#123;&#123; users &#125;&#125;" è¾“å‡ºç»“æžœä¸ºï¼š 123456789ok: [env2] =&gt; (item=[u&apos;ansible&apos;, u&apos;ansible&apos;]) =&gt; &#123; &quot;msg&quot;: &quot;ansible-ansible&quot;&#125;ok: [env2] =&gt; (item=[u&apos;gaopeng&apos;, u&apos;root&apos;]) =&gt; &#123; &quot;msg&quot;: &quot;gaopeng-root&quot;&#125;ok: [env2] =&gt; (item=[u&apos;root&apos;, u&apos;root&apos;]) =&gt; &#123; &quot;msg&quot;: &quot;root-root&quot;&#125; dict2itemsæºç å®žçŽ°ï¼š 123456789101112131415from collections import MutableMappingfrom ansible.errors import AnsibleFilterErrordef dict_to_list_of_dict_key_value_elements(mydict): ''' takes a dictionary and transforms it into a list of dictionaries, with each having a 'key' and 'value' keys that correspond to the keys and values of the original ''' if not isinstance(mydict, MutableMapping): raise AnsibleFilterError("dict2items requires a dictionary, got %s instead." % type(mydict)) ret = [] for key in mydict: ret.append(&#123;'key': key, 'value': mydict[key]&#125;) return ret å­å…ƒç´ å¾ªçŽ¯123456789101112131415161718---- hosts: env2 gather_facts: no vars: hosts: - hostname: env1 user: - root - gaopeng - hostname: env2 user: - gaopeng tasks: - debug: msg: "&#123;&#123; item &#125;&#125;" with_subelements: - "&#123;&#123; hosts &#125;&#125;"y7zxc34v1 - user æ¡ä»¶whenï¼Œç±»ä¼¼äºŽç¼–ç¨‹ä¸­çš„ifã€‚]]></content>
      <categories>
        <category>Ansible</category>
      </categories>
      <tags>
        <tag>Ansible</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ansibleå­¦ä¹ ç¬”è®°-æ¨¡å—]]></title>
    <url>%2F2018%2F07%2F31%2FAnsible%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E6%A8%A1%E5%9D%97%2F</url>
    <content type="text"><![CDATA[Ansibleå¸¸ç”¨æ¨¡å—ç¬”è®°æ¨¡å—å¤§è‡´å¯åˆ†ä¸ºï¼ˆç›®å‰éœ€è¦çš„ï¼Œä»¥åŽç”¨åˆ°å†æ·»åŠ ï¼‰ï¼š æ–‡ä»¶æ¨¡å— å‘½ä»¤æ¨¡å— ç³»ç»Ÿæ¨¡å— å®‰è£…åŒ…ç®¡ç† ç½‘ç»œå·¥å…·æ¨¡å— æ•°æ®åº“æ¨¡å— å­˜å‚¨æ¨¡å— æ¨¡å—åˆ†ç±»å‚è€ƒï¼šAnsibleå®˜æ–¹æ–‡æ¡£ æ¨¡å—çš„æ¼”ç¤ºå‡é‡‡ç”¨Ad-Hocæ¨¡å¼ï¼Œä½¿ç”¨Playbookæ—¶æŒ‰ç…§å›ºå®šæ ¼å¼ä¼ å‚å³å¯ã€‚ å…³äºŽPlaybookå®žä¾‹ç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼Œä¼šåœ¨Playbookç¬”è®°ä¸­æ•´ç†ã€‚ Ansible-doc1234567891011121314151617181920212223Usage: ansible-doc [-l|-F|-s] [options] [-t &lt;plugin type&gt; ] [plugin]Options:# ä»…ä¾›å†…éƒ¨æµ‹è¯•ï¼Œæ˜¾ç¤ºæ‰€æœ‰æ¨¡å—çš„æ–‡æ¡£ -a, --all# å¸®åŠ©ä¿¡æ¯ -h, --help # ä»…ä¾›å†…éƒ¨æµ‹è¯•ï¼Œä»¥jsonæ ¼å¼è¿”å›žæ‰€æœ‰æ¨¡å—ä¿¡æ¯ -j, --json# å¯ç”¨æ¨¡å—åˆ—è¡¨ -l, --list# ä»…æ˜¾ç¤ºæ’ä»¶åå’Œæ¨¡å—è·¯å¾„ -F, --list_files# æŒ‡å®šæ¨¡å—é»˜è®¤è·¯å¾„ -M MODULE_PATH, --module-path=MODULE_PATH# ä»…æ˜¾ç¤ºplaybookç”¨åˆ°çš„è¯´æ˜Ž -s, --snippet# é€‰æ‹©æ’ä»¶ç±»åž‹ï¼Œé»˜è®¤ä¸ºæ¨¡å— -t TYPE, --type=TYPE# è¯¦ç»†ä¿¡æ¯ -v, --verbose# ç‰ˆæœ¬å· --version æ–‡ä»¶ç›¸å…³æ¨¡å—fetchä»Žç›®æ ‡ä¸»æœºä¸Šæ‹‰å–æ–‡ä»¶ã€‚ 1ansible-doc fetch -s å‚æ•° é»˜è®¤ï¼ˆå¯é€‰ï¼‰ è¯´æ˜Ž destï¼ˆå¿…é€‰ï¼‰ æŒ‡å®šå­˜æ”¾æ–‡ä»¶çš„ç›®å½• srcï¼ˆå¿…é€‰ï¼‰ æŒ‡å®šä»ŽæŽ§åˆ¶ä¸»æœºä¸­æ‹‰å–å“ªä¸ªæ–‡ä»¶ï¼Œå¿…é¡»æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼ŒåŽç»­ç‰ˆæœ¬å¯èƒ½ä¼šå¢žåŠ é€’å½’æ‹‰å– fail_on_missing yesï¼ˆnoï¼‰ å¦‚æžœè®¾ç½®ä¸ºyesï¼Œåˆ™å½“æºæ–‡ä»¶ä¸å­˜åœ¨å°±è§†ä¸ºå¤±è´¥ï¼Œå¦‚æžœè®¾ç½®ä¸ºnoï¼Œåˆ™æºæ–‡ä»¶ä¸å­˜åœ¨ä¼šè§†ä¸ºæˆåŠŸ flat é»˜è®¤æ‹‰å–çš„æ–‡ä»¶ä¼šä½¿ç”¨[/ä¸»æœºå/è·¯å¾„/æ–‡ä»¶å]æ¥ä¿å­˜åœ¨æŒ‡å®šçš„ç›®å½•ä¸‹ï¼Œå¦‚æžœè®¾ç½®ä¸ºflat=yesï¼Œåˆ™ä¼šç›´æŽ¥ä½¿ç”¨[æ–‡ä»¶å]ä¿å­˜åœ¨æŒ‡å®šçš„ç›®å½•ä¸‹ï¼Œå¦‚æžœä»Žå¤šä¸ªè¿œç¨‹ä¸»æœºæ‹‰å–ï¼Œä¼šä¸æ–­è¦†ç›– validate_checksum yesï¼ˆnoï¼‰ åœ¨èŽ·å–æ–‡ä»¶ä¹‹åŽè¿›è¡Œmd5æ ¡éªŒ ä¾‹ï¼š æ‹‰å–æ–‡ä»¶ 1234567891011# æ‰§è¡Œå‘½ä»¤&gt; ansible env2 -m fetch -a 'src=/opt/test dest=/opt/'env2 | SUCCESS =&gt; &#123; "changed": true, "checksum": "90c206af0bfefa95541d3e724efe1dbc1ed3877f", # ä¿å­˜çš„è·¯å¾„ï¼šåœ¨æŒ‡å®šçš„/optç›®å½•ä¸‹ä½¿ç”¨[/ä¸»æœºå/è·¯å¾„/æ–‡ä»¶å]æ–¹å¼ä¿å­˜ "dest": "/opt/env2/opt/test", "md5sum": "8b652b8c79f357694a04bd793f533c96", "remote_checksum": "90c206af0bfefa95541d3e724efe1dbc1ed3877f", "remote_md5sum": null&#125; flatä½œç”¨ 123456789101112# æ·»åŠ flat=yeså‚æ•°&gt; ansible env2 -m fetch -a 'src=/opt/test dest=/opt/ flat=yes'# å­˜æ”¾è·¯å¾„å‘ç”Ÿæ”¹å˜env2 | SUCCESS =&gt; &#123; "changed": true, "checksum": "90c206af0bfefa95541d3e724efe1dbc1ed3877f", # ç›´æŽ¥åœ¨/optç›®å½•ä¸‹ä¿å­˜æ–‡ä»¶åï¼Œå¦‚æžœä»Žå¤šä¸ªè¿œç¨‹ä¸»æœºæ‹‰å–ï¼Œä¼šä¸æ–­è¦†ç›– "dest": "/opt/test", "md5sum": "8b652b8c79f357694a04bd793f533c96", "remote_checksum": "90c206af0bfefa95541d3e724efe1dbc1ed3877f", "remote_md5sum": null&#125; fail_on_missingä½œç”¨ 12345678910111213141516# èŽ·å–çš„æ–‡ä»¶ä¸å­˜åœ¨æ—¶æ‰§è¡Œå‘½ä»¤&gt; ansible env2 -m fetch -a 'src=/opt/test_1 dest=/opt/ flat=yes'# æ‰§è¡Œå¤±è´¥env2 | FAILED! =&gt; &#123; "changed": false, "msg": "file not found: /opt/test_1"&#125;# æ·»åŠ fail_on_missing=noå‚æ•°&gt; ansible env2 -m fetch -a 'src=/opt/test_1 dest=/opt/ flat=yes fail_on_missing=no'# æ‰§è¡ŒæˆåŠŸenv2 | SUCCESS =&gt; &#123; "changed": false, "file": "/opt/test_1", "msg": "the remote file does not exist, not transferring, ignored"&#125; copyæ‹·è´æ–‡ä»¶è‡³è¿œç¨‹ä¸»æœºã€‚ 1ansible-doc copy -s å‚æ•° é»˜è®¤ï¼ˆå¯é€‰ï¼‰ è¯´æ˜Ž attributes ä¸ºæ–‡ä»¶æ·»åŠ é¢å¤–å±žæ€§ï¼Œå‚è€ƒchattrå‘½ä»¤ backup noï¼ˆyesï¼‰ å½“è¿œç¨‹ä¸»æœºçš„ç›®æ ‡è·¯å¾„ä¸­å·²å­˜åœ¨åŒåæ–‡ä»¶ï¼Œå¹¶ä¸”ä¸ŽæŽ§åˆ¶ä¸»æœºä¸­çš„æ–‡ä»¶ä¸åŒæ—¶ï¼Œæ˜¯å¦å¯¹è¿œç¨‹ä¸»æœºçš„æ–‡ä»¶è¿›è¡Œå¤‡ä»½ã€‚è®¾ç½®ä¸ºyesæ—¶ï¼Œä¼šå…ˆå¤‡ä»½è¿œç¨‹ä¸»æœºä¸­çš„æ–‡ä»¶ï¼Œç„¶åŽå†å°†æŽ§åˆ¶ä¸»æœºä¸­çš„æ–‡ä»¶æ‹·è´åˆ°è¿œç¨‹ä¸»æœº checksum noï¼ˆyesï¼‰ æ˜¯å¦å¯¹ä¼ è¾“çš„æ–‡ä»¶è¿›è¡Œæ ¡éªŒ content å½“ä¸é€‚ç”¨srcå‚æ•°æŒ‡å®šæ‹·è´æ–‡ä»¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨contentç›´æŽ¥æŒ‡å®šæ–‡ä»¶å†…å®¹ï¼Œsrcå’Œcontentä¸¤ä¸ªå‚æ•°å¿…æœ‰å…¶ä¸€ decrypt yesï¼ˆnoï¼‰ æ˜¯å¦ä½¿ç”¨vaultè‡ªåŠ¨è§£å¯† destï¼ˆå¿…é€‰ï¼‰ æŒ‡å®šæ–‡ä»¶å°†è¢«æ‹·è´åˆ°è¿œç¨‹ä¸»æœºçš„ç›®å½• directory_mode ç³»ç»Ÿé»˜è®¤å€¼ï¼ˆcentos:0755ï¼‰ å½“è¿›è¡Œé€’å½’å¤åˆ¶æ—¶ï¼Œè®¾ç½®ç›®å½•çš„æ¨¡å¼ã€‚ ä»…é’ˆå¯¹åˆ›å»ºç›®å½•æ—¶çš„æ¨¡å¼ï¼Œä¸ä¼šå½±å“å·²å­˜åœ¨çš„ç›®å½• follow noï¼ˆyesï¼‰ æ˜¯å¦éµå¾ªè¿œç¨‹ä¸»æœºçš„é“¾æŽ¥ã€‚å¦‚æžœè®¾ç½®ä¸ºyesï¼Œå¦‚æžœè¿œç¨‹ä¸»æœºçš„ç›®æ ‡è·¯å¾„å­˜åœ¨åŒåçš„è½¯è¿žæŽ¥æ—¶ï¼Œåˆ™ä¼šé€šè¿‡è½¯è¿žæŽ¥è¦†ç›–çœŸå®žçš„æ–‡ä»¶ï¼Œä¿ç•™è¿œç¨‹ä¸»æœºçš„è½¯è¿žæŽ¥ã€‚é»˜è®¤ä¸ºnoï¼Œç›´æŽ¥è¦†ç›–è½¯è¿žæŽ¥ï¼Œæˆä¸ºçœŸå®žçš„æ–‡ä»¶ force yesï¼ˆnoï¼‰ å½“è¿œç¨‹ä¸»æœºçš„ç›®æ ‡è·¯å¾„ä¸­å·²å­˜åœ¨åŒåæ–‡ä»¶ï¼Œæ˜¯å¦å¼ºåˆ¶è¦†ç›–ã€‚è®¾ç½®ä¸ºnoæ—¶ï¼Œä¸ä¼šè¿›è¡Œè¿›è¡Œè¦†ç›–ï¼Œè¿œç¨‹ä¸»æœºçš„åŒåæ–‡ä»¶ä¿æŒä¸å˜ group æŒ‡å®šæ–‡ä»¶æ‹·è´åˆ°è¿œç¨‹ä¸»æœºåŽçš„å±žç»„ local_follow yesï¼ˆnoï¼‰ æ˜¯å¦éµå¾ªæœ¬åœ°æ–‡ä»¶çš„é“¾æŽ¥ mode æŒ‡å®šæ–‡ä»¶æ‹·è´åˆ°è¿œç¨‹ä¸»æœºåŽçš„æƒ³æƒé™å¯ä»¥ä¸º0644æˆ–è€…0775ç­‰å¯ä»¥ä¸ºu+rwï¼Œu=rwç­‰å¯ä»¥ä¸ºpreserveï¼Œè¡¨ç¤ºå’Œæºæ–‡ä»¶çš„æœ‰ç›¸åŒæƒé™ owner æŒ‡å®šæ–‡ä»¶æ‹·è´åˆ°è¿œç¨‹ä¸»æœºåŽçš„å±žä¸» remote_src noï¼ˆyesï¼‰ å¦‚æžœä¸ºnoï¼Œåˆ™åœ¨è¿œç¨‹ä¸»æœºä¸Šæœç´¢srcå¦‚æžœä¸ºyesï¼Œåˆ™åœ¨è¿œç¨‹ä¸»æœºä¸Šç›´æŽ¥è·³è½¬åˆ°srcåªæœ‰åœ¨mode=preserveæ—¶ç”Ÿæ•ˆ selevel s0 å…³äºŽselinuxè®¾ç½®ï¼ˆä¸çŸ¥ï¼‰ serole å…³äºŽselinuxè®¾ç½®ï¼ˆä¸çŸ¥ï¼‰ setype å…³äºŽselinuxè®¾ç½®ï¼ˆä¸çŸ¥ï¼‰ seuser å…³äºŽselinuxè®¾ç½®ï¼ˆä¸çŸ¥ï¼‰ src ç”¨äºŽæŒ‡å®šéœ€è¦æ‹·è´çš„æ–‡ä»¶æˆ–è€…ç›®å½• unsafe_writes ä¸å®‰å…¨å†™å…¥ï¼ˆä¸çŸ¥ï¼‰ validate å¤åˆ¶å‰æ˜¯å¦æ£€éªŒéœ€è¦å¤åˆ¶ç›®çš„åœ°çš„è·¯å¾„ ä¾‹ï¼š å¤åˆ¶æ–‡ä»¶æˆ–ç›®å½• 123456789101112131415161718192021222324252627282930313233# å¤åˆ¶æ–‡ä»¶&gt; ansible env2 -m copy -a 'dest=/opt/ src=/opt/test' env2 | SUCCESS =&gt; &#123; "changed": true, "checksum": "a8fdc205a9f19cc1c7507a60c4f01b13d11d7fd0", "dest": "/opt/test", "gid": 0, "group": "root", "md5sum": "ba1f2511fc30423bdbb183fe33f3dd0f", "mode": "0644", "owner": "root", "size": 4, "src": "/root/.ansible/tmp/ansible-tmp-1533064117.51-270079277825130/source", "state": "file", "uid": 0&#125;# å¤åˆ¶ç›®å½•ï¼Œå¦‚æžœåœ¨ç›®å½•åŽåŠ äº†/åˆ™å¤åˆ¶ç›®å½•ä¸­çš„å…¨éƒ¨æ–‡ä»¶ï¼Œå¦‚æžœä¸åŠ /åˆ™å¤åˆ¶æ•´ä¸ªç›®å½•&gt; ansible env2 -m copy -a 'dest=/opt/ src=/opt/ansible'env2 | SUCCESS =&gt; &#123; "changed": true, "checksum": "a8fdc205a9f19cc1c7507a60c4f01b13d11d7fd0", "dest": "/opt/ansible/test", "gid": 0, "group": "root", "md5sum": "ba1f2511fc30423bdbb183fe33f3dd0f", "mode": "0644", "owner": "root", "size": 4, "src": "/root/.ansible/tmp/ansible-tmp-1533064244.07-151699678500881/source", "state": "file", "uid": 0&#125; contentç”¨æ³• 123456789101112131415# å°†å†…å®¹å†™å…¥æ–‡ä»¶&gt; ansible env2 -m copy -a 'dest=/opt/test content="test\ntest"'env2 | SUCCESS =&gt; &#123; "changed": true, "checksum": "307325bdaf62c0e286f79b3d664ae5bef971b340", "dest": "/opt/test", "gid": 0, "group": "root", "md5sum": "be778b473235e210cc577056226536a4", "mode": "0644", "owner": "root", "size": 9, "src": "/root/.ansible/tmp/ansible-tmp-1533064396.65-112216928591291/source", "state": "file", "uid": 0 directory_modeç”¨æ³• 1234# è®¾ç½®ç›®å½•çš„æƒé™ï¼Œä»…é€‚ç”¨äºŽåœ¨è¿œç¨‹ä¸»æœºåˆ›å»ºç›®å½•çš„æƒ…å†µ&gt; ansible env2 -m copy -a 'dest=/opt/ src=/opt/ansible directory_mode=1644'# æ­¤æ—¶è¿œç¨‹ä¸»æœºçš„ç›®å½•çš„æƒé™å‘ç”Ÿå˜åŒ–drw-r--r-T 2 root root 18 Jul 31 15:25 ansible modeç”¨æ³• 123456789# å°†æ–‡ä»¶æ‹·è´è‡³è¿œç¨‹ä¸»æœºåŽæ”¹å˜æ–‡ä»¶çš„æƒé™&gt; ansible env2 -m copy -a 'dest=/opt/ src=/opt/test mode=0755' # æ­¤æ—¶è¿œç¨‹ä¸»æœºçš„æ–‡ä»¶æƒé™å‘ç”Ÿå˜åŒ–-rwxr-xr-x 1 root root 1 Jul 31 15:38 test# æˆ–è€…é€šè¿‡u+xè¿™ç§æ–¹å¼æ¥æŒ‡å®š&gt; ansible env2 -m copy -a 'dest=/opt/ src=/opt/test mode=u+x'# æ­¤æ—¶è¿œç¨‹ä¸»æœºçš„æ–‡ä»¶æƒé™å‘ç”Ÿå˜åŒ–-rwxr--r-- 1 root root 1 Jul 31 15:39 test attributesç”¨æ³• 12345678# ä¸ºæ–‡ä»¶æƒé™æ·»åŠ idå±žæ€§ï¼Œè¯¦æƒ…æŸ¥é˜…chattræ–‡æ¡£&gt; ansible env2 -m copy -a 'dest=/opt/ src=/opt/test follow=yes attributes=id' # æ­¤æ—¶è¿œç¨‹ä¸»æœºæ–‡ä»¶å±žæ€§æ”¹å˜ï¼ˆlsattrå‘½ä»¤ï¼‰----i-d--------- ./test# ä¸ºæ–‡ä»¶æƒé™å…³é—­idå±žæ€§&gt; ansible env2 -m copy -a 'dest=/opt/ src=/opt/test follow=yes attributes=' # æ­¤æ—¶è¿œç¨‹ä¸»æœºæ–‡ä»¶å±žæ€§å˜ä¸ºç©º---------------- ./test followç”¨æ³• 123456789101112131415# è¿œç¨‹ä¸»æœºä¸Šæœ‰ä¸€ä¸ªtestè½¯è¿žæŽ¥æ–‡ä»¶lrwxrwxrwx 1 root root 14 Jul 31 15:19 test -&gt; ./ansible/test# æ‰§è¡Œå‘½ä»¤è¿›è¡Œæ‹·è´&gt; ansible env2 -m copy -a 'dest=/opt/ src=/opt/test'# æˆåŠŸä¹‹åŽå‘çŽ°è¿œç¨‹ä¸»æœºtestæ–‡ä»¶è½¯è¿žæŽ¥æ²¡äº†ï¼Œè¢«è¦†ç›–æˆçœŸå®žçš„æ–‡ä»¶-rw-r--r-- 1 root root 4 Jul 31 15:20 test# è¿œç¨‹ä¸»æœºä¸Šæœ‰ä¸€ä¸ªtestè½¯è¿žæŽ¥æ–‡ä»¶lrwxrwxrwx 1 root root 12 Jul 31 15:24 test -&gt; ansible/test# æ·»åŠ follow=yeså‚æ•°&gt; ansible env2 -m copy -a 'dest=/opt/ src=/opt/test follow=yes'# è½¯è¿žæŽ¥å­˜åœ¨lrwxrwxrwx 1 root root 12 Jul 31 15:24 test -&gt; ansible/test# çœŸå®žæ–‡ä»¶è¢«è¦†ç›–-rw-r--r-- 1 root root 1 Jul 31 15:25 ansible/test backupç”¨æ³• 1234# è¦†ç›–ä¹‹å‰å¤‡ä»½&gt; ansible env2 -m copy -a 'dest=/opt/ src=/opt/test backup=yes' # æ­¤æ—¶è¿œç¨‹ä¸»æœºå¤šäº†å¤‡ä»½æ–‡ä»¶-rw-r--r-- 1 root root 1 Jul 31 15:25 test.8892.2018-07-31@15:32:56~ ownerã€groupç”¨æ³• 1234# å°†æ–‡ä»¶çš„å±žä¸»ã€å±žç»„å˜ä¸ºå…¶ä»–ç”¨æˆ·&gt; ansible env2 -m copy -a 'dest=/opt/ src=/opt/test owner=gaopeng group=gaopeng'# æ­¤æ—¶è¿œç¨‹ä¸»æœºçš„æ–‡ä»¶çš„å±žä¸»ã€å±žç»„å‘ç”Ÿå˜åŒ–-rw-r--r-- 1 gaopeng gaopeng 1 Jul 31 15:32 test fileå¯¹è¿œç¨‹ä¸»æœºä¸Šçš„æ–‡ä»¶æˆ–ç›®å½•è¿›è¡Œæ“ä½œã€‚åŒ…æ‹¬åˆ›å»ºæ–‡ä»¶æˆ–ç›®å½•ã€åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ã€ä¿®æ”¹æ–‡ä»¶å’Œç›®å½•çš„æƒé™ã€‚ 1ansible-doc file -s å‚æ•° é»˜è®¤ï¼ˆå¯é€‰ï¼‰ è¯´æ˜Ž attributes æ•ˆæžœç­‰åŒäºŽcopyæ¨¡å—ä¸­attributes follow yesï¼ˆnoï¼‰ æ•ˆæžœç­‰åŒäºŽcopyæ¨¡å—ä¸­follow force noï¼ˆyesï¼‰ å½“state=linkï¼Œå¯é…åˆæ­¤å‚æ•°å¼ºåˆ¶åˆ›å»ºé“¾æŽ¥æ–‡ä»¶å½“force=yesæ—¶ï¼Œè¡¨ç¤ºå¼ºåˆ¶åˆ›å»ºé“¾æŽ¥æ–‡ä»¶ï¼Œä¸è¿‡å¼ºåˆ¶åˆ›å»ºé“¾æŽ¥æ–‡ä»¶åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š1. å½“ä½ è¦åˆ›å»ºçš„é“¾æŽ¥æ–‡ä»¶æŒ‡å‘çš„æºæ–‡ä»¶å¹¶ä¸å­˜åœ¨æ—¶ï¼Œä½¿ç”¨æ­¤å‚æ•°ï¼Œå¯ä»¥å…ˆå¼ºåˆ¶åˆ›å»ºå‡ºé“¾æŽ¥æ–‡ä»¶ã€‚2. å½“ä½ è¦åˆ›å»ºçš„é“¾æŽ¥æ–‡ä»¶çš„ç›®å½•ä¸­å·²ç»å­˜åœ¨ä¸Žé“¾æŽ¥æ–‡ä»¶åŒåçš„æ–‡ä»¶æ—¶ï¼Œä¼šå°†åŒåçš„æ–‡ä»¶è¦†ç›–ä¸ºé“¾æŽ¥æ–‡ä»¶ï¼Œç›¸å½“äºŽåˆ é™¤åŒåæ–‡ä»¶ï¼Œåˆ›å»ºé“¾æŽ¥æ–‡ä»¶ã€‚ group æ•ˆæžœç­‰åŒäºŽcopyæ¨¡å—ä¸­group mode æ•ˆæžœç­‰åŒäºŽcopyæ¨¡å—ä¸­mode owner æ•ˆæžœç­‰åŒäºŽcopyæ¨¡å—ä¸­owner pathï¼ˆå¿…é€‰ï¼‰ ç”¨äºŽæŒ‡å®šè¦æ“ä½œçš„æ–‡ä»¶æˆ–ç›®å½• recurse noï¼ˆyesï¼‰ é€’å½’è®¾ç½®ç›®å½•ä¸­æ–‡ä»¶å±žæ€§ï¼Œä»…é€‚ç”¨äºŽç›®å½• selevel å…³äºŽselinuxè®¾ç½®ï¼ˆä¸çŸ¥ï¼‰ serole å…³äºŽselinuxè®¾ç½®ï¼ˆä¸çŸ¥ï¼‰ setype å…³äºŽselinuxè®¾ç½®ï¼ˆä¸çŸ¥ï¼‰ seuser å…³äºŽselinuxè®¾ç½®ï¼ˆä¸çŸ¥ï¼‰ src å½“stateè®¾ç½®ä¸ºlinkæˆ–hardæ—¶ï¼Œè¡¨ç¤ºåˆ›å»ºä¸€ä¸ªè½¯è¿žæŽ¥ã€‚æ‰€ä»¥å¿…é¡»çŸ¥åè½¯é“¾æŽ¥æˆ–è€…ç¡¬é“¾æŽ¥æŒ‡å‘çš„æ–‡ä»¶ï¼Œé€šè¿‡srcå¯ä»¥æŒ‡å®šé“¾æŽ¥æº state fileï¼ˆabsentã€directoryã€hardã€linkã€touchï¼‰ æ­¤å‚æ•°æœ‰å¤šä¸ªå–å€¼ï¼šdirectoryã€fileã€linkã€hardã€touchã€absentdirectoryï¼šå¦‚æžœç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºç›®å½•fileï¼šå³ä½¿æ–‡ä»¶ä¸å­˜åœ¨ä¹Ÿä¸åˆ›å»ºæ–‡ä»¶linkï¼šåˆ›å»ºè½¯é“¾æŽ¥hardï¼šåˆ›å»ºç¡¬é“¾æŽ¥touchï¼šå¦‚æžœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ã€‚å¦‚æžœæ–‡ä»¶å·²å­˜åœ¨ï¼Œæ›´æ–°æœ€åŽè®¿é—®å’Œä¿®æ”¹æ—¶é—´absentï¼šåˆ é™¤ç›®å½•ã€æ–‡ä»¶æˆ–é“¾æŽ¥ unsafe_writes noï¼ˆyesï¼‰ ä¸å®‰å…¨å†™å…¥ï¼ˆä¸çŸ¥ï¼‰ ä¾‹ï¼š åˆ›å»ºæ–‡ä»¶å’Œç›®å½• 123456789101112131415161718192021222324252627# åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚æžœæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™ä¼šæ›´æ–°æ–‡ä»¶çš„æ—¶é—´æˆ³ï¼Œä¸Žtouchå‘½ä»¤ç›¸åŒ&gt; ansible env2 -m file -a 'path=/opt/test state=touch'env2 | SUCCESS =&gt; &#123; "changed": true, "dest": "/opt/test", "gid": 0, "group": "root", "mode": "0744", "owner": "root", "size": 1, "state": "file", "uid": 0&#125;# åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œå¦‚æžœç›®å½•å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸è¿›è¡Œä»»ä½•æ“ä½œ&gt; ansible env2 -m file -a 'path=/opt/ansible state=directory'env2 | SUCCESS =&gt; &#123; "changed": false, "gid": 0, "group": "root", "mode": "01644", "owner": "root", "path": "/opt/ansible", "size": 18, "state": "directory", "uid": 0&#125; åˆ›å»ºä¸€ä¸ªè½¯è¿žæŽ¥ï¼ˆç¡¬é“¾æŽ¥ç±»ä¼¼ï¼‰ 12345678910111213&gt; ansible env2 -m file -a 'path=/opt/test src=/opt/ansible/test state=link force=yes'env2 | SUCCESS =&gt; &#123; "changed": true, "dest": "/opt/test", "gid": 0, "group": "root", "mode": "0777", "owner": "root", "size": 17, "src": "/opt/ansible/test", "state": "link", "uid": 0&#125; modeã€attributesã€ownerã€groupç”¨æ³• 12345678# åˆ›å»ºä¸€ä¸ªæƒé™ä¸º01777ã€å±žä¸»å±žç»„ä¸ºå…¶ä»–ç”¨æˆ·çš„æ–‡ä»¶ã€å¹¶ä¸”å±žæ€§å€¼ä¸ºi&gt; ansible env2 -m file -a 'path=/opt/test state=touch mode=01777 attributes=i owner=gaopeng group=gaopeng'# æ­¤æ—¶æŸ¥çœ‹è¿œç¨‹ä¸»æœºä¸Šçš„æ–‡ä»¶æƒé™åŠå±žæ€§-rwxrwxrwt 1 gaopeng gaopeng 1 Jul 31 17:20 test----i----------- test# æ­¤æ—¶è‹¥æƒ³åœ¨åˆ é™¤æ–‡ä»¶å¿…é¡»æ‰§è¡Œ2ä¸ªæ“ä½œchattr -i testchmod -t test åˆ é™¤æ–‡ä»¶ã€ç›®å½•ã€ç¡¬é“¾æŽ¥æˆ–è½¯è¿žæŽ¥ 1234567# åˆ é™¤æ–‡ä»¶ï¼ˆä¸ç®¡æ˜¯æ–‡ä»¶ã€ç›®å½•è¿˜æ˜¯é“¾æŽ¥éƒ½ä¼šè¢«åˆ é™¤ï¼Œlinuxä¸‹ä¸€åˆ‡çš†æ–‡ä»¶å•Šï¼‰&gt; ansible env2 -m file -a 'path=/opt/test state=absent'env2 | SUCCESS =&gt; &#123; "changed": true, "path": "/opt/test", "state": "absent"&#125; recurseç”¨æ³• 12345# é€’å½’ä¿®æ”¹ç›®ä¸‹çš„æ–‡ä»¶å±žæ€§&gt; ansible env2 -m file -a 'path=/opt/ansible owner=gaopeng group=gaopeng recurse=yes'# æ­¤æ—¶ç›®å½•åŠç›®å½•ä¸‹æ–‡ä»¶çš„å±žæ€§drw-r--r-T 2 gaopeng gaopeng 18 Jul 31 15:25 ansible-rw-r--r-- 1 gaopeng gaopeng 1 Jul 31 15:25 test blockinfileåœ¨æŒ‡å®šçš„æ–‡ä»¶æ’å…¥æ–‡æœ¬ï¼Œè¿™æ®µæ–‡æœ¬æ˜¯è¢«æ ‡è®°è¿‡çš„ï¼Œä»¥ä¾¿ä»¥åŽçš„æ“ä½œä¸­å¯ä»¥é€šè¿‡æ ‡è®°æ¥æ‰¾åˆ°è¿™æ®µæ–‡æœ¬ã€‚ 1ansible-doc blockinfile -s å‚æ•° é»˜è®¤ï¼ˆå¯é€‰ï¼‰ è¯´æ˜Ž attributes åŒcopy backup åŒcopy block æŒ‡å®šæƒ³è¦æ“ä½œçš„æ–‡æœ¬ create å½“è¦æ“ä½œçš„æ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼Œæ˜¯å¦åˆ›å»ºå¯¹åº”çš„æ–‡ä»¶ group åŒcopy insertafter EOFï¼ˆ*regex*ï¼‰ åœ¨æ’å…¥ä¸€æ®µæ–‡æœ¬æ—¶ï¼Œé»˜è®¤ä¼šåœ¨æ–‡ä»¶çš„æœ«å°¾æ’å…¥ã€‚å¦‚æžœä½ æƒ³è¦å°†æ–‡æœ¬åœ¨æŸä¸€è¡Œçš„åŽé¢ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å‚æ•°æŒ‡å®šå¯¹åº”çš„è¡Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼šï¼ˆPython reæ¨¡å—ï¼Œç»ˆäºŽå¯ä»¥ä½¿ç”¨ä¸æ¶ˆè€—åŒ¹é…ç­‰åŠŸèƒ½äº†ï¼‰ï¼Œè¡¨ç¤ºå°†æ–‡æœ¬æ’å…¥åœ¨ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„è¡Œçš„åŽé¢ã€‚å¦‚æžœæœ‰å¤šè¡Œæ–‡æœ¬éƒ½èƒ½å¤ŸåŒ¹é…å¯¹åº”çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œåˆ™ä»¥æœ€åŽä¸€ä¸ªæ»¡è¶³æ­£åˆ™çš„è¡Œä¸ºå‡†EOFï¼šæ’å…¥æ–‡ä»¶æœ«å°¾ insertbefore ï¼ˆBOFï¼Œ*regex*ï¼‰ ç±»ä¼¼äºŽinsertafterï¼Œåªæ˜¯æ’å…¥æŒ‡å®šè¡Œå‰BOFï¼šæ’å…¥æ–‡æœ¬å¼€å¤´ä¸æŒ‡å®šinsertbeforeå‚æ•°ä¼šé»˜è®¤ä½¿ç”¨insertafter=EOF marker {mark} ANSIBLE MANAGED BLOCK è‡ªå®šä¹‰æ ‡è®°é»˜è®¤æƒ…å†µæˆ‘ä»¬æ’å…¥ä¸€æ®µæ–‡æœ¬ï¼ŒAnsibleä¼šè‡ªåŠ¨ä¸ºè¿™æ®µæ–‡æœ¬æ·»åŠ ä¸¤ä¸ªæ ‡è®°ï¼šï¼ˆ# BEGIN ANSIBLE MANAGED BLOCK # END ANSIBLE MANAGED BLOCK ï¼‰å¯ä»¥ä½¿ç”¨markerå‚æ•°è‡ªå®šä¹‰æ ‡è®°ï¼Œä½¿ç”¨{mark}ä¼šæ›¿æ¢æˆå¼€å§‹æ ‡è®°å’Œç»“æŸæ ‡è®° marker_begin BEGIN ç”¨äºŽè®¾ç½®{mark}å¼€å§‹å­—ç¬¦ä¸² marker_end END ç”¨äºŽè®¾ç½®{mark}ç»“æŸå­—ç¬¦ä¸² mode åŒcopy owner åŒcopy path æŒ‡å®šè¦æ“ä½œçš„æ–‡ä»¶ selevel s0 å…³äºŽselinuxè®¾ç½®ï¼ˆä¸çŸ¥ï¼‰ serole å…³äºŽselinuxè®¾ç½®ï¼ˆä¸çŸ¥ï¼‰ setype å…³äºŽselinuxè®¾ç½®ï¼ˆä¸çŸ¥ï¼‰ seuser å…³äºŽselinuxè®¾ç½®ï¼ˆä¸çŸ¥ï¼‰ state presentï¼ˆabsentï¼‰ presentï¼šé»˜è®¤æƒ…å†µä¸‹ï¼ŒæŒ‡å®šä¸€æ®µæ–‡æœ¬æ’å…¥åˆ°æ–‡ä»¶ä¸­æ—¶ï¼Œå¦‚æžœå¯¹åº”çš„æ–‡ä»¶å·²ç»å­˜åœ¨å¯¹åº”çš„æ ‡è®°çš„æ–‡æœ¬ï¼Œä¼šæ›´æ–°å¯¹åº”æ®µè½absentï¼šåˆ é™¤å¯¹åº”æ ‡è®°ä¸Žæ ‡è®°ä¸­çš„æ®µè½ validate æ“ä½œå‰æ˜¯å¦æ£€éªŒéœ€è¦å¤åˆ¶ç›®çš„åœ°çš„è·¯å¾„ ä¾‹ï¼š markerã€marker_beginã€marker_endç”¨æ³• 12345678910111213# æ·»åŠ ä¸€æ®µæ–‡æœ¬è‡³æ–‡ä»¶æœ«å°¾ï¼Œæ ‡è®°ä¸ºservice to startï¼Œå¹¶ä¿®æ”¹&#123;mark&#125;å¼€å§‹ç»“æŸçš„æ ‡è®°å­—ç¬¦ä¸²ä¸ºBegin,End&gt; ansible env2 -m blockinfile -a 'path=/opt/rc.local block="systemctl start httpd" marker="#&#123;mark&#125; service to start" marker_begin="Begin" marker_end="End"'env2 | SUCCESS =&gt; &#123; "changed": true, "msg": "Block inserted"&#125;# æŸ¥çœ‹/opt/rc.localæ–‡ä»¶æœ«å°¾&gt; tail -3 /opt/rc.local#Begin service to startsystemctl start httpd#End service to start æ›¿æ¢æ ‡è®°ä¸­æ–‡æœ¬ 12345678# é»˜è®¤æƒ…å†µä¸‹state=presentï¼Œå³ä¸ºæ›¿æ¢ï¼ŒæŒ‡å®šå¯¹åº”çš„æ ‡è®°å³å¯&gt; ansible env2 -m blockinfile -a 'path=/opt/rc.local block="systemctl start mysqld" marker="#&#123;mark&#125; service to start" marker_begin="Begin" marker_end="End"' # åœ¨è¿œç¨‹ä¸»æœºä¸ŠæŸ¥çœ‹æ–‡ä»¶&gt; tail -3 /opt/rc.local #Begin service to startsystemctl start mysqld#End service to start åˆ é™¤æ ‡è®°æ–‡æœ¬ 12# å°†stateè®¾ç½®ä¸ºabsentï¼Œå¹¶æŒ‡å®šå¯¹åº”çš„æ ‡è®°&gt; ansible env2 -m blockinfile -a 'path=/opt/rc.local block="systemctl start mysqld" marker="#&#123;mark&#125; service to start" marker_begin="Begin" marker_end="End" state=absent' insertafterã€insertbeforeç”¨æ³• 1234567# æ’å…¥åˆ°è¡Œé¦–&gt; ansible env2 -m blockinfile -a 'path=/opt/rc.local block="systemctl start mysqld" marker="#&#123;mark&#125; service to start" marker_begin="Begin" marker_end="End" insertbefore=BOF'# æŸ¥çœ‹è¿œç¨‹ä¸»æœºæ–‡ä»¶&gt; head -3 /opt/rc.local#Begin service to startsystemctl start mysqld#End service to start lineinfileå¯¹æ–‡ä»¶ä¸­çš„æŸä¸€è¡Œè¿›è¡Œæ“ä½œã€‚å¯ä»¥ç¡®ä¿æŸä¸€è¡Œæ˜¯å¦å­˜åœ¨ï¼Œå¯ä»¥æ’å…¥æˆ–åˆ é™¤æŸä¸€è¡Œï¼Œä¹Ÿå¯ä»¥å¯¹æ–‡æœ¬è¿›è¡Œæ›¿æ¢ã€‚ 1ansible-doc lineinfile -s å‚æ•° é»˜è®¤ï¼ˆå¯é€‰ï¼‰ è¯´æ˜Ž attributes åŒcopy backrefs noï¼ˆyesï¼‰ é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æ ¹æ®æ­£åˆ™æ›¿æ¢æ–‡æœ¬æ—¶ï¼Œå³ä½¿regexpå‚æ•°ä¸­çš„æ­£åˆ™å­˜åœ¨åˆ†ç»„ï¼Œåœ¨lineå‚æ•°ä¸­ä¹Ÿä¸èƒ½å¯¹æ­£åˆ™ä¸­çš„åˆ†ç»„è¿›è¡Œå¼•ç”¨ï¼Œé™¤éžå°†backrefså‚æ•°è®¾ç½®ä¸ºyesbackrefs=yesè¡¨ç¤ºå¼€å¯å‘åŽå¼•ç”¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ä½¿ç”¨æ­£åˆ™æ›¿æ¢å¯¹åº”è¡Œæ—¶ï¼Œå¦‚æžœæ­£åˆ™æ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•çš„è¡Œï¼Œé‚£ä¹ˆlineå¯¹åº”çš„å†…å®¹ä¼šè¢«æ’å…¥åˆ°æ–‡æœ¬æœ«å°¾backerfs=yesæ—¶ï¼Œå¦‚æžœæ­£åˆ™æ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•è¡Œæ—¶ï¼Œåˆ™ä¸ä¼šå¯¹æ–‡ä»¶è¿›è¡Œä»»ä½•æ“ä½œ backup noï¼ˆyesï¼‰ åŒcopy create noï¼ˆyesï¼‰ åŒblockinfile firstmatch noï¼ˆyesï¼‰ é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ä½¿ç”¨insertafteræˆ–è€…insertbeforeæ’å…¥æŒ‡å®šçš„è¡Œæ—¶ä¼šä»¥æœ€åŽä¸€ä¸ªåŒ¹é…ç»“æžœä¸ºå‡†firstmatch=yesæ—¶ä»¥ç¬¬ä¸€ä¸ªåŒ¹é…ä¸ºå‡† group åŒcopy insertafter EOFï¼ˆ*regex*ï¼‰ åŒblockinfile insertbefore ï¼ˆBOFï¼Œregex\ï¼‰ åŒblockinfile line æŒ‡å®šæ–‡æœ¬å†…å®¹ mode åŒcopy others å¯ä»¥æŒ‡å®šfileæ¨¡å—çš„å‚æ•° owner åŒcopy path æŒ‡å®šæ“ä½œçš„æ–‡ä»¶ regexp ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å¯¹åº”çš„è¡Œå½“æ›¿æ¢æ–‡æœ¬æ—¶ï¼Œå¦‚æžœæœ‰å¤šè¡Œéƒ½èƒ½è¢«åŒ¹é…ï¼Œåˆ™åªæœ‰åŒ¹é…çš„æœ€åŽé¢çš„è¡Œæ‰ä¼šè¢«æ›¿æ¢å½“åˆ é™¤æ–‡æœ¬æ—¶ï¼Œå¦‚æžœæœ‰å¤šè¡Œæ–‡æœ¬éƒ½èƒ½è¢«åŒ¹é…ï¼Œè¿™äº›è¡Œéƒ½ä¼šè¢«åˆ é™¤ state presentï¼ˆabsentï¼‰ åŒblockinfile ä¾‹ï¼š åŸºæœ¬ç”¨æ³• 1234567# æ’å…¥è¡Œåˆ°æ–‡æœ¬æœ«å°¾&gt; ansible env2 -m lineinfile -a 'path=/opt/test line="test"'env2 | SUCCESS =&gt; &#123; "backup": "", "changed": true, "msg": "line added"&#125; regexpç”¨æ³• 1234567# ä½¿ç”¨æ­£åˆ™æ›¿æ¢æŒ‡å®šçš„è¡Œ&gt; ansible env2 -m lineinfile -a 'path=/opt/test regexp="^test" line="test_1"'env2 | SUCCESS =&gt; &#123; "backup": "", "changed": true, "msg": "line replaced"&#125; insertafterã€insertbeforeç”¨æ³• 1234567# ä½¿ç”¨æ­£åˆ™æ’å…¥åˆ°ç¬¬ä¸€æ¬¡åŒ¹é…çš„è¡Œå‰&gt; ansible env2 -m lineinfile -a 'path=/opt/test line="test_2" insertbefore="^test"'env2 | SUCCESS =&gt; &#123; "backup": "", "changed": true, "msg": "line added"&#125; backrefsç”¨æ³• 123456789101112131415# å¦‚æžœæ­£åˆ™è¡¨è¾¾å¼æ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•ä¸€è¡Œï¼Œé»˜è®¤ä¼šåœ¨æ–‡æœ¬æœ«å°¾æ·»åŠ è¡Œ&gt; ansible env2 -m lineinfile -a 'path=/opt/test regexp="none" line="test_3"'env2 | SUCCESS =&gt; &#123; "backup": "", "changed": true, "msg": "line added"&#125;# ä½¿ç”¨backrefs=yesæ—¶ï¼Œåˆ™ä¸ä¼šè¿›è¡Œä»»ä½•æ“ä½œ&gt; ansible env2 -m lineinfile -a 'path=/opt/test regexp="none" line="test_4" backrefs=yes'env2 | SUCCESS =&gt; &#123; "backup": "", "changed": false, "msg": ""&#125; backupå‚ç…§copyæ¨¡å—ç”¨ä¾‹ï¼Œcreateã€stateç”¨æ³•å‚è€ƒblockinfileä¸¾ä¾‹ã€‚ replaceæ ¹æ®æŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢æ–‡ä»¶ä¸­çš„å­—ç¬¦ä¸²ï¼Œæ–‡ä»¶ä¸­æ‰€æœ‰è¢«æ­£åˆ™åŒ¹é…çš„å­—ç¬¦ä¸²éƒ½ä¼šè¢«æ›¿æ¢ã€‚ 1ansible-doc replace -s å…³äºŽæ–‡ä»¶å±žæ€§ã€å¤‡ä»½ã€selinuxé€‰é¡¹ç­‰ä¸åœ¨è¯´æ˜Žï¼Œå‚è€ƒcopyã€fileæ¨¡å—å³å¯ã€‚ å‚æ•° é»˜è®¤ï¼ˆå¯é€‰ï¼‰ è¯´æ˜Ž after æŒ‡å®šä»ŽæŸè¡Œä¹‹åŽè¿›è¡ŒåŒ¹é…ï¼Œå¯ä»¥ç»“åˆbeforeå‚æ•°ä½¿ç”¨ before æŒ‡å®šä»ŽæŸè¡Œä¹‹å‰è¿›è¡ŒåŒ¹é…ï¼Œå¯ä»¥ç»“æžœafterå‚æ•°ä½¿ç”¨ encoding utf-8 æŒ‡å®šè¯»å†™æ–‡ä»¶çš„å­—ç¬¦ç¼–ç  pathï¼ˆå¿…é€‰ï¼‰ æŒ‡å®šè¦æ“ä½œçš„æ–‡ä»¶ regexpï¼ˆå¿…é€‰ï¼‰ æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼ï¼ˆpython reæ¨¡å—ï¼‰ replace æŒ‡å®šéœ€è¦æ›¿æ¢æˆçš„å­—ç¬¦ä¸² ä¾‹ï¼š æ­£åˆ™æ›¿æ¢ï¼ˆç»ˆäºŽå¯ä»¥ä½¿ç”¨ä¸æ¶ˆè€—åŒ¹é…ï¼Œä½¿ç”¨grepã€awkæ—¶ä¸èƒ½ä½¿ç”¨(?=)(?&lt;=)æŒºè›‹ç–¼ï¼‰ 12345678910111213141516171819# å°†æ–‡æœ¬ä¸­æ‰€æœ‰testéƒ½å˜æˆTEST&gt; ansible env2 -m replace -a 'path=/opt/test regexp="test" replace="TEST"' "changed": true, "msg": "3 replacements made"&#125;# ä¸æ¶ˆè€—åŒ¹é…ï¼Œæ›¿æ¢https://ä¹‹åŽçš„å†…å®¹&gt; ansible env2 -m replace -a 'path=/opt/test regexp="(?&lt;=https://).*" replace="python.org"'env2 | SUCCESS =&gt; &#123; "changed": true, "msg": "1 replacements made"&#125;# å¼•ç”¨åˆ†ç»„&gt; ansible env2 -m replace -a 'path=/opt/test regexp="(https://).*" replace="\1baidu.com"'env2 | SUCCESS =&gt; &#123; "changed": true, "msg": "1 replacements made"&#125; afterã€beforeç”¨æ³• 123# æŒ‡å®šæŸè¡Œä¹‹åŽä¸ŽæŸè¡Œä¹‹å‰è¿›è¡ŒåŒ¹é…æ›¿æ¢# è¿™é‡Œæœ‰ä¸€ç‚¹æžä¸æ˜Žç™½ï¼Œå•ç‹¬ä½¿ç”¨afterå’Œbeforeæ˜¯ä»Žä¹‹åŽã€ä¹‹å‰è¿›è¡ŒåŒ¹é…ï¼Œå¯ä»¥ç»“åˆä¸€èµ·ä½¿ç”¨å°±å‡ºçŽ°é—®é¢˜äº†ï¼Œ&gt; ansible env2 -m replace -a 'path=/opt/test regexp="a" replace="b" after="start" before="end"' findåœ¨è¿œç¨‹ä¸»æœºä¸­æŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶ï¼Œå’Œfindå‘½ä»¤ç›¸åŒã€‚ 1ansible-doc find -s å‚æ•° é»˜è®¤ï¼ˆå¯é€‰ï¼‰ è¯´æ˜Ž age ä½¿ç”¨æ­¤å‚æ•°å¯ä»¥æ ¹æ®æ—¶é—´èŒƒå›´æŸ¥æ‰¾æ–‡ä»¶ï¼Œé»˜è®¤ä»¥æ–‡ä»¶çš„mtimeä¸ºå‡†ä¸ŽæŒ‡å®šçš„æ—¶é—´å¯¹æ¯”å¯ä»¥ä½¿ç”¨çš„å•ä½æœ‰sï¼ˆç§’ï¼‰ã€mï¼ˆåˆ†é’Ÿï¼‰ã€hï¼ˆå°æ—¶ï¼‰ã€dï¼ˆå¤©ï¼‰ã€wï¼ˆæ˜ŸæœŸï¼‰ä½¿ç”¨-è¡¨ç¤ºå°äºŽæŒ‡å®šçš„æ—¶é—´ age_stamp mtimeï¼ˆatimeã€ctimeï¼‰ æ–‡ä»¶çš„æ—¶é—´å±žæ€§æœ‰ä¸‰ç§ç±»åž‹ï¼šatimeã€ctimeã€mtimeï¼Œå½“æ ¹æ®æ—¶é—´èŒƒå›´æŸ¥æ‰¾æ–‡ä»¶æ—¶ï¼Œå¯ä»¥æŒ‡å®šä»¥å“ªä¸ªæ–‡ä»¶çš„æ—¶é—´ç±»åž‹ä¸ºå‡† contains ä½¿ç”¨æ­¤å‚æ•°å¯ä»¥æ ¹æ®æ–‡ç« å†…å®¹æŸ¥æ‰¾æ–‡ä»¶ï¼Œæ­¤å‚æ•°çš„å€¼ä¸ºä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œfindä¼šæ ¹æ®å¯¹åº”çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ–‡ä»¶å†…å®¹ depth è®¾ç½®ç›®å½•æŸ¥æ‰¾çš„é€’å½’å±‚æ•°ï¼Œé€’å½’æŸ¥æ‰¾åˆ°æŒ‡å®šçš„å±‚æ•°æ—¶å³åœæ­¢æŸ¥æ‰¾é»˜è®¤ä¸ºæ— é™æ·±åº¦ excludes æŒ‡å®šä¸€ç§æˆ–å¤šç§ ï¼ˆshellæˆ–regexï¼‰ æ¨¡å¼ï¼Œæ¨¡å¼ç±»åž‹ç”± use_regexå‚æ•°æŽ§åˆ¶ã€‚å¤šç§æ¨¡å¼ä½¿ç”¨åˆ—è¡¨æŒ‡å®š file_type fileï¼ˆanyã€directoryã€linkï¼‰ æŒ‡å®šæŸ¥æ‰¾æ–‡ä»¶çš„ç±»åž‹ follow noï¼ˆyesï¼‰ å¦‚æžœè®¾ç½®ä¸ºyesï¼Œåˆ™éµå¾ªpython2.6+ç‰ˆæœ¬çš„ç¬¦å·é“¾æŽ¥ get_checksum noï¼ˆyesï¼‰ å½“æœ‰ç¬¦åˆæŸ¥æ‰¾æ¡ä»¶çš„æ–‡ä»¶è¢«æ‰¾åˆ°æ—¶ï¼Œä¼šåŒæ—¶è¿”å›žå¯¹åº”æ–‡ä»¶çš„sha1æ ¡éªŒç ã€‚æ–‡ä»¶è¾ƒå¤§æ—¶ï¼Œè®¡ç®—è¿‡ç¨‹ä¼šè€½è¯¯æ—¶é—´ hidden noï¼ˆuesï¼‰ æ˜¯å¦æŸ¥æ‰¾éšè—æ–‡ä»¶ pathsï¼ˆå¿…é¡»ï¼‰ æŒ‡å®šæŸ¥æ‰¾æ–‡ä»¶çš„ç›®å½•ã€‚å¯ä»¥æŒ‡å®šå¤šä¸ªè·¯å¾„ï¼Œç”¨é€—å·éš”å¼€ patterns * æŒ‡å®šæŸ¥æ‰¾æ–‡ä»¶çš„æ–‡ä»¶åç§°ï¼Œæ”¯æŒä½¿ç”¨shellï¼ˆæ¯”å¦‚é€šé…ç¬¦ï¼‰æˆ–æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ–‡ä»¶åç§°ã€‚é»˜è®¤ä½¿ç”¨shellï¼Œå¦‚æžœæƒ³ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼éœ€è¦è®¾ç½®use_regex=yes recurse noï¼ˆyesï¼‰ é»˜è®¤æƒ…å†µä¸‹ï¼Œåªä¼šåœ¨æŒ‡å®šçš„ç›®å½•ä¸­æŸ¥æ‰¾æ–‡ä»¶ï¼Œansibleå¹¶ä¸ä¼šé€’å½’æŸ¥æ‰¾å¦‚æžœè®¾ç½®ä¸ºyesæ—¶ï¼Œåˆ™è¡¨ç¤ºé€’å½’æŸ¥æ‰¾æŒ‡å®šçš„ç›®å½•ä¸­çš„æ–‡ä»¶å¯é…åˆdepthæŒ‡å®šé€’å½’æŸ¥æ‰¾çš„æ·±åº¦ size ä½¿ç”¨æ­¤å‚æ•°å¯ä»¥æ ¹æ®æ–‡ä»¶å¤§å°æŸ¥æ‰¾æ–‡ä»¶å¯ä½¿ç”¨çš„å•ä½æœ‰ï¼štã€gã€mã€kã€bä½¿ç”¨-è¡¨ç¤ºå°äºŽæŒ‡å®šçš„å¤§å° use_regex noï¼ˆyesï¼‰ å¦‚æžœä¸ºnoï¼Œä½¿ç”¨globé€šé…ç¬¦ï¼ˆshellï¼‰ã€‚å¦‚æžœä¸ºyesï¼Œä½¿ç”¨python regexes ä¾‹ï¼š patternsç”¨æ³• 12345678910# æŸ¥æ‰¾åŒ…å«testçš„æ–‡ä»¶ï¼Œçœç•¥äº†æ–‡ä»¶ä¿¡æ¯&gt; ansible env2 -m find -a 'path=/opt patterns="*test*"'env2 | SUCCESS =&gt; &#123; "changed": false, "examined": 6, ... ... "matched": 2, "msg": ""&#125; containsç”¨æ³• 12# æŸ¥æ‰¾æ–‡ä»¶å†…å®¹åŒ…å«testå­—ç¬¦ä¸²çš„æ–‡ä»¶&gt; ansible env2 -m find -a 'path=/opt contains=".*test.*"' ageã€sizeã€recurseç”¨æ³• 123456789# é€’å½’æŸ¥æ‰¾æ—¶é—´è¶…è¿‡3å¤©çš„æ—¥å¿—æ–‡ä»¶&gt; ansible env2 -m find -a 'paths=/var/log/ age=3d recurse=yes'# é€’å½’æŸ¥æ‰¾æ—¶é—´ä¸è¶…è¿‡5mçš„æ—¥å¿—æ–‡ä»¶&gt; ansible env2 -m find -a 'paths=/var/log/ age=-5m recurse=yes'# é€’å½’æŸ¥æ‰¾è¶…è¿‡1Gçš„æ–‡ä»¶&gt; ansible env2 -m find -a 'paths=/var/ size=1g recurse=yes'# é€’å½’æŸ¥æ‰¾å°äºŽ10mçš„æ–‡ä»¶&gt; ansible env2 -m find -a 'paths=/opt size=-10m recurse=yes' hiddenã€use_regexç”¨æ³• 12# æŸ¥æ‰¾rootç›®å½•ä¸‹éšè—æ–‡ä»¶ansible env2 -m find -a 'paths=/root patterns="^\..*" hidden=yes recurse=yes use_regex=yes' archiveæ‰“åŒ…å­˜æ¡£ç›®å½•æ–‡ä»¶ï¼Œåœ¨å½’æ¡£ä¹‹å‰ï¼Œä¸ä¼šå°†æºæ–‡ä»¶ä»ŽæŽ§åˆ¶ä¸»æœºä¸Šæ‹·è´åˆ°è¿œç¨‹ä¸»æœºä¸Šã€‚ unarchiveå°†æŽ§åˆ¶ä¸»æœºçš„åŽ‹ç¼©åŒ…æ‹·è´åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œç„¶åŽè¿›è¡Œè§£åŽ‹ã€‚ synchronizeå¯¹rsyncå‘½ä»¤çš„å°è£…ã€‚ä¸»è¦ç”¨äºŽåŒæ­¥æœ¬åœ°ç›®å½•è‡³è¿œç¨‹ä¸»æœºã€‚ å‘½ä»¤ç›¸å…³æ¨¡å—commandåœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œå‘½ä»¤ã€‚ï¼ˆä¸æ”¯æŒç®¡é“é‡å®šå‘ç­‰ç¬¦å·ï¼‰ 1ansible-doc command -s å‚æ•° é»˜è®¤ï¼ˆå¯é€‰ï¼‰ è¯´æ˜Ž argv å…è®¸ç”¨æˆ·ä½¿ç”¨å­—ç¬¦ä¸²æˆ–åˆ—è¡¨æ¥æä¾›å‘½ä»¤ï¼ŒåŒæ—¶åªèƒ½ä½¿ç”¨å…¶ä¸­ä¸€ç§ chdir æŒ‡å®šè¿è¡Œå‘½ä»¤çš„ç›®å½•ï¼Œä¼šåœ¨æ‰§è¡Œå‘½ä»¤ä¹‹å‰å…ˆè¿›å…¥æŒ‡å®šçš„ç›®å½•ä¸­ creates åŒ¹é…æ–‡ä»¶ï¼Œå½“æ–‡ä»¶å­˜åœ¨æ—¶å°±ä¸æ‰§è¡Œå¯¹åº”çš„å‘½ä»¤ï¼Œä¸ä¼šåˆ›å»ºæ–‡ä»¶ free_formï¼ˆå¿…é€‰ï¼‰ æŒ‡å®šè¿œç¨‹ä¸»æœºæ‰§è¡Œçš„å‘½ä»¤æ³¨æ„ï¼Œè¿™ä¸ªå‚æ•°ä¸æ˜¯å…³é”®å­—å‚æ•°ï¼Œä¸è¦ä½¿ç”¨free_form=è¿™ç§æ–¹å¼ï¼Œç›´æŽ¥ä½¿ç”¨å‘½ä»¤ removes ä¸Žcreatesç›¸åï¼ŒåŒ¹é…æ–‡ä»¶ï¼Œå½“æ–‡ä»¶ä¸å­˜åœ¨æ—¶å°±ä¸æ‰§è¡Œå¯¹åº”çš„å‘½ä»¤ï¼Œä¸ä¼šåˆ é™¤æ–‡ä»¶ stdin æŒ‡å®šå‘½ä»¤çš„stdinçš„å€¼ warn yesï¼ˆnoï¼‰ é»˜è®¤ä¸ºyesï¼Œå¦‚æžœå‘½ä»¤å‘å‡ºè­¦å‘Šï¼Œåˆ™ç»§ç»­è¿›è¡Œã€‚noåˆ™ç›¸å ä¾‹ï¼š free_formã€chdirç”¨æ³• 12# åœ¨è¿œç¨‹ä¸»æœºä¸Š/optæ‰§è¡Œlså‘½ä»¤&gt; ansible env2 -m command -a 'chdir=/opt ls' createsã€removesç”¨æ³• 123456789# å¦‚æžœæ–‡ä»¶å­˜åœ¨ï¼Œå°±ä¸æ‰§è¡Œå¯¹åº”çš„å‘½ä»¤&gt; ansible env2 -m command -a 'creates=/opt/test ls'env2 | SUCCESS | rc=0 &gt;&gt;skipped, since /opt/test exists# å¦‚æžœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå°±ä¸æ‰§è¡Œå¯¹åº”çš„å‘½ä»¤&gt; ansible env2 -m command -a 'removes=/opt/test_2 ls /opt'env2 | SUCCESS | rc=0 &gt;&gt;skipped, since /opt/test_2 does not exist shellåœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œä¸Žcommandæ¨¡å—ä¸åŒçš„æ˜¯ï¼Œshellæ¨¡å—åœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œå‘½ä»¤æ—¶ï¼Œä¼šç»è¿‡è¿œç¨‹ä¸»æœºä¸Šçš„/bin/shç¨‹åºå¤„ç†ã€‚ï¼ˆæ”¯æŒç®¡é“é‡å®šå‘ç­‰ç¬¦å·ï¼‰ 1ansible-doc shell -s å‚æ•° é»˜è®¤ï¼ˆå¯é€‰ï¼‰ è¯´æ˜Ž chdir åŒcommand creates åŒcommand executable é»˜è®¤æƒ…å†µä¸‹ï¼Œshellæ¨¡å—ä¼šè°ƒç”¨è¿œç¨‹ä¸»æœº/bin/shæ‰§è¡Œå‘½ä»¤ã€‚å¦‚æžœæƒ³è¦ä½¿ç”¨å…¶ä»–ç±»åž‹çš„shellæ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å‚æ•°æŒ‡å®šæŸç§ç±»åž‹çš„shellæ‰§è¡Œå¯¹åº”çš„å‘½ä»¤ã€‚ free_form åŒcommand removes åŒcommand stdin åŒcommand warn yesï¼ˆnoï¼‰ åŒcommand ä¾‹ï¼š ä½¿ç”¨ç®¡é“ã€é‡å®šå‘ 12345# å°†è¾“å‡ºçš„å­—ç¬¦ä¸²é‡å®šå‘è‡³æ–‡ä»¶&gt; ansible env2 -m shell -a 'chdir=/opt/ echo test &gt; test'# ç®¡é“&gt; ansible env2 -m shell -a 'ps -ef | wc -l' scriptåœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡ŒæŽ§åˆ¶ä¸»æœºä¸Šçš„è„šæœ¬ï¼Œè„šæœ¬ä¸€ç›´å­˜åœ¨ä¸ŽæŽ§åˆ¶ä¸»æœºæœ¬åœ°ï¼Œä¸éœ€è¦æ‹·è´åˆ°è¿œç¨‹ä¸»æœºåŽå†æ‰§è¡Œã€‚ 1ansible-doc shell -s å‚æ•° é»˜è®¤ï¼ˆå¯é€‰ï¼‰ è¯´æ˜Ž chdir åŒcommand creates åŒcommand executable åŒshell free_form åŒcommand removes åŒcommand ä¾‹ï¼š ç¼–å†™ä¸€ä¸ªè„šæœ¬ï¼Œåœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œ 12345678910111213141516&gt; ansible env2 -m script -a '/opt/monitor.sh'env2 | SUCCESS =&gt; &#123; "changed": true, "rc": 0, "stderr": "Shared connection to env2 closed.\r\n", "stderr_lines": [ "Shared connection to env2 closed." ], "stdout": "cpuä½¿ç”¨çŽ‡: 56.2 %\r\nå†…å­˜ä½¿ç”¨çŽ‡: 129 M\r\nç£ç›˜ç©ºé—´ä½¿ç”¨é‡: 1.6G\r\nç£ç›˜ç©ºé—´åˆ©ç”¨çŽ‡: 10%\r\n", "stdout_lines": [ "cpuä½¿ç”¨çŽ‡: 56.2 %", "å†…å­˜ä½¿ç”¨çŽ‡: 129 M", "ç£ç›˜ç©ºé—´ä½¿ç”¨é‡: 1.6G", "ç£ç›˜ç©ºé—´åˆ©ç”¨çŽ‡: 10%" ]&#125; ç³»ç»Ÿç›¸å…³æ¨¡å—cronç®¡ç†è¿œç¨‹ä¸»æœºä¸­çš„è®¡åˆ’ä»»åŠ¡ï¼ŒåŠŸèƒ½ç›¸å½“äºŽcrontabå‘½ä»¤ã€‚ linux cronç®€è¦è¯´æ˜Žï¼š 1234567891011121314151617181920# Example of job definition:# .---------------- minute (0 - 59)# | .------------- hour (0 - 23)# | | .---------- day of month (1 - 31)# | | | .------- month (1 - 12) OR jan,feb,mar,apr ...# | | | | .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat# | | | | |# * * * * * user-name command to be executed åˆ† æ—¶ æ—¥ æœˆ å‘¨# @ç‰¹æ®Šæ—¶é—´ user-name command to be executed# ç‰¹æ®Šæ—¶é—´ã€‚è®¾ç½®ç‰¹æ®Šæ—¶é—´åŽï¼Œä¸èƒ½å†è®¾ç½®åˆ«çš„æ—¶é—´@reboot é‡å¯ä¹‹åŽè¿è¡Œ@hourly æ¯å°æ—¶è¿è¡Œ@daily æ¯å¤©è¿è¡Œ@weekly æ¯å‘¨è¿è¡Œ@monthly æ¯æœˆè¿è¡Œ@yearly æ¯å¹´è¿è¡Œ@annually åŒ@yearly@midnight åŒ@daily 1ansible-doc cron -s å‚æ•° é»˜è®¤ï¼ˆå¯é€‰ï¼‰ è¯´æ˜Ž minute * åˆ† hour * æ—¶ day * æ—¥ month * æœˆ weekday * æ˜ŸæœŸ backup noï¼ˆyesï¼‰ ä¿®æ”¹æˆ–åˆ é™¤ä¹‹å‰æ˜¯å¦å…ˆå¯¹è®¡åˆ’ä»»åŠ¡è¿›è¡Œå¤‡ä»½ cron_file å¦‚æžœä½¿ç”¨è¯¥å‚æ•°ï¼Œåˆ™ç”¨è¯¥æ–‡ä»¶æ›¿æ¢è¿œç¨‹ä¸»æœºä¸Šcron.dç›®å½•ä¸‹çš„ç”¨æˆ·è®¡åˆ’ä»»åŠ¡ disabled å½“è®¡åˆ’ä»»åŠ¡æœ‰åç§°æ—¶ï¼Œå¯ä»¥æ ¹æ®åç§°ä½¿å¯¹åº”çš„ä»»åŠ¡å…³é—­ï¼ˆå³æ³¨é‡Šï¼‰ã€‚ä½¿ç”¨æ­¤å‚æ•°æ—¶ï¼Œé™¤äº†éœ€è¦æŒ‡å®šä»»åŠ¡çš„åç§°ï¼Œè¿˜éœ€è¦åŒæ—¶æŒ‡å®šä»»åŠ¡çš„jobä»¥åŠä»»åŠ¡çš„æ—¶é—´è®¾å®šä»»åŠ¡çš„æ—¶é—´è®¾å®šå¿…é¡»å’Œå¯¹åº”ä»»åŠ¡å®Œå…¨ç›¸åŒï¼Œå¦åˆ™åœ¨æ³¨é‡Šä»»åŠ¡çš„åŒæ—¶ï¼Œä»»åŠ¡çš„æ—¶é—´è®¾å®šä¼šè¢«ä¿®æ”¹ job æŒ‡å®šè®¡åˆ’ä»»åŠ¡ä¸­éœ€è¦å®žé™…æ‰§è¡Œçš„å‘½ä»¤æˆ–è„šæœ¬ name æŒ‡å®šè®¡åˆ’ä»»åŠ¡çš„åç§°ï¼ˆå³è®¡åˆ’ä»»åŠ¡ä¸­çš„æ³¨é‡Šè¯´æ˜Žï¼‰ reboot noï¼ˆyesï¼‰ ä¸å»ºè®®ä½¿ç”¨ï¼Œå»ºè®®ä½¿ç”¨special_time special_time ï¼ˆrebootã€yearlyã€annually monthlyã€weeklyã€dailyã€hourlyï¼‰ æŒ‡å®šç‰¹æ®Šæ—¶é—´ï¼Œå‚è€ƒcronç®€è¦è¯´æ˜Ž state presentï¼ˆabsentï¼‰ presentï¼šæ ¹æ®åç§°è¿›è¡Œä¿®æ”¹è®¡åˆ’ä»»åŠ¡absentï¼šæ ¹æ®åç§°è¿›è¡Œåˆ é™¤è®¡åˆ’ä»»åŠ¡ user root æŒ‡å®šæ‰§è¡Œè®¡åˆ’ä»»åŠ¡çš„ç”¨æˆ· ä¾‹ï¼š minuteã€hourã€dayã€monthã€weekdayç”¨æ³• 123456# æ·»åŠ è®¡åˆ’ä»»åŠ¡ï¼Œæ¯ä¸‰å¤©åœ¨å½“å¤©çš„1ç‚¹30åˆ†æ‰§è¡Œä¸€ä¸ªä»»åŠ¡&gt; ansible env2 -m cron -a 'name=test minute=30 hour=1 day=*/3 job="echo test"'# æŸ¥çœ‹è¿œç¨‹ä¸»æœºçš„è®¡åˆ’ä»»åŠ¡&gt; cat /var/spool/cron/root#Ansible: test30 1 */3 * * echo test special_timeç”¨æ³• 123456# æ¯æ¬¡é‡å¯æ‰§è¡Œä¸€ä¸ªä»»åŠ¡&gt; ansible env2 -m cron -a 'name="test special time" special_time=reboot job="echo test"'# æŸ¥çœ‹è¿œç¨‹ä¸»æœºçš„è®¡åˆ’ä»»åŠ¡&gt; cat /var/spool/cron/root#Ansible: test special time@reboot echo test stateç”¨æ³• 12345678# é»˜è®¤ä¸ºpresentï¼Œå½“ä»»åŠ¡test special timeå·²ç»å­˜åœ¨æ—¶ï¼Œä¿®æ”¹è®¡åˆ’ä»»åŠ¡&gt; ansible env2 -m cron -a 'name="test special time" special_time=daily job="echo test"' &gt; cat /var/spool/cron/root#Ansible: test special time@daily echo test# è®¾ç½®ä¸ºabsentæ—¶ï¼Œåˆ é™¤è¯¥è®¡åˆ’ä»»åŠ¡&gt; ansible env2 -m cron -a 'name="test special time" state=absent' userç”¨æ³• 123456# ä½¿ç”¨å…¶ä»–ç”¨æˆ·æ¥æ‰§è¡Œè®¡åˆ’ä»»åŠ¡&gt; ansible env2 -m cron -a 'user=gaopeng name="test special time" special_time=daily job="echo test"'# æŸ¥çœ‹è¿œç¨‹ä¸»æœºçš„è®¡åˆ’ä»»åŠ¡(æ–‡ä»¶åä¸æ˜¯root)&gt; cat /var/spool/cron/gaopeng#Ansible: test special time@daily echo test disabledã€backupç”¨æ³• 123456789101112131415# å…³é—­è®¡åˆ’ä»»åŠ¡ï¼Œå…³é—­ä¹‹å‰å…ˆè¿›è¡Œå¤‡ä»½&gt; ansible env2 -m cron -a 'user=gaopeng name="test special time" special_time=daily job="echo test" disabled=yes backup=yes'# å¤‡ä»½æ–‡ä»¶ä¸º/tmp/crontabrCqyRqenv2 | SUCCESS =&gt; &#123; "backup_file": "/tmp/crontabrCqyRq", "changed": true, "envs": [], "jobs": [ "test special time" ]&#125;# æŸ¥çœ‹è¿œç¨‹ä¸»æœºçš„è®¡åˆ’ä»»åŠ¡ï¼Œå·²è¢«æ³¨é‡Š&gt; cat /var/spool/cron/gaopeng #Ansible: test special time#@daily echo test serviceç®¡ç†è¿œç¨‹ä¸»æœºä¸Šçš„æœåŠ¡ã€‚ å¯è¢«serviceç®¡ç†çš„æƒ…å†µï¼š å¦‚æžœæƒ³é€šè¿‡serviceæ¨¡å—ç®¡ç†è¿œç¨‹ä¸»æœºä¸­çš„æŸä¸ªæœåŠ¡ï¼Œé‚£ä¹ˆè¿™ä¸ªæœåŠ¡å¿…é¡»èƒ½è¢«BSD initï¼ŒOpenRCï¼ŒSysV, Solaris SMF, systemd, upstartä¸­ä»»æ„ä¸€ç§æ‰€ç®¡ç†ã€‚å‡è®¾ä½¿ç”¨CentOS 6ï¼ŒCentOS 6é»˜è®¤é€šè¿‡SysVç®¡ç†æœåŠ¡ï¼Œé‚£ä¹ˆè¿™ä¸ªæœåŠ¡å¿…é¡»èƒ½é€šè¿‡service æœåŠ¡å startå¯åŠ¨ã€‚ å‡è®¾ä½¿ç”¨CentOS 7ï¼ŒCentOS 7é»˜è®¤é€šè¿‡systemdç®¡ç†æœåŠ¡ï¼Œé‚£ä¹ˆè¿™ä¸ªæœåŠ¡å¿…é¡»èƒ½é€šè¿‡systemctl start æœåŠ¡åå¯åŠ¨ã€‚ 1ansible-doc service -s å‚æ•° é»˜è®¤ï¼ˆå¯é€‰ï¼‰ è¯´æ˜Ž arguments æŒ‡å®šé¢å¤–å‚æ•° enabled noï¼ˆuesï¼‰ æŒ‡å®šæ˜¯å¦å°†æœåŠ¡è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨é¡¹ name æŒ‡å®šæœåŠ¡å pattern æŒ‡å®šä¸€ä¸ªæ¨¡å¼ï¼Œå¦‚æžœé€šè¿‡statusæŒ‡ä»¤æ¥æŸ¥çœ‹æœåŠ¡çš„çŠ¶æ€æ—¶ï¼Œæ²¡æœ‰å“åº”ï¼Œå°±ä¼šé€šè¿‡psæŒ‡ä»¤åœ¨è¿›ç¨‹ä¸­æ ¹æ®è¯¥æ¨¡å¼è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¦‚æžœåŒ¹é…åˆ°ï¼Œåˆ™è®¤ä¸ºè¯¥æœåŠ¡ä¾ç„¶åœ¨è¿è¡Œ runlevel default é’ˆå¯¹äºŽOpenRCç®¡ç†æœåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å‚æ•°æ¥è®¾ç½®æœåŠ¡çš„è¿è¡Œçº§åˆ« sleep æœåŠ¡é‡å¯æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å‚æ•°è®¾ç½®stopä¸Žstartä¹‹é—´çš„æ—¶é—´é—´éš” state ï¼ˆreloadedã€restartedã€runningã€started ã€stoppedï¼‰ æŒ‡å®šæœåŠ¡çŠ¶æ€ use auto serivceæ¨¡å—é€šå¸¸ä¼šè‡ªåŠ¨ç›‘æµ‹å½“å‰ç³»ç»Ÿä½¿ç”¨çš„æœåŠ¡ç®¡ç†æ¨¡å—æ­¤å‚æ•°å¯ä»¥å¼ºåˆ¶æŒ‡å®šæœåŠ¡ç®¡ç†çš„æ¨¡å— ä¾‹ï¼š nameã€stateç”¨æ³• 1234567891011121314# å¯åŠ¨nginx&gt; ansible env2 -m service -a 'name=nginx state=started'env2 | SUCCESS =&gt; &#123; "changed": true, "name": "nginx", "state": "started", "status": &#123; ... ... &#125;&#125;# å…³é—­nginx&gt; ansible env2 -m service -a 'name=nginx state=stopped' enabledç”¨æ³• 12345# å°†nginxè®¾ç½®ä¸ºå¼€æœºå¯åŠ¨é¡¹&gt; ansible env2 -m service -a 'name=nginx enabled=yes'# æŸ¥çœ‹è¿œç¨‹ä¸»æœºnginxå¼€æœºå¯åŠ¨çŠ¶æ€&gt; systemctl list-unit-files | grep 'nginx'nginx.service enabled userç®¡ç†è¿œç¨‹ä¸»æœºä¸Šçš„ç”¨æˆ·ã€‚æ¯”å¦‚åˆ›å»ºç”¨æˆ·ã€ä¿®æ”¹ç”¨æˆ·ã€åˆ é™¤ç”¨æˆ·ã€ä¸ºç”¨æˆ·åˆ›å»ºç§˜é’¥å¯¹ç­‰ã€‚ 1ansible-doc user -s å‚æ•° é»˜è®¤ï¼ˆå¯é€‰ï¼‰ è¯´æ˜Ž append noï¼ˆyesï¼‰ å¦‚æžœä¸ºyesï¼šç”¨æˆ·æ·»åŠ åˆ°æŒ‡å®šçš„ç»„ä¸­å¦‚æžœä¸ºnoï¼šç”¨æˆ·æ·»åŠ åˆ°æŒ‡å®šçš„ç»„ä¸­ï¼Œç„¶åŽå°†ç”¨æˆ·ä»Žå…¶ä»–ç»„åˆ é™¤ comment ç”¨æˆ·çš„æ³¨é‡Šä¿¡æ¯ create_home yesï¼ˆnoï¼‰ åˆ›å»ºç”¨æˆ·æ—¶ï¼Œæ˜¯å¦åˆ›å»ºå®¶ç›®å½•ã€‚ expires æŒ‡å®šç”¨æˆ·è¿‡æœŸæ—¶é—´ï¼Œç›¸å½“äºŽ/etc/shadowæ–‡ä»¶ä¸­çš„ç¬¬8åˆ—æŒ‡å®šå€¼ä¸ºunixæ—¶é—´æˆ³ï¼Œè½¬æ¢æ—¶é—´æˆ³ä½¿ç”¨date -då‘½ä»¤æˆ–è€…ä½¿ç”¨python datetimeæˆ–timeæ¨¡å— force noï¼ˆyesï¼‰ åªå½±å“state=absentï¼Œè¡¨ç¤ºå¼ºåˆ¶åˆ é™¤ç”¨æˆ·ï¼Œå³ä½¿ç”¨æˆ·æ­£åœ¨ç™»å½•ï¼Œä½œç”¨ä¸Žuserdel -forceç›¸åŒ generate_ssh_key noï¼ˆyesï¼‰ æ˜¯å¦ä¸ºç”¨æˆ·ç”Ÿæˆsshå¯†é’¥å¯¹ï¼Œé»˜è®¤ä¸º~/.ssh/id_rsaçš„ç§é’¥å’Œid_rsa.pubçš„å…¬é’¥ã€‚å¦‚æžœåŒåçš„å¯†é’¥å¯¹å·²ç»å­˜åœ¨å¯¹åº”çš„ç›®å½•ä¸­ï¼Œåˆ™ä¸è¿›è¡Œä»»ä½•æ“ä½œ group æŒ‡å®šç”¨æˆ·æ‰€åœ¨çš„åŸºæœ¬ç»„ groups æŒ‡å®šç”¨æˆ·æ‰€åœ¨çš„é™„åŠ ç»„å¦‚æžœç”¨æˆ·å·²ç»å­˜åœ¨å¹¶ä¸”å·²ç»æ‹¥æœ‰å¤šä¸ªé™„åŠ ç»„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ­¤å‚æ•°è®¾ç½®é™„åŠ ç»„æ—¶ï¼Œç”¨æˆ·åŽŸæ¥çš„é™„åŠ ç»„ä¼šè¢«è¦†ç›–å¦‚æžœä¸æƒ³è¦†ç›–åŽŸæ¥çš„é™„åŠ ç»„ï¼Œåœ¨å…¶åŸºç¡€ä¸Šæ·»åŠ é™„åŠ ç»„ï¼Œç»“åˆappend=yesä½¿ç”¨ hidden ï¼ˆnoã€yesï¼‰ ä»…é™äºŽDarwin/OS Xç³»ç»Ÿï¼Œæ˜¯å¦åœ¨ç™»å½•çª—å£éšè—ç”¨æˆ· home æŒ‡å®šç”¨æˆ·çš„å®¶ç›®å½•è·¯å¾„ local noï¼ˆyesï¼‰ ä½¿ç”¨luseraddä»£æ›¿useraddè¿œç¨‹ä¸»æœºä¸Šå¿…é¡»å¯ä»¥ä½¿ç”¨luseraddå‘½ä»¤ move_home noï¼ˆyesï¼‰ å¦‚æžœç”¨æˆ·æœ‰å®¶ç›®å½•ï¼Œå¯ä»¥ç”¨è¿‡æ­¤å‚æ•°åˆ™è¿ç§»ç”¨æˆ·çš„å®¶ç›®å½•ã€‚ nameï¼ˆå¿…é€‰ï¼‰ æŒ‡å®šæ“ä½œçš„ç”¨æˆ·åç§° password æŒ‡å®šç”¨æˆ·çš„å¯†ç è¿™ä¸ªå¯†ç ä¸èƒ½æ˜¯æ˜Žæ–‡å¯†ç ï¼Œå¿…é¡»æ˜¯å¯¹æ˜Žæ–‡å¯†ç åŠ å¯†åŽçš„å­—ç¬¦ä¸²å¯ä»¥ä½¿ç”¨python passlibæ¨¡å—å…ˆè¿›è¡Œå“ˆå¸ŒåŠ å¯† password_lock ï¼ˆnoã€yesï¼‰ æ˜¯å¦é”å®šå¯†ç ï¼Œä¸ä¼šç¦ç”¨ç”¨æˆ·ç™»å½•ï¼Œåªæ˜¯ä¸èƒ½åœ¨åŒä¸€ä¸ªtaskæ¥ä¿®æ”¹å¯†ç  remove noï¼ˆyesï¼‰ åˆ é™¤ç”¨æˆ·æ—¶ï¼Œæ˜¯å¦åˆ é™¤ç”¨æˆ·çš„å®¶ç›®å½•ç­‰ä¿¡æ¯å½“state=absentå¹¶ä¸”remove=yesæ—¶ï¼Œç›¸å½“äºŽæ‰§è¡Œuserdel â€“removeå‘½ä»¤ shell æŒ‡å®šç”¨æˆ·çš„é»˜è®¤shell ssh_key_bits default set by ssh-keygen å½“generate_ssh_keyä¸ºyesæ—¶ï¼ŒæŒ‡å®šè¦åˆ›å»ºçš„sshå¯†é’¥ä¸­çš„ä½æ•° ssh_key_comment ansible-generated on $HOSTNAME å½“generate_ssh_keyä¸ºyesæ—¶ï¼ŒæŒ‡å®šå…¬é’¥ä¸­çš„æ³¨é‡Šä¿¡æ¯å¦‚æžœåŒåçš„å¯†é’¥å¯¹å·²ç»å­˜åœ¨ä¸ä¼šè¿›è¡Œä»»ä½•æ“ä½œ ssh_key_file .ssh/id_rsa å½“generate_ssh_keyä¸ºyesæ—¶ï¼ŒæŒ‡å®šsshç§é’¥çš„è·¯å¾„å’Œåç§°ï¼Œå¯¹åº”çš„å…¬é’¥ä¼šåœ¨åŒè·¯å¾„ä¸‹ç”Ÿæˆ ssh_key_passphrase å½“generate_ssh_keyä¸ºyesæ—¶ï¼ŒæŒ‡å®šsshç§é’¥çš„å¯†ç å¦‚æžœåŒåçš„å¯†é’¥å¯¹å·²ç»å­˜åœ¨ä¸ä¼šè¿›è¡Œä»»ä½•æ“ä½œ ssh_key_type rsa å½“generate_ssh_keyä¸ºyesæ—¶ï¼ŒæŒ‡å®šå¯†é’¥å¯¹çš„ç±»åž‹å¦‚æžœåŒåçš„å¯†é’¥å¯¹å·²ç»å­˜åœ¨ä¸ä¼šè¿›è¡Œä»»ä½•æ“ä½œ state presentï¼ˆabsentï¼‰ presentï¼šç”¨æˆ·éœ€è¦å­˜åœ¨absentï¼šåˆ é™¤ç”¨æˆ· system noï¼ˆyesï¼‰ æ˜¯å¦åˆ›å»ºä¸ºç³»ç»Ÿç”¨æˆ·ï¼Œä¸èƒ½åœ¨å·²å­˜åœ¨çš„ç”¨æˆ·ä¸Šè¿›è¡Œæ›´æ”¹ uid æŒ‡å®šç”¨æˆ·uidå· update_password alwaysï¼ˆon_createï¼‰ alwaysï¼šå¦‚æžœpasswordå‚æ•°çš„å€¼ä¸Žç”¨æˆ·å½“å‰çš„åŠ å¯†è¿‡çš„å¯†ç å­—ç¬¦ä¸²ä¸ä¸€è‡´ï¼Œåˆ™ç›´æŽ¥æ›´æ–°ç”¨æˆ·çš„å¯†ç on_createï¼šå¦‚æžœpasswordå‚æ•°çš„å€¼ä¸Žç”¨æˆ·å½“å‰çš„åŠ å¯†è¿‡çš„å¯†ç å­—ç¬¦ä¸²ä¸ä¸€è‡´ï¼Œåˆ™ä¸ä¼šæ›´æ–°ç”¨æˆ·çš„å¯†ç å­—ç¬¦ä¸²ï¼Œä¿æŒä¹‹å‰çš„å¯†ç è®¾å®š ä¾‹ï¼š nameã€commentã€passwordã€uidç”¨æ³• 123456789# é¦–å…ˆè¦ç”Ÿæˆå¯†ç çš„åŠ å¯†å­—ç¬¦ä¸²&gt; python -c "from passlib.hash import sha512_crypt; import getpass; print(sha512_crypt.using(rounds=5000).hash(getpass.getpass()))"# è¾“å…¥å¯†ç ï¼ˆä¸ä¼šæ˜¾ç¤ºå¯†ç ï¼‰Password: 123456$6$iDBOhZfEfEHw0OhP$I.oHiGUKG9TZgW0BkYcOFjeL15h.LG5bi/gKNlpLP2wY8ux3zx2sB8fMZyO47kmBld1tUyrwyLM/7oYqcDJ9m1# åˆ›å»ºç”¨æˆ·åä¸ºgpã€å¯†ç ä¸º123456ã€ä¿¡æ¯ä¸ºgaopengã€uidä¸º1993çš„ç”¨æˆ·&gt; ansible env2 -m user -a 'name=gp comment="GaoPeng" uid=1993 password=$6$iDBOhZfEfEHw0OhP$I.oHiGUKG9TZgW0BkYcOFjeL15h.LG5bi/gKNlpLP2wY8ux3zx2sB8fMZyO47kmBld1tUyrwyLM/7oYqcDJ9m1'# æŸ¥çœ‹è¿œç¨‹ä¸»æœºï¼Œæ­¤æ—¶ç”¨æˆ·å·²ç»è¢«åˆ›å»ºgp:x:1993:1993:GaoPeng:/home/gp:/bin/bash stateï¼Œremoveç”¨æ³• 12# åˆ é™¤ç”¨æˆ·ï¼Œé»˜è®¤æƒ…å†µä¸‹åˆ é™¤ç”¨æˆ·ä¹Ÿä¸ä¼šç§»é™¤å®¶ç›®å½•ï¼Œä½¿ç”¨remove=yesåœ¨åˆ é™¤ç”¨æˆ·çš„åŒæ—¶ä¹Ÿä¸€å¹¶ç§»é™¤å®¶ç›®å½•&gt; ansible env2 -m user -a 'name=gp state=absent remove=yes' groupã€groupsã€appendç”¨æ³• 12# æŒ‡å®šç”¨æˆ·å±žç»„ä¸ºrootã€å¹¶ä¸è¦†ç›–åŽŸæœ‰çš„é™„åŠ ç»„æ·»åŠ é™„åŠ ç»„ä¸ºansible&gt; ansible env2 -m user -a 'name=gp group=root groups=ansible append=yes' expiresç”¨æ³• 1234567891011121314# å…ˆç”Ÿæˆæ—¶é—´æˆ³&gt; date -d 2018-08-31 +%s1535644800# åˆ›å»ºä¸´æ—¶ç”¨æˆ·ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´ä¸º2018å¹´8æœˆ31æ—¥ansible env2 -m user -a 'name=guest expires=1535644800 password=$6$iDBOhZfEfEHw0OhP$I.oHiGUKG9TZgW0BkYcOFjeL15h.LG5bi/gKNlpLP2wY8ux3zx2sB8fMZyO47kmBld1tUyrwyLM/7oYqcDJ9m1'# æŸ¥çœ‹ç”¨æˆ·è¿‡æœŸä¿¡æ¯&gt; chage -l guestLast password change : Aug 02, 2018Password expires : neverPassword inactive : neverAccount expires : Aug 30, 2018Minimum number of days between password change : 0Maximum number of days between password change : 99999Number of days of warning before password expires : 7 generate_ssh_keyã€ssh_key_commentã€ssh_key_fileã€ssh_key_passphraseã€ssh_key_typeç”¨æ³• 12# ä¸ºç”¨æˆ·åˆ›å»ºç§˜é’¥å¯¹ï¼Œæ³¨é‡Šä¿¡æ¯ä¸ºGaoPengï¼Œè·¯å¾„ä¸º/opt/id_rsa_gpï¼Œç§é’¥å¯†ç ä¸º123456ï¼ŒåŠ å¯†ç±»åž‹ä¸ºdsa&gt; ansible env2 -m user -a 'name=gp generate_ssh_key=yes ssh_key_comment=GaoPeng ssh_key_file=/opt/id_rsa_gp ssh_key_passphrase=123456 ssh_key_type=dsa' groupç®¡ç†è¿œç¨‹ä¸»æœºä¸Šçš„ç»„ã€‚ è¿œç¨‹ä¸»æœºä¸Šå¿…é¡»æœ‰groupaddã€groupdelã€groupmodæ¨¡å—ã€‚ 1ansible-doc group -s å‚æ•° é»˜è®¤ï¼ˆå¯é€‰ï¼‰ è¯´æ˜Ž gid æŒ‡å®šç»„çš„gid local no ä½¿ç”¨lgroupaddä»£æ›¿groupaddè¿œç¨‹ä¸»æœºä¸Šå¿…é¡»å¯ä»¥ä½¿ç”¨lgroupaddå‘½ä»¤ nameï¼ˆå¿…é€‰ï¼‰ æŒ‡å®šç»„å state presentï¼ˆabsentï¼‰ åŒuser system noï¼ˆyesï¼‰ æ˜¯å¦åˆ›å»ºç³»ç»Ÿç»„ ä¾‹ï¼š nameã€gidç”¨æ³• 12# åˆ›å»ºansibleç»„ï¼Œgidä¸º2018&gt; ansible env2 -m group -a 'name=ansible gid=2018' stateç”¨æ³• 12# åˆ é™¤ansibleç»„&gt; ansible env2 -m group -a 'name=ansible state=absent' sysctlæŽ§åˆ¶Linuxå†…æ ¸å‚æ•°ï¼Œä¸Žsysctlå‘½ä»¤ç›¸åŒã€‚ 1ansible-doc sysctl -s å‚æ•° é»˜è®¤ï¼ˆå¯é€‰ï¼‰ è¯´æ˜Ž ignoreerrors noï¼ˆyesï¼‰ æ˜¯å¦å¿½ç•¥æœªçŸ¥é”®çš„é”™è¯¯ nameï¼ˆå¿…é€‰ï¼‰ æŒ‡å®šéœ€è¦è®¾ç½®çš„å†…æ ¸å‚æ•° reload yesï¼ˆnoï¼‰ è®¾ç½®å®ŒæˆåŽæ˜¯å¦éœ€è¦æ‰§è¡Œsysctl -pæ“ä½œ state presentï¼ˆabsentï¼‰ presentï¼šè¯¥å†…æ ¸å‚æ•°å¿…é¡»å­˜åœ¨absentï¼šåˆ é™¤è¯¥å†…æ ¸å‚æ•° sysctl_file /etc/sysctl.conf æŒ‡å®šsysctl.confçš„ç»å¯¹è·¯å¾„ sysctl_set noï¼ˆyesï¼‰ æ˜¯å¦éªŒè¯ Verify token value value æŒ‡å®šéœ€è¦è®¾ç½®çš„å€¼ ä¾‹ï¼š nameã€valueç”¨æ³• 12# è®¾ç½®overcommit_memory=1&gt; ansible env2 -m sysctl -a 'name=vm.overcommit_memory value=1' mountåœ¨è¿œç¨‹æœåŠ¡å™¨ä¸ŠæŒ‚è½½ç£ç›˜ï¼Œå½“è¿›è¡ŒæŒ‚è½½ç£ç›˜æ“ä½œæ—¶ï¼Œå¦‚æžœæŒ‚è½½ç‚¹æŒ‡å®šçš„è·¯å¾„ä¸å­˜åœ¨ï¼Œå°†åˆ›å»ºè¯¥è·¯å¾„ã€‚ 1ansible-doc mount -s å‚æ•° é»˜è®¤ï¼ˆå¯é€‰ï¼‰ è¯´æ˜Ž backup noï¼ˆyesï¼‰ æ˜¯å¦åˆ›å»ºå¤‡ä»½æ–‡ä»¶ boot yesï¼ˆnoï¼‰ ä»…é€‚ç”¨äºŽSolarisç³»ç»Ÿï¼Œæ˜¯å¦å¼€æœºå¯åŠ¨æ—¶æŒ‚è½½ dump 0 æ˜¯å¦è¿›è¡Œè½¬å‚¨ï¼Œstate=presentæ—¶å°†åœæ­¢å·¥ä½œ fstab /etc/ fstab æ˜¯å¦ä½¿ç”¨æ–‡ä»¶æ¥ä»£æ›¿/etc/fstabï¼Œæ…Žç”¨ fstype æŒ‡å®šæ–‡ä»¶ç³»ç»Ÿç±»åž‹ï¼Œå½“stateçš„å€¼ä¸ºpresentæˆ–mountedæ—¶ï¼Œæ­¤å‚æ•°å¿…é€‰ passno 0ï¼ˆ1ã€2ï¼‰ æ˜¯å¦æ£€éªŒæ‰‡åŒºï¼šå¼€æœºçš„è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿé»˜è®¤ä¼šä»¥fsckæ£€éªŒæˆ‘ä»¬ç³»ç»Ÿæ˜¯å¦ä¸ºå®Œæ•´ï¼ˆcleanï¼‰ opts æŒ‡å®šæŒ‚è½½é€‰é¡¹ pathï¼ˆå¿…é€‰ï¼‰ æŒ‡å®šæŒ‚è½½ç‚¹çš„è·¯å¾„ src æŒ‡å®šæŒ‚è½½çš„è®¾å¤‡ï¼Œå½“stateçš„å€¼ä¸ºpresentæˆ–mountedæ—¶ï¼Œæ­¤å‚æ•°å¿…é€‰ stateï¼ˆå¿…é€‰ï¼‰ ï¼ˆabsentã€mountedã€presentã€unmountedï¼‰ mountedï¼šæŒ‚è½½å¹¶æ­£ç¡®é…ç½®fstabæ–‡ä»¶unmountedï¼šå¸è½½ï¼Œä¸æ”¹å˜fstabæ–‡ä»¶presentï¼šä»…é…ç½®fstabæ–‡ä»¶ï¼Œä¸è¿›è¡Œç£ç›˜æ“ä½œabsentï¼šå¸è½½å¹¶åˆ é™¤fstabå¯¹åº”çš„é…ç½® ä¾‹ï¼š stateã€pathã€fstypeã€srcã€optsç”¨æ³• 1234# æŒ‚è½½å…‰é©±ï¼Œå¹¶æ·»åŠ fstabé…ç½®&gt; ansible env2 -m mount -a 'path=/media src=/dev/cdrom fstype=iso9660 opts=loop state=mounted' # å¸è½½å…‰é©±å¹¶åˆ é™¤/etc/fstabç›¸å…³é…ç½®&gt; ansible env2 -m mount -a 'path=/media state=absent' dumpç”¨æ³• 1234567# æŒ‚è½½è®¾å¤‡ï¼Œæ¯ä¸€ä¸ªæ˜ŸæœŸè¿›è¡Œè½¬å‚¨ansible env2 -m mount -a 'path=/mnt/data src=/dev/sdb1 fstype=xfs dump=7 state=mounted'# æŸ¥çœ‹å¯¹åº”çš„fstabæ–‡ä»¶&gt; cat /etc/fstab | grep /dev/sdb1/dev/sdb1 /mnt/data xfs defaults 7 0# ä¸´æ—¶å¸è½½ï¼Œå¹¶ä¸åˆ é™¤é…ç½®&gt; ansible env2 -m mount -a 'path=/mnt/data state=unmounted' filesystemæ ¼å¼åŒ–ç£ç›˜ï¼Œåˆ›å»ºæ–‡ä»¶ç³»ç»Ÿã€‚ iptablesðŸŒiptables ç®¡ç†é™æ€é˜²ç«å¢™ã€‚ firewalldç®¡ç†åŠ¨æ€é˜²ç«å¢™ selinuxðŸŒselinux ç®¡ç†selinuxæœåŠ¡çŠ¶æ€ã€‚ filesystemåˆå§‹åŒ–æ–‡ä»¶ç³»ç»Ÿã€‚ ðŸŒfilesystem å®‰è£…åŒ…ç›¸å…³æ¨¡å—å®‰è£…åŒ…ç›¸å…³æ¨¡å—ç›®å‰åªåº”ç”¨äºŽç®€å•çš„éœ€æ±‚åœºæ™¯ï¼Œå¤æ‚çš„éœ€æ±‚æ²¡æœ‰ç”¨åˆ°è¿‡ï¼Œå› æ­¤åªè®°å½•ç®€è¦ä¿¡æ¯ã€‚ yum_repositoryç®¡ç†è¿œç¨‹ä¸»æœºä¸Šçš„yumä»“åº“ã€‚ 1ansible-doc yum_repository -s å‚æ•° é»˜è®¤ï¼ˆå¯é€‰ï¼‰ è¯´æ˜Ž nameï¼ˆå¿…é€‰ï¼‰ æŒ‡å®šè¦æ“ä½œçš„å”¯ä¸€çš„ä»“åº“çš„IDå³é…ç½®æ–‡ä»¶ä¸­çš„[]å†…çš„ä»“åº“ID baseurl æŒ‡å®šyumä»“åº“çš„baseurl description æŒ‡å®šä»“åº“çš„æ³¨é‡Šä¿¡æ¯ï¼Œå³ä»“åº“çš„nameå­—æ®µå†…å®¹ file æŒ‡å®šä»“åº“çš„é…ç½®æ–‡ä»¶åç§°ä¸ä½¿ç”¨æ­¤å‚æ•°ï¼Œé»˜è®¤ä¼šä»¥nameå‚æ•°å€¼ä½œä¸ºæ–‡ä»¶åç§°å‰ç¼€ enabled yesï¼ˆnoï¼‰ æ˜¯å¦æ¿€æ´»å¯¹åº”çš„yumæº gpgcheck ï¼ˆnoã€yesï¼‰ æ˜¯å¦å¼€å¯rpmåŒ…éªŒè¯åŠŸèƒ½ gpgcakey å½“gpgcheck=yesæ—¶ï¼Œéœ€è¦ä½¿ç”¨æ­¤å‚æ•°æŒ‡å®šéªŒè¯åŒ…æ‰€éœ€çš„å…¬é’¥ state presentï¼ˆabsentï¼‰ presentï¼šæ­¤yumæºéœ€è¦å­˜åœ¨absentï¼šåˆ é™¤å¯¹åº”yumæº nameã€baeurlã€descriptionã€enabledç”¨æ³• 1234567891011# é…ç½®æœ¬åœ°yumæºï¼Œä½†å¹¶ä¸å¼€å¯å®ƒ&gt; ansible env2 -m yum_repository -a 'name=local baseurl=file:///media description="local yum" enabled=no'# æŸ¥çœ‹è¿œç¨‹ä¸»æœºé…ç½®&gt; cat /etc/yum.repos.d/local.repo[local]baseurl = file:///mediaenabled = 0name = local yum# é…ç½®epelæº&gt; ansible env2 -m yum_repository -a 'name=epel description="aliyun EPEL" baseurl="https://mirrors.aliyun.com/epel/$releasever\Server/$basearch/"' gpgcheckã€gpgcakeyç”¨æ³• 12# é…ç½®æœ¬åœ°yumæºï¼Œå¼€å¯åŒ…éªŒè¯åŠŸèƒ½ï¼Œå¹¶å¼€å¯å®ƒ&gt; ansible env2 -m yum_repository -a 'name=local baseurl=file:///media description="local yum" gpgcheck=yes gpgcakey=file:///media/RPM-GPG-KEY-CentOS-7' stateç”¨æ³• 12# åˆ é™¤epelæº&gt; ansible env2 -m yum_repository -a 'name=epel state=absent' yumåœ¨è¿œç¨‹ä¸»æœºä¸Šç”¨è¿‡yumç®¡ç†è½¯ä»¶åŒ…ã€‚ 1ansible-doc yum -s å‚æ•° é»˜è®¤ï¼ˆå¯é€‰ï¼‰ è¯´æ˜Ž name æŒ‡å®šéœ€è¦ç®¡ç†çš„è½¯ä»¶åŒ… state presentï¼ˆabsentã€installedã€latestã€removedï¼‰ presentï¼šç¡®ä¿è½¯ä»¶åŒ…å·²ç»å®‰è£…installedï¼šåŒpresentlatestï¼šå®‰è£…yumä¸­æœ€æ–°çš„ç‰ˆæœ¬absentï¼šåˆ é™¤å¯¹åº”çš„è½¯ä»¶åŒ…removedï¼šåŒabsent disable_gpg_check noï¼ˆyesï¼‰ ç”¨äºŽç¦ç”¨å¯¹rpmåŒ…çš„å…¬é’¥gpgéªŒè¯åœ¨å¯¹åº”çš„yumæºæ²¡æœ‰å¼€å¯gpgéªŒè¯çš„æƒ…å†µä¸‹ï¼Œéœ€è¦å°†æ­¤å‚æ•°çš„å€¼è®¾ç½®ä¸ºyes enablerepo æŒ‡å®šå®‰è£…åŒ…ä¸´æ—¶å¯ç”¨çš„yumæºå¦‚æžœä½ ä¸ç¡®è®¤yumæºæ˜¯å¦å¯ç”¨ï¼Œå¯ä»¥åœ¨å®‰è£…è½¯ä»¶åŒ…æ—¶å°†æ­¤å‚æ•°è®¾ç½®ä¸ºyes disabelrepo ä¸´æ—¶ç¦ç”¨yumæº ä¾‹ï¼š nameã€stateã€disable_gpg_checkç”¨æ³• 12345# å®‰è£…nginxï¼Œè·³è¿‡gpgéªŒè¯&gt; ansible env2 -m yum -a 'name=nginx disable_gpg_check=yes'# å¸è½½nginx&gt; ansible env2 -m yum -a 'name=nginx state=absent' ç½‘ç»œå·¥å…·æ¨¡å—get_url:globe_with_meridians:get_url wait_foræ•°æ®åº“ç›¸å…³æ¨¡å—MySQLç›¸å…³æ¨¡å—mysql_dbðŸŒmysql_db mysql_replicationmysql_userðŸŒmysql_user mysql_variablesMongoDBç›¸å…³æ¨¡å—mongodb_parametermongodb_userRedisç›¸å…³æ¨¡å—rediså­˜å‚¨ç›¸å…³æ¨¡å—glusterfsç›¸å…³gluster_peerðŸŒgluster_peer gluster_volumeðŸŒgluster_volume]]></content>
      <categories>
        <category>Ansible</category>
      </categories>
      <tags>
        <tag>Ansible</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ansibleå­¦ä¹ ç¬”è®°-Ad-Hoc]]></title>
    <url>%2F2018%2F07%2F30%2FAnsible%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Ad-Hoc%2F</url>
    <content type="text"><![CDATA[Ad-Hocç¬”è®°Ansibleæä¾›ä¸¤ç§å®Œæˆä»»åŠ¡çš„æ–¹å¼ï¼š ansible â€” Ad-hocï¼Œè§£å†³ä¸€äº›ç®€å•æˆ–è€…ä¸´æ—¶é‡åˆ°çš„ä»»åŠ¡ï¼Œç›¸å½“äºŽLinuxçš„ç³»ç»Ÿå‘½ä»¤è¡Œä¸‹çš„shellå‘½ä»¤ ansible-playbook â€” Playbookï¼Œè§£å†³å¤æ‚æˆ–è€…å›ºåŒ–ä¸‹æ¥çš„ä»»åŠ¡ï¼Œç›¸å½“äºŽLinuxç³»ç»Ÿçš„Shellè„šæœ¬ è¿™æ¬¡è®°å½•Ad-Hocçš„ä½¿ç”¨æ–¹æ³•ã€‚ Ad-HocåŽŸç† è¯¦ç»†è¿‡ç¨‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162[root@env1 tmp]# ansible env1 -m ping -vvvansible 2.6.1# è¯»å–é…ç½®æ–‡ä»¶ config file = /etc/ansible/ansible.cfg# é…ç½®çš„æ¨¡å—è·¯å¾„ configured module search path = [u'/root/.ansible/plugins/modules', u'/usr/share/ansible/plugins/modules']# anisbleåº“ã€å‘½ä»¤çš„ä½ç½®åŠpythonç‰ˆæœ¬å· ansible python module location = /usr/lib/python2.7/site-packages/ansible executable location = /usr/bin/ansible python version = 2.7.5 (default, Aug 4 2017, 00:39:18) [GCC 4.8.5 20150623 (Red Hat 4.8.5-16)]# ä½¿ç”¨é…ç½®æ–‡ä»¶Using /etc/ansible/ansible.cfg as config file# è§£æžä¸»æœºæ¸…å•ä¸­ï¼ˆiniæ’ä»¶è§£æžï¼‰Parsed /etc/ansible/hosts inventory source with ini pluginMETA: ran handlers# é“¾æŽ¥è¿œç¨‹ä¸»æœºæˆåŠŸï¼ˆESTABLISHï¼‰ï¼ŒUSER:Noneè¡¨ç¤ºä½¿ç”¨ç³»ç»Ÿå½“å‰ç”¨æˆ·ï¼ŒæœªæŒ‡å®šç«¯å£å·è¡¨ç¤ºä½¿ç”¨sshé»˜è®¤ç«¯å£å·&lt;env1&gt; ESTABLISH SSH CONNECTION FOR USER: None&lt;env1&gt; SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o ConnectTimeout=10 -o ControlPath=/root/.ansible/cp/a950b0cbe8 env1 '/bin/sh -c '"'"'echo ~ &amp;&amp; sleep 0'"'"''&lt;env1&gt; (0, '/root\n', '')# åˆ›å»ºä¸´æ—¶ç›®å½•&lt;env1&gt; ESTABLISH SSH CONNECTION FOR USER: None&lt;env1&gt; SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o ConnectTimeout=10 -o ControlPath=/root/.ansible/cp/a950b0cbe8 env1 '/bin/sh -c '"'"'( umask 77 &amp;&amp; mkdir -p "` echo /root/.ansible/tmp/ansible-tmp-1532981758.0-52597477914119 `" &amp;&amp; echo ansible-tmp-1532981758.0-52597477914119="` echo /root/.ansible/tmp/ansible-tmp-1532981758.0-52597477914119 `" ) &amp;&amp; sleep 0'"'"''&lt;env1&gt; (0, 'ansible-tmp-1532981758.0-52597477914119=/root/.ansible/tmp/ansible-tmp-1532981758.0-52597477914119\n', '')# putæ‰€éœ€è¿è¡Œçš„è„šæœ¬Using module file /usr/lib/python2.7/site-packages/ansible/modules/system/ping.py&lt;env1&gt; PUT /root/.ansible/tmp/ansible-local-208102tQ8Kw/tmpT0qXOj TO /root/.ansible/tmp/ansible-tmp-1532981758.0-52597477914119/ping.py&lt;env1&gt; SSH: EXEC sftp -b - -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o ConnectTimeout=10 -o ControlPath=/root/.ansible/cp/a950b0cbe8 '[env1]'&lt;env1&gt; (0, 'sftp&gt; put /root/.ansible/tmp/ansible-local-208102tQ8Kw/tmpT0qXOj /root/.ansible/tmp/ansible-tmp-1532981758.0-52597477914119/ping.py\n', '')# ç»™è„šæœ¬æ·»åŠ ç”¨æˆ·å¯æ‰§è¡Œæƒé™&lt;env1&gt; ESTABLISH SSH CONNECTION FOR USER: None&lt;env1&gt; SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o ConnectTimeout=10 -o ControlPath=/root/.ansible/cp/a950b0cbe8 env1 '/bin/sh -c '"'"'chmod u+x /root/.ansible/tmp/ansible-tmp-1532981758.0-52597477914119/ /root/.ansible/tmp/ansible-tmp-1532981758.0-52597477914119/ping.py &amp;&amp; sleep 0'"'"''&lt;env1&gt; (0, '', '')# è¿è¡Œè„šæœ¬ï¼Œå¹¶è¿”å›žç»“æžœ&lt;env1&gt; ESTABLISH SSH CONNECTION FOR USER: None&lt;env1&gt; SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o ConnectTimeout=10 -o ControlPath=/root/.ansible/cp/a950b0cbe8 -tt env1 '/bin/sh -c '"'"'/usr/bin/python /root/.ansible/tmp/ansible-tmp-1532981758.0-52597477914119/ping.py &amp;&amp; sleep 0'"'"''&lt;env1&gt; (0, '\r\n&#123;"ping": "pong", "invocation": &#123;"module_args": &#123;"data": "pong"&#125;&#125;&#125;\r\n', 'Shared connection to env1 closed.\r\n')# åˆ é™¤è„šæœ¬&lt;env1&gt; ESTABLISH SSH CONNECTION FOR USER: None&lt;env1&gt; SSH: EXEC ssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o ConnectTimeout=10 -o ControlPath=/root/.ansible/cp/a950b0cbe8 env1 '/bin/sh -c '"'"'rm -f -r /root/.ansible/tmp/ansible-tmp-1532981758.0-52597477914119/ &gt; /dev/null 2&gt;&amp;1 &amp;&amp; sleep 0'"'"''# è¾“å‡ºè¿”å›žç»“æžœ&lt;env1&gt; (0, '', '')env1 | SUCCESS =&gt; &#123; "changed": false, "invocation": &#123; "module_args": &#123; "data": "pong" &#125; &#125;, "ping": "pong"&#125;META: ran handlersMETA: ran handlers å¹¶å‘ï¼š Ansibleä½¿ç”¨multiprocessingç®¡ç†å¤šçº¿ç¨‹ Ad-Hocå‘½ä»¤ç”¨æ³•1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798Usage: ansible &lt;host-pattern&gt; [options]Options:# æ¨¡å—å‚æ•°# ä¾‹ï¼šansible -m command -a 'hostname' -a MODULE_ARGS, --args=MODULE_ARGS# vaultå¯†ç  --ask-vault-pass# åŽå°æ‰§è¡Œå‘½ä»¤ï¼Œè¶…è¿‡SECONDSç§’ä¹‹åŽä¸­æ­¢ä»»åŠ¡ -B SECONDS, --background=SECONDS # ä¸æ‰§è¡Œä»»åŠ¡ï¼Œå°è¯•æ£€æŸ¥å¯èƒ½å‘ç”Ÿçš„å˜åŒ–# ä¾‹ï¼šansible env1 -m file -a 'path=/tmp/testfile state=touch' -C -C, --check# å½“æ›´æ”¹ï¼ˆå°çš„ï¼‰æ–‡ä»¶å’Œæ¨¡æ¿æ—¶ï¼Œæ˜¾ç¤ºè¿™äº›æ–‡ä»¶çš„å·®å¼‚ï¼Œå¤§æ–‡ä»¶ä½¿ç”¨--check# ä¾‹ï¼šansible env1 -m blockinfile -a 'path=/tmp/testfile block=test' -D -D, --diff# è®¾ç½®å¤–éƒ¨å˜é‡ï¼Œå¦‚æžœæ˜¯å˜é‡æ–‡ä»¶åœ¨æ–‡ä»¶å‰é¢åŠ '@'# ä¾‹ï¼šansible-playbook cmdvar.yml --extra-vars 'pass_var=cmdline pass var' -e EXTRA_VARS, --extra-vars=EXTRA_VARS# è®¾ç½®å¹¶å‘çº¿ç¨‹æ•°ï¼Œé»˜è®¤5ä¸ª# ä¾‹ï¼šansible test -m ping -f 1 -vvvï¼ˆå˜ä¸ºçº¿æ€§æ‰§è¡Œï¼‰ -f FORKS, --forks=FORKS# æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ -h, --help# æŒ‡å®šinventoryæ–‡ä»¶# ä¾‹ï¼š ansible -i /etc/ansible/hosts test -m ping -i INVENTORY, --inventory=INVENTORY, --inventory-file=INVENTORY# è¿›ä¸€æ­¥é™åˆ¶æ‰€é€‰ä¸»æœº/ç»„æ¨¡å¼# ä¾‹ï¼š ansible test -m ping -l env1ï¼ˆåªå¯¹è¿™ä¸ªipæ‰§è¡Œï¼‰ -l SUBSET, --limit=SUBSET# åˆ—å‡ºä¸»æœºåˆ—è¡¨ï¼Œä¸æ‰§è¡Œä»»ä½•å‘½ä»¤ --list-hosts# æŒ‡å®šæ‰§è¡Œæ—¶ä½¿ç”¨çš„æ¨¡å—ï¼Œä¸æŒ‡å®šæ—¶é»˜è®¤ä¸ºcommandæ¨¡å— -m MODULE_NAME, --module-name=MODULE_NAME# æ‰§è¡Œæ¨¡å—çš„å­˜æ”¾è·¯å¾„ï¼Œé»˜è®¤ä¸º[u'/root/.ansible/plugins/modules',u'/usr/share/ansible/plugins/modules'] -M MODULE_PATH, --module-path=MODULE_PATH# åŽ‹ç¼©è¾“å‡ºï¼ˆè¾“å‡ºä¸ºä¸€è¡Œï¼‰# ä¾‹ï¼šansible test -m ping -o -o, --one-line# è®¾ç½®playbookç›®å½• --playbook-dir=BASEDIR# å¦‚æžœä½¿ç”¨äº†-Bï¼Œå¯ä»¥ä½¿ç”¨-Pæ¥è®¾ç½®è½®è¯¢é—´éš”ï¼Œé»˜è®¤15ç§’ -P POLL_INTERVAL, --poll=POLL_INTERVAL# å¯¹playbookè¿›è¡Œè¯­æ³•æ£€æµ‹ï¼Œä¸ä¼šæ‰§è¡Œplaybookï¼ˆæ³¨æ„ä¸æ˜¯æ£€æŸ¥æ–‡ä»¶ï¼Œåªæ˜¯æ£€æŸ¥è¯­æ³•æ˜¯å¦æ­£ç¡®ï¼‰# ä¾‹ï¼šansible env1 -m file -a 'path=/opt/ state=touch' --syntax-check --syntax-check# è¾“å‡ºä¿¡æ¯è‡³ç›®å½•ä¸‹# ä¾‹ï¼šansible test -m ping --tree /opt/ansible/ -t TREE, --tree=TREE# æŒ‡å®švalutçš„id --vault-id=VAULT_IDS# æŒ‡å®švaultå¯†ç æ–‡ä»¶ --vault-password-file=VAULT_PASSWORD_FILES# è¯¦ç»†æ¨¡å¼ï¼Œ-vvvè¡¨ç¤ºæ›´å¤šï¼Œ-vvvvè¡¨ç¤ºå¯ç”¨è¿žæŽ¥è°ƒè¯• -v, --verbose# æŸ¥çœ‹ansibleç‰ˆæœ¬å· --version Connection Options:# sshè®¤è¯å¯†ç  -k, --ask-pass ask for connection password# æŒ‡å®šç§˜é’¥æ–‡ä»¶ --private-key=PRIVATE_KEY_FILE, --key-file=PRIVATE_KEY_FILE# æŒ‡å®šè¿œç¨‹ä¸»æœºè¿è¡Œå‘½ä»¤çš„ç”¨æˆ·ï¼Œé»˜è®¤Noneï¼ˆä»¥å½“å‰ç³»ç»Ÿç”¨æˆ·ï¼‰ -u REMOTE_USER, --user=REMOTE_USER# æŒ‡å®šè¿žæŽ¥æ–¹å¼ï¼Œé»˜è®¤smart -c CONNECTION, --connection=CONNECTION# è¿žæŽ¥è¿œç¨‹ä¸»æœºè¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’ï¼Œé»˜è®¤ä¸º10ç§’ -T TIMEOUT, --timeout=TIMEOUT# æŒ‡å®šsftp/scp/sshè¿žæŽ¥æ—¶çš„å‚æ•°ï¼ˆä¾‹å¦‚ProxyCommandï¼‰ --ssh-common-args=SSH_COMMON_ARGS# æŒ‡å®šsftpçš„é¢å¤–å‚æ•°ï¼ˆä¾‹å¦‚-f,-lï¼‰ --sftp-extra-args=SFTP_EXTRA_ARGS# æŒ‡å®šscpçš„é¢å¤–å‚æ•°ï¼ˆä¾‹å¦‚-lï¼‰ --scp-extra-args=SCP_EXTRA_ARGS# æŒ‡å®šsshçš„é¢å¤–å‚æ•°ï¼ˆä¾‹å¦‚-Rï¼‰ --ssh-extra-args=SSH_EXTRA_ARGSPrivilege Escalation Options:# ç›¸å½“äºŽlinuxsuduå‘½ä»¤ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼Œå»ºè®®ä½¿ç”¨become -s, --sudo# æ‰€éœ€çš„sudoç”¨æˆ·ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼Œå»ºè®®ä½¿ç”¨become -U SUDO_USER, --sudo-user=SUDO_USER# ä½¿ç”¨suæ¥è¿è¡Œä»»åŠ¡ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼Œå»ºè®®ä½¿ç”¨become -S, --su # ä½¿ç”¨suæ¥ä½œä¸ºè¿™ä¸ªç”¨æˆ·è¿è¡Œä»»åŠ¡ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼Œå»ºè®®ä½¿ç”¨become -R SU_USER, --su-user=SU_USER# åœ¨è¿è¡Œå‘½ä»¤æ—¶å‘Šè¯‰å¯ä»¥æˆä¸ºå¦ä¸€ä¸ªç”¨æˆ·ï¼Œæ²¡æœ‰å¯†ç æç¤º -b, --become# æŒ‡å®šå‡çº§ç‰¹æƒæ—¶çš„æ–¹æ³•ï¼Œé»˜è®¤sudoï¼Œå¯ä»¥é€‰æ‹©çš„æœ‰[ sudo | su | pbrun | pfexec | doas | dzdo | ksu | runas | pmrun | enable | machinectl ] --become-method=BECOME_METHOD# æŒ‡å®šè¿è¡Œä»»åŠ¡çš„ç”¨æˆ·ï¼Œé»˜è®¤rootç”¨æˆ· --become-user=BECOME_USER# sudoå¯†ç ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼Œå»ºè®®ä½¿ç”¨become --ask-sudo-pass# suå¯†ç ï¼Œä¸å»ºè®®ä½¿ç”¨ï¼Œå»ºè®®ä½¿ç”¨become --ask-su-pass# è¯·æ±‚æƒé™æå‡çš„å¯†ç ï¼Œå³ä½¿ç”¨becomeæ—¶æ‰€éœ€çš„å¯†ç  -K, --ask-become-pass Ad-Hocæ‰§è¡Œä»»åŠ¡Ansibleæ‰§è¡Œä»»åŠ¡æ—¶ï¼Œä¸è®ºæ˜¯Ad-Hocè¿˜æ˜¯Playbookéƒ½éœ€è¦ä¾èµ–ansibleçš„å„ä¸ªæ¨¡å—ï¼Œæ¯”å¦‚ä½¿ç”¨anible -m pingæ—¶å°±éœ€è¦ä½¿ç”¨pingæ¨¡å—ï¼ŒAnsibleçš„æ¨¡å—éžå¸¸ä¹‹å¤šï¼Œæˆ‘ä¼šå•ç‹¬å†™ä¸€ç¯‡ç¬”è®°æ¥è®°å½•å¸¸ç”¨çš„æ¨¡å—ï¼Œå› ä¸ºæ¨¡å—çš„ç¬”è®°ä¸è®ºæ˜¯Ad-Hocè¿˜æ˜¯Playbookéƒ½å°†ä½¿ç”¨åˆ°ã€‚]]></content>
      <categories>
        <category>Ansible</category>
      </categories>
      <tags>
        <tag>Ansible</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ansibleå­¦ä¹ ç¬”è®°-Inventory]]></title>
    <url>%2F2018%2F07%2F30%2FAnsible%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%B8%BB%E6%9C%BA%E6%B8%85%E5%8D%95%2F</url>
    <content type="text"><![CDATA[Ansibleä¸»æœºæ¸…å•ç¬”è®°Inventoryæ˜¯Ansibleç®¡ç†ä¸»æœºä¿¡æ¯çš„é…ç½®æ–‡ä»¶ï¼Œç›¸å½“äºŽç³»ç»ŸHOSTSæ–‡ä»¶çš„åŠŸèƒ½ï¼Œé»˜è®¤å­˜æ”¾åœ¨/etc/ansible/hostsã€‚ Ansibleä½¿ç”¨æ—¶å¯ä»¥ç”¨è¿‡-iæˆ–--inventory-fileæ¥æŒ‡å®šè¯»å–ã€‚]]></content>
      <categories>
        <category>Ansible</category>
      </categories>
      <tags>
        <tag>Ansible</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ansibleå­¦ä¹ ç¬”è®°-Config]]></title>
    <url>%2F2018%2F07%2F30%2FAnsible%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E9%85%8D%E7%BD%AE%2F</url>
    <content type="text"><![CDATA[Ansibleé…ç½®æ–‡ä»¶ç¬”è®°Ansibleè¯»å–é…ç½®æ–‡ä»¶çš„é¡ºåº ANSIBLE_CONFIGï¼ˆå¦‚æžœè®¾ç½®äº†çŽ¯å¢ƒå˜é‡ï¼‰ ansible.cfgï¼ˆå½“å‰ç›®å½•ï¼‰ ~/.ansible.cfgï¼ˆå½“å‰ç”¨æˆ·å®¿ä¸»ç›®å½•ï¼‰ /etc/ansible.cfg å‘½ä»¤è¯­æ³• 1ansible-config [view|dump|list] [--help] [options] [ansible.cfg] options --version â€” ç‰ˆæœ¬å· -c &lt;CONFIG_FILE&gt;, --config &lt;CONFIG_FILE&gt; â€” æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„ -v, --verbose â€” è¯¦ç»†æ¨¡å¼ï¼ˆ-vvvè¡¨ç¤ºæ›´å¤šï¼Œ-vvvvè¡¨ç¤ºå¼€å¯è¿žæŽ¥è°ƒè¯•ï¼‰ view æ˜¾ç¤ºå½“å‰çš„é…ç½®æ–‡ä»¶ dump æ˜¾ç¤ºå½“å‰è®¾ç½®ï¼Œå¦‚æžœæŒ‡å®šäº†é…ç½®æ–‡ä»¶ï¼Œåˆ™è¦†ç›–é…ç½®æ–‡ä»¶ --only-changed â€” ä»…æ˜¾ç¤ºä»Žé»˜è®¤å€¼æ›´æ”¹çš„é…ç½® list åˆ—å‡ºlib/constants.pyçš„æ‰€æœ‰é…ç½®ï¼Œå¹¶æ˜¾ç¤ºenvå’Œé…ç½®æ–‡ä»¶çš„åç§° é…ç½®åœ¨æ­¤è®°å½•ä¸€ä¸‹é…ç½®æ–‡ä»¶å„ä¸ªé€‰é¡¹çš„ä½œç”¨ï¼š ä»¥ä¸‹é…ç½®é¡¹åœ¨å®žé™…æ–‡ä»¶ä¸­éƒ½è¢«æ³¨é‡Šï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨é»˜è®¤é…ç½®ï¼Œæ ¹æ®è‡ªå·±çš„éœ€è¦ä¿®æ”¹ã€‚ ä¸ºäº†æ˜¾ç¤ºæ•ˆæžœï¼Œæˆ‘æŠŠæ³¨é‡Šéƒ½åŽ»æŽ‰äº†ã€‚ defaultsæ—¥å¸¸å¯èƒ½ç”¨åˆ°çš„é…ç½®ï¼Œå¤šæ•°ä¿æŒé»˜è®¤å³å¯ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219[defaults]# Inventoryæ–‡ä»¶# é»˜è®¤ï¼š/etc/ansible/hostsinventory = /etc/ansible/hosts# libåº“å­˜æ”¾ç›®å½•# é»˜è®¤ï¼š~/.ansible/plugins/modules:/usr/share/ansible/plugins/moduleslibrary = /usr/share/my_modules/# æ¨¡å—ç›®å½•# é»˜è®¤ï¼š~/.ansible/plugins/module_utils:/usr/share/ansible/plugins/module_utilmodule_utils = /usr/share/my_module_utils/# è¿œç¨‹ä¸»æœºä¸´æ—¶æ–‡ä»¶å­˜æ”¾ç›®å½•# é»˜è®¤ï¼š~/.ansible/tmpremote_tmp = ~/.ansible/tmp# æœ¬åœ°ä¸´æ—¶æ–‡ä»¶å­˜æ”¾ç›®å½•# é»˜è®¤ï¼š~/.ansible/tmplocal_tmp = ~/.ansible/tmp# æ¨¡å—é»‘åå•æ–‡ä»¶ï¼ˆ2.5ç‰ˆæœ¬åŠä»¥åŽï¼‰# é»˜è®¤ï¼šNoneplugin_filters_cfg = /etc/ansible/plugin_filters.yml# å¹¶å‘æ•°# é»˜è®¤ï¼š5forks = 5# è½®è¯¢æ—¶é—´é—´éš”# é»˜è®¤ï¼š15poll_interval = 15# sudoç”¨æˆ·# é»˜è®¤ï¼šNonesudo_user = root# æ˜¯å¦éœ€è¦sudoå¯†ç # é»˜è®¤ï¼šFalseask_sudo_pass = True# æ˜¯å¦éœ€è¦å¯†ç ï¼Œå¦‚æžœä½¿ç”¨ç§˜é’¥éªŒè¯ä¸éœ€è¦ä¿®æ”¹æ­¤é…ç½®# é»˜è®¤ï¼šFalseask_pass = True# ä¼ è¾“æ¨¡å¼# é»˜è®¤ï¼šsmartï¼ˆsmartæ¨¡å¼ä¼šåœ¨sshå’Œparamikoä¹‹é—´åˆ‡æ¢ï¼Œå–å†³äºŽæ“ä½œç³»ç»Ÿå’Œsshç‰ˆæœ¬ã€‚# å¯é€‰ï¼šsshã€paramikotransport = smart# è¿œç¨‹é“¾æŽ¥ç«¯å£å·# é»˜è®¤ï¼šNoneï¼ˆå°†ä½¿ç”¨è¿žæŽ¥æ’ä»¶çš„é»˜è®¤ç«¯å£å·ï¼Œæ¯”å¦‚ä½¿ç”¨sshè¿žæŽ¥æ—¶ä¼šä½¿ç”¨æŽ§åˆ¶ç«¯sshçš„é»˜è®¤ç«¯å£å·ï¼‰remote_port = 22# æ¨¡å—åœ¨è¿œç¨‹ä¸»æœºæ‰§è¡Œæ—¶ä½¿ç”¨çš„è¯­è¨€çŽ¯å¢ƒè®¾ç½®ï¼ˆåªæœ‰module_set_locale=Trueæ—¶æ‰ç”Ÿæ•ˆï¼‰# é»˜è®¤ï¼šdefaultsï¼ˆå°è¯•å°†æŽ§åˆ¶å™¨çš„LANGçŽ¯å¢ƒå˜é‡è®¾ç½®ä¸ºè¿œç¨‹ä¸»æœºçš„LANGçŽ¯å¢ƒå˜é‡ï¼‰module_lang = Cmodule_set_locale = False# Gathering Factsçš„é»˜è®¤ç­–ç•¥ï¼ˆæ¯ä¸ªplayåœ¨æ‰§è¡Œæ—¶éƒ½ä¼šå…ˆæ‰§è¡Œä¸€ä¸ªé»˜è®¤ä»»åŠ¡ï¼šæ”¶é›†è¿œç¨‹ç³»ç»Ÿçš„ä¿¡æ¯ï¼‰# é»˜è®¤ï¼šimplicitï¼ˆç¼“å­˜æ’ä»¶å°†è¢«å¿½ç•¥ï¼ŒFactsæ•°æ®å°†è¢«æ”¶é›†ï¼Œé™¤éžåœ¨playbookæ–‡ä»¶ä¸­åŠ ä¸Šgather_facts: falseï¼‰# å¯é€‰ï¼šexplicitï¼ˆä¸æ”¶é›†Factsæ•°æ®ï¼Œé™¤éžåœ¨playbookæ–‡ä»¶ä¸­åŠ ä¸Šgather_facts: Trueï¼‰# å¯é€‰ï¼šsmartï¼ˆæ™ºèƒ½æ¨¡å¼ï¼Œä¼šæ”¶é›†æ²¡æœ‰å‘çŽ°Factsæ•°æ®çš„ä¸»æœºï¼Œå¦‚æžœå·²ç»æ”¶é›†äº†ï¼Œå°†ä¸ä¼šå†è¿›è¡Œæ”¶é›†ä»»åŠ¡ï¼‰# explicitå’Œsmartéƒ½å¯ä½¿ç”¨ç¼“å­˜æ’ä»¶gathering = implicit# å®šä¹‰èŽ·å–Factsä¿¡æ¯çš„å­é›†# é»˜è®¤ï¼šallï¼ˆèŽ·å–å…¨éƒ¨ä¿¡æ¯ï¼‰# å¯é€‰ï¼šnetworkï¼ˆæ”¶é›†æœ€ç®€ä¿¡æ¯å’Œç½‘ç»œä¿¡æ¯ï¼‰# å¯é€‰ï¼šhardwareï¼ˆæ”¶é›†ç¡¬ä»¶ä¿¡æ¯ï¼‰# å¯é€‰ï¼švirtualï¼ˆæ”¶é›†æœ€ç®€ä¿¡æ¯å’Œè™šæ‹Ÿä¿¡æ¯ï¼‰# å¯é€‰ï¼šfacterï¼ˆä»Žfacterä¸­å¯¼å…¥ä¿¡æ¯ï¼Œéœ€è¦è¿œç¨‹ä¸»æœºå®‰è£…facteråŒ…ï¼‰# å¯é€‰ï¼šohaiï¼ˆä»Žohaiä¸­å¯¼å…¥ä¿¡æ¯ï¼Œéœ€è¦è¿œç¨‹ä¸»æœºå®‰è£…ohaiåŒ…ï¼‰# å¯ä»¥ä½¿ç”¨é€—å·æ¥ç»„åˆï¼ˆnetwork,hardwareï¼‰# å¯ä»¥ä½¿ç”¨æ„Ÿå¹å·æ¥æŽ’é™¤ï¼ˆ!hardware,!facter,!ohaiï¼‰# æœ€ç®€ä¿¡æ¯æ€»æ˜¯ä¼šè¢«é‡‡é›†gather_subset = all# æ”¶é›†Factsä¿¡æ¯çš„è¶…æ—¶æ—¶é—´ï¼Œä¸é€‚ç”¨ansible hosts -m setup# é»˜è®¤ï¼š10gather_timeout = 10# è§’è‰²è·¯å¾„ï¼Œå¯ç”¨:åˆ†éš”ä¸åŒçš„è·¯å¾„# é»˜è®¤ï¼š~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/rolesroles_path = /etc/ansible/roles# é¦–æ¬¡é“¾æŽ¥æ˜¯å¦éœ€è¦æ£€æŸ¥keyè®¤è¯# é»˜è®¤ï¼šTrue# å»ºè®®æ”¹ä¸ºFalsehost_key_checking = False# æ”¹å˜é»˜è®¤å›žè°ƒï¼Œä¸€æ¬¡åªèƒ½å¯ç”¨ä¸€ä¸ª'stdout'ç±»åž‹# å¯è‡ªå®šä¹‰æ’ä»¶æ¥æ”¹å˜å›žè°ƒæ˜¾ç¤ºçš„æ ¼å¼ç­‰# é»˜è®¤ï¼šdefaultstdout_callback = skippy# ç™½åå•çš„å›žè°ƒåˆ—è¡¨ï¼Œå¹¶éžæ‰€æœ‰å›žè°ƒéƒ½éœ€è¦åˆ—å…¥ç™½åå•ï¼Œä½†Ansibleè‡ªå¸¦çš„è®¸å¤šå›žè°ƒéƒ½éœ€è¦åŠ å…¥ç™½åå•åˆ—è¡¨ï¼Œå› ä¸ºä¸å¸Œæœ›ä»–ä»¬è¢«é»˜è®¤æ¿€æ´»# é»˜è®¤ï¼š[]callback_whitelist = timer, mail# è®¾å®šä»»åŠ¡æ˜¯å¦ä¸ºé™æ€ï¼Œ2.0ç‰ˆæœ¬é»˜è®¤åŠ¨æ€ã€‚è‹¥è®¾ç½®ä¸ºTrueï¼Œåˆ™åƒ1.xç‰ˆæœ¬é‚£æ ·ä¸ºé™æ€ã€‚# é»˜è®¤ï¼šFalsetask_includes_static = Falsehandler_includes_static = False# sudoå¯æ‰§è¡Œæ–‡ä»¶å# é»˜è®¤ï¼šsudosudo_exe = sudo# sudoå‚æ•°# é»˜è®¤ï¼š-H -S -nsudo_flags = -H -S -n# sshè¶…æ—¶æ—¶é—´# é»˜è®¤ï¼š10timeout = 10# é»˜è®¤çš„è¿œç¨‹è¿žæŽ¥ç”¨æˆ·# é»˜è®¤ï¼šNoneï¼ˆå½“å‰æ­£åœ¨æ‰§è¡Œä»»åŠ¡çš„ç”¨æˆ·ï¼‰remote_user = root# æ—¥å¿—æ–‡ä»¶# é»˜è®¤ï¼šNoneï¼ˆä¸æ‰“å°æ—¥å¿—ï¼‰log_path = /var/log/ansible.log# ansibleé»˜è®¤çš„æ‰§è¡Œæ¨¡å—# é»˜è®¤ï¼šcommandmodule_name = command# æ‰§è¡Œè„šæœ¬çš„è§£é‡Šå™¨# é»˜è®¤ï¼š/bin/shexecutable = /bin/sh# å˜é‡é‡å å¼ï¼Œæ˜¯ä¼˜å…ˆçº§é«˜çš„æ›¿æ¢ä¼˜å…ˆçº§ä½Žçš„è¿˜æ˜¯åˆå¹¶ï¼ˆpythonä¸­çš„å­—å…¸ï¼‰ï¼Œä¸å»ºè®®è®¾ç½®# é»˜è®¤ï¼šreplacehash_behaviour = replace# ä½¿è§’è‰²ä¸­çš„å˜é‡æ— æ³•ä»Žå…¶ä»–è§’è‰²ä¸­è®¿é—®ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè§’è‰²ä¸­çš„å˜é‡å°†åœ¨å…¨å±€å˜é‡èŒƒå›´ä¸­å¯è§ã€‚ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µï¼Œå¯ä»¥å¯ç”¨ä»¥ä¸‹é€‰é¡¹ï¼Œåªæœ‰tasksçš„ä»»åŠ¡å’Œhandlerså¾—ä»»åŠ¡å¯ä»¥çœ‹åˆ°è§’è‰²å˜é‡# é»˜è®¤ï¼šFalseprivate_role_vars = yes# jinja2çš„æ‰©å±•åº”ç”¨# é»˜è®¤ï¼š[]jinja2_extensions = jinja2.ext.do,jinja2.ext.i18n# ç§é’¥æ–‡ä»¶è·¯å¾„# é»˜è®¤ï¼šNoneprivate_key_file = /path/to/file# vaultå¯†ç æ–‡ä»¶è·¯å¾„# é»˜è®¤ï¼šNonevault_password_file = /path/to/vault_password_file# å®šä¹‰ä¸€ä¸ªJinja2å˜é‡ï¼Œå¯ä»¥æ’å…¥åˆ°Ansibleé…ç½®æ¨¡ç‰ˆç³»ç»Ÿç”Ÿæˆçš„æ–‡ä»¶ä¸­# é»˜è®¤ï¼šAnsible managedansible_managed = Ansible managed# æ˜¯å¦æ˜¾ç¤ºè·³è¿‡çš„ä»»åŠ¡çŠ¶æ€ï¼Œä¸ç®¡ä»»åŠ¡æ˜¯å¦è¢«è·³è¿‡ï¼Œä»»åŠ¡å¤´ä»ç„¶ä¼šæ˜¾ç¤ºå‡ºæ¥# é»˜è®¤ï¼šTruedisplay_skipped_hosts = True# æ¸…æ¥šæƒ…å†µä¸‹playbookä¼šä¸ºæ¯ä¸ªè¿è¡Œçš„ä»»åŠ¡æ‰“å°ä¸€ä¸ªæ ‡é¢˜ã€‚å¦‚æžœæŒ‡å®šäº†æ ‡é¢˜åï¼Œåˆ™ä¼šæ‰“å°è¿™ä¸ªæ ‡é¢˜ï¼›å¦‚æžœæ²¡æœ‰æŒ‡å®šæ ‡é¢˜ï¼Œplaybookä¼šæ ¹æ®ä»»åŠ¡çš„è¡ŒåŠ¨æ¥åˆ¤æ–­å½“å‰çš„ä»»åŠ¡æ˜¯ä»€ä¹ˆã€‚å¦‚æžœè®¾ç½®äº†è¿™ä¸ªå˜é‡ï¼Œé‚£ä¹ˆplaybookä¼šåœ¨æ ‡é¢˜ä¸­åŒ…å«ä»»åŠ¡çš„å‚æ•°ã€‚# é»˜è®¤ï¼šFalsedisplay_args_to_stdout = False# å¦‚æžœæ‰€å¼•ç”¨çš„å˜é‡åç§°é”™è¯¯çš„è¯, æ˜¯å¦è®©ansibleåœ¨æ‰§è¡Œæ­¥éª¤ä¸Šå¤±è´¥# é»˜è®¤ï¼šTrueerror_on_undefined_vars = False# æ˜¯å¦ç¦ç”¨ç³»ç»Ÿå¯èƒ½å‡ºçŽ°çš„é—®é¢˜ç›¸å…³çš„è­¦å‘Š# é»˜è®¤ï¼šTruesystem_warnings = True# å°†ä¸å†ä½¿ç”¨çš„è¯­è¨€ç‰¹æ€§æ˜¾ç¤ºå¼ƒç”¨è­¦å‘Šï¼Œå¹¶å°†åœ¨ä»¥åŽçš„ç‰ˆæœ¬ä¸­åˆ é™¤# é»˜è®¤ï¼šTruedeprecation_warnings = True# é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ä½¿ç”¨shellæˆ–å‘½ä»¤æ¨¡å—æ—¶ï¼Œè¯¥å‘½ä»¤å°†å‘å‡ºè­¦å‘Šã€‚è¿™äº›è­¦å‘Šå¯ä»¥é€šè¿‡è°ƒæ•´è¿™ä¸ªè®¾ç½®ä¸ºFalseæ¥å…³é—­ï¼Œè¿˜å¯ä»¥ä½¿ç”¨æ¨¡å—é€‰é¡¹è­¦å‘Šåœ¨ä»»åŠ¡çº§åˆ«æŽ§åˆ¶å®ƒï¼ˆwarn=yes|noï¼‰# é»˜è®¤ï¼šTruecommand_warnings = False# ä»¥ä¸‹ä¸ºæ’ä»¶å­˜æ”¾ç›®å½•# é»˜è®¤ï¼š~/.ansible/plugins/æ’ä»¶å:/usr/share/ansible/plugins/æ’ä»¶åaction_plugins = /usr/share/ansible/plugins/actioncache_plugins = /usr/share/ansible/plugins/cachecallback_plugins = /usr/share/ansible/plugins/callbackconnection_plugins = /usr/share/ansible/plugins/connectionlookup_plugins = /usr/share/ansible/plugins/lookupinventory_plugins = /usr/share/ansible/plugins/inventoryvars_plugins = /usr/share/ansible/plugins/varsfilter_plugins = /usr/share/ansible/plugins/filtertest_plugins = /usr/share/ansible/plugins/testterminal_plugins = /usr/share/ansible/plugins/terminalstrategy_plugins = /usr/share/ansible/plugins/strategy# playçš„é»˜è®¤ç­–ç•¥# é»˜è®¤ï¼šlinearï¼ˆçº¿æ€§ï¼‰# å¯é€‰ï¼šfreeï¼ˆå°½å¿«ï¼‰ä»¥åŠå…¶ä»–çš„ç­–ç•¥æ’ä»¶strategy = free# æŽ§åˆ¶callbackæ’ä»¶ï¼ˆå‰é¢æœ‰è®¾ç½®æ’ä»¶çš„è·¯å¾„ï¼‰æ˜¯å¦åœ¨è¿è¡Œ/usr/bin/ansibleçš„æ—¶å€™è¢«åŠ è½½# é»˜è®¤ï¼šFalsebin_ansible_callbacks = False# æ˜¯å¦å¼€å¯cowsayåŠŸèƒ½ï¼Œä¸æƒ³ä½¿ç”¨å¯ä»¥é€šè¿‡export ANSIBLE_NOCOWS=1æ¥å…³é—­# é»˜è®¤ï¼šFalsenocows = 1# æŒ‡å®šcowsayè¿˜æ˜¯éšæœºé€‰æ‹©æ¨¡å—ï¼ˆcow_whitelisté€‰é¡¹ä¸­çš„æ¨¡å—ï¼‰# é»˜è®¤ï¼šdefaultcow_selection = random# cowsayç™½åå•# é»˜è®¤ï¼š[â€˜bud-frogsâ€™, â€˜bunnyâ€™, â€˜cheeseâ€™, â€˜daemonâ€™, â€˜defaultâ€™, â€˜dragonâ€™, â€˜elephant-in-snakeâ€™, â€˜elephantâ€™, â€˜eyesâ€™, â€˜hellokittyâ€™, â€˜kittyâ€™, â€˜luke-koalaâ€™, â€˜meowâ€™, â€˜milkâ€™, â€˜moofasaâ€™, â€˜mooseâ€™, â€˜renâ€™, â€˜sheepâ€™, â€˜smallâ€™, â€˜stegosaurusâ€™, â€˜stimpyâ€™, â€˜supermilkerâ€™, â€˜three-eyesâ€™, â€˜turkeyâ€™, â€˜turtleâ€™, â€˜tuxâ€™, â€˜udderâ€™, â€˜vader-koalaâ€™, â€˜vaderâ€™, â€˜wwwâ€™]cow_whitelist=bud-frogs,bunny,cheese,daemon,default,dragon,elephant-in-snake,elephant,eyes,hellokitty,kitty,luke-koala,meow,milk,moofasa,moose,ren,sheep,small,stegosaurus,stimpy,supermilker,three-eyes,turkey,turtle,tux,udder,vader-koala,vader,www# é»˜è®¤ansibleä¼šä¸ºè¾“å‡ºç»“æžœåŠ ä¸Šé¢œè‰²,ç”¨æ¥æ›´å¥½çš„åŒºåˆ†çŠ¶æ€ä¿¡æ¯å’Œå¤±è´¥ä¿¡æ¯.å¦‚æžœä½ æƒ³å…³é—­è¿™ä¸€åŠŸèƒ½,å¯ä»¥æŠŠnocolorè®¾ç½®ä¸º1# é»˜è®¤ï¼šFalsenocolor = 1# factå€¼é»˜è®¤å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¯ä»¥è®¾ç½®å­˜å‚¨åœ¨redisç­‰å…¶ä»–ç¼“å­˜åž‹æ•°æ®åº“ä¸­# é»˜è®¤ï¼šmemoryfact_caching = memory# å½“playbookå¤±è´¥çš„æƒ…å†µä¸‹ï¼Œæ˜¯å¦åˆ›å»ºä¸€ä¸ªé‡è¯•æ–‡ä»¶# é»˜è®¤ï¼šTrueretry_files_enabled = False# é‡è¯•æ–‡ä»¶çš„è·¯å¾„# é»˜è®¤ï¼šNoneï¼ˆå½“å‰æ‰§è¡Œç›®å½•ï¼‰retry_files_save_path = ~/.ansible-retry# Ansibleå¯ä»¥ä¼˜åŒ–åœ¨å¾ªçŽ¯æ—¶ä½¿ç”¨åˆ—è¡¨å‚æ•°è°ƒç”¨æ¨¡å—çš„æ“ä½œã€‚ è€Œä¸æ˜¯æ¯ä¸ªwith_é¡¹è°ƒç”¨æ¨¡å—ä¸€æ¬¡ï¼Œè¯¥æ¨¡å—ä¼šä¸€æ¬¡è°ƒç”¨æ‰€æœ‰é¡¹ç›®ä¸€æ¬¡ã€‚è¯¥å‚æ•°è®°å½•å“ªäº›actionæ˜¯è¿™æ ·æ“ä½œçš„ã€‚# é»˜è®¤ï¼šapk, apt, dnf, homebrew, openbsd_pkg, pacman, pkgng, yum, zyppersquash_actions = apk,apt,dnf,homebrew,pacman,pkgng,yum,zypper# ä»»åŠ¡æ•°æ®çš„æ—¥å¿—è®°å½•# é»˜è®¤ï¼šFalseno_log = False# åœ¨è¿œç¨‹ä¸»æœºä¸Šæ˜¯å¦ç¦æ­¢ä»»åŠ¡çš„æ—¥å¿—è®°å½•ï¼Œä½†åœ¨æŽ§åˆ¶ä¸»æœºä¸Šä»ç„¶ä¼šè®°å½•# é»˜è®¤ï¼šFalseno_target_syslog = False# ï¼ˆä¸çŸ¥ï¼‰allow_world_readable_tmpfiles = False# æŽ§åˆ¶å‘é€åˆ°å·¥ä½œè¿›ç¨‹çš„å˜é‡çš„åŽ‹ç¼©çº§åˆ«ï¼Œæ­¤å€¼å¿…é¡»æ˜¯ä»Ž0åˆ°9çš„æ•´æ•°ã€‚# é»˜è®¤ï¼š0ï¼ˆä¸åŽ‹ç¼©ï¼‰var_compression_level = 9# åŽ‹ç¼©æ–¹æ³•# é»˜è®¤ï¼šZIP_DEFLATEDï¼ˆzipåŽ‹ç¼©ï¼‰# å¯é€‰ï¼šZIP_STOREDï¼ˆæ— åŽ‹ç¼©ï¼‰module_compression = 'ZIP_DEFLATED'# æŽ§åˆ¶--diffæ–‡ä»¶ä¸Šçš„æˆªæ­¢ç‚¹ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ï¼Œè®¾ç½®0åˆ™ä¸ºæ— é™åˆ¶ï¼ˆå¯èƒ½å¯¹å†…å­˜æœ‰å½±å“ï¼‰# é»˜è®¤ï¼š104448max_diff_size = 1048576# å°†åœ¨2.8æœ¬æœ¬åˆ é™¤ä¸è®¨è®ºmerge_multiple_cli_flags = True# æ˜¯å¦æ˜¾ç¤ºå®šåˆ¶çš„statsä¿¡æ¯# é»˜è®¤ï¼šFalseshow_custom_stats = True# å½“ä½¿ç”¨ç›®å½•ä½œä¸ºåº“å­˜æºæ—¶å¿½ç•¥çš„æ‰©å±•åˆ—è¡¨# é»˜è®¤ï¼š&#123;&#123;(BLACKLIST_EXTS + ( â€˜~â€™, â€˜.origâ€™, â€˜.iniâ€™, â€˜.cfgâ€™, â€˜.retryâ€™))&#125;&#125;inventory_ignore_extensions = ~, .orig, .bak, .ini, .cfg, .retry, .pyc, .pyo# é’ˆå¯¹ç½‘ç»œè®¾å¤‡ä¼˜åŒ–çš„å¤‡é€‰æ‰§è¡Œè·¯å¾„ï¼Œé™¤éžäº†è§£å®ƒæ˜¯æ€Žä¹ˆå·¥ä½œçš„ï¼Œå¦åˆ™ä¸è¦æ”¹åŠ¨# é»˜è®¤ï¼šult: [â€˜eosâ€™, â€˜nxosâ€™, â€˜iosâ€™, â€˜iosxrâ€™, â€˜junosâ€™, â€˜enosâ€™, â€˜ceâ€™, â€˜vyosâ€™, â€˜srosâ€™, â€˜dellos9â€™, â€˜dellos10â€™, â€˜dellos6â€™, â€˜asaâ€™, â€˜arubaâ€™, â€˜aireosâ€™, â€˜bigipâ€™, â€˜ironwareâ€™, â€˜onyxâ€™]network_group_modules = eos, nxos, ios, iosxr, junos, vyos# æ˜¯å¦å…è®¸å¿½ç•¥ä¸å®‰å…¨çš„æ•°æ®ï¼ˆé€šè¿‡è¯¸å¦‚æŸ¥æ‰¾ï¼ˆ'foo'ï¼‰ä¹‹ç±»çš„å˜é‡ï¼Œæˆ–è€…ä½œä¸ºå¸¦æœ‰'withfoo'çš„å¾ªçŽ¯ä½¿ç”¨çš„å˜é‡ï¼‰# é»˜è®¤ï¼šFalseallow_unsafe_lookups = False# ä¸ºæ‰€æœ‰çš„palyè®¾ç½®é»˜è®¤é”™è¯¯# é»˜è®¤ï¼šFalseany_errors_fatal = False inventoryä¸»æœºæ¸…å•çš„ç›¸å…³é…ç½®ã€‚ 1234567891011[inventory]# ä¸»æœºæ¸…å•æ’ä»¶ï¼Œä¹Ÿå†³å®šä½¿ç”¨çš„é¡ºåº# é»˜è®¤ï¼š[â€˜host_listâ€™, â€˜scriptâ€™, â€˜yamlâ€™, â€˜iniâ€™, â€˜autoâ€™]enable_plugins=host_list, virtualbox, yaml, constructed# åŒdefaultsä¸­inventory_ignore_extensionsé€‰é¡¹ignore_extensions = .pyc, .pyo, .swp, .bak, ~, .rpm, .md, .txt, ~, .orig, .ini, .cfg, .retry# åœ¨ä½¿ç”¨ç›®å½•ä½œä¸ºåº“å­˜æºæ—¶å¿½ç•¥çš„æ¨¡å¼# é»˜è®¤ï¼š[]ignore_patterns =# å¦‚æžœä¸ºTrueï¼Œæœªè§£æžçš„ä¸»æœºä¸ºerrorï¼Œå¦åˆ™ä¸ºè­¦å‘Šunparsed_is_failed = False privilege_escalationsudoç”¨æˆ·ææƒçš„ç›¸å…³é…ç½®ã€‚ 123456789101112# æ˜¯å¦å…è®¸sudoå‘½ä»¤æˆä¸ºå¦å¤–ä¸€ä¸ªç”¨æˆ·# é»˜è®¤ï¼šfalsebecome=True# sudoçš„æ–¹å¼# é»˜è®¤ï¼šsudobecome_method=sudo# ç‰¹æƒå‡çº§æ—¶ç§°ä¸ºçš„ç”¨æˆ·# é»˜è®¤ï¼šrootbecome_user=root# sudoåŽæ˜¯å¦éªŒè¯å¯†ç # é»˜è®¤ï¼šFalsebecome_ask_pass=False paramiko_connectionparamikoè¿žæŽ¥ç›¸å…³é…ç½®ï¼Œç›®å‰å·²ç»ä¸å¸¸ç”¨ï¼ŒåŸºæœ¬é€‚ç”¨sshè¿žæŽ¥ã€‚ 12345678910# è¯¥éƒ¨åˆ†å·²ç»ä¸æ€Žä¹ˆç”¨ï¼Œç®€å•äº†è§£[paramiko_connection]# ä¸è®°å½•æ–°ä¸»æœºçš„keyä»¥æå‡æ•ˆçŽ‡record_host_keys=False# ç¦ç”¨sudoåŠŸèƒ½pty=False# æ˜¯å¦æ˜¾ç¤ºå…¬é’¥æ–‡ä»¶look_for_keys = False# æ˜¯å¦è‡ªåŠ¨æ·»åŠ å…¬é’¥æ–‡ä»¶host_key_auto_add = True ssh_connectionsshè¿žæŽ¥ç›¸å…³é…ç½®ã€‚ 12345678910111213141516171819202122232425262728293031323334[ssh_connection]# sshè¿žæŽ¥æ—¶çš„å‚æ•°# é»˜è®¤ï¼š-C -o ControlMaster=auto -o ControlPersist=60sssh_args = -C -o ControlMaster=auto -o ControlPersist=60s# ä¿å­˜ControlPathå¥—æŽ¥å­—çš„ç›®å½•# é»˜è®¤ï¼š~/.ansible/pccontrol_path_dir = ~/.ansible/cp# ä¿å­˜ControlPathå¥—æŽ¥å­—ä½ç½®# é»˜è®¤ï¼šNonecontrol_path =# é»˜è®¤æƒ…å†µä¸‹ï¼Œansibleçš„æ‰§è¡Œæµç¨‹æ˜¯æŠŠç”Ÿæˆå¥½çš„æœ¬åœ°pythonè„šæœ¬putåˆ°è¿œç¨‹æœåŠ¡å™¨ç„¶åŽè¿è¡Œã€‚å¦‚æžœå¼€å¯äº†pipeliningï¼Œæ•´ä¸ªæµç¨‹å°‘äº†ä¸€ä¸ªputè„šæœ¬åˆ°è¿œç¨‹æœåŠ¡å™¨çš„æ­¥éª¤ï¼Œç›´æŽ¥åœ¨SSHçš„ä¼šè¯ä¸­è¿›è¡Œï¼Œå¯ä»¥æé«˜æ•´ä¸ªæ‰§è¡Œæ•ˆçŽ‡ã€‚# é»˜è®¤ï¼šFalse# å¯é€‰ï¼šTrue(éœ€è¦è¢«æŽ§çš„è¿œç¨‹æœåŠ¡å™¨å°†/etc/sudoersä¸­çš„Defaults requirettyæ³¨é‡ŠæŽ‰)pipelining = False# æŽ§åˆ¶æ–‡ä»¶ä¼ è¾“æœºåˆ¶ï¼ˆæ—§ï¼‰# é»˜è®¤ï¼šsmartï¼ˆå…ˆå°è¯•ä½¿ç”¨sftpï¼Œå†å°è¯•ä½¿ç”¨scpï¼‰# å¯é€‰ï¼šTrueï¼ˆåªä½¿ç”¨scpä¼ è¾“æ–‡ä»¶ï¼‰# å¯é€‰ï¼šFalseï¼ˆåªä½¿ç”¨sftpä¼ è¾“æ–‡ä»¶ï¼‰scp_if_ssh = smart# æŽ§åˆ¶æ–‡ä»¶ä¼ è¾“çš„æœºåˆ¶(æ–°)# é»˜è®¤ï¼šsmartï¼ˆæŒ‰é¡ºåºå°è¯•ä½¿ç”¨sftpã€scpã€ddï¼‰# å¯é€‰ï¼šsftpï¼ˆåªä½¿ç”¨stfpä¼ è¾“æ–‡ä»¶ï¼‰# å¯é€‰ï¼šscpï¼ˆåªä½¿ç”¨scpä¼ è¾“æ–‡ä»¶ï¼‰# å¯é€‰ï¼špipedï¼ˆåªä½¿ç”¨ddä¼ è¾“æ–‡ä»¶ï¼‰transfer_method = smart# sftpæ˜¯å¦ä½¿ç”¨æ‰¹å¤„ç†æ¨¡å¼æ¥ä¼ è¾“æ–‡ä»¶# é»˜è®¤ï¼šTrue# å¯é€‰ï¼šFalseï¼ˆåªæœ‰åœ¨æ‚¨çš„sftpç‰ˆæœ¬åœ¨æ‰¹å¤„ç†æ¨¡å¼ä¸Šæœ‰é—®é¢˜æ—¶æ‰åº”ç¦ç”¨ï¼‰sftp_batch_mode = False# ä¸çŸ¥use_tty = True# åœ¨ä¸å¯åˆ°è¾¾çš„æƒ…å†µä¸‹ï¼Œé‡è¯•SSHè¿žæŽ¥åˆ°ä¸»æœºçš„æ¬¡æ•°ã€‚å¯¹äºŽæ¯æ¬¡é‡è¯•å°è¯•ï¼Œéƒ½æœ‰ä¸€ä¸ªæŒ‡æ•°çº§çš„å›žé€€ï¼Œæ‰€ä»¥åœ¨ç¬¬ä¸€æ¬¡å°è¯•ä¹‹åŽï¼Œæœ‰1sç­‰å¾…ï¼Œç„¶åŽæ˜¯2sã€4sç­‰ï¼Œç›´åˆ°30sï¼ˆmaxï¼‰ã€‚# é»˜è®¤ï¼š0retries = 3 persistent_connectionæŒä¹…åŒ–è¿žæŽ¥çš„ç›¸å…³é…ç½®ã€‚ 12345678910[persistent_connection]# æŒä¹…è¿žæŽ¥è¶…æ—¶å€¼ï¼Œå¦‚æžœåœ¨è¶…æ—¶å€¼è¿‡æœŸä¹‹å‰æ²¡æœ‰æ”¶åˆ°æ–°çš„è¯·æ±‚ï¼Œåˆ™è¿žæŽ¥å…³é—­# é»˜è®¤ï¼š30connect_timeout = 30# é‡è¯•è¶…æ—¶å€¼ï¼Œè¿™ä¸ªå€¼å¿…é¡»å¤§äºŽcommand_timeoutå€¼ï¼Œå¹¶ä¸”å°äºŽconnect_timeout# é»˜è®¤ï¼š30connect_retry_timeout = 15# å“åº”è¶…æ—¶æ—¶é—´å€¼# é»˜è®¤ï¼š10command_timeout = 10 accelerateaccelerateæ¨¡å¼ï¼ˆåŠ é€Ÿæ¨¡å¼ï¼‰çš„ç›¸å…³é…ç½®ã€‚ 123456789101112131415# åŠ é€Ÿè¿žæŽ¥ç«¯å£# é»˜è®¤ï¼š5099accelerate_port = 5099# å‘½ä»¤æ‰§è¡Œè¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’# é»˜è®¤ï¼š30accelerate_timeout = 30# è¿žæŽ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’# é»˜è®¤ï¼š5.0accelerate_connect_timeout = 5.0# è¿›ç¨‹è¶…æ—¶æ—¶é—´ï¼Œå•ä½åˆ†é’Ÿ# é»˜è®¤ï¼š30accelerate_daemon_timeout = 30# æ˜¯å¦å…è®¸åŠ è½½å¤šä¸ªç§é’¥# é»˜è®¤ï¼šno#accelerate_multi_key = yes selinuxselinuxçš„ç›¸å…³é…ç½®ã€‚ 1234567[selinux]# æ–‡ä»¶ç³»ç»Ÿåœ¨å¤„ç†å®‰å…¨ä¸Šä¸‹æ–‡æ—¶éœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œå®šä¹‰å¤åˆ¶çŽ°æœ‰ä¸Šä¸‹æ–‡çš„æ–‡ä»¶ç³»ç»Ÿ# é»˜è®¤ï¼šfuse, nfs, vboxsf, ramfs, 9pspecial_context_filesystems = nfs,vboxsf,fuse,ramfs,9p# æ˜¯å¦ä»¥å…è®¸libvirt_lxcè¿žæŽ¥åœ¨æ²¡æœ‰SELinuxçš„æƒ…å†µä¸‹å·¥ä½œ# é»˜è®¤ï¼šFalselibvirt_lxc_noseclabel = yes colorsé¢œè‰²çš„ç›¸å…³é…ç½®ã€‚ 123456789101112131415# è¿™éƒ¨åˆ†æ ¹æ®è‡ªå·±éœ€è¦ä¿®æ”¹ï¼ŒåŸºæœ¬ä¸ä¼šè¿›è¡Œé…ç½®ã€‚[colors]highlight = whiteverbose = bluewarn = bright purpleerror = reddebug = dark graydeprecate = purpleskip = cyanunreachable = redok = greenchanged = yellowdiff_add = greendiff_remove = reddiff_lines = cyan diffæ‰“å°å·®å¼‚çš„ç›¸å…³é…ç½®ã€‚ 12345678[diff]# æ˜¯å¦æ€»æ˜¯æ‰“å°æ”¹å˜çŠ¶æ€æ˜¯çš„å·®å¼‚# é»˜è®¤ï¼šno# å¯é€‰ï¼šyesï¼ˆç›¸å½“äºŽ--diffï¼‰always = no# æ‰“å°æ–‡ä»¶å·®å¼‚æ—¶ï¼Œéœ€è¦æ˜¾ç¤ºä¸Šä¸‹æ–‡çš„è¡Œæ•°# é»˜è®¤ï¼š3context = 3]]></content>
      <categories>
        <category>Ansible</category>
      </categories>
      <tags>
        <tag>Ansible</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Centos å†…å­˜ä¿¡æ¯]]></title>
    <url>%2F2018%2F07%2F23%2FCentos%20%E5%86%85%E5%AD%98%E4%BF%A1%E6%81%AF%2F</url>
    <content type="text"><![CDATA[1 Free1.1 CentOS6åŠä»¥å‰åœ¨CentOS6åŠä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œfreeå‘½ä»¤è¾“å‡ºæ˜¯è¿™æ ·çš„ï¼š 123456$free -m total used free shared buffers cachedMem: 1002 769 233 0 62 421-/+ buffers/cache: 286 716Swap: 1153 0 1153 ç¬¬ä¸€è¡Œï¼š â€‹ ç³»ç»Ÿå†…å­˜ä¸»è¦åˆ†ä¸ºå››éƒ¨åˆ†ï¼šused(ç¨‹åºå·²ä½¿ç”¨å†…å­˜)ï¼Œfree(ç©ºé—²å†…å­˜)ï¼Œbuffers(buffer cache)ï¼Œ cached(Page cache)ã€‚ â€‹ ç³»ç»Ÿæ€»å†…å­˜total = used + freeï¼› bufferså’Œcachedè¢«ç®—åœ¨usedé‡Œï¼Œå› æ­¤ç¬¬ä¸€è¡Œç³»ç»Ÿå·²ä½¿ç”¨å†…å­˜used = buffers + cached + ç¬¬äºŒè¡Œç³»ç»Ÿå·²ä½¿ç”¨å†…å­˜usedã€‚ â€‹ ç”±äºŽbufferså’Œcachedåœ¨ç³»ç»Ÿéœ€è¦æ—¶å¯ä»¥è¢«å›žæ”¶ä½¿ç”¨ï¼Œå› æ­¤ç³»ç»Ÿå¯ç”¨å†…å­˜ = free + buffers + cachedï¼› â€‹ sharedä¸ºç¨‹åºå…±äº«çš„å†…å­˜ç©ºé—´ï¼Œå¾€å¾€ä¸º0ã€‚ ç¬¬äºŒè¡Œï¼š æ­£å› ä¸ºbufferså’Œcachedåœ¨ç³»ç»Ÿéœ€è¦æ—¶å¯ä»¥è¢«å›žæ”¶ä½¿ç”¨ï¼Œå› æ­¤bufferå’Œcachedå…¶å®žå¯ä»¥å¯ä»¥ç®—ä½œå¯ç”¨å†…å­˜ï¼Œå› æ­¤ï¼š ç³»ç»Ÿå¯ç”¨å†…å­˜ï¼Œå³ç¬¬äºŒè¡Œçš„free = ç¬¬ä¸€è¡Œçš„free + buffers + cachedã€‚ ç³»ç»Ÿå·²ä½¿ç”¨å†…å­˜ï¼Œå³ç¬¬äºŒè¡Œçš„used = total - ç¬¬äºŒè¡Œfreeã€‚ ç¬¬ä¸‰è¡Œï¼š â€‹ swapå†…å­˜äº¤æ¢ç©ºé—´ä½¿ç”¨æƒ…å†µã€‚ 1.2 CentOS7åŠä»¥åŽ CentOS7åŠä»¥åŽfreeå‘½ä»¤çš„è¾“å‡ºå¦‚ä¸‹ï¼š 1234# free -m total used free shared buff/cache availableMem: 3440 213 2276 168 950 2778Swap: 0 0 0 bufferå’Œcachedè¢«åˆæˆä¸€ç»„ï¼ŒåŠ å…¥äº†ä¸€ä¸ªavailableï¼Œå…³äºŽæ­¤availableï¼Œæ–‡æ¡£ä¸Šçš„è¯´æ˜Žå¦‚ä¸‹ï¼š MemAvailable: An estimate of how much memory is available for starting new applications, without swapping. å³ç³»ç»Ÿå¯ç”¨å†…å­˜ï¼Œä¹‹å‰è¯´è¿‡ç”±äºŽbufferå’Œcacheå¯ä»¥åœ¨éœ€è¦æ—¶è¢«é‡Šæ”¾å›žæ”¶ï¼Œç³»ç»Ÿå¯ç”¨å†…å­˜å³ free + buffer + cacheï¼Œåœ¨CentOS 7ä¹‹åŽè¿™ç§è¯´æ³•å¹¶ä¸å‡†ç¡®ï¼Œå› ä¸ºå¹¶ä¸æ˜¯æ‰€æœ‰çš„buffer/cacheç©ºé—´éƒ½å¯ä»¥è¢«å›žæ”¶ã€‚ å³available = free + buffer/cache - ä¸å¯è¢«å›žæ”¶å†…å­˜(å…±äº«å†…å­˜æ®µã€tmpfsã€ramfsç­‰)ã€‚ å› æ­¤åœ¨CentOS7ä¹‹åŽï¼Œç”¨æˆ·ä¸éœ€è¦åŽ»è®¡ç®—buffer/cacheï¼Œå³å¯ä»¥çœ‹åˆ°è¿˜æœ‰å¤šå°‘å†…å­˜å¯ç”¨ï¼Œæ›´åŠ ç®€å•ç›´è§‚ã€‚ 1.3 buffer/cacheç›¸å…³ä»‹ç»ä»€ä¹ˆæ˜¯buffer/cacheï¼Ÿ buffer å’Œ cache æ˜¯ä¸¤ä¸ªåœ¨è®¡ç®—æœºæŠ€æœ¯ä¸­è¢«ç”¨æ»¥çš„åè¯ï¼Œæ”¾åœ¨ä¸é€šè¯­å¢ƒä¸‹ä¼šæœ‰ä¸åŒçš„æ„ä¹‰ã€‚åœ¨ Linux çš„å†…å­˜ç®¡ç†ä¸­ï¼Œè¿™é‡Œçš„ buffer æŒ‡ Linux å†…å­˜çš„ï¼š Buffer cache ã€‚è¿™é‡Œçš„ cache æŒ‡ Linux å†…å­˜ä¸­çš„ï¼š Page cache ã€‚ç¿»è¯‘æˆä¸­æ–‡å¯ä»¥å«åšç¼“å†²åŒºç¼“å­˜å’Œé¡µé¢ç¼“å­˜ã€‚åœ¨åŽ†å²ä¸Šï¼Œå®ƒä»¬ä¸€ä¸ªï¼ˆ buffer ï¼‰è¢«ç”¨æ¥å½“æˆå¯¹ io è®¾å¤‡å†™çš„ç¼“å­˜ï¼Œè€Œå¦ä¸€ä¸ªï¼ˆ cache ï¼‰è¢«ç”¨æ¥å½“ä½œå¯¹ io è®¾å¤‡çš„è¯»ç¼“å­˜ï¼Œè¿™é‡Œçš„ io è®¾å¤‡ï¼Œä¸»è¦æŒ‡çš„æ˜¯å—è®¾å¤‡æ–‡ä»¶å’Œæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ™®é€šæ–‡ä»¶ã€‚ä½†æ˜¯çŽ°åœ¨ï¼Œå®ƒä»¬çš„æ„ä¹‰å·²ç»ä¸ä¸€æ ·äº†ã€‚åœ¨å½“å‰çš„å†…æ ¸ä¸­ï¼Œ page cache é¡¾åæ€ä¹‰å°±æ˜¯é’ˆå¯¹å†…å­˜é¡µçš„ç¼“å­˜ï¼Œè¯´ç™½äº†å°±æ˜¯ï¼Œå¦‚æžœæœ‰å†…å­˜æ˜¯ä»¥ page è¿›è¡Œåˆ†é…ç®¡ç†çš„ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ page cache ä½œä¸ºå…¶ç¼“å­˜æ¥ç®¡ç†ä½¿ç”¨ã€‚å½“ç„¶ï¼Œä¸æ˜¯æ‰€æœ‰çš„å†…å­˜éƒ½æ˜¯ä»¥é¡µï¼ˆ page ï¼‰è¿›è¡Œç®¡ç†çš„ï¼Œä¹Ÿæœ‰å¾ˆå¤šæ˜¯é’ˆå¯¹å—ï¼ˆ block ï¼‰è¿›è¡Œç®¡ç†çš„ï¼Œè¿™éƒ¨åˆ†å†…å­˜ä½¿ç”¨å¦‚æžœè¦ç”¨åˆ° cache åŠŸèƒ½ï¼Œåˆ™éƒ½é›†ä¸­åˆ° buffer cache ä¸­æ¥ä½¿ç”¨ã€‚ï¼ˆä»Žè¿™ä¸ªè§’åº¦å‡ºå‘ï¼Œæ˜¯ä¸æ˜¯ buffer cache æ”¹åå«åš block cache æ›´å¥½ï¼Ÿï¼‰ç„¶è€Œï¼Œä¹Ÿä¸æ˜¯æ‰€æœ‰å—ï¼ˆ block ï¼‰éƒ½æœ‰å›ºå®šé•¿åº¦ï¼Œç³»ç»Ÿä¸Šå—çš„é•¿åº¦ä¸»è¦æ˜¯æ ¹æ®æ‰€ä½¿ç”¨çš„å—è®¾å¤‡å†³å®šçš„ï¼Œè€Œé¡µé•¿åº¦åœ¨ X86 ä¸Šæ— è®ºæ˜¯ 32 ä½è¿˜æ˜¯ 64 ä½éƒ½æ˜¯ 4k ã€‚ æ˜Žç™½äº†è¿™ä¸¤å¥—ç¼“å­˜ç³»ç»Ÿçš„åŒºåˆ«ï¼Œå°±å¯ä»¥ç†è§£å®ƒä»¬ç©¶ç«Ÿéƒ½å¯ä»¥ç”¨æ¥åšä»€ä¹ˆäº†ã€‚ ä»€ä¹ˆæ˜¯ page cache Page cache ä¸»è¦ç”¨æ¥ä½œä¸ºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ–‡ä»¶æ•°æ®çš„ç¼“å­˜æ¥ç”¨ï¼Œå°¤å…¶æ˜¯é’ˆå¯¹å½“è¿›ç¨‹å¯¹æ–‡ä»¶æœ‰ read ï¼ write æ“ä½œçš„æ—¶å€™ã€‚å¦‚æžœä½ ä»”ç»†æƒ³æƒ³çš„è¯ï¼Œä½œä¸ºå¯ä»¥æ˜ å°„æ–‡ä»¶åˆ°å†…å­˜çš„ç³»ç»Ÿè°ƒç”¨ï¼š mmap æ˜¯ä¸æ˜¯å¾ˆè‡ªç„¶çš„ä¹Ÿåº”è¯¥ç”¨åˆ° page cache ï¼Ÿåœ¨å½“å‰çš„ç³»ç»Ÿå®žçŽ°é‡Œï¼Œ page cache ä¹Ÿè¢«ä½œä¸ºå…¶å®ƒæ–‡ä»¶ç±»åž‹çš„ç¼“å­˜è®¾å¤‡æ¥ç”¨ï¼Œæ‰€ä»¥äº‹å®žä¸Š page cache ä¹Ÿè´Ÿè´£äº†å¤§éƒ¨åˆ†çš„å—è®¾å¤‡æ–‡ä»¶çš„ç¼“å­˜å·¥ä½œã€‚ ä»€ä¹ˆæ˜¯ buffer cache Buffer cache åˆ™ä¸»è¦æ˜¯è®¾è®¡ç”¨æ¥åœ¨ç³»ç»Ÿå¯¹å—è®¾å¤‡è¿›è¡Œè¯»å†™çš„æ—¶å€™ï¼Œå¯¹å—è¿›è¡Œæ•°æ®ç¼“å­˜çš„ç³»ç»Ÿæ¥ä½¿ç”¨ã€‚è¿™æ„å‘³ç€æŸäº›å¯¹å—çš„æ“ä½œä¼šä½¿ç”¨ buffer cache è¿›è¡Œç¼“å­˜ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿçš„æ—¶å€™ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ä¸¤ä¸ªç¼“å­˜ç³»ç»Ÿæ˜¯ä¸€èµ·é…åˆä½¿ç”¨çš„ï¼Œæ¯”å¦‚å½“æˆ‘ä»¬å¯¹ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œå†™æ“ä½œçš„æ—¶å€™ï¼Œ page cache çš„å†…å®¹ä¼šè¢«æ”¹å˜ï¼Œè€Œ buffer cache åˆ™å¯ä»¥ç”¨æ¥å°† page æ ‡è®°ä¸ºä¸åŒçš„ç¼“å†²åŒºï¼Œå¹¶è®°å½•æ˜¯å“ªä¸€ä¸ªç¼“å†²åŒºè¢«ä¿®æ”¹äº†ã€‚è¿™æ ·ï¼Œå†…æ ¸åœ¨åŽç»­æ‰§è¡Œè„æ•°æ®çš„å›žå†™ï¼ˆ writeback ï¼‰æ—¶ï¼Œå°±ä¸ç”¨å°†æ•´ä¸ª page å†™å›žï¼Œè€Œåªéœ€è¦å†™å›žä¿®æ”¹çš„éƒ¨åˆ†å³å¯ã€‚ å¦‚ä½•å›žæ”¶ cache ï¼Ÿ Linux å†…æ ¸ä¼šåœ¨å†…å­˜å°†è¦è€—å°½çš„æ—¶å€™ï¼Œè§¦å‘å†…å­˜å›žæ”¶çš„å·¥ä½œï¼Œä»¥ä¾¿é‡Šæ”¾å‡ºå†…å­˜ç»™æ€¥éœ€å†…å­˜çš„è¿›ç¨‹ä½¿ç”¨ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ“ä½œä¸­ä¸»è¦çš„å†…å­˜é‡Šæ”¾éƒ½æ¥è‡ªäºŽå¯¹ buffer ï¼ cache çš„é‡Šæ”¾ã€‚å°¤å…¶æ˜¯è¢«ä½¿ç”¨æ›´å¤šçš„ cache ç©ºé—´ã€‚æ—¢ç„¶å®ƒä¸»è¦ç”¨æ¥åšç¼“å­˜ï¼Œåªæ˜¯åœ¨å†…å­˜å¤Ÿç”¨çš„æ—¶å€™åŠ å¿«è¿›ç¨‹å¯¹æ–‡ä»¶çš„è¯»å†™é€Ÿåº¦ï¼Œé‚£ä¹ˆåœ¨å†…å­˜åŽ‹åŠ›è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œå½“ç„¶æœ‰å¿…è¦æ¸…ç©ºé‡Šæ”¾ cache ï¼Œä½œä¸º free ç©ºé—´åˆ†ç»™ç›¸å…³è¿›ç¨‹ä½¿ç”¨ã€‚æ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è®¤ä¸º buffer/cache ç©ºé—´å¯ä»¥è¢«é‡Šæ”¾ï¼Œè¿™ä¸ªç†è§£æ˜¯æ­£ç¡®çš„ã€‚ ä½†æ˜¯è¿™ç§æ¸…ç¼“å­˜çš„å·¥ä½œä¹Ÿå¹¶ä¸æ˜¯æ²¡æœ‰æˆæœ¬ã€‚ç†è§£ cache æ˜¯å¹²ä»€ä¹ˆçš„å°±å¯ä»¥æ˜Žç™½æ¸…ç¼“å­˜å¿…é¡»ä¿è¯ cache ä¸­çš„æ•°æ®è·Ÿå¯¹åº”æ–‡ä»¶ä¸­çš„æ•°æ®ä¸€è‡´ï¼Œæ‰èƒ½å¯¹ cache è¿›è¡Œé‡Šæ”¾ã€‚æ‰€ä»¥ä¼´éšç€ cache æ¸…é™¤çš„è¡Œä¸ºçš„ï¼Œä¸€èˆ¬éƒ½æ˜¯ç³»ç»Ÿ IO é£™é«˜ã€‚å› ä¸ºå†…æ ¸è¦å¯¹æ¯” cache ä¸­çš„æ•°æ®å’Œå¯¹åº”ç¡¬ç›˜æ–‡ä»¶ä¸Šçš„æ•°æ®æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æžœä¸ä¸€è‡´éœ€è¦å†™å›žï¼Œä¹‹åŽæ‰èƒ½å›žæ”¶ã€‚ åœ¨ç³»ç»Ÿä¸­é™¤äº†å†…å­˜å°†è¢«è€—å°½çš„æ—¶å€™å¯ä»¥æ¸…ç¼“å­˜ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™ä¸ªæ–‡ä»¶æ¥äººå·¥è§¦å‘ç¼“å­˜æ¸…é™¤çš„æ“ä½œï¼š 12[root@tencent64 ~]# cat /proc/sys/vm/drop_caches 1 æ–¹æ³•æ˜¯ï¼š 1echo 1 &gt; /proc/sys/vm/drop_caches å½“ç„¶ï¼Œè¿™ä¸ªæ–‡ä»¶å¯ä»¥è®¾ç½®çš„å€¼åˆ†åˆ«ä¸º 1 ã€ 2 ã€ 3 ã€‚å®ƒä»¬æ‰€è¡¨ç¤ºçš„å«ä¹‰ä¸ºï¼š echo 1 &gt; /proc/sys/vm/drop_caches:è¡¨ç¤ºæ¸…é™¤ pagecache ã€‚ echo 2 &gt; /proc/sys/vm/drop_caches:è¡¨ç¤ºæ¸…é™¤å›žæ”¶ slab åˆ†é…å™¨ä¸­çš„å¯¹è±¡ï¼ˆåŒ…æ‹¬ç›®å½•é¡¹ç¼“å­˜å’Œ inode ç¼“å­˜ï¼‰ã€‚ slab åˆ†é…å™¨æ˜¯å†…æ ¸ä¸­ç®¡ç†å†…å­˜çš„ä¸€ç§æœºåˆ¶ï¼Œå…¶ä¸­å¾ˆå¤šç¼“å­˜æ•°æ®å®žçŽ°éƒ½æ˜¯ç”¨çš„ pagecache ã€‚ echo 3 &gt; /proc/sys/vm/drop_caches:è¡¨ç¤ºæ¸…é™¤ pagecache å’Œ slab åˆ†é…å™¨ä¸­çš„ç¼“å­˜å¯¹è±¡ã€‚]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Pythonå­¦ä¹ ç¬”è®°-staticmethodã€classmethod]]></title>
    <url>%2F2018%2F07%2F14%2FPython%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-staticmethod%E3%80%81classmethod%2F</url>
    <content type="text"><![CDATA[ç½‘ä¸Šçœ‹åˆ°çš„ å†™çš„å¾ˆæ¸…æ™°ä¹‹åŽå†æ•´ç† 1234567891011121314151617181920212223# é™æ€å‡½æ•°ï¼Œç±»å‡½æ•°ï¼Œæˆå‘˜å‡½æ•° # é™æ€å‡½æ•°(@staticmethod): å³é™æ€æ–¹æ³•,ä¸»è¦å¤„ç†ä¸Žè¿™ä¸ªç±»çš„é€»è¾‘å…³è”, å¦‚éªŒè¯æ•°æ®; # ç±»å‡½æ•°(@classmethod):å³ç±»æ–¹æ³•, æ›´å…³æ³¨äºŽä»Žç±»ä¸­è°ƒç”¨æ–¹æ³•, è€Œä¸æ˜¯åœ¨å®žä¾‹ä¸­è°ƒç”¨æ–¹æ³•, å¦‚æž„é€ é‡è½½; # æˆå‘˜å‡½æ•°: å®žä¾‹çš„æ–¹æ³•, åªèƒ½é€šè¿‡å®žä¾‹è¿›è¡Œè°ƒç”¨; class Person: grade=1 def __init__(self,name): self.name = name def sayHi(self):#åŠ  self åŒºåˆ«äºŽæ™®é€šå‡½æ•° print 'Hello, your name is?',self.name # å£°æ˜Žé™æ€ï¼ŒåŽ»æŽ‰åˆ™ç¼–è¯‘æŠ¥é”™;è¿˜æœ‰é™æ€æ–¹æ³•ä¸èƒ½è®¿é—®ç±»å˜é‡å’Œå®žä¾‹å˜é‡ # å¥½å¤„ï¼šä¸éœ€è¦å®šä¹‰å®žä¾‹å³å¯ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚å¦å¤–ï¼Œå¤šä¸ªå®žä¾‹å…±äº«æ­¤é™æ€æ–¹æ³•ã€‚ @staticmethod def sayName():#ä½¿ç”¨äº†é™æ€æ–¹æ³•ï¼Œåˆ™ä¸èƒ½å†ä½¿ç”¨ self print "my name is king"#,grade,#self.name # ç±»æ–¹æ³•ï¼šä¸€ä¸ªç±»æ–¹æ³•å°±å¯ä»¥é€šè¿‡ç±»æˆ–å®ƒçš„å®žä¾‹æ¥è°ƒç”¨çš„æ–¹æ³•, # ä¸ç®¡ä½ æ˜¯ç”¨ç±»æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•è¿˜æ˜¯ç±»å®žä¾‹è°ƒç”¨è¿™ä¸ªæ–¹æ³•,è¯¥æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ€»æ˜¯å®šä¹‰è¯¥æ–¹æ³•çš„ç±»å¯¹è±¡ã€‚ @classmethod def classMethod(cls): print("class method") é¡ºä¾¿æä¸€ä¸‹ç±»å±žæ€§å’Œå®žä¾‹å±žæ€§ï¼š ç±»å±žæ€§å¯ç”¨äºŽä¸ºå®žä¾‹å±žæ€§æä¾›é»˜è®¤å€¼ã€‚ ç±»å±žæ€§å°±æ˜¯ç±»ä¸­ä¸åŠ selfçš„å±žæ€§ï¼š 12345678910class Vector2d: typecode = 'd' def __init__(self, x, y): self.__x = float(x) self.__y = float(y) def __bytes__(self): return (bytes([ord(self.typecode)]) + bytes(array(self.typecode, self))) 123456789101112131415161718Vector2d.typecodeOut[11]: 'd' # åˆ›å»ºå®žä¾‹æ—¶ï¼Œç±»å±žæ€§ä¼šè¢«å½“æˆå®žä¾‹å±žæ€§å¹¶ä¸ºå®žä¾‹å±žæ€§æä¾›é»˜è®¤å€¼v1 = Vector2d(1.1, 2.2)dumpd = bytes(v1)dumpdOut[14]: b'd\x9a\x99\x99\x99\x99\x99\xf1?\x9a\x99\x99\x99\x99\x99\x01@' # ä¿®æ”¹å®žä¾‹å±žæ€§v1.typecode = 'f'dumpf = bytes(v1)dumpfOut[18]: b'f\xcd\xcc\x8c?\xcd\xcc\x0c@' # ç±»å±žæ€§æ²¡æœ‰å˜Vector2d.typecodeOut[19]: 'd' è¿™ç§ç±»åž‹å¯ä»¥ç›´æŽ¥é€šè¿‡ç±»æ¥è®¿é—®ç±»å±žæ€§ï¼› åˆ›å»ºå®žä¾‹æ—¶ï¼Œç±»å±žæ€§ä¼šè¢«å½“æˆå®žä¾‹å±žæ€§å¹¶ä¸ºå®žä¾‹å±žæ€§æä¾›é»˜è®¤å€¼ã€‚ æ‰€ä»¥è¯´æ·»åŠ æ–¹æ³•æ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨self.typecodeæ¥èŽ·å–å®žä¾‹å±žæ€§ã€‚ å¦‚æžœæƒ³ä¿®æ”¹ç±»å±žæ€§çš„å€¼ï¼Œå¿…é¡»ç›´æŽ¥åœ¨ç±»ä¸Šä¿®æ”¹ï¼Œä¸èƒ½é€šè¿‡å®žä¾‹ä¿®æ”¹ã€‚ 1Vector2d.typecode = 'f' æœ‰ç§ä¿®æ”¹æ–¹æ³•æ›´ç¬¦åˆPythoné£Žæ ¼ï¼Œè€Œä¸”æ•ˆæžœæ›´æŒä¹…ï¼Œä¹Ÿæ›´æœ‰é’ˆå¯¹æ€§ã€‚ç±»å±žæ€§æ˜¯å…¬å¼€çš„ï¼Œå› æ­¤ä¼šè¢«å­ç±»ç»§æ‰¿ï¼ŒäºŽæ˜¯ç»å¸¸ä¼šåˆ›å»ºä¸€ä¸ªå­ç±»ï¼Œåªç”¨äºŽå®šåˆ¶ç±»çš„æ•°æ®å±žæ€§ã€‚ DjangoåŸºäºŽç±»çš„è§†å›¾å°±å¤§é‡ä½¿ç”¨äº†è¿™ä¸ªæŠ€æœ¯ã€‚ 123from vector2d_v1 import Vector2dclass ShortVector2d(Vector2d): typecode = 'f']]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Pythonå­¦ä¹ ç¬”è®°-timeæ¨¡å—]]></title>
    <url>%2F2018%2F07%2F13%2FPython%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-time%E6%A8%A1%E5%9D%97%2F</url>
    <content type="text"><![CDATA[åœ¨Pythonä¸­ï¼Œä¸Žæ—¶é—´å¤„ç†æœ‰å…³çš„æ¨¡å—åŒ…æ‹¬ï¼štimeï¼Œdatetimeä»¥åŠcalendarã€‚ Timeæ¨¡å—-æ—¶é—´èŽ·å–å’Œè½¬æ¢ä¸€äº›æœ¯è¯­å’Œçº¦å®šçš„è§£é‡Š UTCï¼ˆCoordinated Universal Timeï¼Œä¸–ç•Œåè°ƒæ—¶ ï¼‰ï¼Œä¹Ÿå«æ ¼æž—å¨æ²»å¤©æ–‡æ—¶é—´ï¼Œæ˜¯ä¸–ç•Œæ ‡å‡†æ—¶é—´ã€‚åœ¨ä¸­å›½ä¸ºUTC+8 DSTï¼ˆDaylight Saving Time ï¼‰ï¼Œå³å¤ä»¤æ—¶ï¼Œæ˜¯ä¸€ç§ä¸ºèŠ‚çº¦èƒ½æºè€Œäººä¸ºè§„å®šåœ°æ–¹æ—¶é—´çš„åˆ¶åº¦ï¼Œä¸€èˆ¬åœ¨å¤©äº®æ—©çš„å¤å­£äººä¸ºå°†æ—¶é—´æå‰ä¸€å°æ—¶ã€‚åœ¨ä¸­å›½1992å¹´å·²ç»åœæ­¢ ä¸€äº›å®žæ—¶å‡½æ•°çš„è®¡ç®—ç²¾åº¦å¯èƒ½ä½ŽäºŽå®ƒä»¬å»ºè®®çš„å€¼æˆ–å‚æ•°ï¼Œä¾‹å¦‚åœ¨å¤§éƒ¨åˆ†Unixç³»ç»Ÿï¼Œæ—¶é’Ÿä¸€ç§’é’Ÿâ€æ»´ç­”â€œ50~100æ¬¡ ä¸¤ç§è¡¨çŽ°å½¢å¼æ—¶é—´æˆ³ï¼ˆtimestampï¼‰ï¼š é€šå¸¸æ¥è¯´ï¼Œæ—¶é—´æˆ³è¡¨ç¤ºçš„æ˜¯ä»Ž1970å¹´1æœˆ1æ—¥00:00:00å¼€å§‹æŒ‰ç§’è®¡ç®—çš„åç§»é‡ï¼ˆtime.gmtime(0)ï¼‰ï¼Œæ­¤æ¨¡å—ä¸­çš„å‡½æ•°æ— æ³•å¤„ç†1970çºªå…ƒå¹´ä»¥å‰çš„æ—¥æœŸå’Œæ—¶é—´æˆ–å¤ªé¥è¿œçš„æœªæ¥ï¼ˆå¤„ç†æžé™å–å†³äºŽCå‡½æ•°åº“ï¼Œå¯¹äºŽ32ä½çš„ç³»ç»Ÿæ¥è¯´æ˜¯2038å¹´ï¼‰ æ—¶é—´å…ƒç»„ï¼ˆtime.struct_timeï¼‰ï¼š gmtime()ï¼Œlocaltime()å’Œstrptime()ä»¥æ—¶é—´å…ƒç»„ï¼ˆstruct_timeï¼‰çš„å½¢å¼è¿”å›žã€‚ ç´¢å¼•å€¼ï¼ˆIndexï¼‰ å±žæ€§ï¼ˆAttributeï¼‰ å€¼ï¼ˆValuesï¼‰ 0 tm_yearï¼ˆå¹´ï¼‰ ï¼ˆä¾‹å¦‚ï¼š2015ï¼‰ 1 tm_monï¼ˆæœˆï¼‰ 1 ~ 12 2 tm_mdayï¼ˆæ—¥ï¼‰ 1 ~ 31 3 tm_hourï¼ˆæ—¶ï¼‰ 0 ~ 23 4 tm_minï¼ˆåˆ†ï¼‰ 0 ~ 59 5 tm_secï¼ˆç§’ï¼‰ 0 ~ 61ï¼ˆè§ä¸‹æ–¹æ³¨1ï¼‰ 6 tm_wdayï¼ˆæ˜ŸæœŸå‡ ï¼‰ 0 ~ 6ï¼ˆ0 è¡¨ç¤ºæ˜ŸæœŸä¸€ï¼‰ 7 tm_ydayï¼ˆä¸€å¹´ä¸­çš„ç¬¬å‡ å¤©ï¼‰ 1 ~ 366 8 tm_isdstï¼ˆæ˜¯å¦ä¸ºå¤ä»¤æ—¶ï¼‰ 0ï¼Œ 1ï¼Œ -1ï¼ˆ-1 ä»£è¡¨å¤ä»¤æ—¶ï¼‰ æ³¨1ï¼š60 ä»£è¡¨é—°ç§’ï¼Œ61 æ˜¯åŸºäºŽåŽ†å²åŽŸå› ä¿ç•™ã€‚ å±žæ€§timezonetime.timezone å±žæ€§è¿”å›žå½“åœ°æ—¶é—´ä¸Žæ ‡å‡†UTCæ—¶é—´çš„è¯¯å·®ï¼Œä»¥ç§’è®¡ ï¼ˆç¾Žæ´² &gt;0ï¼›å¤§éƒ¨åˆ†æ¬§æ´²ï¼Œäºšæ´²ï¼Œéžæ´² &lt;= 0 1234&gt;&gt;&gt; time.timezone-28800&gt;&gt;&gt; -8*60*60-28800 altzonetime.altzoneå±žæ€§è¿”å›žå½“åœ°å¤ä»¤æ—¶æ—¶é—´ä¸Žæ ‡å‡†UTCæ—¶é—´çš„è¯¯å·®ï¼Œä»¥ç§’è®¡ã€‚ 1234&gt;&gt;&gt; time.altzone-32400&gt;&gt;&gt; -9*60*60-32400 daylight å½“åœ°æ—¶é—´æ˜¯å¦åæ˜ å¤ä»¤æ—¶ï¼Œé»˜è®¤ä¸º0 12&gt;&gt;&gt; time.daylight0 time.tznametime.tznameå±žæ€§åŒ…å«ä¸€å¯¹æ ¹æ®æƒ…å†µçš„ä¸åŒè€Œä¸åŒçš„å­—ç¬¦ä¸²ï¼Œåˆ†åˆ«æ˜¯å¸¦å¤ä»¤æ—¶çš„æœ¬åœ°æ—¶åŒºåç§°ï¼Œå’Œä¸å¸¦çš„ã€‚ (æ ‡å‡†æ—¶åŒºåç§°,å¤ä»¤æ—¶æ—¶åŒºåç§°çš„å…ƒç»„) 12&gt;&gt;&gt; time.tzname('Ã–ÃÂ¹ÃºÂ±ÃªÃ—Â¼ÃŠÂ±Â¼Ã¤', 'Ã–ÃÂ¹ÃºÃÃ„ÃÃ®ÃŠÂ±') å‡½æ•°timetime() è¿”å›žå½“å‰æ—¶é—´çš„æ—¶é—´æˆ³ï¼ˆ1970çºªå…ƒå¹´åŽç»è¿‡çš„æµ®ç‚¹ç§’æ•°ï¼‰ 12&gt;&gt;&gt; time.time()1531461304.5539289 asctime asctime(â€¦) asctime([tuple]) -&gt; string æŽ¥å—æ—¶é—´å…ƒç»„å¹¶è¿”å›žä¸€ä¸ªå¯è¯»çš„å½¢å¼ä¸ºâ€Tue Dec 11 18:07:14 2015â€ï¼ˆ2015å¹´12æœˆ11æ—¥ å‘¨äºŒ 18æ—¶07åˆ†14ç§’ï¼‰çš„ 24 ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²ã€‚ 12345&gt;&gt;&gt; t = time.localtime()&gt;&gt;&gt; ttime.struct_time(tm_year=2018, tm_mon=7, tm_mday=13, tm_hour=13, tm_min=38, tm_sec=44, tm_wday=4, tm_yday=194, tm_isdst=0)&gt;&gt;&gt; time.asctime(t)'Fri Jul 13 13:38:44 2018' clock clock(â€¦) clock() -&gt; floating point number ç”¨ä»¥æµ®ç‚¹æ•°è®¡ç®—çš„ç§’æ•°è¿”å›žå½“å‰çš„ CPU æ—¶é—´ã€‚ç”¨æ¥è¡¡é‡ä¸åŒç¨‹åºçš„è€—æ—¶ï¼Œæ¯” time.time() æ›´æœ‰ç”¨ã€‚ Python 3.3 ä»¥åŽä¸è¢«æŽ¨èï¼Œç”±äºŽè¯¥æ–¹æ³•ä¾èµ–æ“ä½œç³»ç»Ÿï¼Œå»ºè®®ä½¿ç”¨ perf_counter() æˆ– process_time() ä»£æ›¿ï¼ˆä¸€ä¸ªè¿”å›žç³»ç»Ÿè¿è¡Œæ—¶é—´ï¼Œä¸€ä¸ªè¿”å›žè¿›ç¨‹è¿è¡Œæ—¶é—´ï¼Œè¯·æŒ‰ç…§å®žé™…éœ€æ±‚é€‰æ‹©ï¼‰ åœ¨ä¸åŒçš„ç³»ç»Ÿä¸Šå«ä¹‰ä¸åŒã€‚åœ¨UNIXç³»ç»Ÿä¸Šï¼Œå®ƒè¿”å›žçš„æ˜¯â€œè¿›ç¨‹æ—¶é—´â€ï¼Œå®ƒæ˜¯ç”¨ç§’è¡¨ç¤ºçš„æµ®ç‚¹æ•°ï¼ˆæ—¶é—´æˆ³ï¼‰ã€‚è€Œåœ¨Windowsä¸­ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œè¿”å›žçš„æ˜¯è¿›ç¨‹è¿è¡Œçš„å®žé™…æ—¶é—´ã€‚è€Œç¬¬äºŒæ¬¡ä¹‹åŽçš„è°ƒç”¨æ˜¯è‡ªç¬¬ä¸€æ¬¡è°ƒç”¨ä»¥åŽåˆ°çŽ°åœ¨çš„è¿è¡Œæ—¶é—´ã€‚ï¼ˆå®žé™…ä¸Šæ˜¯ä»¥WIN32ä¸ŠQueryPerformanceCounter()ä¸ºåŸºç¡€ï¼Œå®ƒæ¯”æ¯«ç§’è¡¨ç¤ºæ›´ä¸ºç²¾ç¡®ï¼‰ 12345678910# åœ¨Windowsä¸­ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œè¿”å›žçš„æ˜¯è¿›ç¨‹è¿è¡Œçš„å®žé™…æ—¶é—´ã€‚&gt;&gt;&gt; print('clock_1: %s' % time.clock() )clock_1: 4.276543543552533e-07# ç¬¬äºŒæ¬¡ä¹‹åŽçš„è°ƒç”¨æ˜¯è‡ªç¬¬ä¸€æ¬¡è°ƒç”¨ä»¥åŽåˆ°çŽ°åœ¨çš„è¿è¡Œæ—¶é—´ã€‚&gt;&gt;&gt; print('clock_1: %s' % time.clock() )clock_1: 2.2088326019731115&gt;&gt;&gt; print('clock_2: %s' % time.clock() )clock_2: 8.735795567533678&gt;&gt;&gt; print('clock_3: %s' % time.clock() )clock_3: 13.871665204801532 ctime ctime(â€¦) ctime(seconds) -&gt; string æŠŠä¸€ä¸ªæ—¶é—´æˆ³ï¼ˆæŒ‰ç§’è®¡ç®—çš„æµ®ç‚¹æ•°ï¼‰è½¬åŒ–ä¸ºtime.asctime()çš„å½¢å¼ã€‚å¦‚æžœå‚æ•°æœªç»™æˆ–è€…ä¸ºNoneçš„æ—¶å€™ï¼Œå°†ä¼šé»˜è®¤time.time()å³å½“å‰æ—¶é—´æˆ³ä¸ºå‚æ•°ã€‚å®ƒçš„ä½œç”¨ç›¸å½“äºŽtime.asctime(time.localtime(secs))ã€‚ 123456&gt;&gt;&gt; time.ctime()'Fri Jul 13 14:36:18 2018'&gt;&gt;&gt; time.time()1531463798.9535468&gt;&gt;&gt; time.ctime(1531463798.9535468)'Fri Jul 13 14:36:38 2018' localtime localtime(â€¦) localtime([seconds]) -&gt; (tm_year,tm_mon,tm_mday,tm_hour,tm_min, tm_sec,tm_wday,tm_yday,tm_isdst) å°†ä¸€ä¸ªæ—¶é—´æˆ³è½¬æ¢ä¸ºå½“å‰æ—¶åŒºçš„struct_timeã€‚secså‚æ•°æœªæä¾›ï¼Œåˆ™ä»¥å½“å‰æ—¶é—´ä¸ºå‡†ã€‚ 123456&gt;&gt;&gt; time.localtime()time.struct_time(tm_year=2018, tm_mon=7, tm_mday=13, tm_hour=14, tm_min=45, tm_sec=41, tm_wday=4, tm_yday=194, tm_isdst=0)&gt;&gt;&gt; time.time()1531464356.65697&gt;&gt;&gt; time.localtime(1531464356.65697)time.struct_time(tm_year=2018, tm_mon=7, tm_mday=13, tm_hour=14, tm_min=45, tm_sec=56, tm_wday=4, tm_yday=194, tm_isdst=0) gmtime gmtime(â€¦) gmtime([seconds]) -&gt; (tm_year, tm_mon, tm_mday, tm_hour, tm_min, tm_sec, tm_wday, tm_yday, tm_isdst) å’Œlocaltime()æ–¹æ³•ç±»ä¼¼ï¼Œgmtime()æ–¹æ³•æ˜¯å°†ä¸€ä¸ªæ—¶é—´æˆ³è½¬æ¢ä¸ºUTCæ—¶åŒºï¼ˆ0æ—¶åŒºï¼‰çš„struct_timeã€‚ 12&gt;&gt;&gt; time.gmtime()time.struct_time(tm_year=2018, tm_mon=7, tm_mday=13, tm_hour=6, tm_min=47, tm_sec=35, tm_wday=4, tm_yday=194, tm_isdst=0) mktime mktime(â€¦) mktime(tuple) -&gt; floating point number å°†ä¸€ä¸ªstruct_timeè½¬åŒ–ä¸ºæ—¶é—´æˆ³ã€‚ 12&gt;&gt;&gt; time.mktime(time.localtime())1531464557.0 perf_counter perf_counter(â€¦) perf_counter() -&gt; float è¿”å›žè®¡æ—¶å™¨çš„ç²¾å‡†æ—¶é—´ï¼ˆç³»ç»Ÿçš„è¿è¡Œæ—¶é—´ï¼‰ï¼ŒåŒ…å«æ•´ä¸ªç³»ç»Ÿçš„ç¡çœ æ—¶é—´ã€‚ç”±äºŽè¿”å›žå€¼çš„åŸºå‡†ç‚¹æ˜¯æœªå®šä¹‰çš„ï¼Œæ‰€ä»¥ï¼Œåªæœ‰è¿žç»­è°ƒç”¨çš„ç»“æžœä¹‹é—´çš„å·®æ‰æ˜¯æœ‰æ•ˆçš„ã€‚ 123456&gt;&gt;&gt; t0 = time.perf_counter()&gt;&gt;&gt; t01420.9757357472427&gt;&gt;&gt; t1 = time.perf_counter()&gt;&gt;&gt; t1 - t023.103979024409227 process_time(æœªç†è§£) process_time(â€¦) process_time() -&gt; float è¿”å›žå½“å‰è¿›ç¨‹æ‰§è¡Œ CPU çš„æ—¶é—´æ€»å’Œï¼Œä¸åŒ…å«ç¡çœ æ—¶é—´ã€‚ç”±äºŽè¿”å›žå€¼çš„åŸºå‡†ç‚¹æ˜¯æœªå®šä¹‰çš„ï¼Œæ‰€ä»¥ï¼Œåªæœ‰è¿žç»­è°ƒç”¨çš„ç»“æžœä¹‹é—´çš„å·®æ‰æ˜¯æœ‰æ•ˆçš„ã€‚ 12&gt;&gt;&gt; time.process_time()0.125 sleep sleep(â€¦) sleep(seconds) çº¿ç¨‹æŽ¨è¿ŸæŒ‡å®šçš„æ—¶é—´è¿è¡Œï¼Œå•ä½ä¸ºç§’ã€‚ 1sleep(2) strfimestrftime(â€¦) strftime(format[, tuple]) -&gt; string æŠŠä¸€ä¸ªä»£è¡¨æ—¶é—´çš„å…ƒç»„æˆ–è€…struct_timeï¼ˆå¦‚ç”±time.localtime()å’Œtime.gmtime()è¿”å›žï¼‰è½¬åŒ–ä¸ºæ ¼å¼åŒ–çš„æ—¶é—´å­—ç¬¦ä¸²ã€‚å¦‚æžœtæœªæŒ‡å®šï¼Œå°†ä¼ å…¥time.localtime()ã€‚å¦‚æžœå…ƒç»„ä¸­ä»»ä½•ä¸€ä¸ªå…ƒç´ è¶Šç•Œï¼ŒValueErrorçš„é”™è¯¯å°†ä¼šè¢«æŠ›å‡ºã€‚ format æ ¼å¼å¦‚ä¸‹ï¼š æ ¼å¼ å«ä¹‰ å¤‡æ³¨ %a æœ¬åœ°ï¼ˆlocaleï¼‰ç®€åŒ–æ˜ŸæœŸåç§° %A æœ¬åœ°å®Œæ•´æ˜ŸæœŸåç§° %b æœ¬åœ°ç®€åŒ–æœˆä»½åç§° %B æœ¬åœ°å®Œæ•´æœˆä»½åç§° %c æœ¬åœ°ç›¸åº”çš„æ—¥æœŸå’Œæ—¶é—´è¡¨ç¤º %d ä¸€ä¸ªæœˆä¸­çš„ç¬¬å‡ å¤©ï¼ˆ01 - 31ï¼‰ %H ä¸€å¤©ä¸­çš„ç¬¬å‡ ä¸ªå°æ—¶ï¼ˆ24 å°æ—¶åˆ¶ï¼Œ00 - 23ï¼‰ %l ä¸€å¤©ä¸­çš„ç¬¬å‡ ä¸ªå°æ—¶ï¼ˆ12 å°æ—¶åˆ¶ï¼Œ01 - 12ï¼‰ %j ä¸€å¹´ä¸­çš„ç¬¬å‡ å¤©ï¼ˆ001 - 366ï¼‰ %m æœˆä»½ï¼ˆ01 - 12ï¼‰ %M åˆ†é’Ÿæ•°ï¼ˆ00 - 59ï¼‰ %p æœ¬åœ° am æˆ–è€… pm çš„ç›¸åº”ç¬¦ æ³¨1 %S ç§’ï¼ˆ01 - 61ï¼‰ æ³¨2 %U ä¸€å¹´ä¸­çš„æ˜ŸæœŸæ•°ï¼ˆ00 - 53 æ˜ŸæœŸå¤©æ˜¯ä¸€ä¸ªæ˜ŸæœŸçš„å¼€å§‹ï¼‰ç¬¬ä¸€ä¸ªæ˜ŸæœŸå¤©ä¹‹å‰çš„æ‰€æœ‰å¤©æ•°éƒ½æ”¾åœ¨ç¬¬ 0 å‘¨ æ³¨3 %w ä¸€ä¸ªæ˜ŸæœŸä¸­çš„ç¬¬å‡ å¤©ï¼ˆ0 - 6ï¼Œ0 æ˜¯æ˜ŸæœŸå¤©ï¼‰ æ³¨3 %W å’Œ %U åŸºæœ¬ç›¸åŒï¼Œä¸åŒçš„æ˜¯ %W ä»¥æ˜ŸæœŸä¸€ä¸ºä¸€ä¸ªæ˜ŸæœŸçš„å¼€å§‹ %x æœ¬åœ°ç›¸åº”æ—¥æœŸ %X æœ¬åœ°ç›¸åº”æ—¶é—´ %y åŽ»æŽ‰ä¸–çºªçš„å¹´ä»½ï¼ˆ00 - 99ï¼‰ %Y å®Œæ•´çš„å¹´ä»½ %z ç”¨ +HHMM æˆ– -HHMM è¡¨ç¤ºè·ç¦»æ ¼æž—å¨æ²»çš„æ—¶åŒºåç§»ï¼ˆH ä»£è¡¨åè¿›åˆ¶çš„å°æ—¶æ•°ï¼ŒM ä»£è¡¨åè¿›åˆ¶çš„åˆ†é’Ÿæ•°ï¼‰ %Z æ—¶åŒºçš„åå­—ï¼ˆå¦‚æžœä¸å­˜åœ¨ä¸ºç©ºå­—ç¬¦ï¼‰ %% %å·æœ¬èº« æ³¨1ï¼šâ€œ%pâ€åªæœ‰ä¸Žâ€œ%Iâ€é…åˆä½¿ç”¨æ‰æœ‰æ•ˆæžœã€‚ æ³¨2ï¼š60 ä»£è¡¨é—°ç§’ï¼Œ61 æ˜¯åŸºäºŽåŽ†å²åŽŸå› ä¿ç•™ã€‚ æ³¨3ï¼šå½“ä½¿ç”¨ strptime() å‡½æ•°æ—¶ï¼Œåªæœ‰å½“åœ¨è¿™å¹´ä¸­çš„å‘¨æ•°å’Œå¤©æ•°è¢«ç¡®å®šçš„æ—¶å€™ %U å’Œ %W æ‰ä¼šè¢«è®¡ç®—ã€‚ 12&gt;&gt;&gt; time.strftime('%Y-%m-%d %X')'2018-07-13 15:06:39' strptime strptime(â€¦) strptime(string, format) -&gt; struct_time æŠŠä¸€ä¸ªæ ¼å¼åŒ–æ—¶é—´å­—ç¬¦ä¸²è½¬åŒ–ä¸º struct_timeã€‚å®žé™…ä¸Šå®ƒå’Œ strftime() æ˜¯é€†æ“ä½œã€‚ 123456&gt;&gt;&gt; time_now = time.strftime('%y-%m-%d %X') &gt;&gt;&gt; time_now '18-07-13 15:09:04' &gt;&gt;&gt; time.strptime(time_now, '%y-%m-%d %X') time.struct_time(tm_year=2018, tm_mon=7, tm_mday=13, tm_hour=15, tm_min=9, tm_sec=4, tm_wday=4, tm_yday=194, tm_isdst=-1) æ€»ç»“æ ¹æ®ä¹‹å‰æè¿°ï¼Œåœ¨Pythonä¸­å…±æœ‰ä¸‰ç§è¡¨è¾¾æ–¹å¼ï¼š timestamp tupleæˆ–è€…struct_time æ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚å®ƒä»¬ä¹‹é—´çš„è½¬åŒ–å¦‚å›¾æ‰€ç¤ºï¼š]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Pythonæ¨¡å—</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Pythonå­¦ä¹ ç¬”è®°-å‡½æ•°å†…çœ]]></title>
    <url>%2F2018%2F07%2F13%2FPython%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%87%BD%E6%95%B0%E5%86%85%E7%9C%81%2F</url>
    <content type="text"><![CDATA[å­¦ä¹ ã€Šæµç•…çš„Pythonæ—¶ã€‹ä¸€ç­‰å‡½æ•°çš„å‡½æ•°å†…çœæ—¶ï¼Œæœ‰ä¸€äº›ç–‘é—®ï¼š ä»€ä¹ˆæ˜¯å‡½æ•°å†…çœï¼Ÿ å‡½æ•°å†…çœæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ ä¹¦ä¸Šæ²¡æœ‰æ¶‰åŠå†…çœçš„æ¦‚å¿µï¼Œæ‰€ä»¥åœ¨ç½‘ä¸ŠæŸ¥é˜…äº†ä¸€ä¸‹èµ„æ–™æ¥è®°å½•ä¸€ä¸‹å‡½æ•°å†…çœã€‚ è¿™ç¯‡ç¬”è®°æŠ„å½•äºŽã€ŠPythonè‡ªçœæŒ‡å—ã€‹ï¼Œç”±äºŽè¿™ç¯‡æ–‡ç« ä½¿ç”¨çš„æ˜¯Python 2ï¼Œæˆ‘ç”¨Python 3å†æŠ„å½•ä¸€éã€‚ ä»¥åŠåŽé¢æœ‰æˆ‘è‡ªå·±çš„è¡¥å……ï¼Œä¸»è¦æ˜¯åŠ ä¸Šä¹¦ä¸Šçš„å†…å®¹ä»¥åŠè‡ªå·±çš„ç†è§£ã€‚ ä»€ä¹ˆæ˜¯è‡ªçœ åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œè‡ªçœï¼ˆintrospectionï¼‰æ˜¯ä¸€ç§è‡ªæˆ‘æ£€æŸ¥è¡Œä¸ºã€‚è‡ªçœæ˜¯æŒ‡å¯¹æŸäººè‡ªèº«æ€æƒ³ã€æƒ…ç»ªã€åŠ¨æœºå’Œè¡Œä¸ºçš„æ£€æŸ¥ã€‚ä¼Ÿå¤§çš„å“²å­¦å®¶è‹æ ¼æ‹‰åº•å°†ç”Ÿå‘½ä¸­çš„å¤§éƒ¨åˆ†æ—¶é—´ç”¨äºŽè‡ªæˆ‘æ£€æŸ¥ï¼Œå¹¶é¼“åŠ±ä»–çš„é›…å…¸æœ‹å‹ä»¬ä¹Ÿè¿™æ ·åšã€‚ä»–ç”šè‡³å¯¹è‡ªå·±ä½œå‡ºäº†è¿™æ ·çš„è¦æ±‚ï¼šâ€œæœªç»è‡ªçœçš„ç”Ÿå‘½ä¸å€¼å¾—å­˜åœ¨ã€‚â€ åœ¨è®¡ç®—æœºç¼–ç¨‹ä¸­ï¼Œè‡ªçœæ˜¯æŒ‡è¿™ç§èƒ½åŠ›ï¼šæ£€æŸ¥æŸäº›äº‹ç‰©ä»¥ç¡®å®šå®ƒæ˜¯ä»€ä¹ˆï¼Œå®ƒçŸ¥é“ä»€ä¹ˆä»¥åŠå®ƒèƒ½åšä»€ä¹ˆã€‚è‡ªçœå‘ç¨‹åºå‘˜æä¾›äº†æžå¤§çš„çµæ´»æ€§å’ŒæŽ§åˆ¶åŠ›ã€‚ä¸€æ—¦æ‚¨ä½¿ç”¨äº†æ”¯æŒè‡ªçœçš„ç¼–ç¨‹é¢„è¨€ï¼Œå°±ä¼šäº§ç”Ÿç±»ä¼¼è¿™æ ·çš„æ„Ÿè§‰ï¼šâ€œæœªç»æ£€æŸ¥çš„å¯¹è±¡ä¸å€¼å¾—å®žä¾‹åŒ–â€ã€‚ æœ¬æ–‡ä»‹ç»äº† Python ç¼–ç¨‹è¯­è¨€çš„è‡ªçœèƒ½åŠ›ã€‚æ•´ä¸ª Python è¯­è¨€å¯¹è‡ªçœæä¾›äº†æ·±å…¥è€Œå¹¿æ³›çš„æ”¯æŒã€‚å®žé™…ä¸Šï¼Œå¾ˆéš¾æƒ³è±¡å‡å¦‚ Python è¯­è¨€æ²¡æœ‰å…¶è‡ªçœç‰¹æ€§æ˜¯ä»€ä¹ˆæ ·å­ã€‚åœ¨è¯»å®Œæœ¬æ–‡æ—¶ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿéžå¸¸è½»æ¾åœ°æ´žå¯Ÿåˆ°è‡ªå·± Python å¯¹è±¡çš„â€œçµé­‚â€ã€‚ è‡ªçœå’Œåå°„ åœ¨ç½‘ä¸Šæœ‰å¾ˆå¤šèµ„æ–™æŠŠè‡ªçœå’Œåå°„ç†è§£ä¸ºä¸€ä¸ªæ¦‚å¿µï¼Œä¹Ÿæœ‰ç†è§£ä¸ºä¸åŒæ¦‚å¿µçš„ï¼Œåœ¨æ­¤è®¨è®ºä¸€ä¸‹ã€‚ è‡ªçœåœ¨wikiä¸Šçš„è§£é‡Šï¼šåœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œå†…çœæ˜¯æŒ‡è®¡ç®—æœºç¨‹åºåœ¨è¿è¡Œæ—¶ï¼ˆRun timeï¼‰æ£€æŸ¥å¯¹è±¡ï¼ˆObjectï¼‰ç±»åž‹çš„ä¸€ç§èƒ½åŠ›ï¼Œé€šå¸¸ä¹Ÿå¯ä»¥ç§°ä½œè¿è¡Œæ—¶ç±»åž‹æ£€æŸ¥ã€‚ ä¸åº”è¯¥å°†å†…çœå’Œåå°„æ··æ·†ã€‚ç›¸å¯¹äºŽå†…çœï¼Œåå°„æ›´è¿›ä¸€æ­¥ï¼Œæ˜¯æŒ‡è®¡ç®—æœºç¨‹åºåœ¨è¿è¡Œæ—¶ï¼ˆRun timeï¼‰å¯ä»¥è®¿é—®ã€æ£€æµ‹å’Œä¿®æ”¹å®ƒæœ¬èº«çŠ¶æ€æˆ–è¡Œä¸ºçš„ä¸€ç§èƒ½åŠ›ã€‚ æœç´¢è‡ªçœå’Œåå°„çš„åŒºåˆ«ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯è®²javaçš„ï¼Œè€Œpythonå‡ ä¹Žéƒ½æŠŠè‡ªçœå’Œåå°„ç†è§£ä¸ºä¸€ä¸ªæ¦‚å¿µã€‚ æœ‰ä¸€ä¸ªåšå®¢å†™åˆ°â€”â€”æˆ‘æ„Ÿ åå°„ä¸Žè‡ªçœå…¶å®žæ˜¯ä¸€å›žäº‹ åªæ˜¯åœ¨JAVAä¸­æŠŠè‡ªçœè¯´æˆåå°„ï¼Œåœ¨PYTHONä¸­æŠŠåå°„è¯´æˆè‡ªçœã€‚ æˆ‘ä¹Ÿæ˜¯è¿™ä¹ˆè§‰å¾—ï¼Œæ‰€ä»¥ç›®å‰å§‘ä¸”å…ˆæŠŠè‡ªçœå’Œåå°„ç†è§£ä¸ºä¸€ä¸ªæ¦‚å¿µã€‚ä»¥åŽæœ‰æ–°çš„æƒ³æ³•å†æ¥è§£é‡Šã€‚ åœ¨æ·±å…¥ç ”ç©¶æ›´é«˜çº§çš„æŠ€æœ¯ä¹‹å‰ï¼Œæˆ‘ä»¬å°½å¯èƒ½ç”¨æœ€æ™®é€šçš„æ–¹å¼æ¥ç ”ç©¶ Python è‡ªçœã€‚æœ‰äº›è¯»è€…ç”šè‡³å¯èƒ½ä¼šäº‰è®ºè¯´ï¼šæˆ‘ä»¬å¼€å§‹æ—¶æ‰€è®¨è®ºçš„ç‰¹æ€§ä¸åº”ç§°ä¹‹ä¸ºâ€œè‡ªçœâ€ã€‚æˆ‘ä»¬å¿…é¡»æ‰¿è®¤ï¼Œå®ƒä»¬æ˜¯å¦å±žäºŽè‡ªçœçš„èŒƒç•´è¿˜æœ‰å¾…è®¨è®ºã€‚ä½†ä»Žæœ¬èŠ‚çš„æ„å›¾å‡ºå‘ï¼Œæˆ‘ä»¬æ‰€å…³å¿ƒçš„åªæ˜¯æ‰¾å‡ºæœ‰è¶£é—®é¢˜çš„ç­”æ¡ˆã€‚ çŽ°åœ¨è®©æˆ‘ä»¬ä»¥äº¤äº’æ–¹å¼ä½¿ç”¨ Python æ¥å¼€å§‹ç ”ç©¶ã€‚è¿™æ˜¯å‰é¢å·²ç»åœ¨ä½¿ç”¨çš„ä¸€ç§æ–¹å¼ã€‚ è”æœºå¸®åŠ©åœ¨äº¤äº’æ¨¡å¼ä¸‹ï¼Œç”¨ help å‘ Python è¯·æ±‚å¸®åŠ©ã€‚ 1234567891011121314151617&gt;&gt;&gt; help()Welcome to Python 3.6&apos;s help utility!If this is your first time using Python, you should definitely check outthe tutorial on the Internet at https://docs.python.org/3.6/tutorial/.Enter the name of any module, keyword, or topic to get help on writingPython programs and using Python modules. To quit this help utility andreturn to the interpreter, just type &quot;quit&quot;.To get a list of available modules, keywords, symbols, or topics, type&quot;modules&quot;, &quot;keywords&quot;, &quot;symbols&quot;, or &quot;topics&quot;. Each module also comeswith a one-line summary of what it does; to list the modules whose nameor summary contain a given string such as &quot;spam&quot;, type &quot;modules spam&quot;.help&gt; è¿™æ—¶å€™å°±è¿›å…¥äº†è”æœºå¸®åŠ©çŠ¶æ€ï¼Œæ ¹æ®æç¤ºè¾“å…¥keywordsï¼š 12345678910111213help&gt; keywordsHere is a list of the Python keywords. Enter any keyword to get more help.False def if raiseNone del import returnTrue elif in tryand else is whileas except lambda withassert finally nonlocal yieldbreak for notclass from orcontinue global pass çŽ°åœ¨æ˜¾ç¤ºå‡ºäº†Pythonå…³é”®è¯çš„åˆ—è¡¨ã€‚æŒ‰ç…§è¯´æ˜Žæˆ‘ä»¬ç»§ç»­è¾“å…¥å…³é”®å­—èŽ·å–å…³é”®å­—çš„ç›¸å…³æ–‡æ¡£ã€‚ 12345678910111213141516171819202122232425262728293031323334353637help&gt; in Membership test operations ************************** The operators &quot;in&quot; and &quot;not in&quot; test for membership. &quot;x in s&quot; evaluates to &quot;True&quot; if *x* is a member of *s*, and &quot;False&quot; otherwise. &quot;x not in s&quot; returns the negation of &quot;x in s&quot;. All built-in sequences and set types support this as well as dictionary, for which &quot;in&quot; tests whether the dictionary has a given key. For container types such as list, tuple, set, frozenset, dict, or collections.deque, the expression &quot;x in y&quot; is equivalent to &quot;any(x is e or x == e for e in y)&quot;. For the string and bytes types, &quot;x in y&quot; is &quot;True&quot; if and only if *x* is a substring of *y*. An equivalent test is &quot;y.find(x) != -1&quot;. Empty strings are always considered to be a substring of any other string, so &quot;&quot;&quot; in &quot;abc&quot;&quot; will return &quot;True&quot;. For user-defined classes which define the &quot;__contains__()&quot; method, &quot;x in y&quot; returns &quot;True&quot; if &quot;y.__contains__(x)&quot; returns a true value, and &quot;False&quot; otherwise. For user-defined classes which do not define &quot;__contains__()&quot; but do define &quot;__iter__()&quot;, &quot;x in y&quot; is &quot;True&quot; if some value &quot;z&quot; with &quot;x == z&quot; is produced while iterating over &quot;y&quot;. If an exception is raised during the iteration, it is as if &quot;in&quot; raised that exception. Lastly, the old-style iteration protocol is tried: if a class defines &quot;__getitem__()&quot;, &quot;x in y&quot; is &quot;True&quot; if and only if there is a non- negative integer index *i* such that &quot;x == y[i]&quot;, and all lower integer indices do not raise &quot;IndexError&quot; exception. (If any other exception is raised, it is as if &quot;in&quot; raised that exception). The operator &quot;not in&quot; is defined to have the inverse true value of &quot;in&quot;. Related help topics: SEQUENCEMETHODS æ­£å¦‚æ‚¨ä»Žè¿™ä¸ªç¤ºä¾‹å¯ä»¥çœ‹åˆ°çš„ï¼ŒPython çš„è”æœºå¸®åŠ©å®žç”¨ç¨‹åºä¼šæ˜¾ç¤ºå…³äºŽå„ç§ä¸»é¢˜æˆ–ç‰¹å®šå¯¹è±¡çš„ä¿¡æ¯ã€‚å¸®åŠ©å®žç”¨ç¨‹åºå¾ˆæœ‰ç”¨ï¼Œå¹¶ç¡®å®žåˆ©ç”¨äº† Python çš„è‡ªçœèƒ½åŠ›ã€‚ä½†ä»…ä»…ä½¿ç”¨å¸®åŠ©ä¸ä¼šæ­ç¤ºå¸®åŠ©æ˜¯å¦‚ä½•èŽ·å¾—å…¶ä¿¡æ¯çš„ã€‚è€Œä¸”ï¼Œå› ä¸ºæœ¬æ–‡çš„ç›®çš„æ˜¯æ­ç¤º Python è‡ªçœçš„æ‰€æœ‰ç§˜å¯†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»è¿…é€Ÿåœ°è·³å‡ºå¯¹å¸®åŠ©å®žç”¨ç¨‹åºçš„è®¨è®ºã€‚ æœ€åŽè®©æˆ‘ä»¬æ¥èŽ·å¾—ä¸€ä¸ªå¯ç”¨æ¨¡å—çš„åˆ—è¡¨ã€‚ æ¨¡å—åªæ˜¯åŒ…å« Python ä»£ç çš„æ–‡æœ¬æ–‡ä»¶ï¼Œå…¶åç§°åŽç¼€æ˜¯ .py ã€‚å¦‚æžœåœ¨ Python æç¤ºç¬¦ä¸‹è¾“å…¥help(&#39;modules&#39;) ï¼Œæˆ–åœ¨ help æç¤ºç¬¦ä¸‹è¾“å…¥ modules ï¼Œåˆ™ä¼šçœ‹åˆ°ä¸€é•¿åˆ—å¯ç”¨æ¨¡å—ï¼Œç±»ä¼¼äºŽä¸‹é¢æ‰€ç¤ºçš„éƒ¨åˆ†åˆ—è¡¨ã€‚è‡ªå·±å°è¯•å®ƒä»¥è§‚å¯Ÿæ‚¨çš„ç³»ç»Ÿä¸­æœ‰å“ªäº›å¯ç”¨æ¨¡å—ï¼Œå¹¶äº†è§£ä¸ºä»€ä¹ˆä¼šè®¤ä¸º Python æ˜¯â€œè‡ªå¸¦ç”µæ± â€çš„ã€‚ å°±æ˜¯è¯´ Python åœ¨è¢«å®‰è£…æ—¶ï¼Œå°±å¸¦äº†å¾ˆå¤šæ¨¡å—ï¼Œè¿™äº›æ¨¡å—æ˜¯ä½ ä»¥åŽå¼€å‘ä¸­ä¼šç”¨åˆ°çš„ï¼Œæ¯”å–»æˆç”µæ± ï¼Œå¥½æ¯”å¼€å‘çš„åŠ©åŠ›å·¥å…·ï¼‰ï¼Œæˆ–è€…è¯´æ˜¯ Python ä¸€è¢«å®‰è£…ï¼Œå°±å·²ç»åŒ…å«æœ‰çš„æ¨¡å—ï¼Œä¸ç”¨æˆ‘ä»¬è´¹åŠ›å†å®‰è£…äº†ã€‚ 1234567891011121314help&gt; modulesPlease wait a moment while I gather a list of all available modules...D:\Microsoft Visual Studio\Shared\Python36_64\lib\site-packages\IPython\kernel\__init__.py:13: ShimWarning: The `IPython.kernel` package has been deprecated since IPython 4.0.You should import from ipykernel or jupyter_client instead. &quot;You should import from ipykernel or jupyter_client instead.&quot;, ShimWarning)IPython asynchat idna sched__future__ asyncio imaplib secrets_ast asyncore imghdr select...ast idlelib runpyEnter any module name to get more help. Or, type &quot;modules spam&quot; to searchfor modules whose name or summary contain the string &quot;spam&quot;. dir()å‡½æ•°å°½ç®¡æŸ¥æ‰¾å’Œå¯¼å…¥æ¨¡å—ç›¸å¯¹å®¹æ˜“ï¼Œä½†è¦è®°ä½æ¯ä¸ªæ¨¡å—åŒ…å«ä»€ä¹ˆå´ä¸æ˜¯è¿™ä¹ˆç®€å•ã€‚ä½ æˆ–è®¸å¹¶ä¸å¸Œæœ›æ€»æ˜¯å¿…é¡»æŸ¥çœ‹æºä»£ç æ¥æ‰¾å‡ºç­”æ¡ˆã€‚å¹¸è¿çš„æ˜¯ï¼ŒPython æä¾›äº†ä¸€ç§æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®çš„ dir() å‡½æ•°æ¥æ£€æŸ¥æ¨¡å—ï¼ˆä»¥åŠå…¶å®ƒå¯¹è±¡ï¼‰çš„å†…å®¹ã€‚ å…¶å®žï¼Œè¿™ä¸ªä¸œè¥¿æˆ‘ä»¬å·²ç»ä¸€ç›´åœ¨ä½¿ç”¨ã€‚ dir() å‡½æ•°å¯èƒ½æ˜¯ Python è‡ªçœæœºåˆ¶ä¸­æœ€è‘—åçš„éƒ¨åˆ†äº†ã€‚å®ƒè¿”å›žä¼ é€’ç»™å®ƒçš„ä»»ä½•å¯¹è±¡çš„å±žæ€§åç§°ç»è¿‡æŽ’åºçš„åˆ—è¡¨ã€‚å¦‚æžœä¸æŒ‡å®šå¯¹è±¡ï¼Œåˆ™ dir() è¿”å›žå½“å‰ä½œç”¨åŸŸä¸­ï¼ˆç†è§£ä¸ºæŸä¸ªèŒƒå›´ï¼‰çš„åç§°ã€‚è®©æˆ‘ä»¬å°† dir() å‡½æ•°åº”ç”¨äºŽ keyword æ¨¡å—ï¼Œå¹¶è§‚å¯Ÿå®ƒæ­ç¤ºäº†ä»€ä¹ˆï¼š 123&gt;&gt;&gt; import keyword&gt;&gt;&gt; dir(keyword)['__all__', '__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__spec__', 'iskeyword', 'kwlist', 'main'] å¦‚æžœä¸å¸¦ä»»ä½•å‚æ•°ï¼Œåˆ™ dir() è¿”å›žå½“å‰ä½œç”¨åŸŸä¸­çš„åç§°ã€‚è¯·æ³¨æ„ï¼Œå› ä¸ºæˆ‘ä»¬å…ˆå‰å¯¼å…¥äº† keyword ï¼Œæ‰€ä»¥å®ƒä»¬å‡ºçŽ°åœ¨åˆ—è¡¨ä¸­ã€‚å¯¼å…¥æ¨¡å—å°†æŠŠè¯¥æ¨¡å—çš„åç§°æ·»åŠ åˆ°å½“å‰ä½œç”¨åŸŸï¼š 12&gt;&gt;&gt; dir()['__annotations__', '__builtins__', '__doc__', '__loader__', '__name__', '__package__', '__spec__', 'keyword'] dir() å‡½æ•°æ˜¯å†…ç½®å‡½æ•°ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ä¸å¿…ä¸ºäº†ä½¿ç”¨è¯¥å‡½æ•°è€Œå¯¼å…¥æ¨¡å—ã€‚ä¸å¿…åšä»»ä½•æ“ä½œï¼ŒPython å°±å¯è¯†åˆ«å†…ç½®å‡½æ•°ã€‚ å†è§‚å¯Ÿï¼Œçœ‹åˆ°è°ƒç”¨ dir() åŽè¿”å›žäº†è¿™ä¸ªåç§° __builtins__ ã€‚ä¹Ÿè®¸æ­¤å¤„æœ‰è¿žæŽ¥ã€‚è®©æˆ‘ä»¬åœ¨ Python æç¤ºç¬¦ä¸‹è¾“å…¥åç§° __builtins__ ï¼Œå¹¶è§‚å¯Ÿ Python æ˜¯å¦ä¼šå‘Šè¯‰æˆ‘ä»¬å…³äºŽå®ƒçš„ä»»ä½•æœ‰è¶£çš„äº‹æƒ…ï¼š 12&gt;&gt;&gt; __builtins__&lt;module '__builtin__' (built-in)&gt; å› æ­¤ __builtins__ çœ‹èµ·æ¥è±¡æ˜¯å½“å‰ä½œç”¨åŸŸä¸­ç»‘å®šåˆ°åä¸º __builtin__ çš„æ¨¡å—å¯¹è±¡çš„åç§°ã€‚ï¼ˆå› ä¸ºæ¨¡å—ä¸æ˜¯åªæœ‰å¤šä¸ªå•ä¸€å€¼çš„ç®€å•å¯¹è±¡ï¼Œæ‰€ä»¥ Python æ”¹åœ¨å°–æ‹¬å·ä¸­æ˜¾ç¤ºå…³äºŽæ¨¡å—çš„ä¿¡æ¯ã€‚ï¼‰ æ³¨ï¼šå¦‚æžœæ‚¨åœ¨ç£ç›˜ä¸Šå¯»æ‰¾ __builtin__.py æ–‡ä»¶ï¼Œå°†ç©ºæ‰‹è€Œå½’ã€‚è¿™ä¸ªç‰¹æ®Šçš„æ¨¡å—å¯¹è±¡æ˜¯ Python è§£é‡Šå™¨å‡­ç©ºåˆ›å»ºçš„ï¼Œå› ä¸ºå®ƒåŒ…å«ç€è§£é‡Šå™¨å§‹ç»ˆå¯ç”¨çš„é¡¹ã€‚å°½ç®¡çœ‹ä¸åˆ°ç‰©ç†æ–‡ä»¶ï¼Œä½†æˆ‘ä»¬ä»å¯ä»¥å°† dir() å‡½æ•°åº”ç”¨äºŽè¿™ä¸ªå¯¹è±¡ï¼Œä»¥è§‚å¯Ÿæ‰€æœ‰å†…ç½®å‡½æ•°ã€é”™è¯¯å¯¹è±¡ä»¥åŠå®ƒæ‰€åŒ…å«çš„å‡ ä¸ªæ‚é¡¹å±žæ€§ã€‚ 12&gt;&gt;&gt; dir(__builtins__)['ArithmeticError', 'AssertionError', 'AttributeError', 'BaseException', 'BlockingIOError', 'BrokenPipeError', 'BufferError', 'BytesWarning', 'ChildProcessError', 'ConnectionAbortedError', 'ConnectionError', 'ConnectionRefusedError', 'ConnectionResetError', 'DeprecationWarning', 'EOFError', 'Ellipsis', 'EnvironmentError', 'Exception', 'False', 'FileExistsError', 'FileNotFoundError', 'FloatingPointError', 'FutureWarning', 'GeneratorExit', 'IOError', 'ImportError', 'ImportWarning', 'IndentationError', 'IndexError', 'InterruptedError', 'IsADirectoryError', 'KeyError', 'KeyboardInterrupt', 'LookupError', 'MemoryError', 'ModuleNotFoundError', 'NameError', 'None', 'NotADirectoryError', 'NotImplemented', 'NotImplementedError', 'OSError', 'OverflowError', 'PendingDeprecationWarning', 'PermissionError', 'ProcessLookupError', 'RecursionError', 'ReferenceError', 'ResourceWarning', 'RuntimeError', 'RuntimeWarning', 'StopAsyncIteration', 'StopIteration', 'SyntaxError', 'SyntaxWarning', 'SystemError', 'SystemExit', 'TabError', 'TimeoutError', 'True', 'TypeError', 'UnboundLocalError', 'UnicodeDecodeError', 'UnicodeEncodeError', 'UnicodeError', 'UnicodeTranslateError', 'UnicodeWarning', 'UserWarning', 'ValueError', 'Warning', 'WindowsError', 'ZeroDivisionError', '_', '__build_class__', '__debug__', '__doc__', '__import__', '__loader__', '__name__', '__package__', '__spec__', 'abs', 'all', 'any', 'ascii', 'bin', 'bool', 'bytearray', 'bytes', 'callable', 'chr', 'classmethod', 'compile', 'complex', 'copyright', 'credits', 'delattr', 'dict', 'dir', 'divmod', 'enumerate', 'eval', 'exec', 'exit', 'filter', 'float', 'format', 'frozenset', 'getattr', 'globals', 'hasattr', 'hash', 'help', 'hex', 'id', 'input', 'int', 'isinstance', 'issubclass', 'iter', 'len', 'license', 'list', 'locals', 'map', 'max', 'memoryview', 'min', 'next', 'object', 'oct', 'open', 'ord', 'pow', 'print', 'property', 'quit', 'range', 'repr', 'reversed', 'round', 'set', 'setattr', 'slice', 'sorted', 'staticmethod', 'str', 'sum', 'super', 'tuple', 'type', 'vars', 'zip'] dir() å‡½æ•°é€‚ç”¨äºŽæ‰€æœ‰å¯¹è±¡ç±»åž‹ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²ã€æ•´æ•°ã€åˆ—è¡¨ã€å…ƒç»„ã€å­—å…¸ã€å‡½æ•°ã€å®šåˆ¶ç±»ã€ç±»å®žä¾‹å’Œç±»æ–¹æ³•ã€‚ ä¾‹å¦‚å°† dir() åº”ç”¨äºŽå­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¦‚æ‚¨æ‰€è§ï¼Œå³ä½¿ç®€å•çš„ Python å­—ç¬¦ä¸²ä¹Ÿæœ‰è®¸å¤šå±žæ€§ ï¼š 12&gt;&gt;&gt; dir("This is a str.")['__add__', '__class__', '__contains__', '__delattr__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getitem__', '__getnewargs__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__len__', '__lt__', '__mod__', '__mul__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__rmod__', '__rmul__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__', 'capitalize', 'casefold', 'center', 'count', 'encode', 'endswith', 'expandtabs', 'find', 'format', 'format_map', 'index', 'isalnum', 'isalpha', 'isdecimal', 'isdigit', 'isidentifier', 'islower', 'isnumeric', 'isprintable', 'isspace', 'istitle', 'isupper', 'join', 'ljust', 'lower', 'lstrip', 'maketrans', 'partition', 'replace', 'rfind', 'rindex', 'rjust', 'rpartition', 'rsplit', 'rstrip', 'split', 'splitlines', 'startswith', 'strip', 'swapcase', 'title', 'translate', 'upper', 'zfill'] æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å…¶ä»–çš„å¯¹è±¡ç±»åž‹ï¼š 12&gt;&gt;&gt; dir(43)['__abs__', '__add__', '__and__', '__bool__', '__ceil__', '__class__', '__delattr__', '__dir__', '__divmod__', '__doc__', '__eq__', '__float__', '__floor__', '__floordiv__', '__format__', '__ge__', '__getattribute__', '__getnewargs__', '__gt__', '__hash__', '__index__', '__init__', '__init_subclass__', '__int__', '__invert__', '__le__', '__lshift__', '__lt__', '__mod__', '__mul__', '__ne__', '__neg__', '__new__', '__or__', '__pos__', '__pow__', '__radd__', '__rand__', '__rdivmod__', '__reduce__', '__reduce_ex__', '__repr__', '__rfloordiv__', '__rlshift__', '__rmod__', '__rmul__', '__ror__', '__round__', '__rpow__', '__rrshift__', '__rshift__', '__rsub__', '__rtruediv__', '__rxor__', '__setattr__', '__sizeof__', '__str__', '__sub__', '__subclasshook__', '__truediv__', '__trunc__', '__xor__', 'bit_length', 'conjugate', 'denominator', 'from_bytes', 'imag', 'numerator', 'real', 'to_bytes'] 12&gt;&gt;&gt; dir(&#123;&#125;)['__class__', '__contains__', '__delattr__', '__delitem__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getitem__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__len__', '__lt__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__setitem__', '__sizeof__', '__str__', '__subclasshook__', 'clear', 'copy', 'fromkeys', 'get', 'items', 'keys', 'pop', 'popitem', 'setdefault', 'update', 'values'] 12&gt;&gt;&gt; dir(set)['__and__', '__class__', '__contains__', '__delattr__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__gt__', '__hash__', '__iand__', '__init__', '__init_subclass__', '__ior__', '__isub__', '__iter__', '__ixor__', '__le__', '__len__', '__lt__', '__ne__', '__new__', '__or__', '__rand__', '__reduce__', '__reduce_ex__', '__repr__', '__ror__', '__rsub__', '__rxor__', '__setattr__', '__sizeof__', '__str__', '__sub__', '__subclasshook__', '__xor__', 'add', 'clear', 'copy', 'difference', 'difference_update', 'discard', 'intersection', 'intersection_update', 'isdisjoint', 'issubset', 'issuperset', 'pop', 'remove', 'symmetric_difference', 'symmetric_difference_update', 'union', 'update'] 12&gt;&gt;&gt; dir(list)['__add__', '__class__', '__contains__', '__delattr__', '__delitem__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getitem__', '__gt__', '__hash__', '__iadd__', '__imul__', '__init__', '__init_subclass__', '__iter__', '__le__', '__len__', '__lt__', '__mul__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__reversed__', '__rmul__', '__setattr__', '__setitem__', '__sizeof__', '__str__', '__subclasshook__', 'append', 'clear', 'copy', 'count', 'extend', 'index', 'insert', 'pop', 'remove', 'reverse', 'sort'] é€šè¿‡dir()å‡½æ•°èŽ·å–å¯¹è±¡çš„å±žæ€§ä»¥åŠæ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥éšæ—¶çš„äº†è§£æˆ‘ä»¬åˆ›å»ºçš„å¯¹è±¡åŒ…å«äº†ä»€ä¹ˆï¼Œä»¥åŠå¯ä»¥åšäº›ä»€ä¹ˆã€‚ æ–‡æ¡£å­—ç¬¦ä¸²åœ¨è®¸å¤š dir() ç¤ºä¾‹ä¸­ï¼Œæ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°çš„ä¸€ä¸ªå±žæ€§æ˜¯ __doc__ å±žæ€§ã€‚è¿™ä¸ªå±žæ€§æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒåŒ…å«äº†æè¿°å¯¹è±¡çš„æ³¨é‡Šã€‚Python ç§°ä¹‹ä¸ºæ–‡æ¡£å­—ç¬¦ä¸²æˆ– docstring ã€‚ å¦‚æžœæ¨¡å—ã€ç±»ã€æ–¹æ³•æˆ–å‡½æ•°å®šä¹‰çš„ç¬¬ä¸€æ¡è¯­å¥æ˜¯å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆè¯¥å­—ç¬¦ä¸²ä¼šä½œä¸ºå¯¹è±¡çš„ __doc__ å±žæ€§ä¸Žè¯¥å¯¹è±¡å…³è”èµ·æ¥ã€‚ä¾‹å¦‚ï¼Œçœ‹ä¸€ä¸‹ str ç±»åž‹å¯¹è±¡çš„æ–‡æ¡£å­—ç¬¦ä¸²ã€‚å› ä¸ºæ–‡æ¡£å­—ç¬¦ä¸²é€šå¸¸åŒ…å«åµŒå…¥çš„æ¢è¡Œ \n ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Python çš„ print è¯­å¥ï¼Œä»¥ä¾¿è¾“å‡ºæ›´æ˜“äºŽé˜…è¯»ï¼š 1234567891011&gt;&gt;&gt; print(str.__doc__)str(object='') -&gt; strstr(bytes_or_buffer[, encoding[, errors]]) -&gt; strCreate a new string object from the given object. If encoding orerrors is specified, then the object must expose a data bufferthat will be decoded using the given encoding and error handler.Otherwise, returns the result of object.__str__() (if defined)or repr(object).encoding defaults to sys.getdefaultencoding().errors defaults to 'strict'. åˆ©ç”¨è‡ªçœæ£€æŸ¥ Python å¯¹è±¡å‰é¢å·²ç»å¥½å‡ æ¬¡æåˆ°äº†â€œå¯¹è±¡ï¼ˆobjectï¼‰â€è¿™ä¸ªè¯ï¼Œä½†ä¸€ç›´æ²¡æœ‰çœŸæ­£å®šä¹‰å®ƒã€‚ç¼–ç¨‹çŽ¯å¢ƒä¸­çš„å¯¹è±¡å¾ˆåƒã€‚çŽ°å®žä¸–ç•Œä¸­çš„å¯¹è±¡ã€‚å®žé™…çš„å¯¹è±¡æœ‰ä¸€å®šçš„å½¢çŠ¶ã€å¤§å°ã€é‡é‡å’Œå…¶å®ƒç‰¹å¾ã€‚å®žé™…çš„å¯¹è±¡è¿˜èƒ½å¤Ÿå¯¹å…¶çŽ¯å¢ƒè¿›è¡Œå“åº”ã€ä¸Žå…¶å®ƒå¯¹è±¡äº¤äº’æˆ–æ‰§è¡Œä»»åŠ¡ã€‚è®¡ç®—æœºä¸­çš„å¯¹è±¡è¯•å›¾æ¨¡æ‹Ÿæˆ‘ä»¬èº«è¾¹çŽ°å®žä¸–ç•Œä¸­çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬è±¡æ–‡æ¡£ã€æ—¥ç¨‹è¡¨å’Œä¸šåŠ¡è¿‡ç¨‹è¿™æ ·çš„æŠ½è±¡å¯¹è±¡ã€‚ å…¶å®žï¼Œæˆ‘æ€»è§‰å¾—æŠŠ object ç¿»è¯‘æˆå¯¹è±¡ï¼Œè®©äººæ„Ÿè§‰å¾ˆæ²¡æœ‰å…·è±¡çš„æ„Ÿè§‰ï¼Œå› ä¸ºåœ¨æ±‰è¯­é‡Œé¢ï¼Œå¯¹è±¡æ˜¯ä¸€ä¸ªå¾ˆç¬¼ç»Ÿçš„è¯æ±‡ã€‚å¦å¤–ä¸€ç§ç¿»è¯‘ï¼Œæµè¡ŒäºŽå°æ¹¾ï¼ŒæŠŠå®ƒç§°ä¸ºâ€œç‰©ä»¶â€ï¼Œå€’æ˜¯æŒºä¸é”™çš„ç†è§£ã€‚å½“ç„¶ï¼Œåè¯å°±ä¸çº ç¼ äº†ï¼Œå…³é”®æ˜¯ç†è§£å†…æ¶µã€‚å…³äºŽé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œå¯ä»¥é˜…è¯»ç»´åŸºç™¾ç§‘çš„ä»‹ç»â€”â€”é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡â€”â€”å…ˆäº†è§£å¤§æ¦‚ã€‚ ç±»ä¼¼äºŽå®žé™…çš„å¯¹è±¡ï¼Œå‡ ä¸ªè®¡ç®—æœºå¯¹è±¡å¯èƒ½å…±äº«å…±åŒçš„ç‰¹å¾ï¼ŒåŒæ—¶ä¿æŒå®ƒä»¬è‡ªå·±ç›¸å¯¹è¾ƒå°çš„å˜å¼‚ç‰¹å¾ã€‚æƒ³ä¸€æƒ³æ‚¨åœ¨ä¹¦åº—ä¸­çœ‹åˆ°çš„ä¹¦ç±ã€‚ä¹¦ç±çš„æ¯ä¸ªç‰©ç†å‰¯æœ¬éƒ½å¯èƒ½æœ‰æ±¡è¿¹ã€å‡ å¼ ç ´æŸçš„ä¹¦é¡µæˆ–å”¯ä¸€çš„æ ‡è¯†å·ã€‚å°½ç®¡æ¯æœ¬ä¹¦éƒ½æ˜¯å”¯ä¸€çš„å¯¹è±¡ï¼Œä½†éƒ½æ‹¥æœ‰ç›¸åŒæ ‡é¢˜çš„æ¯æœ¬ä¹¦éƒ½åªæ˜¯åŽŸå§‹æ¨¡æ¿çš„å®žä¾‹ï¼Œå¹¶ä¿ç•™äº†åŽŸå§‹æ¨¡æ¿çš„å¤§å¤šæ•°ç‰¹å¾ã€‚ å¯¹äºŽé¢å‘å¯¹è±¡çš„ç±»å’Œç±»å®žä¾‹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸ª Python å­ç¬¦ä¸²éƒ½è¢«èµ‹äºˆäº†ä¸€äº›å±žæ€§ï¼Œ dir() å‡½æ•°æ­ç¤ºäº†è¿™äº›å±žæ€§ã€‚ äºŽæ˜¯åœ¨è®¡ç®—æœºæœ¯è¯­ä¸­ï¼Œå¯¹è±¡æ˜¯æ‹¥æœ‰æ ‡è¯†å’Œå€¼çš„äº‹ç‰©ï¼Œå±žäºŽç‰¹å®šç±»åž‹ã€å…·æœ‰ç‰¹å®šç‰¹å¾å’Œä»¥ç‰¹å®šæ–¹å¼æ‰§è¡Œæ“ä½œã€‚ å¹¶ä¸”ï¼Œå¯¹è±¡ä»Žä¸€ä¸ªæˆ–å¤šä¸ªçˆ¶ç±»ç»§æ‰¿äº†å®ƒä»¬çš„è®¸å¤šå±žæ€§ã€‚é™¤äº†å…³é”®å­—å’Œç‰¹æ®Šç¬¦å·ï¼ˆè±¡è¿ç®—ç¬¦ï¼Œå¦‚ + ã€ - ã€ * ã€ ** ã€ / ã€ % ã€ &lt; ã€ &gt; ç­‰ï¼‰å¤–ï¼ŒPython ä¸­çš„æ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯å¯¹è±¡ã€‚Python å…·æœ‰ä¸€ç»„ä¸°å¯Œçš„å¯¹è±¡ç±»åž‹ï¼šå­—ç¬¦ä¸²ã€æ•´æ•°ã€æµ®ç‚¹ã€åˆ—è¡¨ã€å…ƒç»„ã€å­—å…¸ã€å‡½æ•°ã€ç±»ã€ç±»å®žä¾‹ã€æ¨¡å—ã€æ–‡ä»¶ç­‰ã€‚ å½“æ‚¨æœ‰ä¸€ä¸ªä»»æ„çš„å¯¹è±¡ï¼ˆä¹Ÿè®¸æ˜¯ä¸€ä¸ªä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°çš„å¯¹è±¡ï¼‰æ—¶ï¼Œå¯èƒ½å¸Œæœ›çŸ¥é“ä¸€äº›å…³äºŽè¯¥å¯¹è±¡çš„æƒ…å†µã€‚å¦‚å¸Œæœ› Python å‘Šè¯‰æˆ‘ä»¬ï¼š å¯¹è±¡çš„åç§°æ˜¯ä»€ä¹ˆï¼Ÿ è¿™æ˜¯å“ªç§ç±»åž‹çš„å¯¹è±¡ï¼Ÿ å¯¹è±¡çŸ¥é“äº›ä»€ä¹ˆï¼Ÿ å¯¹è±¡èƒ½åšäº›ä»€ä¹ˆï¼Ÿ å¯¹è±¡çš„çˆ¶å¯¹è±¡æ˜¯è°ï¼Ÿ åç§°å¹¶éžæ‰€æœ‰å¯¹è±¡éƒ½æœ‰åç§°ï¼Œä½†é‚£äº›æœ‰åç§°çš„å¯¹è±¡éƒ½å°†åç§°å­˜å‚¨åœ¨å…¶ __name__ å±žæ€§ä¸­ã€‚æ³¨ï¼šåç§°æ˜¯ä»Žå¯¹è±¡è€Œä¸æ˜¯å¼•ç”¨è¯¥å¯¹è±¡çš„å˜é‡ä¸­æ´¾ç”Ÿçš„ã€‚ 1234567891011121314&gt;&gt;&gt; l = list# dir(l)å’Œdir(list)ç»“æžœç›¸åŒ&gt;&gt;&gt; dir(l)['__add__', '__class__', '__contains__', '__delattr__', '__delitem__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getitem__', '__gt__', '__hash__', '__iadd__', '__imul__', '__init__', '__init_subclass__', '__iter__', '__le__', '__len__', '__lt__', '__mul__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__reversed__', '__rmul__', '__setattr__', '__setitem__', '__sizeof__', '__str__', '__subclasshook__', 'append', 'clear', 'copy', 'count', 'extend', 'index', 'insert', 'pop', 'remove', 'reverse', 'sort']&gt;&gt;&gt; dir(list)['__add__', '__class__', '__contains__', '__delattr__', '__delitem__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getitem__', '__gt__', '__hash__', '__iadd__', '__imul__', '__init__', '__init_subclass__', '__iter__', '__le__', '__len__', '__lt__', '__mul__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__reversed__', '__rmul__', '__setattr__', '__setitem__', '__sizeof__', '__str__', '__subclasshook__', 'append', 'clear', 'copy', 'count', 'extend', 'index', 'insert', 'pop', 'remove', 'reverse', 'sort']&gt;&gt;&gt; l.__name__ 'list'&gt;&gt;&gt; list.__name__'list'# æˆ‘ä¹‹å‰è®²è¿‡__name__çš„ç”¨æ³•&gt;&gt;&gt; __name__ #è¿™æ˜¯ä¸ä¸€æ ·çš„'__main__' æ¨¡å—æ‹¥æœ‰åç§°ï¼ŒPython è§£é‡Šå™¨æœ¬èº«è¢«è®¤ä¸ºæ˜¯é¡¶çº§æ¨¡å—æˆ–ä¸»æ¨¡å—ã€‚å½“ä»¥äº¤äº’çš„æ–¹å¼è¿è¡Œ Python æ—¶ï¼Œå±€éƒ¨ __name__ å˜é‡è¢«èµ‹äºˆå€¼ &#39;__main__&#39; ã€‚åŒæ ·åœ°ï¼Œå½“ä»Žå‘½ä»¤è¡Œæ‰§è¡Œ Python æ¨¡å—ï¼Œè€Œä¸æ˜¯å°†å…¶å¯¼å…¥å¦ä¸€ä¸ªæ¨¡å—æ—¶ï¼Œå…¶ __name__ å±žæ€§è¢«èµ‹äºˆå€¼ &#39;__main__&#39; ï¼Œè€Œä¸æ˜¯è¯¥æ¨¡å—çš„å®žé™…åç§°ã€‚è¿™æ ·ï¼Œæ¨¡å—å¯ä»¥æŸ¥çœ‹å…¶è‡ªèº«çš„ __name__ å€¼æ¥è‡ªè¡Œç¡®å®šå®ƒä»¬è‡ªå·±æ­£è¢«å¦‚ä½•ä½¿ç”¨ï¼Œæ˜¯ä½œä¸ºå¦ä¸€ä¸ªç¨‹åºçš„æ”¯æŒï¼Œè¿˜æ˜¯ä½œä¸ºä»Žå‘½ä»¤è¡Œæ‰§è¡Œçš„ä¸»åº”ç”¨ç¨‹åºã€‚å› æ­¤ï¼Œä¸‹é¢è¿™æ¡æƒ¯ç”¨çš„è¯­å¥åœ¨ Python æ¨¡å—ä¸­æ˜¯å¾ˆå¸¸è§çš„ï¼š 12345678if __name__ == '__main__': # Do something appropriate here, like calling a # main() function defined elsewhere in this module. main()else: # Do nothing. This module has been imported by another # module that wants to make use of the functions, # classes and other useful bits it has defined. ç±»åž‹type() å‡½æ•°æœ‰åŠ©äºŽæˆ‘ä»¬ç¡®å®šå¯¹è±¡æ˜¯å­—ç¬¦ä¸²è¿˜æ˜¯æ•´æ•°ï¼Œæˆ–æ˜¯å…¶å®ƒç±»åž‹çš„å¯¹è±¡ã€‚å®ƒé€šè¿‡è¿”å›žç±»åž‹å¯¹è±¡æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚ï¼ˆå…¶å®žå°±ç›¸å½“äºŽè®¿é—®å¯¹è±¡__class__å±žæ€§ï¼Œä¸ªäººç†è§£ï¼‰ 12345678910111213141516&gt;&gt;&gt; list.__class__&lt;class 'type'&gt;&gt;&gt;&gt; type(list)&lt;class 'type'&gt;&gt;&gt;&gt; [].__class__&lt;class 'list'&gt;&gt;&gt;&gt; type([])&lt;class 'list'&gt;&gt;&gt;&gt; &#123;&#125;.__class__&lt;class 'dict'&gt;&gt;&gt;&gt; type(&#123;&#125;)&lt;class 'dict'&gt;&gt;&gt;&gt; 'python'.__class__&lt;class 'str'&gt;&gt;&gt;&gt; type('python')&lt;class 'str'&gt; æ ‡è¯†å…ˆå‰è¯´è¿‡ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰æ ‡è¯†ã€ç±»åž‹å’Œå€¼ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¯èƒ½æœ‰å¤šä¸ªå˜é‡å¼•ç”¨åŒä¸€å¯¹è±¡ï¼ŒåŒæ ·åœ°ï¼Œå˜é‡å¯ä»¥å¼•ç”¨çœ‹èµ·æ¥ç›¸ä¼¼ï¼ˆæœ‰ç›¸åŒçš„ç±»åž‹å’Œå€¼ï¼‰ï¼Œä½†æ‹¥æœ‰æˆªç„¶ä¸åŒæ ‡è¯†çš„å¤šä¸ªå¯¹è±¡ã€‚å½“æ›´æ”¹å¯¹è±¡æ—¶ï¼ˆå¦‚å°†æŸä¸€é¡¹æ·»åŠ åˆ°åˆ—è¡¨ï¼‰ï¼Œè¿™ç§å…³äºŽå¯¹è±¡æ ‡è¯†çš„æ¦‚å¿µå°¤å…¶é‡è¦ï¼Œå¦‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œ list_1 å’Œ list_2 å˜é‡å¼•ç”¨åŒä¸€ä¸ªåˆ—è¡¨å¯¹è±¡ã€‚æ­£å¦‚æ‚¨åœ¨ç¤ºä¾‹ä¸­æ‰€è§ï¼Œ id() å‡½æ•°ç»™ä»»ä½•ç»™å®šå¯¹è±¡è¿”å›žå”¯ä¸€çš„æ ‡è¯†ç¬¦ã€‚ 1234567891011121314151617181920&gt;&gt;&gt; print(id.__doc__)Return the identity of an object.This is guaranteed to be unique among simultaneously existing objects.(CPython uses the object's memory address.)# list_1å’Œlist_2æ ‡è¯†ä¸åŒ&gt;&gt;&gt; list_1 = [1, 2, 3]&gt;&gt;&gt; list_2 = [1, 2, 3]&gt;&gt;&gt; id(list_1)1740112651912&gt;&gt;&gt; id(list_2)1740117536520# aå’Œbæ ‡è¯†ç›¸åŒ&gt;&gt;&gt; a = 1&gt;&gt;&gt; b = 1&gt;&gt;&gt; id(a)1653632016&gt;&gt;&gt; id(b)1653632016 Pythonä¸­ä¼šä¸ºæ¯ä¸ªå‡ºçŽ°çš„å¯¹è±¡åˆ†é…å†…å­˜ï¼Œå“ªæ€•ä»–ä»¬çš„å€¼å®Œå…¨ç›¸ç­‰ï¼ˆæ³¨æ„æ˜¯ç›¸ç­‰ä¸æ˜¯ç›¸åŒï¼‰ã€‚ å±žæ€§å¯¹è±¡æ‹¥æœ‰å±žæ€§ï¼Œå¹¶ä¸” dir() å‡½æ•°ä¼šè¿”å›žè¿™äº›å±žæ€§çš„åˆ—è¡¨ã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶æˆ‘ä»¬åªæƒ³æµ‹è¯•ä¸€ä¸ªæˆ–å¤šä¸ªå±žæ€§æ˜¯å¦å­˜åœ¨ã€‚ å¦‚æžœå¯¹è±¡å…·æœ‰æˆ‘ä»¬æ­£åœ¨è€ƒè™‘çš„å±žæ€§ï¼Œé‚£ä¹ˆé€šå¸¸å¸Œæœ›åªæ£€ç´¢è¯¥å±žæ€§ã€‚è¿™ä¸ªä»»åŠ¡å¯ä»¥ç”±hasattr()å’Œ getattr() å‡½æ•°æ¥å®Œæˆã€‚ 123456789101112131415161718192021222324252627&gt;&gt;&gt; print(hasattr.__doc__)#åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡é‡Œé¢æ˜¯å¦æœ‰nameå±žæ€§æˆ–è€…nameæ–¹æ³•ï¼Œè¿”å›žBOOLå€¼ï¼Œæœ‰nameç‰¹æ€§è¿”å›žTrueï¼Œ å¦åˆ™è¿”å›žFalseã€‚éœ€è¦æ³¨æ„çš„æ˜¯nameè¦ç”¨æ‹¬å·æ‹¬èµ·æ¥Return whether the object has an attribute with the given name.This is done by calling getattr(obj, name) and catching AttributeError.&gt;&gt;&gt; print(getattr.__doc__)# èŽ·å–å¯¹è±¡objectçš„å±žæ€§æˆ–è€…æ–¹æ³•ï¼Œå¦‚æžœå­˜åœ¨æ‰“å°å‡ºæ¥ï¼Œå¦‚æžœä¸å­˜åœ¨ï¼Œæ‰“å°å‡ºé»˜è®¤å€¼ï¼Œé»˜è®¤å€¼å¯é€‰ã€‚# éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æžœæ˜¯è¿”å›žçš„å¯¹è±¡çš„æ–¹æ³•ï¼Œè¿”å›žçš„æ˜¯æ–¹æ³•çš„å†…å­˜åœ°å€ï¼Œå¦‚æžœéœ€è¦è¿è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥åœ¨åŽé¢æ·»åŠ ä¸€å¯¹æ‹¬å·ã€‚getattr(object, name[, default]) -&gt; valueGet a named attribute from an object; getattr(x, 'y') is equivalent to x.y.When a default argument is given, it is returned when the attribute doesn'texist; without it, an exception is raised in that case.&gt;&gt;&gt; hasattr(list, '__add__')True&gt;&gt;&gt; hasattr(dict, '__add__')False&gt;&gt;&gt; list_1 = [1, 3, 2]&gt;&gt;&gt; getattr(list_1, 'sort')&lt;built-in method sort of list object at 0x0000019526CAEAC8&gt;&gt;&gt;&gt; getattr(list_1, 'sort')()&gt;&gt;&gt; list_1[1, 2, 3] æ­¤å¤–è¿˜æœ‰setattrâ€”â€”ä¸ºå¯¹è±¡æ·»åŠ å˜é‡æˆ–æ–¹æ³• ã€delattrâ€”â€”åˆ é™¤å¯¹è±¡ä¸­çš„å˜é‡ï¼ˆä¸èƒ½ç”¨äºŽåˆ é™¤æ–¹æ³•ï¼‰ã€‚ å¯è°ƒç”¨Pythonæ•°æ®ç±»åž‹æ–‡æ¡£åˆ—å‡ºäº†7ç§å¯è°ƒç”¨å¯¹è±¡ã€‚ ç”¨æˆ·å®šä¹‰çš„å‡½æ•° ä½¿ç”¨defè¯­å¥æˆ–lambdaè¡¨è¾¾å¼åˆ›å»ºã€‚ å†…ç½®å‡½æ•° ä½¿ç”¨Cè¯­è¨€ï¼ˆCPythonï¼‰å®žçŽ°çš„å‡½æ•°ï¼Œå¦‚lenæˆ–time.strftimeã€‚ å†…ç½®æ–¹æ³• ä½¿ç”¨Cè¯­è¨€å®žçŽ°çš„æ–¹æ³•ï¼Œå¦‚dict.getã€‚ æ–¹æ³• åœ¨ç±»çš„å®šä¹‰ä½“ä¸­å®šä¹‰çš„å‡½æ•° ç±» è°ƒç”¨ç±»æ—¶ä¼šè¿è¡Œç±»çš„__new__æ–¹æ³•åˆ›å»ºä¸€ä¸ªå®žä¾‹ï¼Œç„¶åŽè¿è¡Œ__init__æ–¹æ³•ï¼Œåˆå§‹åŒ–å®žä¾‹ï¼Œæœ€åŽæŠŠå®žä¾‹è¿”å›žç»™å¯¹æ–¹ã€‚ ç±»çš„å®žä¾‹ å¦‚æžœç±»å®šä¹‰äº†__call__æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒçš„å®žä¾‹å¯ä»¥ä½œä¸ºå‡½æ•°è°ƒç”¨ ç”Ÿæˆå™¨å‡½æ•° ä½¿ç”¨yieldå…³é”®å­—çš„å‡½æ•°æˆ–æ–¹æ³•ã€‚è°ƒç”¨ç”Ÿæˆå™¨å‡½æ•°è¿”å›žçš„æ˜¯ç”Ÿæˆå™¨å¯¹è±¡ã€‚ Pythonä¸­æœ‰å„ç§å„æ ·å¯è°ƒç”¨ç±»åž‹ï¼Œå› æ­¤åˆ¤æ–­å¯¹è±¡èƒ½å¦è°ƒç”¨ï¼Œæœ€å®‰å…¨çš„æ–¹æ³•æ˜¯ä½¿ç”¨å†…ç½®çš„callable()å‡½æ•°ï¼š 12345678910&gt;&gt;&gt; print(callable.__doc__)Return whether the object is callable (i.e., some kind of function).Note that classes are callable, as are instances of classes with a__call__() method.&gt;&gt;&gt; abs, str, 13(&lt;built-in function abs&gt;, &lt;class 'str'&gt;, 13)&gt;&gt;&gt; [callable(obj) for obj in (abs, str, 13)][True, True, False] å®žä¾‹åœ¨ type() å‡½æ•°æä¾›å¯¹è±¡çš„ç±»åž‹æ—¶ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ isinstance() å‡½æ•°æµ‹è¯•å¯¹è±¡ï¼Œä»¥ç¡®å®šå®ƒæ˜¯å¦æ˜¯æŸä¸ªç‰¹å®šç±»åž‹æˆ–å®šåˆ¶ç±»çš„å®žä¾‹ï¼š 1234567891011121314151617&gt;&gt;&gt; print(isinstance.__doc__)Return whether an object is an instance of a class or of a subclass thereof.A tuple, as in ``isinstance(x, (A, B, ...))``, may be given as the target tocheck against. This is equivalent to ``isinstance(x, A) or isinstance(x, B)or ...`` etc.&gt;&gt;&gt; isinstance(2, int)True&gt;&gt;&gt; isinstance(2, str)False&gt;&gt;&gt; isinstance([1, 2, 3], list)True&gt;&gt;&gt; isinstance(&#123;1, 2, 3&#125;, set)True&gt;&gt;&gt; isinstance(&#123;1, 2, 3&#125;, dict)False å­ç±»å…³äºŽç±»çš„é—®é¢˜ï¼Œæœ‰ä¸€ä¸ªâ€œç»§æ‰¿â€æ¦‚å¿µï¼Œæœ‰ç»§æ‰¿å°±æœ‰çˆ¶å­é—®é¢˜ï¼Œè¿™æ˜¯åœ¨çŽ°å®žç”Ÿæ´»ä¸­å¾ˆæ­£å¸¸çš„ï¼Œåœ¨ç¼–ç¨‹è¯­è¨€ä¸­ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ åœ¨ç±»è¿™ä¸€çº§åˆ«ï¼Œå¯ä»¥æ ¹æ®ä¸€ä¸ªç±»æ¥å®šä¹‰å¦ä¸€ä¸ªç±»ï¼ŒåŒæ ·åœ°ï¼Œè¿™ä¸ªæ–°ç±»ä¼šæŒ‰ç…§å±‚æ¬¡åŒ–çš„æ–¹å¼ç»§æ‰¿å±žæ€§ã€‚Python ç”šè‡³æ”¯æŒå¤šé‡ç»§æ‰¿ï¼Œå¤šé‡ç»§æ‰¿æ„å‘³ç€å¯ä»¥ç”¨å¤šä¸ªçˆ¶ç±»æ¥å®šä¹‰ä¸€ä¸ªç±»ï¼Œè¿™ä¸ªæ–°ç±»ç»§æ‰¿äº†å¤šä¸ªçˆ¶ç±»ã€‚ issubclass() å‡½æ•°ä½¿æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä¸€ä¸ªç±»æ˜¯ä¸æ˜¯ç»§æ‰¿äº†å¦ä¸€ä¸ªç±»ï¼š 123456789101112131415&gt;&gt;&gt; print(issubclass.__doc__)Return whether 'cls' is a derived from another class or is the same class.A tuple, as in ``issubclass(x, (A, B, ...))``, may be given as the target tocheck against. This is equivalent to ``issubclass(x, A) or issubclass(x, B)or ...`` etc.&gt;&gt;&gt; from abc import ABC, abstractmethod&gt;&gt;&gt; class Test(ABC): ... @abstractmethod ... def test(self): ... """test""" ... &gt;&gt;&gt; issubclass(Test, ABC) True å‡½æ•°å†…çœ æˆ‘ä»¬ä½¿ç”¨å®žä¾‹æ¥è®²è¿°å‡½æ•°å†…çœçš„å…·ä½“ä½œç”¨ã€‚ è¿™éƒ¨åˆ†å‚è€ƒä¸Žã€Šæµç•…çš„Pythonã€‹ç¬¬äº”ç« ã€‚ é¦–å…ˆå®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼š 1234567891011121314def clip(text:str, max_len:'int &gt; 0'=80) -&gt; str: """åœ¨max_lenå‰é¢æˆ–åŽé¢çš„ç¬¬ä¸€ä¸ªç©ºæ ¼å¤„æˆªæ–­æ–‡æœ¬""" end = None if len(text) &gt; max_len: space_before = text.rfind(' ', 0, max_len) if space_before &gt;= 0: end = space_before else: space_after = text.rfind(' ', max_len) if space_after &gt;= 0: end = space_after if end is None: end = len(text) return text[:end].rstrip() ä½¿ç”¨dir()èŽ·å–å‡½æ•°çš„å±žæ€§ä½¿ç”¨dirå‡½æ•°å¯ä»¥æŽ¢çŸ¥clipå…·æœ‰ä¸‹è¿°å±žæ€§ï¼š 1['__annotations__', '__call__', '__class__', '__closure__', '__code__', '__defaults__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__get__', '__getattribute__', '__globals__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__kwdefaults__', '__le__', '__lt__', '__module__', '__name__', '__ne__', '__new__', '__qualname__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__'] å…¶ä¸­å¤§å¤šæ•°å±žæ€§æ˜¯Pythonå¯¹è±¡å…±æœ‰çš„ã€‚æˆ‘ä»¬é‡ç‚¹è¯´æ˜Žå‡½æ•°ä¸“æœ‰è€Œç”¨æˆ·å®šä¹‰çš„ä¸€èˆ¬å¯¹è±¡æ²¡æœ‰çš„å±žæ€§ã€‚ è®¡ç®—ä¸¤ä¸ªå±žæ€§é›†åˆçš„å·®é›†ä¾¿èƒ½å¾—åˆ°å‡½æ•°ä¸“æœ‰çš„å±žæ€§åˆ—è¡¨ï¼š 1234567&gt;&gt;&gt; class C: pass...&gt;&gt;&gt; obj = C()&gt;&gt;&gt; def func(): pass...&gt;&gt;&gt; sorted(set(dir(func)) - set(dir(obj)))['__annotations__', '__call__', '__closure__', '__code__', '__defaults__', '__get__', '__globals__', '__kwdefaults__', '__name__', '__qualname__'] åˆ—å‡ºè¿™äº›å±žæ€§çš„ç®€è¦è¯´æ˜Žï¼š åç§° ç±»åž‹ è¯´æ˜Ž __annotations__ dict å‚æ•°å’Œè¿”å›žå€¼çš„æ³¨è§£ __call__ method-wrapper å®žçŽ°ï¼ˆï¼‰è¿ç®—ç¬¦ï¼Œå³å¯è°ƒç”¨å¯¹è±¡åè®® __closure__ tuple å‡½æ•°é—­åŒ…ï¼Œå³è‡ªç”±å˜é‡çš„ç»‘å®šï¼ˆé€šå¸¸æ˜¯Noneï¼‰ __code__ code ç¼–è¯‘æˆå­—èŠ‚ç çš„å‡½æ•°å…ƒæ•°æ®å’Œå‡½æ•°å®šä¹‰ä½“ __defaults__ tuple å½¢å¼å‚æ•°çš„é»˜è®¤å€¼ __get__ method-wrapper å®žçŽ°åˆ¶åº¦æè¿°ç¬¦åè®® __globals__ dict å‡½æ•°æ‰€åœ¨æ¨¡å—ä¸­çš„å…¨å±€å˜é‡ __kwdefaults__ dict ä»…é™å…³é”®å­—å½¢å¼å‚æ•°çš„é»˜è®¤å€¼ __name__ str å‡½æ•°åç§° __qualname__ str å‡½æ•°çš„é™å®šåç§°ï¼Œå¦‚Random.choice èŽ·å–å‡½æ•°æ³¨è§£123&gt;&gt;&gt; from clip import clip&gt;&gt;&gt; clip.__annotations__&#123;'text': &lt;class 'str'&gt;, 'max_len': 'int &gt; 0', 'return': &lt;class 'str'&gt;&#125; å‡½æ•°å£°æ˜Žä¸­çš„å„ä¸ªå‚æ•°å¯ä»¥åœ¨ï¼šä¹‹åŽå¢žåŠ æ³¨è§£è¡¨è¾¾å¼ã€‚å¦‚æžœå‚æ•°æœ‰é»˜è®¤å€¼ï¼Œæ³¨è§£æ”¾åœ¨å‚æ•°åå’Œ=å·ä¹‹é—´ã€‚å¦‚æžœæƒ³æ³¨è§£è¿”å›žå€¼ï¼Œåœ¨ï¼‰å’Œå‡½æ•°å£°æ˜Žæœ«å°¾çš„ï¼šä¹‹é—´æ·»åŠ -&gt;è¡¨è¾¾å¼ã€‚è¿™ä¸ªè¡¨è¾¾å¼å¯ä»¥æ˜¯ä»»ä½•ç±»åž‹ã€‚æ³¨è§£ä¸­æœ€å¸¸ç”¨çš„ç±»åž‹æ˜¯ç±»ï¼ˆå¦‚stræˆ–intï¼‰å’Œå­—ç¬¦ä¸²ï¼ˆå¦‚â€™int&gt;0â€™ï¼‰ã€‚ èŽ·å–å‡½æ•°æ–‡æ¡£å­—ç¬¦ä¸²12&gt;&gt;&gt; clip.__doc__'åœ¨max_lenå‰é¢æˆ–åŽé¢çš„ç¬¬ä¸€ä¸ªç©ºæ ¼å¤„æˆªæ–­æ–‡æœ¬' èŽ·å–å‡½æ•°å‚æ•°ä¿¡æ¯12345678&gt;&gt;&gt; clip.__defaults__ (80,) &gt;&gt;&gt; clip.__code__ &lt;code object clip at 0x000001ABE1308780, file "C:\Users\Peng.Gao\Desktop\fluency_python\c5\clip.py", line 1&gt; &gt;&gt;&gt; clip.__code__.co_varnames ('text', 'max_len', 'end', 'space_before', 'space_after') &gt;&gt;&gt; clip.__code__.co_argcount 2 å¯ä»¥çœ‹å‡ºè¿™ç§ç»„ç»‡ä¿¡æ¯çš„æ–¹å¼å¹¶ä¸æ˜¯å¾ˆä¾¿åˆ©çš„ã€‚ ä¹‹åŽå†ä»‹ç»æ›´å¥½çš„æ–¹å¼inspectæ¨¡å—ã€‚]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Pythonå®žçŽ°ç»Ÿè®¡æ–‡æœ¬å½“ä¸­å•è¯æ•°é‡]]></title>
    <url>%2F2018%2F06%2F30%2FPython%E5%AE%9E%E7%8E%B0%E7%BB%9F%E8%AE%A1%E6%96%87%E6%9C%AC%E5%BD%93%E4%B8%AD%E5%8D%95%E8%AF%8D%E6%95%B0%E9%87%8F%2F</url>
    <content type="text"><![CDATA[å…³äºŽç”¨å®žçŽ°ç»Ÿè®¡æ–‡æœ¬å½“ä¸­å•è¯æ•°é‡è¿™ä¸ªåŠŸèƒ½ï¼Œä»£ç è¿›è¡Œä¸€æ­¥ä¸€æ­¥çš„å‡çº§ã€‚ æˆ‘åšä¸ªå›žé¡¾ï¼Œæˆ–è®¸ä»¥åŽè¿˜èƒ½å†™å‡ºæ›´ç¬¦åˆæ ‡å‡†çš„ä»£ç ã€‚ 1 åˆšçœ‹å®Œã€Špythonç¼–ç¨‹ï¼šä»Žå…¥é—¨åˆ°å®žè·µã€‹çš„æ—¶å€™å†™çš„ä»£ç å­¦ä¹ pythonçš„æ—¶å€™åœ¨ã€Špythonç¼–ç¨‹ï¼šä»Žå…¥é—¨åˆ°å®žè·µã€‹ä¹¦ä¸­ç¬¬10ç« ä¸­å­¦ä¹ äº†åˆ†æžæ–‡æœ¬ï¼Œå½“æ—¶å†™å‡ºäº†ç»Ÿè®¡ä¸€ä¸ªå•è¯å‡ºçŽ°çš„é¢‘çŽ‡ï¼š 1234567891011121314151617181920# 10-10 å¸¸è§å•è¯def row_count(filename): try: with open(filename) as f_obj: content = f_obj.read() except FileNotFoundError: msg = "The file " + filename + " does not exist." print(msg) else: content = content.replace(',', ' ') content = content.replace('.', ' ') content = content.replace('-', ' ') content = content.strip().lower() words = content.split() # ç»Ÿè®¡rowå•è¯å‡ºçŽ°åœ¨æ–‡æœ¬ä¸­çš„æ¬¡æ•° number = words.count('row') print('row : %d' % number)filename = 'Heart of Darkness.txt'row_count(filename) è¿è¡Œç»“æžœä¸ºï¼š 1row : 9 è¿™ä¸ªä»£ç åªæ˜¯å®žçŽ°ä¸€ä¸ªå•è¯çš„å‡ºçŽ°æ¬¡æ•°çš„ç»Ÿè®¡ã€‚ å¹¶ä¸”è¿˜æœ‰ä¸€äº›é—®é¢˜ã€‚æ¯”å¦‚è¿˜æœ‰[aã€(bè¿™æ ·çš„æ ‡ç‚¹ç¬¦å·å‡ºçŽ°åœ¨å•è¯ä¸­ã€‚ 2 å†™å®Œä¸€ä¸ªå•è¯çš„ç»Ÿè®¡ï¼Œåˆæ‰©å±•äº†å¯¹æ‰€æœ‰å•è¯éƒ½è¿›è¡Œç»Ÿè®¡å¹¶æŽ’åºå½“æ—¶å†™å®Œè¯¾åŽä½œä¸šæ—¶ï¼Œæƒ³åˆ°äº†èƒ½ä¸èƒ½å¯¹æ‰€æœ‰å•è¯éƒ½è¿›è¡Œç»Ÿè®¡å¹¶è¿›è¡ŒæŽ’åºå‘¢ï¼ŒäºŽæ˜¯ä¸Šç½‘æŸ¥äº†ä¸€äº›èµ„æ–™ï¼Œå†™å‡ºäº†ä¸‹é¢çš„ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839from operator import itemgetterdef words_list(filename): try: with open(filename) as f_obj: content = f_obj.read() except FileNotFoundError: msg = "The file " + filename + " does not exist." print(msg) else: content = content.replace(',', ' ') content = content.replace('.', ' ') content = content.replace('!', ' ') content = content.replace('-', ' ') content = content.replace('_', ' ') content = content.replace('(', ' ') content = content.replace(')', ' ') content = content.strip() words = [word.lower() for word in content.split()] return wordsdef count_results(filename): words_count = &#123;&#125; words = words_list(filename) words_count = words_count.fromkeys(words) for word in words_count.keys(): number = words.count(word) words_count[word] = number words_count = sorted(words_count.items(), key=itemgetter(1), reverse=True) return words_countif __name__ == '__main__': filename = 'Heart of Darkness.txt' words_count = count_results(filename) for word, word_count in words_count[:10]: print('&#123;0:&lt;10&#125; : &#123;1&#125;'.format(word, word_count)) è¿è¡Œç»“æžœä¸ºï¼š 12345678910the : 2440of : 1492a : 1205and : 1045i : 1039to : 967was : 671in : 668he : 563had : 503 è¿˜æ˜¯æœ‰é—®é¢˜ï¼Œè¿˜æ˜¯æœ‰æ ‡ç‚¹ç¬¦å·æ²¡æœ‰å½»åº•æ¸…é™¤ï¼Œç±»ä¼¼è¿™ç§[a]ã€_a_ã€‚ 3 å­¦å®Œæ­£åˆ™è¡¨è¾¾å¼ä»¥åŽä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œåˆ†å‰²å•è¯å­¦ä¼šä½¿ç”¨æ­£åˆ™ä»¥åŽï¼Œè¯•ç€ç”¨æ­£åˆ™æ¥æ¸…é™¤æ ‡ç‚¹ç¬¦å·ï¼š 1234567891011121314151617181920212223242526272829303132import refrom operator import itemgetterdef words_list(filename): try: with open(filename) as f_obj: content = f_obj.read() except FileNotFoundError: msg = "The file " + filename + " does not exist." print(msg) else: WORD_RE = re.compile(r'\W+') words = WORD_RE.split(content.lower()) return wordsdef count_results(filename): words_count = &#123;&#125; words = words_list(filename) words_count = words_count.fromkeys(words) for word in words_count.keys(): number = words.count(word) words_count[word] = number words_count = sorted(words_count.items(), key=itemgetter(1), reverse=True) return words_countif __name__ == '__main__': filename = 'Heart of Darkness.txt' words_count = count_results(filename) for word, word_count in words_count[:10]: print('&#123;0:&lt;10&#125; : &#123;1&#125;'.format(word, word_count)) ç»Ÿè®¡ç»“æžœä¸ºï¼š 12345678910the : 2468of : 1496a : 1209i : 1153and : 1062to : 974in : 673was : 672he : 596it : 515 è¿˜æ˜¯æœ‰é—®é¢˜ï¼Œ\w+åŒ…å«[A-Za-z0-9_]ï¼Œæ‰€ä»¥åŒ…å«â€™_â€˜çš„å•è¯ä¹Ÿä¼šè¢«ç»Ÿè®¡å‡ºæ¥ï¼Œæ¯”å¦‚è¯´â€˜_that_â€™ä¹Ÿä¼šè¢«ç»Ÿè®¡ï¼Œå¹¶ä¸”åŒºåˆ«äºŽthatã€‚ é¦–å…ˆæƒ³åˆ°å°±æ˜¯å…ˆæŠŠä¸‹åˆ’çº¿(_)æ›¿æ¢ä¸ºç©ºæ ¼å³å¯ï¼Œä¸è¿‡ä¹Ÿå¯ä»¥æŠŠ_that_å’Œthatå½“åšæ˜¯2ç§å•è¯ã€‚ 4 è¿˜æƒ³åˆ°äº†ä¸€ä¸ªä¸éœ€è¦countçš„è§£æ³•ä»Šå¤©çœ‹å¦ä¸€æœ¬ä¹¦ã€Šæµç•…çš„pythonã€‹ï¼Œåœ¨å­¦ä¹ å­—å…¸å’Œé›†åˆçš„æ—¶å€™æƒ³åˆ°äº†å¦ä¸€ç§è§£æ³•ï¼š 123456789101112131415161718192021222324252627def count_results(filename): try: with open(filename) as f_obj: content = f_obj.read() except FileNotFoundError: msg = "The file " + filename + " does not exist." print(msg) else: WORD_RE = re.compile(r'\w+') words_count = &#123;&#125; for match in WORD_RE.finditer(content.lower()): word = match.group() # occurrences = words_count.get(word, []) # occurrences.append(word) # words_count[word] = occurrences words_count.setdefault(word, []).append(word) words_count = &#123;word:len(value) for word, value in words_count.items()&#125; words_count = sorted(words_count.items(), key=itemgetter(1), reverse=True) return words_countif __name__ == '__main__': filename = 'Heart of Darkness.txt' words_count = count_results(filename) for word, word_count in words_count[:10]: print('&#123;0:&lt;10&#125; : &#123;1&#125;'.format(word, word_count)) 12345678910the : 2468of : 1496a : 1209i : 1153and : 1062to : 974in : 673was : 672he : 596it : 515 è¿™ä¸ªæ–¹æ³•æ¯”ä½¿ç”¨countçš„æ–¹æ³•é€Ÿåº¦è¦å¿«ä¸Šä¸å°‘ã€‚ 5 countæ–¹æ³•å’Œlenæ–¹æ³•é€Ÿåº¦æ¯”è¾ƒ12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970import refrom operator import itemgetterdef words_list(filename): try: with open(filename) as f_obj: content = f_obj.read() except FileNotFoundError: msg = "The file " + filename + " does not exist." print(msg) else: WORD_RE = re.compile(r'\W+') words = WORD_RE.split(content.lower()) return wordsdef count_results(filename): words_count = &#123;&#125; words = words_list(filename) words_count = words_count.fromkeys(words) for word in words_count.keys(): number = words.count(word) words_count[word] = number words_count = sorted(words_count.items(), key=itemgetter(1), reverse=True) return words_countdef count_words(filename): try: with open(filename) as f_obj: content = f_obj.read() except FileNotFoundError: msg = "The file " + filename + " does not exist." print(msg) else: WORD_RE = re.compile(r'\w+') words_count = &#123;&#125; for match in WORD_RE.finditer(content.lower()): word = match.group() # occurrences = words_count.get(word, []) # occurrences.append(word) # words_count[word] = occurrences words_count.setdefault(word, []).append(word) words_count = &#123;word: len(value) for word, value in words_count.items()&#125; words_count = sorted(words_count.items(), key=itemgetter(1), reverse=True) return words_countif __name__ == '__main__': import timeit def test_count_results(): filename = 'Heart of Darkness.txt' words_count = count_results(filename) return words_count def test_count_words(): filename = 'Heart of Darkness.txt' words_count = count_words(filename) return words_count time_1 = timeit.Timer('test_count_results()', setup="from __main__ import test_count_results") time_2 = timeit.Timer('test_count_words()', setup="from __main__ import test_count_words") print(time_1.timeit(number=10)) print(time_2.timeit(number=10)) è¾“å‡ºç»“æžœä¸ºï¼š 1254.6624033767616740.5711055088342789 ç»“æžœå‘çŽ°å·®è·è¿˜æ˜¯æŒºå¤§çš„ã€‚ è¯´ä¸€ä¸ªæˆ‘è®¤ä¸ºçš„åŽŸå› ï¼š countéœ€è¦éåŽ†åˆ—è¡¨ï¼ŒéåŽ†åˆ—è¡¨æ˜¯å¾ˆæ¶ˆè€—æ—¶é—´çš„ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼› è€Œä½¿ç”¨len()æ–¹æ³•æ—¶ï¼ŒCPythonä¼šç›´æŽ¥ä»Žå†…å­˜æ¥è¯»å–å±žæ€§å€¼ï¼Œå½“ç„¶è¦å¿«å¾ˆå¤šã€‚ ä»¥ä¸‹æ‘˜è‡ªã€Šæµç•…çš„pythonã€‹ç¬¬ä¸€ç«  å¦‚ä½•ä½¿ç”¨ç‰¹æ®Šæ–¹æ³• é¦–å…ˆæ˜Žç¡®ä¸€ç‚¹ï¼Œç‰¹æ®Šæ–¹æ³•çš„å­˜åœ¨æ˜¯ä¸ºäº†è¢«Pythonè§£é‡Šå™¨è°ƒç”¨çš„ï¼Œä½ è‡ªå·±å¹¶ä¸éœ€è¦è°ƒç”¨å®ƒä»¬ã€‚ä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰my_object.__len()__è¿™ç§å†™æ³•ï¼Œè€Œåº”è¯¥ä½¿ç”¨len(my_object)ã€‚åœ¨æ‰§è¡Œlen(my_object)çš„æ—¶å€™ï¼Œå¦‚æžœmy_objectæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ç±»çš„å¯¹è±¡ï¼Œé‚£ä¹ˆPythonä¼šè‡ªå·±åŽ»è°ƒç”¨å…¶ä¸­ç”±ä½ å®žçŽ°çš„__len__æ–¹æ³•ã€‚ ç„¶è€Œå¦‚æžœæ˜¯Pythonå†…ç½®çš„ç±»åž‹ï¼Œæ¯”å¦‚åˆ—è¡¨ï¼ˆlistï¼‰ã€å­—ç¬¦ä¸²ï¼ˆstrï¼‰ã€å­—èŠ‚ç³»åˆ—ï¼ˆbytearrayï¼‰ç­‰ï¼Œé‚£ä¹ˆCPythonä¼šæŠ„ä¸ªè¿‘è·¯ï¼Œ__len__å®žé™…ä¸Šä¼šç›´æŽ¥è¿”å›žPyVarObjecté‡Œçš„ob_sizeå±žæ€§ã€‚PyVarObjectæ˜¯è¡¨ç¤ºå†…å­˜ä¸­é•¿åº¦å¯å˜çš„å†…ç½®å¯¹è±¡çš„Cè¯­è¨€ç»“æž„ä½“ã€‚ç›´æŽ¥è¯»å–è¿™ä¸ªå€¼æ¯”è°ƒç”¨ä¸€ä¸ªæ–¹æ³•è¦å¿«å¾ˆå¤šã€‚ ç›®å‰çŸ¥è¯†æŽŒæ¡çš„ä¸å¤ªå¤šï¼Œè¿˜ä¸èƒ½å¾ˆè‚¯å®šã€‚ è¯´ä¸å®šä»¥åŽè¿˜æœ‰å…¶ä»–çš„æ”¹è¿›ï¼Œå¯èƒ½æœªå®Œå¾…ç»­ã€‚ 6 ä½¿ç”¨è®¡æ•°å™¨ï¼ˆCounterï¼‰æ–¹æ³•æ¥å®žçŽ°ï¼ˆç›®å‰ä¸ºæ­¢ä¸ªäººè§‰å¾—æœ€ä½³è§£æ³•ï¼‰å¥½å§ï¼Œä»Šå¤©åœ¨å­¦ä¹ ã€Šæµç•…çš„pythonã€‹æ—¶ï¼Œåˆå‘çŽ°äº†ç›®å‰ä¸ºæ­¢æˆ‘è®¤ä¸ºæœ€ä½³è§£å†³æ–¹å¼ã€‚ collections.Counter è¿™ä¸ªæ˜ å°„ç±»åž‹ä¼šç»™é”®å‡†å¤‡ä¸€ä¸ªæ•´ä½“è®¡æ•°å™¨ã€‚ æ¯æ¬¡æ›´æ–°ä¸€ä¸ªé”®çš„æ—¶å€™ä¼šå¢žåŠ è¿™ä¸ªè®¡æ•°å™¨ã€‚æ‰€ä»¥è¿™ä¸ªç±»åž‹å¯ä»¥ç”¨æ¥ç»™å¯æ•£åˆ—è¡¨å¯¹è±¡è®¡æ•°ï¼Œæˆ–è€…æ˜¯å½“æˆå¤šé‡é›†åˆæ¥ç”¨â€”â€”å¤šé‡é›†åˆå°±æ˜¯é›†åˆé‡Œçš„å…ƒç´ å¯ä»¥å‡ºçŽ°ä¸æ­¢ä¸€æ¬¡ã€‚ Counterå®žçŽ°äº†+å’Œ-è¿ç®—ç¬¦ç”¨æ¥åˆå¹¶è®°å½•ï¼Œè¿˜æœ‰åƒmost_common([n])è¿™ç±»å¾ˆæœ‰ç”¨çš„æ–¹æ³•ã€‚most_common([n])ä¼šæŒ‰ç…§æ¬¡åºè¿”å›žæ˜ å°„é‡Œæœ€å¸¸è§çš„nä¸ªé”®å’Œä»–ä»¬çš„è®¡æ•°ï¼Œè¯¦æƒ…å‚é˜…æ–‡æ¡£ï¼ˆhttps://docs.python.org/3/library/collections.html#collections.Counterï¼‰ã€‚ çœ‹ä¸€ä¸‹ä½¿ç”¨Counterç±»æ¥å®žçŽ°å¯¹å•è¯è¿›è¡Œç»Ÿè®¡çš„ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233import reimport collectionsdef words_list(filename): try: with open(filename) as f_obj: content = f_obj.read() except FileNotFoundError: msg = "The file " + filename + " does not exist." print(msg) else: WORD_RE = re.compile(r'\W+') words = WORD_RE.split(content.lower()) return words def words_counter(filename): try: with open(filename) as f_obj: content = f_obj.read() except FileNotFoundError: msg = "The file " + filename + " does not exist." print(msg) else: words = words_list(filename) words_count = collections.Counter(words) return words_countif __name__ != '__main__': filename = 'Heart of Darkness.txt' words_count = words_counter(filename) # æ³¨æ„è¿™ä¸ªæ˜¾ç¤ºå‰10éœ€è¦ä½¿ç”¨words_count.most_common(10)æ–¹æ³• for word, word_count in words_count.most_common(10): print('&#123;0:&lt;20&#125; : &#123;1&#125;'.format(word, word_count)) ç»“æžœä¸ºï¼š 12345678910the : 2468of : 1496a : 1209i : 1153and : 1062to : 974in : 673was : 672he : 596it : 515 è¿žæŽ’åºï¼ˆsortedï¼‰éƒ½çœäº†ï¼Œç†è®ºä¸Šåº”è¯¥æ›´å¿«ã€‚æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹é€Ÿåº¦ã€‚ 1234567891011121314151617181920212223242526272829if __name__ == '__main__': import timeit def test_count_results(): filename = 'Heart of Darkness.txt' words_count = count_results(filename) return words_count def test_count_words(): filename = 'Heart of Darkness.txt' words_count = count_words(filename) return words_count def test_words_counter(): filename = 'Heart of Darkness.txt' words_count = words_counter(filename) return words_count time_1 = timeit.Timer('test_count_results()', setup="from __main__ import test_count_results") time_2 = timeit.Timer('test_count_words()', setup="from __main__ import test_count_words") time_3 = timeit.Timer('test_words_counter()', setup="from __main__ import test_words_counter") print(time_1.timeit(number=10)) print(time_2.timeit(number=10)) print(time_3.timeit(number=10)) ç»“æžœä¸ºï¼š 12336.7605531286150150.379986186752539370.2645591842058579 æžœç„¶é€Ÿåº¦æ›´å¿«äº†ã€‚ è¿˜èƒ½æœªå®Œå¾…ç»­å—ï¼Ÿ]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Pythonå­¦ä¹ ç¬”è®°-æ­£åˆ™è¡¨è¾¾å¼ä¸Žreæ¨¡å—]]></title>
    <url>%2F2018%2F06%2F28%2FPython%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[1 ä½¿ç”¨ç›®çš„ å·¥ä½œä¸­ä¸€ç›´åœ¨ä½¿ç”¨Linuxï¼Œä¹Ÿä½¿ç”¨è¿‡æ­£åˆ™è¡¨è¾¾å¼ï¼ˆgrepã€awkå‘½ä»¤ï¼‰ï¼Œéƒ½æ˜¯çŽ°ç”¨çŽ°æŸ¥ï¼Œæ²¡æœ‰çœŸæ­£åŽ»äº†è§£å®ƒï¼Œç”¨å®Œä»¥åŽå°±å¿˜ã€‚ å­¦ä¹ pythonä¹‹åŽå‘çŽ°ä½¿ç”¨pythonå¤„ç†æ–‡æœ¬ã€æ—¥å¿—ç­‰æ–‡ä»¶ç”¨æ­£åˆ™è¡¨è¾¾å¼çš„åœ°æ–¹æ¯”è¾ƒå¤šã€‚æ¯æ¬¡éƒ½å¾—æµªè´¹æŒºé•¿æ—¶é—´åŽ»è®¾è®¡æ­£åˆ™è¡¨è¾¾å¼ï¼Œå°±æ˜¯å› ä¸ºæ²¡æœ‰çœŸæ­£æŽŒæ¡å®ƒï¼Œä»¥è‡³äºŽç”¨èµ·æ¥æ²¡æœ‰å¾—å¿ƒåº”æ‰‹çš„æ„Ÿè§‰ã€‚ æˆ‘èŠ±è´¹ä¸€ä¸‹åˆåŠ ä¸€æ™šä¸Šçš„æ—¶é—´é˜…è¯»äº†ä¸€æœ¬ã€Šæ­£åˆ™è¡¨è¾¾å¼å¿…çŸ¥å¿…ä¼šã€‹æ„Ÿè§‰æ­£åˆ™è¡¨è¾¾å¼ä¸å¤æ‚ï¼Œä½†æ˜¯èƒ½ç†Ÿç»ƒã€å‡†ç¡®ã€é«˜æ•ˆçš„ä½¿ç”¨å®ƒå¹¶ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„æ—¶é—´ã€‚å¿…é¡»è¦å¤šä½¿ç”¨ã€å¤šé˜…è¯»æ‰è¡Œã€‚ ç›®å‰åªæ˜¯å±žäºŽå…¥é—¨ï¼Œç­‰ä»¥åŽå¦‚æžœéœ€è¦å­¦ä¹ çˆ¬è™«çš„æ—¶å€™åº”è¯¥éœ€è¦æ›´æ·±å…¥çš„äº†è§£ï¼Œé‚£æ—¶å€™å†åŽ»åŽ»é˜…è¯»ã€Šç²¾é€šæ­£åˆ™è¡¨è¾¾å¼ã€‹ã€‚ è™½è¯´æ˜¯å…¥é—¨ï¼Œä¹Ÿæƒ³æ€»ç»“ä¸€ä¸‹ä¾¿ä»¥åŽæŸ¥é˜…ã€‚ 2 æ­£åˆ™è¡¨è¾¾å¼åŸºç¡€ 2.1 æ­£åˆ™è¡¨è¾¾å¼ç®€å•ä»‹ç»æ­£åˆ™è¡¨è¾¾å¼å¹¶ä¸æ˜¯Pythonçš„ä¸€éƒ¨åˆ†ã€‚æ­£åˆ™è¡¨è¾¾å¼æ˜¯ç”¨äºŽå¤„ç†å­—ç¬¦ä¸²çš„å¼ºå¤§å·¥å…·ï¼Œæ‹¥æœ‰è‡ªå·±ç‹¬ç‰¹çš„è¯­æ³•ä»¥åŠä¸€ä¸ªç‹¬ç«‹çš„å¤„ç†å¼•æ“Žï¼Œæ•ˆçŽ‡ä¸Šå¯èƒ½ä¸å¦‚strè‡ªå¸¦çš„æ–¹æ³•ï¼Œä½†åŠŸèƒ½ååˆ†å¼ºå¤§ã€‚ å¾—ç›ŠäºŽè¿™ä¸€ç‚¹ï¼Œåœ¨æä¾›äº†æ­£åˆ™è¡¨è¾¾å¼çš„è¯­è¨€é‡Œï¼Œæ­£åˆ™è¡¨è¾¾å¼çš„è¯­æ³•éƒ½æ˜¯ä¸€æ ·çš„ï¼ŒåŒºåˆ«åªåœ¨äºŽä¸åŒçš„ç¼–ç¨‹è¯­è¨€å®žçŽ°æ”¯æŒçš„è¯­æ³•æ•°é‡ä¸åŒï¼›ä½†ä¸ç”¨æ‹…å¿ƒï¼Œä¸è¢«æ”¯æŒçš„è¯­æ³•é€šå¸¸æ˜¯ä¸å¸¸ç”¨çš„éƒ¨åˆ†ã€‚ æ­£åˆ™è¡¨è¾¾å¼å·¥å…· æœ€åŸºç¡€çš„åŠŸèƒ½ï¼Œæµ‹è¯•ç”¨è¿˜è¡Œ http://tool.oschina.net/regex/ ï¼ˆç›®å‰ç”¨è¿‡æœ€å¥½çš„webç«¯ï¼Œå¾ˆé€‚åˆå­¦ä¹ çš„æ—¶å€™ä½¿ç”¨ï¼‰ http://regex.zjmainstay.cn/ ï¼ˆä¸Šä¸ªå·¥å…·çš„åŽŸç‰ˆï¼‰ https://regex101.com/ RegexBuddy ï¼ˆå®¢æˆ·ç«¯ï¼Œè²Œä¼¼æ˜¯æœ€å…¨é¢çš„ï¼Œéœ€è¦æ”¶è´¹ï¼Œæ²¡æœ‰ä½¿ç”¨è¿‡ï¼‰ è¿˜æœ‰å¾ˆå¤šç±»ä¼¼çš„å·¥å…·ï¼Œç½‘ä¸Šè‡ªå·±æœç´¢å°±å¥½ã€‚ 2.2 æ­£åˆ™è¡¨è¾¾å¼å…ƒå­—ç¬¦ç»Ÿè®¡å…ˆç»Ÿè®¡ä¸€ä¸‹æ­£åˆ™è¡¨è¾¾å¼å¸¸ç”¨çš„å…ƒå­—ç¬¦ï¼Œåœ¨ä¸¾ä¾‹è¯¦ç»†è¯´æ˜Žã€‚ å…ƒå­—ç¬¦ è¯´æ˜Ž ä¸€èˆ¬å­—ç¬¦ åŒ¹é…è‡ªèº« . åŒ¹é…ä»»ä½•ä¸€ä¸ªå•ä¸ªçš„å­—ç¬¦ï¼ˆåœ¨ç»å¤§å¤šæ•°çš„æ­£åˆ™è¡¨è¾¾å¼å®žçŽ°é‡Œï¼Œåªèƒ½åŒ¹é…é™¤æ¢è¡Œç¬¦ä»¥å¤–çš„ä»»ä½•å•ä¸ªå­—ç¬¦ï¼‰ [â€¦] å­—ç¬¦é›†ï¼ˆå­—ç¬¦ç±»ï¼‰ã€‚å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦ï¼›å¯ä»¥ä½¿ç”¨-ï¼ˆè¿žå­—ç¬¦ï¼‰åˆ©ç”¨é›†åˆåŒºé—´[â€¦]ä¸­ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯^è¡¨ç¤ºå–å-ï¼ˆè¿žå­—ç¬¦ï¼‰æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å…ƒå­—ç¬¦ï¼Œä½œä¸ºå…ƒå­—ç¬¦åªèƒ½ç”¨åœ¨[å’Œ]ä¹‹é—´ï¼Œåœ¨å­—ç¬¦é›†ä»¥å¤–çš„åœ°æ–¹-ï¼ˆè¿žå­—ç¬¦ï¼‰åªæ˜¯ä¸€ä¸ªæ™®é€šå­—ç¬¦ï¼Œåªèƒ½ä¸Ž-ï¼ˆè¿žå­—ç¬¦ï¼‰æœ¬èº«ç›¸åŒ¹é…ï¼Œä¸éœ€è¦è¢«è½¬ä¹‰ã€‚æ‰€æœ‰çš„å…ƒå­—ç¬¦åœ¨å­—ç¬¦é›†ä¸­éƒ½å¤±åŽ»åŽŸæœ‰çš„ç‰¹æ®Šå«ä¹‰ï¼Œä¸éœ€è¦è¢«è½¬ä¹‰ï¼Œä½†è½¬ä¹‰äº†ä¹Ÿæ²¡æœ‰åå¤„ã€‚æ³¨æ„[å’Œ]ä¹Ÿåªèƒ½åŒ¹é…ä¸€ä¸ªå­—ç¬¦ \ è½¬ä¹‰ï¼Œå°†ç‰¹æ®Šå­—ç¬¦å˜ä¸ºæ™®é€šå­—ç¬¦ å…ƒå­—ç¬¦ï¼ˆç‰¹å®šçš„å­—ç¬¦ç±»åˆ«ï¼‰ è¯´æ˜Ž \w ä»»ä½•ä¸€ä¸ªå­—æ¯æ•°å­—æˆ–ä¸‹åˆ’çº¿å­—ç¬¦ç­‰ä»·äºŽ[a-zA-Z0-9_] \W ä»»ä½•ä¸€ä¸ªéžå­—æ¯æ•°å­—æˆ–éžä¸‹åˆ’çº¿å­—ç¬¦ç­‰ä»·äºŽ[^a-zA-Z0-9_] \d ä»»ä½•ä¸€ä¸ªæ•°å­—å­—ç¬¦ç­‰ä»·äºŽ[0-9] \D ä»»ä½•ä¸€ä¸ªéžæ•°å­—å­—ç¬¦ç­‰ä»·äºŽ[^0-9] \s ä»»ä½•ä¸€ä¸ªç©ºç™½å­—ç¬¦ç­‰ä»·äºŽ[\f\n\r\t\v ] ï¼ˆæ³¨æ„å­—ç¬¦é›†ä¸­æœ‰ä¸ªç©ºæ ¼ï¼‰ \S ä»»ä½•ä¸€ä¸ªéžç©ºç™½å­—ç¬¦ç­‰ä»·äºŽ[^\f\n\r\t\v ] å…ƒå­—ç¬¦ï¼ˆæ•°é‡è¯ï¼‰ è¯´æ˜Žï¼ˆç”¨åœ¨æ™®é€šå­—ç¬¦ã€å…ƒå­—ç¬¦ã€å­—ç¬¦é›†æˆ–å­è¡¨è¾¾å¼ä¹‹åŽï¼‰ *ï¼ˆè´ªå©ªåž‹ï¼‰ å‰ä¸€ä¸ªå­—ç¬¦æˆ–å­—ç¬¦é›†åˆé‡å¤å‡ºçŽ°0æ¬¡æˆ–å¤šæ¬¡ï¼ˆæ— é™æ¬¡ï¼‰ +ï¼ˆè´ªå©ªåž‹ï¼‰ å‰ä¸€ä¸ªå­—ç¬¦æˆ–å­—ç¬¦é›†åˆè¿žç»­å‡ºçŽ°1æ¬¡æˆ–å¤šæ¬¡æ•ˆæžœç­‰ä»·äºŽ{1,} ï¼Ÿï¼ˆè´ªå©ªåž‹ï¼‰ å‰ä¸€ä¸ªå­—ç¬¦æˆ–å­—ç¬¦é›†åˆå‡ºçŽ°0æ¬¡æˆ–1æ¬¡æ•ˆæžœç­‰ä»·äºŽ{0,1} {}ï¼ˆè´ªå©ªåž‹ï¼‰ è®¾å®šå‰ä¸€ä¸ªå­—ç¬¦æˆ–å­—ç¬¦é›†åˆçš„é‡å¤æ¬¡æ•°{m,n}å¯ä»¥ä¸ºé‡å¤åŒ¹é…æ¬¡æ•°è®¾å®šä¸€ä¸ªåŒºé—´{m,}è¡¨ç¤ºé‡å¤åŒ¹é…å‰ä¸€ä¸ªå­—ç¬¦é‡å¤æ¬¡æ•°ä¸ºmè‡³æ— é™æ¬¡{,n}è¡¨ç¤ºé‡å¤åŒ¹é…å‰ä¸€ä¸ªå­—ç¬¦é‡å¤æ¬¡æ•°ä¸º0è‡³næ¬¡ *ï¼Ÿï¼ˆéžè´ªå©ªåž‹ï¼‰ åŒ¹é…å°½é‡å°‘çš„å­—ç¬¦ï¼Œè‡³å°‘0æ¬¡ +ï¼Ÿï¼ˆéžè´ªå©ªåž‹ï¼‰ åŒ¹é…å°½é‡å°‘çš„å­—ç¬¦ï¼Œè‡³å°‘ä¸€æ¬¡ ??ï¼ˆéžè´ªå©ªåž‹ï¼‰ åŒ¹é…å°½é‡å°‘çš„å­—ç¬¦ï¼Œè‡³å°‘0æ¬¡ {m,n}ï¼Ÿï¼ˆéžè´ªå©ªåž‹ï¼‰ åŒ¹é…å°½é‡å°‘çš„å­—ç¬¦ï¼Œè‡³å°‘mæ¬¡ å…ƒå­—ç¬¦ï¼ˆè¾¹ç•Œä½ç½®ï¼‰ è¯´æ˜Žï¼ˆè¾¹ç•ŒåŒ¹é…ä¸æ¶ˆè€—å¾…åŒ¹é…å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ï¼‰ ^ å­—ç¬¦ä¸²å¼€å¤´åœ¨å¤šè¡Œæ¨¡å¼(?m)ä¸­åŒ¹é…æ¯ä¸€è¡Œçš„å¼€å¤´ $ å­—ç¬¦ä¸²æœ«å°¾åœ¨å¤šè¡Œæ¨¡å¼(?m)ä¸­åŒ¹é…æ¯ä¸€è¡Œçš„æœ«å°¾ \A ä»…åŒ¹é…å­—ç¬¦ä¸²å¼€å¤´ \Z ä»…åŒ¹é…å­—ç¬¦ä¸²æœ«å°¾ \b å•è¯è¾¹ç•ŒåŒ¹é…è¿™æ ·ä¸€ä¸ªä½ç½®ï¼šä½äºŽä¸€ä¸ªèƒ½å¤Ÿç”¨æ¥æž„æˆå•è¯çš„å­—ç¬¦ï¼ˆ\wï¼‰å’Œä¸€ä¸ªä¸èƒ½ç”¨æ¥æž„æˆå•è¯çš„å­—ç¬¦ï¼ˆ\Wï¼‰ä¹‹é—´ \B éžå•è¯è¾¹ç•Œçš„ä½ç½®[^\b] å…ƒå­—ç¬¦ï¼ˆé€»è¾‘åˆ†ç»„ï¼‰ è¯´æ˜Ž \ ä»£è¡¨å·¦å³è¡¨è¾¾å¼ä»»æ„åŒ¹é…ä¸€ä¸ªæ€»æ˜¯å…ˆå°è¯•åŒ¹é…å·¦è¾¹çš„è¡¨è¾¾å¼ï¼Œä¸€æ—¦æˆåŠŸåˆ™è·³è¿‡åŒ¹é…å³è¾¹çš„è¡¨è¾¾å¼ (â€¦) å°æ‹¬å·é‡ŒåŒ…è£¹æŒ‡å®šå­è¡¨è¾¾å¼ï¼ˆå­ä¸²ï¼‰ï¼Œè¿™å°±æ˜¯åˆ†ç»„ã€‚ åˆ†ç»„ï¼Œåˆ†ç»„ä»Ž1å¼€å§‹ï¼Œä»Žè¡¨è¾¾å¼å·¦è¾¹å¼€å§‹æ¯é‡åˆ°ä¸€ä¸ªåˆ†ç»„çš„å·¦æ‹¬å·æ—¶ç¼–å·+1åˆ†ç»„è¡¨è¾¾å¼è¢«è§†ä¸ºä¸€ä¸ªæ•´ä½“ï¼Œå¯ä»¥åŽæŽ¥æ•°é‡è¯ã€‚è¡¨è¾¾å¼è‹¥æœ‰ä¸¨è¡¨ç¤ºä»…åœ¨è¯¥ç»„ä¸­æœ‰æ•ˆ (?P\&lt;name>â€¦) å‘½ååˆ†ç»„å¯ä»¥ç»™åˆ†ç»„èµ·ä¸€ä¸ªå”¯ä¸€çš„åå­—ï¼Œç„¶åŽç”¨è¿™ä¸ªåå­—ï¼ˆè€Œä¸æ˜¯ç›¸å¯¹ä½ç½®ï¼‰æ¥å¼•ç”¨ \&lt;number> å¼•ç”¨ç¼–å·ä¸º\&lt;number>çš„åˆ†ç»„åŒ¹é…åˆ°çš„å­—ç¬¦ä¸² (?P=name) å¼•ç”¨å‘½åä¸º\&lt;name>çš„åˆ†ç»„åŒ¹é…åˆ°çš„å­—ç¬¦ä¸² å…ƒå­—ç¬¦ï¼ˆç‰¹æ®Šæž„é€ ï¼‰ è¯´æ˜Žï¼ˆä¸ä½œä¸ºåˆ†ç»„ï¼‰ (?:â€¦) ï¼ˆâ€¦ï¼‰ä¸åˆ†ç»„ç‰ˆæœ¬ (?=â€¦) å‘å‰æŸ¥æ‰¾åŒ¹é…=åŽé¢å­—ç¬¦çš„å†…å®¹éžæ•èŽ·ï¼Œä¸æ¶ˆè€—å­—ç¬¦ä¸²å†…å®¹ï¼ˆé€šä¿—è®²å°±æ˜¯ä¸åŒ…å«åŒ¹é…çš„å­—ç¬¦ï¼‰ (?!â€¦) å‘å‰æŸ¥æ‰¾ä¸åŒ¹é…!åŽé¢å­—ç¬¦çš„å†…å®¹éžæ•èŽ·ï¼Œä¸æ¶ˆè€—å­—ç¬¦ä¸²å†…å®¹ï¼ˆé€šä¿—è®²å°±æ˜¯ä¸åŒ…å«åŒ¹é…çš„å­—ç¬¦ï¼‰ (?&lt;=â€¦) å‘åŽæŸ¥æ‰¾åŒ¹é…=åŽé¢å­—ç¬¦çš„å†…å®¹éžæ•èŽ·ï¼Œä¸æ¶ˆè€—å­—ç¬¦ä¸²å†…å®¹ï¼ˆé€šä¿—è®²å°±æ˜¯ä¸åŒ…å«åŒ¹é…çš„å­—ç¬¦ï¼‰ (?&lt;!â€¦) å‘åŽæŸ¥æ‰¾ä¸åŒ¹é…!åŽé¢å­—ç¬¦çš„å†…å®¹éžæ•èŽ·ï¼Œä¸æ¶ˆè€—å­—ç¬¦ä¸²å†…å®¹ï¼ˆé€šä¿—è®²å°±æ˜¯ä¸åŒ…å«åŒ¹é…çš„å­—ç¬¦ï¼‰ (?(1)yes\ä¸¨no) è‹¥æˆåŠŸåŒ¹é…åˆ†ç»„1ï¼Œåˆ™åŒ¹é…ç«–çº¿å‰çš„å­è¡¨è¾¾å¼ï¼Œå¦åˆ™åŒ¹é…åŽè€…ã€‚ è¿˜æœ‰ä¸€äº›é€’å½’çŽ¯è§†ç­‰ç­‰å…ƒå­—ç¬¦ç›®å‰æ„Ÿè§‰ç”¨ä¸ä¸Šï¼Œé€šå¸¸ç”¨äºŽå¾ˆå¤æ‚çš„æƒ…å†µï¼Œæš‚æ—¶ä¸ç»Ÿè®¡ã€‚ 2.3 æ­£åˆ™è¡¨è¾¾å¼å®žä¾‹ä¾‹1ï¼šä½¿ç”¨æ•°é‡è¯ RGBå€¼ï¼šç”¨ä¸€ä¸ªåå…­è¿›åˆ¶æ•°å­—ç»™å‡ºçš„çº¢ã€ç»¿ã€è“ä¸‰åŸºè‰²çš„ç»„åˆå€¼ã€‚ æµ‹è¯•æ–‡æœ¬ï¼ˆç²—ä½“å­—è¡¨ç¤ºéœ€è¦åŒ¹é…å‡ºæ¥çš„å­—ç¬¦ä¸²ï¼‰ï¼š &lt;BODY BGCOLOR=â€#336633â€œ TEXT=â€#FFFFFFâ€œ MARGINWIDTH=â€0â€ MARGINHEIGTH=â€0â€ TOPMARGIN=â€0â€ LEFTMARGIN=â€0â€&gt; 1#[0-9A-Fa-f]&#123;6&#125; Match 1 å®Œæ•´åŒ¹é… 20-27 `#336633` Match 2 å®Œæ•´åŒ¹é… 35-42 `#FFFFFF` ä¾‹2ï¼šä½¿ç”¨åˆ†ç»„ä»¥åŠæ¡ä»¶åˆ¤æ–­ æŸ¥æ‰¾ä¸­å›½å›ºå®šç”µè¯å·ç  æˆ‘å›½çš„å›ºå®šç”µè¯å·ç çš„è§„å¾‹æ˜¯åŒºå·+ç”µè¯å·ç ï¼š æœ€å¼€å§‹çš„ä½ä¸€å®šæ˜¯0ï¼Œè¡¨ç¤ºé•¿é€”ï¼ŒæŽ¥ç€æ˜¯2ä½ã€3ä½æˆ–è€…ç»„æˆçš„åŒºå·ã€‚ ç„¶åŽæ˜¯7ä½æˆ–è€…8ä½çš„ç”µè¯å·ç ï¼Œå…¶ä¸­é¦–ä½ä¸ä¸º1ã€‚ å›½å†…ä¹ æƒ¯çš„ç”µè¯æ ¼å¼æœ‰ï¼š 029 8845 7890 (029)88457890 (029) 88457890 029-8845-7890 029-88457890 020-8845 7890 æµ‹è¯•æ–‡æœ¬ï¼ˆç²—ä½“å­—è¡¨ç¤ºéœ€è¦åŒ¹é…å‡ºæ¥çš„å­—ç¬¦ä¸²ï¼‰ï¼š 022-5731-3255(0701)40566323010-667788990376 622779104356647988(0376-22444567(0378 2234432 1(?m)^(\()?0[1-9]\d&#123;1,2&#125;(?(1)\)|[- ])[2-9]\d&#123;2,3&#125;[-]?\d&#123;4&#125; è§£é‡Šä¸€ä¸‹è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼š (?m) è¡¨ç¤ºå¼€å¯å¤šè¡ŒåŒ¹é… ^(\()?0 è¡¨ç¤ºå¿…é¡»ä»¥(å¼€å¤´æˆ–è€…0å¼€å¤´ï¼Œå¹¶æŠŠ(åˆ†ç»„ï¼Œç¼–å·ä¸º1 (?(1)\)|[- ])è¡¨ç¤ºè‹¥æˆåŠŸåŒ¹é…åˆ°åˆ†ç»„1(\()ï¼Œåˆ™åŒ¹é…)ï¼Œè‹¥åŒ¹é…è¡¥åˆ€åˆ†ç»„1ï¼Œåˆ™åŒ¹é…-æˆ–è€…ç©ºæ ¼ã€‚ Match 1 å®Œæ•´åŒ¹é… 0-13 `022-5731-3255` Match 2 å®Œæ•´åŒ¹é… 14-28 `(0701)40566323` åˆ†ç»„ 1. 14-15 `(` Match 3 å®Œæ•´åŒ¹é… 29-41 `010-66778899` Match 4 å®Œæ•´åŒ¹é… 42-54 `0376 6227791` ä¾‹3ï¼šå­è¡¨è¾¾å¼çš„åµŒå¥—ç”¨æ³• IPv4åœ°å€ç”±4ä¸ªå­—èŠ‚æž„æˆï¼ŒIPåœ°å€ä¸­çš„4ç»„æ•°å­—åˆ†åˆ«å¯¹åº”ç€é‚£4ä¸ªå­—èŠ‚ã€‚æ‰€ä»¥IPåœ°å€é‡Œçš„æ¯ç»„æ•°å­—çš„å–å€¼èŒƒå›´ä¹Ÿå°±æ˜¯å•ä¸ªå­—èŠ‚çš„è¡¨ç¤ºèŒƒå›´ï¼Œå³0~255ã€‚ æ­£åˆ™è¡¨è¾¾å¼ä¸æ‡‚è®¡ç®—ï¼Œåªæ˜¯ä¸€ç§å·¥å…·ï¼Œæ²¡åŠžæ³•è®¾å®šå–å€¼èŒƒå›´ã€‚ ä¸€ç»„æ•°å­—çš„å–å€¼èŒƒå›´éœ€è¦æˆ‘ä»¬è‡ªå·±æ¥æž„é€ ï¼š ä»»ä½•ä¸€ä¸ª1ä½æˆ–2ä½æ•°å­— ä»»ä½•ä¸€ä¸ªä»¥1å¼€å¤´çš„3ä½æ•°å­— ä»»ä½•ä¸€ä¸ªä»¥2å¼€å¤´ã€ç¬¬äºŒä½æ•°å­—åœ¨0~4ä¹‹é—´çš„3ä½æ•°å­— ä»»ä½•ä¸€ä¸ªä»¥25å¼€å¤´ã€ç¬¬ä¸‰ä½æ•°å­—åœ¨0~5ä¹‹é—´çš„3ä½æ•°å­— æµ‹è¯•æ–‡æœ¬ï¼š 255.255.255.01.1.1.122.2.222.234192.168.99.101192.168.99.10111124.258.66.88192192.168.99.101 1\b(((\d&#123;1,2&#125;)|(1\d&#123;2&#125;)|(2[0-4]\d)|(25[0-5]))\.)&#123;3&#125;((\d&#123;1,2&#125;)|(1\d&#123;2&#125;)|(2[0-4]\d)|(25[0-5]))\b Match 1 å®Œæ•´åŒ¹é… 0-13 `255.255.255.0` åˆ†ç»„ 1. 8-12 `255.` åˆ†ç»„ 2. 8-11 `255` åˆ†ç»„ 6. 8-11 `255` åˆ†ç»„ 7. 12-13 `0` åˆ†ç»„ 8. 12-13 `0` Match 2 å®Œæ•´åŒ¹é… 14-21 `1.1.1.1` åˆ†ç»„ 1. 18-20 `1.` åˆ†ç»„ 2. 18-19 `1` åˆ†ç»„ 3. 18-19 `1` åˆ†ç»„ 7. 20-21 `1` åˆ†ç»„ 8. 20-21 `1` Match 3 å®Œæ•´åŒ¹é… 22-34 `22.2.222.234` åˆ†ç»„ 1. 27-31 `222.` åˆ†ç»„ 2. 27-30 `222` åˆ†ç»„ 3. 25-26 `2` åˆ†ç»„ 5. 27-30 `222` åˆ†ç»„ 7. 31-34 `234` åˆ†ç»„ 10. 31-34 `234` Match 4 å®Œæ•´åŒ¹é… 35-49 `192.168.99.101` åˆ†ç»„ 1. 43-46 `99.` åˆ†ç»„ 2. 43-45 `99` åˆ†ç»„ 3. 43-45 `99` åˆ†ç»„ 4. 39-42 `168` åˆ†ç»„ 7. 46-49 `101` åˆ†ç»„ 9. 46-49 `101` æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠï¼ˆâ€¦ï¼‰å½“åšå­è¡¨è¾¾å¼æ¥ä½¿ç”¨ï¼ˆæ¯”å¦‚é™åˆ¶|æˆ–è€…è·Ÿæ•°é‡è¯ç­‰ï¼‰ï¼Œä¹Ÿå¯ä»¥å½“åšåˆ†ç»„æ¥ä½¿ç”¨ï¼ˆæ¯”å¦‚å›žæº¯å¼•ç”¨ï¼‰ã€‚ ä¾‹4ï¼šèŽ·å–åŒ¹é…ä¸ŽéžèŽ·å–åŒ¹é… åœ¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„è¿‡ç¨‹ä¸­ï¼Œå…¶å®žå­˜åœ¨â€œæ¶ˆè€—å­—ç¬¦â€çš„è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ä¸€ä¸ªå­—ç¬¦åœ¨åŒ¹é…è¿‡ç¨‹ä¸­è¢«æ£€ç´¢ï¼ˆæ¶ˆè€—ï¼‰è¿‡ï¼ŒåŽé¢çš„åŒ¹é…å°±ä¸ä¼šå†æ£€ç´¢è¿™ä¸€å­—ç¬¦äº†ã€‚ åŒ¹é…ä½¿ç”¨çš„åè®® æµ‹è¯•æ–‡æœ¬ï¼š1 https://www.baidu.comhttp://www.cnblogs.comftp://ftp.forta.com æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªæ™®é€šçš„ï¼ˆèŽ·å–åŒ¹é…ï¼Œæ¶ˆè€—å­—ç¬¦ä¸²å†…å®¹ï¼‰ 1.+(:) è¿™é‡Œï¼šåˆ†ä¸åˆ†ç»„éƒ½ä¸€æ ·ï¼Œè¿™é‡Œåªæ˜¯æ¸…æ™°çš„è¡¨è¾¾èŽ·å–åŒ¹é…å’ŒéžèŽ·å–åŒ¹é… Match 1 å®Œæ•´åŒ¹é… 0-6 `https:` Match 2 å®Œæ•´åŒ¹é… 22-27 `http:` Match 3 å®Œæ•´åŒ¹é… 45-49 `ftp:` å¯ä»¥çœ‹å‡ºï¼šä¹Ÿè¢«åŒ¹é…è¿›åŽ»äº†ï¼Œæˆ‘ä»¬å¦‚æžœä¸æƒ³åŒ¹é…ï¼šçš„è¯å°±å¯ä»¥ä½¿ç”¨éžèŽ·å–åŒ¹é…ï¼Œä¸æ¶ˆè€—åŒ¹é…çš„å­—ç¬¦ã€‚ 1.+(?=:) Match 1 å®Œæ•´åŒ¹é… 0-5 `https` Match 2 å®Œæ•´åŒ¹é… 22-26 `http` Match 3 å®Œæ•´åŒ¹é… 45-48 `ftp` å¯ä»¥å‘çŽ°åŒ¹é…çš„ï¼šå¹¶æ²¡æœ‰å‡ºçŽ°åœ¨æˆ‘ä»¬çš„æœ€ç»ˆåŒ¹é…ç»“æžœä¸­ã€‚ åŒç†ï¼Œ(?!â€¦)(?&lt;=â€¦)(?&lt;!â€¦)ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ã€‚ ä¾‹5ï¼šè´ªå©ªåž‹å…ƒå­—ç¬¦å’Œéžè´ªå©ªåž‹å…ƒå­—ç¬¦ è´ªå©ªåž‹æ€»æ˜¯å°è¯•åŒ¹é…å°½å¯èƒ½å¤šçš„å­—ç¬¦ï¼›éžè´ªå©ªåž‹åž‹åˆ™ç›¸åï¼Œæ€»æ˜¯å°è¯•åŒ¹é…å°½å¯èƒ½å°‘çš„å­—ç¬¦ã€‚ è´ªå©ªæ€§å…ƒå­—ç¬¦ éžè´ªå©ªåž‹å…ƒå­—ç¬¦ * *? + +? {m,n} {m,n}? æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ï¼š æµ‹è¯•æ–‡æœ¬ï¼š &lt;div&gt;test1&lt;/div&gt;bb&lt;div&gt;test2&lt;/div&gt; 1&lt;div&gt;.*&lt;\/div&gt; Match 1 å®Œæ•´åŒ¹é… 0-34 &lt;div&gt;test1&lt;/div&gt;bb&lt;div&gt;test2&lt;/div&gt; 1&lt;div&gt;.*?&lt;\/div&gt; Match 1 å®Œæ•´åŒ¹é… 0-16 &lt;div&gt;test1&lt;/div&gt; Match 2 å®Œæ•´åŒ¹é… 18-34 &lt;div&gt;test2&lt;/div&gt; å¦‚æžœåªåŒ¹é…ä¸€æ¬¡çš„è¯ï¼Œä½¿ç”¨è´ªå©ªæ¨¡å¼å°±å°½å¯èƒ½å¤šçš„åŒ¹é…ç¬¦åˆè¡¨è¾¾å¼çš„ç»“æžœï¼›è€Œä½¿ç”¨éžè´ªå©ªæ¨¡å¼åŒ¹é…ç¬¦åˆè¡¨è¾¾å¼å°±ç«‹å³åœæ­¢è¿™æ¬¡åŒ¹é…ï¼Œå¼€å§‹ä¸‹æ¬¡åŒ¹é…ã€‚ 3 Python reæ¨¡å—ä½¿ç”¨ re æ¨¡å—ä½¿ Python è¯­è¨€æ‹¥æœ‰å…¨éƒ¨çš„æ­£åˆ™è¡¨è¾¾å¼åŠŸèƒ½ã€‚ compile å‡½æ•°æ ¹æ®ä¸€ä¸ªæ¨¡å¼å­—ç¬¦ä¸²å’Œå¯é€‰çš„æ ‡å¿—å‚æ•°ç”Ÿæˆä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡ã€‚è¯¥å¯¹è±¡æ‹¥æœ‰ä¸€ç³»åˆ—æ–¹æ³•ç”¨äºŽæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å’Œæ›¿æ¢ã€‚ re æ¨¡å—ä¹Ÿæä¾›äº†ä¸Žè¿™äº›æ–¹æ³•åŠŸèƒ½å®Œå…¨ä¸€è‡´çš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°ä½¿ç”¨ä¸€ä¸ªæ¨¡å¼å­—ç¬¦ä¸²åšä¸ºå®ƒä»¬çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚ 3.1 æ­£åˆ™è¡¨è¾¾å¼ä¿®é¥°ç¬¦ - å¯é€‰æ ‡å¿—æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥åŒ…å«ä¸€äº›å¯é€‰æ ‡å¿—ä¿®é¥°ç¬¦æ¥æŽ§åˆ¶åŒ¹é…çš„æ¨¡å¼ã€‚ä¿®é¥°ç¬¦è¢«æŒ‡å®šä¸ºä¸€ä¸ªå¯é€‰çš„æ ‡å¿—ã€‚å¤šä¸ªæ ‡å¿—å¯ä»¥é€šè¿‡æŒ‰ä½ OR(|) å®ƒä»¬æ¥æŒ‡å®šã€‚å¦‚ re.I | re.M è¢«è®¾ç½®æˆ I å’Œ M æ ‡å¿—ï¼š ä¿®é¥°ç¬¦ æè¿° re.Iï¼ˆIGNORECASEï¼‰ ä½¿åŒ¹é…å¯¹å¤§å°å†™ä¸æ•æ„Ÿ re.Lï¼ˆLOCALEï¼‰ åšæœ¬åœ°åŒ–è¯†åˆ«ï¼ˆlocale-awareï¼‰åŒ¹é…ä½¿é¢„å®šå­—ç¬¦ç±» \w \W \b \B \s \S å–å†³äºŽå½“å‰åŒºåŸŸè®¾å®š re.Mï¼ˆ MULTILINE ï¼‰ å¤šè¡ŒåŒ¹é…ï¼Œæ”¹å˜ ^ å’Œ $çš„è¡Œä¸º re.Sï¼ˆDOTALLï¼‰ ä½¿ . åŒ¹é…åŒ…æ‹¬æ¢è¡Œåœ¨å†…çš„æ‰€æœ‰å­—ç¬¦ re.Uï¼ˆ UNICODE ï¼‰ æ ¹æ®Unicodeå­—ç¬¦é›†è§£æžå­—ç¬¦ã€‚ä½¿é¢„å®šå­—ç¬¦ç±» \w \W \b \B \s \S \d \D å–å†³äºŽunicodeå®šä¹‰çš„å­—ç¬¦å±žæ€§ re.Xï¼ˆ VERBOSE ï¼‰ è¯¦ç»†æ¨¡å¼ï¼Œè¯¥æ ‡å¿—é€šè¿‡ç»™äºˆä½ æ›´çµæ´»çš„æ ¼å¼ä»¥ä¾¿ä½ å°†æ­£åˆ™è¡¨è¾¾å¼å†™å¾—æ›´æ˜“äºŽç†è§£ã€‚ 3.2 åæ–œæ çš„å›°æ‰°ä¸Žå¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ç›¸åŒï¼Œæ­£åˆ™è¡¨è¾¾å¼é‡Œä½¿ç”¨\ä½œä¸ºè½¬ä¹‰å­—ç¬¦ï¼Œè¿™å°±å¯èƒ½é€ æˆåæ–œæ å›°æ‰°ã€‚ å‡å¦‚ä½ éœ€è¦åŒ¹é…æ–‡æœ¬ä¸­çš„å­—ç¬¦\ï¼Œé‚£ä¹ˆä½¿ç”¨ç¼–ç¨‹è¯­è¨€è¡¨ç¤ºçš„æ­£åˆ™è¡¨è¾¾å¼é‡Œå°†éœ€è¦4ä¸ªåæ–œæ â€\\\\â€œï¼šå‰ä¸¤ä¸ªå’ŒåŽä¸¤ä¸ªåˆ†åˆ«ç”¨äºŽåœ¨ç¼–ç¨‹è¯­è¨€é‡Œè½¬ä¹‰æˆåæ–œæ ï¼Œè½¬æ¢æˆä¸¤ä¸ªåæ–œæ åŽå†åœ¨æ­£åˆ™è¡¨è¾¾å¼é‡Œè½¬ä¹‰æˆä¸€ä¸ªåæ–œæ ã€‚ Pythoné‡Œçš„åŽŸç”Ÿå­—ç¬¦ä¸²å¾ˆå¥½åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªä¾‹å­ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥ä½¿ç”¨râ€™\â€˜è¡¨ç¤ºã€‚åŒæ ·ï¼ŒåŒ¹é…ä¸€ä¸ªæ•°å­—çš„â€™\dâ€™å¯ä»¥å†™æˆrâ€™\dâ€™ã€‚æœ‰äº†åŽŸç”Ÿå­—ç¬¦ä¸²ï¼Œä½ å†ä¹Ÿä¸ç”¨æ‹…å¿ƒæ˜¯ä¸æ˜¯æ¼å†™äº†åæ–œæ ï¼Œå†™å‡ºæ¥çš„è¡¨è¾¾å¼ä¹Ÿæ›´ç›´è§‚ã€‚ 3.3 compileç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¿”å›žä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼ˆ Pattern ï¼‰ å¯¹è±¡ã€‚ï¼ˆå¯ä»¥æŠŠé‚£äº›å¸¸ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼ç¼–è¯‘æˆæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡ï¼Œè¿™æ ·å¯ä»¥æé«˜æ•ˆçŽ‡ã€‚ï¼‰ è¯­æ³•ï¼š compile(pattern,flags=0) pattern - ç¼–è¯‘æ—¶ç”¨çš„è¡¨è¾¾å¼å­—ç¬¦ä¸² flags - æ ‡å¿—ä½ï¼Œç”¨äºŽæŽ§åˆ¶æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…æ–¹å¼ï¼Œå¦‚ï¼šæ˜¯å¦åŒºåˆ†å¤§å°å†™ï¼Œå¤šè¡ŒåŒ¹é…ç­‰ç­‰ã€‚ 123456&gt;&gt;&gt; import re&gt;&gt;&gt; data = "Tina is a good girl, she is cool, clever, and so on..."&gt;&gt;&gt; pattern = re.compile(r'\w*oo\w*', re.I)# æŸ¥æ‰¾æ‰€æœ‰åŒ…å«ooçš„å•è¯ï¼Œfindallæ–¹æ³•ä¸‹é¢ä¼šè®²åˆ°&gt;&gt;&gt; print(pattern.findall(data))['good', 'cool'] 3.4 matchä»Žå­—ç¬¦ä¸²çš„èµ·å§‹ä½ç½®åŒ¹é…patternï¼Œå¦‚æžœpatternç»“æŸæ—¶ä»å¯åŒ¹é…åˆ™è¿”å›žä¸€ä¸ªmacth objectå¯¹è±¡ï¼›å¦‚æžœèµ·å§‹ä½ç½®åŒ¹é…ä¸æˆåŠŸçš„è¯ï¼Œmatch()å°±è¿”å›žnoneã€‚ è¯­æ³•ï¼š match(pattern, string, flags=0) pattern - åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼ string - è¦åŒ¹é…çš„å­—ç¬¦ä¸² flags - æ ‡å¿—ä½ï¼Œç”¨äºŽæŽ§åˆ¶æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…æ–¹å¼ï¼Œå¦‚ï¼šæ˜¯å¦åŒºåˆ†å¤§å°å†™ï¼Œå¤šè¡ŒåŒ¹é…ç­‰ç­‰ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨group(num) æˆ– groups() åŒ¹é…å¯¹è±¡å‡½æ•°æ¥èŽ·å–åŒ¹é…è¡¨è¾¾å¼ã€‚ group(num=0) - åŒ¹é…çš„æ•´ä¸ªè¡¨è¾¾å¼çš„å­—ç¬¦ä¸²ï¼Œgroup() å¯ä»¥ä¸€æ¬¡è¾“å…¥å¤šä¸ªç»„å·ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å®ƒå°†è¿”å›žä¸€ä¸ªåŒ…å«é‚£äº›ç»„æ‰€å¯¹åº”å€¼çš„å…ƒç»„ã€‚ groups() - è¿”å›žä¸€ä¸ªåŒ…å«æ‰€æœ‰å°ç»„å­—ç¬¦ä¸²çš„å…ƒç»„ï¼Œä»Ž 1 åˆ° æ‰€å«çš„å°ç»„å·ã€‚ å®žä¾‹ï¼š 1234567891011121314151617181920# èµ·å§‹ä½ç½®åŒ¹é…æˆåŠŸï¼Œè¿”å›žä¸€ä¸ªmatch objectå¯¹è±¡&gt;&gt;&gt; print(re.match('www','www.runoob.com')) &lt;_sre.SRE_Match object; span=(0, 3), match='www'&gt; # match objectå¯¹è±¡ä½¿ç”¨spanå‡½æ•°æ¥è¿”å›žä¸€ä¸ªå…ƒç»„åŒ…å«åŒ¹é…çš„ä½ç½®&gt;&gt;&gt; print(re.match('www','www.runoob.com').span())(0, 3)# match objectå¯¹è±¡ä½¿ç”¨group()å‡½æ•°æ¥è¿”å›žåŒ¹é…çš„å­—ç¬¦ä¸²,ä¸‹é¢ä¼šè¯¦ç»†è®²åˆ°&gt;&gt;&gt; print(re.match('www','www.runoob.com').group())www# match objectå¯¹è±¡ä½¿ç”¨groups()å‡½æ•°æ¥è¿”å›žä»¥å…ƒç»„å½¢å¼åˆ†ç»„æ•èŽ·çš„å­—ç¬¦ä¸²&gt;&gt;&gt; print(re.match('(www)','www.runoob.com').groups())('www',)# èµ·å§‹ä½ç½®åŒ¹é…ä¸æˆåŠŸï¼Œè¿”å›žNone&gt;&gt;&gt; print(re.match('com','www.runoob.com')) None# ç”±äºŽè¿”å›žçš„ä¸æ˜¯match objectå¯¹è±¡ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨match objectå¯¹è±¡æ‰€åŒ…å«çš„æ–¹æ³•&gt;&gt;&gt; print(re.match('com','www.runoob.com').span())Traceback (most recent call last): File "&lt;stdin&gt;", line 1, in &lt;module&gt; 3.5 fullmatchä»Žå­—ç¬¦ä¸²çš„èµ·å§‹ä½ç½®åŒ¹é…patternï¼Œå¦‚æžœå®Œå…¨åŒ¹é…åˆ™è¿”å›žä¸€ä¸ªmacth objectå¯¹è±¡ï¼›å¦‚æžœä»Žèµ·å§‹ä½ç½®è‡³ç»“æŸä½ç½®ä¸å®Œå…¨åŒ¹é…çš„è¯ï¼Œfullmatch()å°±è¿”å›žnoneã€‚ è¯­æ³•ï¼š fullmatch(pattern, string, flags=0) pattern - åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼ string - è¦åŒ¹é…çš„å­—ç¬¦ä¸² flags - æ ‡å¿—ä½ï¼Œç”¨äºŽæŽ§åˆ¶æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…æ–¹å¼ï¼Œå¦‚ï¼šæ˜¯å¦åŒºåˆ†å¤§å°å†™ï¼Œå¤šè¡ŒåŒ¹é…ç­‰ç­‰ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨group(num) æˆ– groups() åŒ¹é…å¯¹è±¡å‡½æ•°æ¥èŽ·å–åŒ¹é…è¡¨è¾¾å¼ã€‚ group(num=0) - åŒ¹é…çš„æ•´ä¸ªè¡¨è¾¾å¼çš„å­—ç¬¦ä¸²ï¼Œgroup() å¯ä»¥ä¸€æ¬¡è¾“å…¥å¤šä¸ªç»„å·ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å®ƒå°†è¿”å›žä¸€ä¸ªåŒ…å«é‚£äº›ç»„æ‰€å¯¹åº”å€¼çš„å…ƒç»„ã€‚ groups() - è¿”å›žä¸€ä¸ªåŒ…å«æ‰€æœ‰å°ç»„å­—ç¬¦ä¸²çš„å…ƒç»„ï¼Œä»Ž 1 åˆ° æ‰€å«çš„å°ç»„å·ã€‚ matchå’Œfullmatchçš„åŒºåˆ« matchåªè€ƒè™‘èµ·å§‹ä½ç½®åŒ¹é…æˆåŠŸå³å¯ï¼›è€Œfullmatchåˆ™æ˜¯å®Œå…¨åŒ¹é…å³èµ·å§‹ä½ç½®å’Œç»“æŸä½ç½®éƒ½åŒ¹é…æˆåŠŸ å®žä¾‹ 1234&gt;&gt;&gt; print(re.fullmatch('www','www.baidu.com'))None&gt;&gt;&gt; print(re.fullmatch('www','www'))&lt;_sre.SRE_Match object; span=(0, 3), match='www'&gt; 3.6 searchæ‰«ææ•´ä¸ªå­—ç¬¦ä¸²ï¼Œåªè¿”å›žç¬¬ä¸€ä¸ªæˆåŠŸåŒ¹é…çš„macth objectå¯¹è±¡ï¼Œå¦‚æžœå­—ç¬¦ä¸²æ²¡æœ‰åŒ¹é…åˆ™è¿”å›žNoneã€‚ è¯­æ³•ï¼š search(pattern, string, flags=0) pattern - åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼ string - è¦åŒ¹é…çš„å­—ç¬¦ä¸² flags - æ ‡å¿—ä½ï¼Œç”¨äºŽæŽ§åˆ¶æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…æ–¹å¼ï¼Œå¦‚ï¼šæ˜¯å¦åŒºåˆ†å¤§å°å†™ï¼Œå¤šè¡ŒåŒ¹é…ç­‰ç­‰ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨group(num) æˆ– groups() åŒ¹é…å¯¹è±¡å‡½æ•°æ¥èŽ·å–åŒ¹é…è¡¨è¾¾å¼ã€‚ group(num=0) åŒ¹é…çš„æ•´ä¸ªè¡¨è¾¾å¼çš„å­—ç¬¦ä¸²ï¼Œgroup() å¯ä»¥ä¸€æ¬¡è¾“å…¥å¤šä¸ªç»„å·ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å®ƒå°†è¿”å›žä¸€ä¸ªåŒ…å«é‚£äº›ç»„æ‰€å¯¹åº”å€¼çš„å…ƒç»„ã€‚ groups() è¿”å›žä¸€ä¸ªåŒ…å«æ‰€æœ‰å°ç»„å­—ç¬¦ä¸²çš„å…ƒç»„ï¼Œä»Ž 1 åˆ° æ‰€å«çš„å°ç»„å·ã€‚ matchä¸Žsearchçš„åŒºåˆ« matchåªåŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹ï¼Œå¦‚æžœå­—ç¬¦ä¸²å¼€å§‹ä¸ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œåˆ™åŒ¹é…å¤±è´¥ï¼Œå‡½æ•°è¿”å›žNoneï¼› è€ŒsearchåŒ¹é…æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªåŒ¹é…ã€‚ å®žä¾‹ï¼š 1234567891011121314151617&gt;&gt;&gt; line = "Cats are smarter than dogs"# åŒ¹é…æˆåŠŸï¼Œè¿”å›žä¸€ä¸ªmatch objectå¯¹è±¡&gt;&gt;&gt; print(re.search(r'(.*)[ ]are[ ](\b\w+?\b)', line, re.M|re.I))&lt;_sre.SRE_Match object; span=(0, 16), match='Cats are smarter'&gt;# ä»¥å…ƒç»„å½¢å¼è¿”å›žå…¨éƒ¨åˆ†ç»„æˆªèŽ·çš„å­—ç¬¦ä¸²ã€‚ç›¸å½“äºŽè°ƒç”¨group(1,2,â€¦last)&gt;&gt;&gt; print(re.search(r'(.*)[ ]are[ ](\b\w+?\b)', line, re.M|re.I).groups())('Cats', 'smarter')# æˆ‘ä»¬ç¼–å†™æ­£åˆ™è¡¨è¾¾å¼å®šä¹‰äº†ç»„(...)ï¼Œè¿™æ—¶å°±å¯ä»¥æ·»åŠ ç¼–å·æˆ–è€…ç»„åï¼ˆå¦‚æžœä½¿ç”¨äº†å‘½ååˆ†ç»„ï¼‰æ¥è¿”å›žä¸€ä¸ªæˆ–å¤šä¸ªåˆ†ç»„æ•èŽ·çš„å­—ç¬¦ä¸²# ç¼–å·0ä»£è¡¨è¿”å›žæ•´ä¸ªåŒ¹é…çš„å­—ç¬¦ä¸²ï¼Œä¸å¡«å†™å‚æ•°æ—¶ï¼ˆgroup()ï¼‰è¿”å›žgroup(0)&gt;&gt;&gt; print(re.search(r'(.*)[ ]are[ ](\b\w+?\b)', line, re.M|re.I).group())Cats are smarter&gt;&gt;&gt; print(re.search(r'(.*)[ ]are[ ](\b\w+?\b)', line, re.M|re.I).group(1))Cats&gt;&gt;&gt; print(re.search(r'(.*)[ ]are[ ](\b\w+?\b)', line, re.M|re.I).group(2))smarter&gt;&gt;&gt; print(re.search(r'(.*)[ ]are[ ](\b\w+?\b)', line, re.M|re.I).group(1, 2))('Cats', 'smarter') 3.7 match objectå¯¹è±¡matchå’Œsearchä¸€æ—¦åŒ¹é…æˆåŠŸï¼Œåˆ™è¿”å›žä¸€ä¸ªmatch objectå¯¹è±¡ã€‚ match objectå¯¹è±¡æ—¶ä¸€æ¬¡åŒ¹é…çš„ç»“æžœï¼ŒåŒ…å«äº†å¾ˆå¤šå…³äºŽæ­¤æ¬¡åŒ¹é…çš„ä¿¡æ¯ã€‚å¯ä»¥ä½¿ç”¨matchæä¾›çš„å¯è¯»å±žæ€§æˆ–æ–¹æ³•æ¥è¯»å–è¿™äº›ä¿¡æ¯ã€‚ å±žæ€§ï¼š string - åŒ¹é…æ—¶ä½¿ç”¨çš„æ–‡æœ¬ re - åŒ¹é…æ—¶ä½¿ç”¨çš„patternå¯¹è±¡ pos - æ–‡æœ¬ä¸­æ­£åˆ™è¡¨è¾¾å¼å¼€å§‹æœç´¢çš„ç´¢å¼• endpos - æ–‡æœ¬ä¸­æ­£åˆ™è¡¨è¾¾å¼ç»“æŸæœç´¢çš„ç´¢å¼• lastindex - æœ€åŽä¸€ä¸ªè¢«æ•èŽ·çš„åˆ†ç»„çš„ç¼–å·ï¼Œå¦‚æžœæ²¡æœ‰è¢«æ•èŽ·çš„åˆ†ç»„åˆ™è¿”å›žNone lastgroup - æœ€åŽä¸€ä¸ªè¢«æ•èŽ·çš„åˆ†ç»„çš„åˆ«åï¼Œå¦‚æžœè¿™ä¸ªåˆ†ç»„æ²¡æœ‰åˆ«åæˆ–è€…æ˜¯æ²¡æœ‰è¢«æ•èŽ·çš„åˆ†ç»„åˆ™è¿”å›žNone æ–¹æ³•ï¼š group(1, 2, â€¦) èŽ·å¾—ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†ç»„æ•èŽ·çš„å­—ç¬¦ä¸²ï¼ŒæŒ‡å®šå¤šä¸ªå‚æ•°æ—¶å°†ä»¥å…ƒç»„å½¢å¼è¿”å›ž å‚æ•°å¯ä»¥ä½¿åˆ†ç»„ç¼–å·ä¹Ÿå¯ä»¥æ˜¯åˆ«å ç¼–å·0ä»£è¡¨æ•´ä¸ªåŒ¹é…çš„å­—ç¬¦ä¸²ï¼Œä¸å¡«å†™å‚æ•°æ—¶ï¼Œè¿”å›žgroup(0) æ²¡æœ‰æ•èŽ·å­—ç¬¦ä¸²çš„ç»„è¿”å›žNoneï¼Œæ•èŽ·äº†å¤šæ¬¡çš„ç»„è¿”å›žæœ€åŽä¸€æ¬¡æ•èŽ·çš„å­—ç¬¦ä¸² groups() ä»¥å…ƒç»„å½¢å¼è¿”å›žå…¨éƒ¨åˆ†ç»„æ•èŽ·çš„å­—ç¬¦ä¸²ã€‚ ç›¸å½“äºŽgroup(1, 2, 3, â€¦, last) groupdict() è¿”å›žä»¥æœ‰åˆ«åçš„ç»„çš„åˆ«åä¸ºé”®ï¼Œä»¥è¯¥ç»„æ•èŽ·çš„å­—ç¬¦ä¸²ä¸ºå€¼çš„å­—å…¸ æ²¡æœ‰åˆ«åçš„ç»„ä¸åŒ…å«åœ¨å†… start(n) è¿”å›žæŒ‡å®šçš„ç»„æ•èŽ·çš„å­—ç¬¦ä¸²åœ¨stringä¸­çš„èµ·å§‹ç´¢å¼• è¯¥ç´¢å¼•ä¸ºåŒ¹é…çš„å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦çš„ç´¢å¼• æ²¡æœ‰å‚æ•°æ—¶ï¼Œé»˜è®¤ä¸ºstart(0) end(n) è¿”å›žæŒ‡å®šçš„ç»„æ•èŽ·çš„å­—ç¬¦ä¸²åœ¨stringä¸­çš„ç»“æŸç´¢å¼• è¯¥ç´¢å¼•ä¸ºåŒ¹é…çš„å­—ç¬¦ä¸²çš„æœ€åŽä¸€ä¸ªå­—ç¬¦çš„ç´¢å¼•+1 æ²¡æœ‰å‚æ•°æ—¶ï¼Œé»˜è®¤ä¸ºend(0) span(n) ä»¥å…ƒç»„å½¢å¼è¿”å›žåŒ¹é…çš„ä½ç½® ç›¸å½“äºŽè¿”å›žï¼ˆstart(n), end(n)ï¼‰ expand(template) å°†åŒ¹é…åˆ°çš„åˆ†ç»„ä»£å…¥templateä¸­ç„¶åŽè¿”å›ž templateä¸­å¯ä»¥ä½¿ç”¨\idæˆ–\g&lt; id&gt; \g&lt;name&gt;å¼•ç”¨åˆ†ç»„ï¼Œä½†ä¸èƒ½ä½¿ç”¨ç¼–å·0 \idä¸Ž\g&lt;id&gt;æ˜¯ç­‰ä»·çš„ï¼›ä½†\10å°†è¢«è®¤ä¸ºæ˜¯ç¬¬10ä¸ªåˆ†ç»„ï¼Œå¦‚æžœä½ æƒ³è¡¨è¾¾\1ä¹‹åŽæ˜¯å­—ç¬¦â€™0â€™ï¼Œåªèƒ½ä½¿ç”¨\g&lt;1&gt;0 å®žä¾‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849&gt;&gt;&gt; line = "Cats are smarter than dogs"&gt;&gt;&gt; match_object = re.search(r'(.*)[ ]are[ ](?P&lt;sign&gt;\b\w+?\b)', line, re.M|re.I)# è¿”å›žåŒ¹é…æ—¶ä½¿ç”¨çš„æ–‡æœ¬&gt;&gt;&gt; match_object.string'Cats are smarter than dogs'# è¿”å›žåŒ¹é…æ—¶ä½¿ç”¨çš„patternå¯¹è±¡&gt;&gt;&gt; match_object.rere.compile('(.*)[ ]are[ ](?P&lt;sign&gt;\\b\\w+?\\b)', re.IGNORECASE|re.MULTILINE)# æ–‡æœ¬ä¸­æ­£åˆ™è¡¨è¾¾å¼å¼€å§‹æœç´¢çš„ç´¢å¼•&gt;&gt;&gt; match_object.pos0# æ–‡æœ¬ä¸­æ­£åˆ™è¡¨è¾¾å¼ç»“æŸæœç´¢çš„ç´¢å¼•&gt;&gt;&gt; match_object.endpos26# æœ€åŽä¸€ä¸ªåˆ†ç»„çš„ç¼–å·&gt;&gt;&gt; match_object.lastindex2# æœ€åŽä¸€ä¸ªè¢«æ•èŽ·çš„åˆ†ç»„çš„åˆ«å&gt;&gt;&gt; match_object.lastgroup'sign'# ä»¥å…ƒç»„å½¢å¼è¿”å›žå¤šä¸ªåˆ†ç»„æ•èŽ·çš„å­—ç¬¦ä¸²&gt;&gt;&gt; match_object.group(1, 2)('Cats', 'smarter')# è¿”å›žåˆ†ç»„1æ•èŽ·çš„å­—ç¬¦ä¸²&gt;&gt;&gt; match_object.group(1)'Cats'# è¿”å›žæ•´ä¸ªåŒ¹é…çš„å­—ç¬¦ä¸²&gt;&gt;&gt; match_object.group()'Cats are smarter'# ä»¥å…ƒç»„å½¢å¼è¿”å›žå…¨éƒ¨åˆ†ç»„æ•èŽ·çš„å­—ç¬¦ä¸²&gt;&gt;&gt; match_object.groups()('Cats', 'smarter')# è¿”å›žä»¥æœ‰åˆ«åçš„ç»„çš„åˆ«åä¸ºé”®ï¼Œä»¥è¯¥ç»„æ•èŽ·çš„å­—ç¬¦ä¸²ä¸ºå€¼çš„å­—å…¸&gt;&gt;&gt; match_object.groupdict()&#123;'sign': 'smarter'&#125;# è¿”å›žåˆ†ç»„2æ•èŽ·çš„å­—ç¬¦ä¸²åœ¨stringä¸­çš„èµ·å§‹ç´¢å¼•&gt;&gt;&gt; match_object.start(2)9# è¿”å›žåˆ†ç»„2æ•èŽ·çš„å­—ç¬¦ä¸²åœ¨stringä¸­çš„ç»“æŸç´¢å¼•&gt;&gt;&gt; match_object.end(2)16# ä»¥å…ƒç»„å½¢å¼è¿”å›žåˆ†ç»„2åŒ¹é…çš„ä½ç½®&gt;&gt;&gt; match_object.span(2)(9, 16)# å°†åˆ†ç»„1ã€åˆ†ç»„&lt;sign&gt;å¸¦å…¥r'\g&lt;sign&gt; \1'ä¸­è¿”å›žã€‚ï¼ˆå°±æ˜¯æŠŠåˆ†ç»„1å’Œåˆ†ç»„2å¯¹è°ƒï¼‰&gt;&gt;&gt; match_object.expand(r'\g&lt;sign&gt; \1')'smarter Cats' 3.8 findallåœ¨å­—ç¬¦ä¸²ä¸­æ‰¾åˆ°æ­£åˆ™è¡¨è¾¾å¼æ‰€åŒ¹é…çš„æ‰€æœ‰å­ä¸²ï¼Œå¹¶è¿”å›žä¸€ä¸ªåˆ—è¡¨ï¼Œå¦‚æžœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ï¼Œåˆ™è¿”å›žç©ºåˆ—è¡¨ã€‚ è¯­æ³•ï¼š findall(pattern, string, flags=0) pattern - åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼ string - è¦åŒ¹é…çš„å­—ç¬¦ä¸² flags - æ ‡å¿—ä½ï¼Œç”¨äºŽæŽ§åˆ¶æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…æ–¹å¼ï¼Œå¦‚ï¼šæ˜¯å¦åŒºåˆ†å¤§å°å†™ï¼Œå¤šè¡ŒåŒ¹é…ç­‰ç­‰ findallä¸Žmatchã€searchçš„åŒºåˆ« match å’Œ search æ˜¯åŒ¹é…ä¸€æ¬¡ ï¼Œfindall åŒ¹é…æ‰€æœ‰ å®žä¾‹ï¼š 12345# ç¼–è¯‘ä¸€ä¸ªéžè´ªå©ªåŒ¹é…æ•°å­—çš„æ­£åˆ™è¡¨è¾¾å¼&gt;&gt;&gt; p = re.compile(r'\d+?')# ä½¿ç”¨findall()å‡½æ•°å°†æ‰€æœ‰åŒ¹é…çš„å­—ç¬¦ä¸²è¿”å›žåˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­&gt;&gt;&gt; print(p.findall('1fwer334nk432j5'))['1', '3', '3', '4', '4', '3', '2', '5'] 3.9 finditeråœ¨å­—ç¬¦ä¸²ä¸­æ‰¾åˆ°æ­£åˆ™è¡¨è¾¾å¼æ‰€åŒ¹é…çš„æ‰€æœ‰å­ä¸²ï¼Œå¹¶æŠŠå®ƒä»¬ä½œä¸ºä¸€ä¸ªè¿­ä»£å™¨è¿”å›žã€‚ è¯­æ³•ï¼š finditer(pattern, string, flags=0) pattern - åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼ string - è¦åŒ¹é…çš„å­—ç¬¦ä¸² flags - æ ‡å¿—ä½ï¼Œç”¨äºŽæŽ§åˆ¶æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…æ–¹å¼ï¼Œå¦‚ï¼šæ˜¯å¦åŒºåˆ†å¤§å°å†™ï¼Œå¤šè¡ŒåŒ¹é…ç­‰ç­‰ å®žä¾‹ï¼š 12345678910&gt;&gt;&gt; iter = re.finditer('\d+', '1fwer334nk432j5') &gt;&gt;&gt; iter &lt;callable_iterator object at 0x00000124117EBE48&gt; &gt;&gt;&gt; for i in iter: ... print(i.group()) ... 1 334 432 5 3.10 subä½¿ç”¨reæ›¿æ¢stringä¸­æ¯ä¸€ä¸ªåŒ¹é…çš„å­ä¸²åŽè¿”å›žæ›¿æ¢åŽçš„å­—ç¬¦ä¸²ã€‚ è¯­æ³•ï¼š sub(pattern, repl, string, count=0, flags=0) pattern - åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼ repl - æ›¿æ¢çš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚å½“replæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ—¶ï¼Œå¯ä»¥ä½¿ç”¨\idã€\g&lt;id&gt;æˆ–\g&lt;name&gt;å¼•ç”¨åˆ†ç»„ï¼›å½“replæ˜¯ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œè¿™ä¸ªå‡½æ•°åªæŽ¥å—ä¸€ä¸ªå‚æ•°ï¼ˆmacth objectå¯¹è±¡ï¼‰ï¼Œå¹¶è¿”å›žä¸€ä¸ªå­—ç¬¦ä¸²ç”¨äºŽæ›¿æ¢ã€‚ string - è¦åŒ¹é…çš„å­—ç¬¦ä¸² count - æŒ‡å®šæœ€å¤šæ›¿æ¢æ¬¡æ•°ï¼Œé»˜è®¤å…¨éƒ¨æ›¿æ¢ flags - æ ‡å¿—ä½ï¼Œç”¨äºŽæŽ§åˆ¶æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…æ–¹å¼ï¼Œå¦‚ï¼šæ˜¯å¦åŒºåˆ†å¤§å°å†™ï¼Œå¤šè¡ŒåŒ¹é…ç­‰ç­‰ å®žä¾‹ï¼š 1234567891011121314151617181920212223242526272829# å½“replæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ—¶ï¼Œå¯ä»¥ä½¿ç”¨\g&lt;id&gt;å¼•ç”¨åˆ†ç»„&gt;&gt;&gt; phone = '03766227791'&gt;&gt;&gt; print(re.sub(r'(^\d&#123;4&#125;)', r'\g&lt;1&gt;-', phone))0376-6227791&gt;&gt;&gt; print(re.sub(r'(^\d&#123;4&#125;)', r'(\1)', phone))(0376)6227791# è¿™ä¸ªä¾‹å­è™½ç„¶æŠŠdogså’Œcatsäº’æ¢äº†ä½ç½®ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¤§å°å†™çš„é—®é¢˜ï¼Œæˆ‘ä»¬ç”¨å‡½æ•°æ¥å¤„ç†å®ƒ&gt;&gt;&gt; line = "Cats are smarter than dogs"&gt;&gt;&gt; p = re.compile(r'(\b\w+\b)(.*)(\b\w+\b)')&gt;&gt;&gt; p.sub(r'\3\2\1', line)'dogs are smarter than Cats'# å½“replæ˜¯ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œè¿™ä¸ªå‡½æ•°åªæŽ¥å—ä¸€ä¸ªmatch objectå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›žä¸€ä¸ªå­—ç¬¦ä¸²ç”¨äºŽæ›¿æ¢&gt;&gt;&gt; line = "Cats are smarter than dogs"&gt;&gt;&gt; p = re.compile(r'(\b\w+\b)(.*)(\b\w+\b)')&gt;&gt;&gt; def func(m):... return m.group(3).title() + m.group(2) + m.group(1).lower()...&gt;&gt;&gt; p.sub(func, line)'Dogs are smarter than cats'# ä¹Ÿå¯ä»¥ç”¨åŒ¿åå‡½æ•°&gt;&gt;&gt; p.sub(lambda m:m.group(3).title()+m.group(2)+m.group(1).lower(), line)'Dogs are smarter than cats'&gt;&gt;&gt; s = 'A23G4HFD567'&gt;&gt;&gt; re.sub(r'(?P&lt;value&gt;\d+?)', lambda m:str(int(m.group('value'))*2), s, 3)'A46G8HFD567' 3.11 subn è¿”å›ž (sub(repl, string[, count]), æ›¿æ¢æ¬¡æ•°ï¼‰ è¯­æ³•ï¼š subn(pattern, repl, string, count=0, flags=0) pattern - åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼ repl - æ›¿æ¢çš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚å½“replæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ—¶ï¼Œå¯ä»¥ä½¿ç”¨\idã€\g&lt;id&gt;æˆ–\g&lt;name&gt;å¼•ç”¨åˆ†ç»„ï¼›å½“replæ˜¯ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œè¿™ä¸ªå‡½æ•°åªæŽ¥å—ä¸€ä¸ªå‚æ•°ï¼ˆmacth objectå¯¹è±¡ï¼‰ï¼Œå¹¶è¿”å›žä¸€ä¸ªå­—ç¬¦ä¸²ç”¨äºŽæ›¿æ¢ã€‚ string - è¦åŒ¹é…çš„å­—ç¬¦ä¸² count - æŒ‡å®šæœ€å¤šæ›¿æ¢æ¬¡æ•°ï¼Œé»˜è®¤å…¨éƒ¨æ›¿æ¢ flags - æ ‡å¿—ä½ï¼Œç”¨äºŽæŽ§åˆ¶æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…æ–¹å¼ï¼Œå¦‚ï¼šæ˜¯å¦åŒºåˆ†å¤§å°å†™ï¼Œå¤šè¡ŒåŒ¹é…ç­‰ç­‰ å®žä¾‹ï¼š 123&gt;&gt;&gt; s = 'A23G4HFD567'&gt;&gt;&gt; re.subn(r'(?P&lt;value&gt;\d+?)', lambda m:str(int(m.group('value'))*2), s)('A46G8HFD101214', 6) 3.12 splitæŒ‰ç…§èƒ½å¤ŸåŒ¹é…çš„å­ä¸²å°†stringåˆ†å‰²åŽè¿”å›žåˆ—è¡¨ã€‚ è¯­æ³•ï¼š split(pattern, string, maxsplit=0, flags=0) pattern - åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼ string - è¦åŒ¹é…çš„å­—ç¬¦ä¸² maxsplit - æŒ‡å®šæœ€å¤§åˆ†å‰²æ¬¡æ•°ï¼Œé»˜è®¤å…¨éƒ¨åˆ†å‰² flags - æ ‡å¿—ä½ï¼Œç”¨äºŽæŽ§åˆ¶æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…æ–¹å¼ï¼Œå¦‚ï¼šæ˜¯å¦åŒºåˆ†å¤§å°å†™ï¼Œå¤šè¡ŒåŒ¹é…ç­‰ç­‰ å®žä¾‹ï¼š 12&gt;&gt;&gt; re.split(r'\d', 'one1two2three3four4five5')['one', 'two', 'three', 'four', 'five', ''] 3.13 purgeæ¸…ç©ºç¼“å­˜ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼ è¯­æ³• purge() å®žä¾‹ï¼š 1&gt;&gt;&gt; re.purge()]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Pythonæ¨¡å—</tag>
        <tag>regex</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŠ“åŒ…å·¥å…·-Fiddlerçš„ä½¿ç”¨ï¼ˆä¸€ï¼‰]]></title>
    <url>%2F2018%2F06%2F25%2F%E6%8A%93%E5%8C%85%E5%B7%A5%E5%85%B7-Fiddler%E7%9A%84%E4%BD%BF%E7%94%A8%EF%BC%88%E4%B8%80%EF%BC%89%2F</url>
    <content type="text"><![CDATA[1. Fiddlerç®€ä»‹ Fiddleræ˜¯ä½äºŽå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„HTTPä»£ç†ã€‚ å®ƒèƒ½å¤Ÿè®°å½•å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ‰€æœ‰ HTTPè¯·æ±‚ï¼Œå¯ä»¥é’ˆå¯¹ç‰¹å®šçš„HTTPè¯·æ±‚ï¼Œåˆ†æžè¯·æ±‚æ•°æ®ã€è®¾ç½®æ–­ç‚¹ã€è°ƒè¯•webåº”ç”¨ã€ä¿®æ”¹è¯·æ±‚çš„æ•°æ®ï¼Œç”šè‡³å¯ä»¥ä¿®æ”¹æœåŠ¡å™¨è¿”å›žçš„æ•°æ®ï¼ŒåŠŸèƒ½éžå¸¸å¼ºå¤§ï¼Œæ˜¯webè°ƒè¯•çš„åˆ©å™¨ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼šå®¢æˆ·ç«¯çš„æ‰€æœ‰è¯·æ±‚éƒ½è¦å…ˆç»è¿‡Fiddlerï¼Œç„¶åŽè½¬å‘åˆ°ç›¸åº”çš„æœåŠ¡å™¨ï¼Œåä¹‹ï¼ŒæœåŠ¡å™¨ç«¯çš„æ‰€æœ‰å“åº”ï¼Œä¹Ÿéƒ½ä¼šå…ˆç»è¿‡Fiddlerç„¶åŽå‘é€åˆ°å®¢æˆ·ç«¯ï¼ŒåŸºäºŽè¿™ä¸ªåŽŸå› ï¼ŒFiddleræ”¯æŒæ‰€æœ‰å¯ä»¥è®¾ç½®httpä»£ç†ä¸º127.0.0.1:8888çš„æµè§ˆå™¨å’Œåº”ç”¨ç¨‹åºã€‚ æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š 2. Fiddlerä»£ç†é…ç½® 2.1. WindowsçŽ¯å¢ƒæµè§ˆå™¨é…ç½®2.1.1. IEFiddlerä½œä¸ºç³»ç»Ÿä»£ç†ï¼Œå½“å¯åŠ¨Fidderæ—¶ï¼ŒIEçš„proxyè®¾å®šä¼šå˜æˆ127.0.0.1:8888ã€‚ ä¿®æ”¹ç«¯å£ï¼š å¦‚æžœ8888ç«¯å£å·²ç»è¢«å ç”¨ï¼Œå¯åœ¨fiddlerä¸­ä¿®æ”¹ç«¯å£ã€‚ èœå•æ  -&gt; Tools -&gt; Options -&gt; Connections -&gt; Fiddler listens on port: [9999] å¦‚æžœä½ çš„æµè§ˆå™¨åœ¨å¼€å¯fiddlerä¹‹åŽæ²¡æœ‰è®¾ç½®ç›¸åº”çš„ä»£ç†ï¼Œåˆ™fiddleræ˜¯æ— æ³•æ•èŽ·åˆ°HTTPè¯·æ±‚çš„ã€‚ å½“ä½ çš„ç³»ç»Ÿä»£ç†å‘ç”Ÿå˜åŒ–ï¼ŒFiddlerä¼šæœ‰å¦‚ä¸‹è­¦å‘Šï¼š æ­¤æ—¶è‹¥æƒ³é‡æ–°è®¾ç½®fiddlerä»£ç†ï¼Œåªéœ€ç‚¹å‡»ä¸€ä¸‹é»„è‰²åŒºåŸŸå³å¯ã€‚ 2.1.2. ChromeChromeå¦‚æžœæ²¡æœ‰ä½¿ç”¨ä»£ç†æ’ä»¶ï¼Œåˆ™ä¼šè‡ªåŠ¨ä½¿ç”¨ieçš„ä»£ç†é…ç½®ï¼Œåªéœ€é…ç½®IEçš„ä»£ç†é…ç½®å³å¯ã€‚ åœ¨chromeé…ç½®ä¸­æ‰“å¼€ä»£ç†è®¾ç½®ä¼šè‡ªåŠ¨å¼¹å‡ºieçš„ä»£ç†é…ç½®ã€‚ Chromå¦‚æžœä½¿ç”¨äº†ä»£ç†æ’ä»¶ï¼Œå°±éœ€è¦é…ç½®æ’ä»¶æˆ–è€…ç›´æŽ¥ä½¿ç”¨ç³»ç»Ÿä»£ç†ã€‚ æœ‰ä¸‰ç§æ–¹æ³•ï¼š åœ¨æ’ä»¶ä¸­é€‰æ‹©ä½¿ç”¨ç³»ç»Ÿä»£ç† æŠŠä»£ç†æ’ä»¶å…³é—­ç›´æŽ¥ä½¿ç”¨ç³»ç»Ÿä»£ç† è‡ªå·±åœ¨æ’ä»¶ä¸­é…ç½®ä»£ç†ï¼š 2.1.3. FirefoxFirefoxå†…ç½®çš„æœ‰ä»£ç†æ’ä»¶ï¼ŒåŒæ ·æœ‰2ç§æ–¹æ³•æ¥é…ç½®ï¼š ç›´æŽ¥ä½¿ç”¨ç³»ç»Ÿä»£ç† é…ç½®ä»£ç† 2.1.4. è¿œç¨‹ä¸»æœºæŠ“åŒ…è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯Fiddleræƒ³æŠ“å¦ä¸€å°ç”µè„‘çš„åŒ…ï¼Œå°±éœ€è¦åœ¨å¦ä¸€å°ç”µè„‘ä¸Šé…ç½®ä»£ç†äº†ã€‚ å¼€å¯è¿œç¨‹é“¾æŽ¥åŠŸèƒ½ï¼šFiddlerèœå•æ  -&gt; Tools -&gt; Options -&gt; connections -&gt; å‹¾é€‰Allow remote computers to connect åœ¨å¦ä¸€å°ç”µè„‘ä¸Šé…ç½®host(Fiddleræ‰€åœ¨ä¸»æœº):port(Fiddleré…ç½®çš„ç«¯å£)ä»£ç†å³å¯ã€‚ 2.2. iphoneæŠ“åŒ…è®¾ç½®2.2.1. é…ç½®Fiddler å¼€å¯è¿œç¨‹é“¾æŽ¥åŠŸèƒ½ï¼šFiddlerèœå•æ  -&gt; Tools -&gt; Options -&gt; connections -&gt; å‹¾é€‰Allow remote computers to connect å¼€å¯æ•èŽ·httpsæµé‡ï¼šFiddlerèœå•æ  -&gt; Tools -&gt; Options -&gt; HTTPS -&gt; å‹¾é€‰ Capture HTTPSCONNECTs -&gt; å‹¾é€‰ Decrypt HTTPS traffic -&gt; é€‰æ‹©from remote clients only -&gt; å‹¾é€‰Ignore server certificate errors(unsafe) èŽ·å–Fiddleræ‰€åœ¨ipåœ°å€ï¼ˆFiddleræ‰€åœ¨ä¸»æœºå’Œæ‰‹æœºé“¾æŽ¥åŒä¸€è·¯ç”±ï¼‰ï¼š 2.2.2. Iphoneä¸Šé…ç½®Fiddlerä¸ºä»£ç†è®¾ç½® -&gt; æ— çº¿å±€åŸŸç½‘ -&gt; é…ç½®æ— çº¿å±€åŸŸç½‘ -&gt; é…ç½®ä»£ç† -&gt; å‹¾é€‰æ‰‹åŠ¨ -&gt; é…ç½®æœåŠ¡å™¨ï¼ˆå³Fiddleræ‰€åœ¨ä¸»æœºï¼‰å’Œç«¯å£å·ï¼ˆFiddleré…ç½®çš„ç«¯å£å·ï¼‰ æ­¤æ—¶ï¼ŒFiddlerå¯ä»¥æ•èŽ·iphoneæ‰‹æœºä¸Šçš„httpåè®®çš„è®¿é—®ã€‚ ä½†æ˜¯ï¼Œiphoneæ‰‹æœºæ— æ³•è®¿é—®httpsåè®®çš„è¯·æ±‚ï¼ŒæŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®æè¿°æ–‡ä»¶å¹¶ä¿¡ä»»å®ƒã€‚ 2.2.3. Iphoneä¸Šå®‰è£…Fiddleræè¿°æ–‡ä»¶ æ‰“å¼€Safariæµè§ˆå™¨ï¼Œè®¿é—®ä»£ç†æœåŠ¡å™¨ip:portã€‚æ¯”å¦‚http://192.168.99.206:8888ã€‚ ç‚¹å‡»FiddlerRoot Certificateå®‰è£…æè¿°æ–‡ä»¶ã€‚ åˆ é™¤æè¿°æ–‡ä»¶ï¼š è‹¥æƒ³åˆ é™¤æè¿°æ–‡ä»¶ï¼Œè®¾ç½® -&gt; é€šç”¨ -&gt; æè¿°æ–‡ä»¶ -&gt; é€‰ä¸­è¦åˆ é™¤çš„æè¿°æ–‡ä»¶ -&gt; ç§»é™¤æè¿°æ–‡ä»¶ ä¿¡ä»»è¯ä¹¦ï¼šè®¾ç½® -&gt; é€šç”¨ -&gt; å…³äºŽæœ¬æœº -&gt; è¯ä¹¦ä¿¡ä»»è®¾ç½® -&gt; å¼€å¯å¯¹Fiddlerçš„è¯ä¹¦ä¿¡ä»» æ­¤æ—¶å°±å¯ä»¥ç”¨FiddleræŠ“å–iphoneæ‰‹æœºä¸ŠSafariæµè§ˆå™¨å’ŒAPPçš„http/httpsåè®®çš„æ•°æ®åŒ…äº†ã€‚ å…³äºŽIOSç‰ˆæœ¬ ios10.3ä¹‹å‰ç‰ˆæœ¬çš„Iphoneä¸éœ€è¦ä¿¡ä»»è¯ä¹¦ã€‚ ios10.3ä¹‹åŽç‰ˆæœ¬çš„Iphoneéœ€è¦ä¿¡ä»»è¯ä¹¦ã€‚ 2.3 AndroidæŠ“åŒ…é…ç½®å’Œiphoneç±»ä¼¼ï¼Œåªæ˜¯å°‘äº†ä¸€æ­¥å®‰è£…æè¿°æ–‡ä»¶ã€‚ 2.3.1. é…ç½®Fiddlerå‚ç…§iphoneé…ç½®Fiddler 2.3.2 Androidä»£ç†é…ç½®æ²¡æœ‰å®‰å“æœºï¼Œä¸‹äº†ä¸€ä¸ªæ¨¡æ‹Ÿå™¨è¯•éªŒï¼Œå¯èƒ½æ­¥éª¤æœ‰ä¸åŒã€‚ è®¾ç½®-&gt; WLAN -&gt; ç‚¹å‡»å·²è¿žæŽ¥çš„ç½‘ç»œ -&gt; ä¿®æ”¹ç½‘ç»œ -&gt; å‹¾é€‰æ˜¾ç¤ºé«˜çº§é€‰é¡¹ -&gt; é€‰æ‹©ä»£ç†ä¸ºæ‰‹åŠ¨ -&gt; æ‰‹æœºçš„IPåœ°å€å’ŒFiddlerä»£ç†çš„ä¸»æœºipåœ°å€å¿…é¡»åœ¨åŒä¸€ç½‘æ®µï¼Œæ¨¡æ‹Ÿå™¨ä½¿ç”¨æ¡¥æŽ¥æ¨¡å¼è¿˜éœ€è¦ä¸‹è½½æ’ä»¶ï¼Œæˆ‘æ‡’å¾—å¼„äº†ï¼Œä¸Šé¢çš„é…ç½®æ‰‹æœºæ˜¯è®¿é—®ä¸äº†Fiddlerä¸»æœºipçš„ï¼Œæ•…æ— æ³•æŠ“åŒ…ï¼Œåªæ˜¯ä¸ºäº†ä¸¾ä¾‹ç”¨ã€‚ æ­¤æ—¶ï¼Œå°±å¯ä»¥ç”¨FiddleræŠ“å–Androidæ‰‹æœºä¸Šæµè§ˆå™¨å’ŒAPPçš„http/httpsåè®®çš„æ•°æ®åŒ…äº†ã€‚ 3. Fiddler ç•Œé¢ç®€ä»‹Fiddlerä¸»ç•Œé¢çš„å¸ƒå±€å¦‚ä¸‹ï¼š ä¸»ç•Œé¢ä¸­ä¸»è¦åŒ…æ‹¬å››ä¸ªå¸¸ç”¨çš„å—ï¼š Fiddlerçš„èœå•æ ï¼Œä¸Šå›¾ç»¿è‰²éƒ¨åˆ†ã€‚ åŒ…æ‹¬æ•èŽ·httpè¯·æ±‚ï¼Œåœæ­¢æ•èŽ·è¯·æ±‚ï¼Œä¿å­˜httpè¯·æ±‚ï¼Œè½½å…¥æœ¬åœ°sessionã€è®¾ç½®æ•èŽ·è§„åˆ™ç­‰åŠŸèƒ½ã€‚ Fiddlerçš„å·¥å…·æ ,ä¸Šå›¾æ©™è‰²éƒ¨åˆ†ã€‚ åŒ…æ‹¬Fiddleré’ˆå¯¹å½“å‰viewçš„æ“ä½œï¼ˆæš‚åœï¼Œæ¸…é™¤session,decodeæ¨¡å¼ã€æ¸…é™¤ç¼“å­˜ç­‰ï¼‰ã€‚ web Sessioné¢æ¿ï¼Œä¸Šå›¾çº¢è‰²åŒºåŸŸã€‚ ä¸»è¦æ˜¯FiddleræŠ“å–åˆ°çš„æ¯æ¡httpè¯·æ±‚ï¼ˆæ¯ä¸€æ¡ç§°ä¸ºä¸€ä¸ªsessionï¼‰,ä¸»è¦åŒ…å«äº†è¯·æ±‚çš„urlï¼Œåè®®ï¼ŒçŠ¶æ€ç ï¼Œbodyç­‰ä¿¡æ¯ï¼Œè¯¦ç»†çš„å­—æ®µå«ä¹‰å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å­—æ®µ ä¿¡æ¯ # HTTP Requestçš„é¡ºåºï¼Œä»Ž1å¼€å§‹ï¼ŒæŒ‰ç…§é¡µé¢åŠ è½½è¯·æ±‚çš„é¡ºåºé€’å¢ž Result HTTPå“åº”çš„çŠ¶æ€ç  Protocol è¯·æ±‚ä½¿ç”¨çš„åè®®ï¼Œå¦‚HTTP/HTTPS/FTP Host è¯·æ±‚åœ°å€çš„åŸŸå URL è¯·æ±‚çš„æœåŠ¡å™¨è·¯å¾„å’Œæ–‡ä»¶åï¼Œä¹ŸåŒ…æ‹¬GETå‚æ•° BODY è¯·æ±‚çš„å¤§å°ï¼Œä»¥byteä¸ºå•ä½ Caching è¯·æ±‚çš„ç¼“å­˜è¿‡æœŸæ—¶é—´æˆ–ç¼“å­˜æŽ§åˆ¶headerç­‰å€¼ Process å‘å‡ºæ­¤è¯·æ±‚çš„Winodwsè¿›ç¨‹åŠè¿›ç¨‹IDï¼ˆè¿œç¨‹è®¾å¤‡èŽ·å–ä¸åˆ°ï¼‰ Comments ç”¨æˆ·é€šè¿‡è„šæœ¬æˆ–å³é”®èœå•ç»™æ­¤sessionå¢žåŠ çš„å¤‡æ³¨ Custom ç”¨æˆ·å¯ä»¥é€šè¿‡è„šæœ¬è®¾ç½®çš„è‡ªå®šä¹‰å€¼ è¯¦æƒ…å’Œæ•°æ®ç»Ÿè®¡é¢æ¿ï¼Œä¸Šå›¾é»‘è‰²åŒºåŸŸã€‚ é’ˆå¯¹æ¯æ¡httpè¯·æ±‚çš„å…·ä½“ç»Ÿè®¡ï¼ˆä¾‹å¦‚å‘é€/æŽ¥å—å­—èŠ‚æ•°ï¼Œå‘é€/æŽ¥æ”¶æ—¶é—´ï¼Œè¿˜æœ‰ç²—ç•¥ç»Ÿè®¡ä¸–ç•Œå„åœ°è®¿é—®è¯¥æœåŠ¡å™¨æ‰€èŠ±è´¹çš„æ—¶é—´ï¼‰å’Œæ•°æ®åŒ…åˆ†æžã€‚ ä¸‹ä¸€ç¯‡åœ¨è¯¦ç»†ä»‹ç»Fiddlerçš„å¸¸ç”¨åŠŸèƒ½ã€‚]]></content>
      <categories>
        <category>ç½‘ç»œ</category>
      </categories>
      <tags>
        <tag>ç½‘ç»œ</tag>
        <tag>æŠ“åŒ…</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Pythonå­¦ä¹ ç¬”è®°-sortedæ¨¡å—]]></title>
    <url>%2F2018%2F06%2F25%2FPython%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-sort%E4%B8%8Esorted%E6%A8%A1%E5%9D%97%2F</url>
    <content type="text"><![CDATA[sorted(iterableï¼Œkey=None,reverse=False) keykeyæŒ‡å®šä¸€ä¸ªæŽ¥æ”¶ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ç”¨äºŽä»Žæ¯ä¸ªå…ƒç´ ä¸­æå–ä¸€ä¸ªç”¨äºŽæ¯”è¾ƒçš„å…³é”®å­—ã€‚é»˜è®¤å€¼ä¸ºNone ã€‚ reverseæ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ã€‚å¦‚æžœè®¾ç½®ä¸ºTrueï¼Œåˆ—è¡¨å…ƒç´ å°†è¢«å€’åºæŽ’åˆ—ï¼Œé»˜è®¤ä¸ºFalseã€‚ python3 sortedå–æ¶ˆäº†å¯¹cmpçš„æ”¯æŒã€‚ ä¾‹1ï¼šæŒ‰ç…§å­¦ç”Ÿçš„å¹´é¾„æŽ’åº123&gt;&gt;&gt; students = [('john', 'A', 15), ('jane', 'B', 12), ('dave','B', 10)]&gt;&gt;&gt; sorted(students,key=lambda x: x[2])[('dave', 'B', 10), ('jane', 'B', 12), ('john', 'A', 15)] ä¾‹2ï¼šæ­£æ•°åœ¨å‰è´Ÿæ•°åœ¨åŽï¼›æ­£æ•°ä»Žå°åˆ°å¤§ï¼›è´Ÿæ•°ä»Žå¤§åˆ°å°123&gt;&gt;&gt; list_1 = [7, -8, 5, 4, 0, -2, -5]&gt;&gt;&gt; sorted(list_1, key=lambda x:(x&lt;0,abs(x)))[0, 4, 5, 7, -2, -5, -8] ä¾‹3ï¼šå­—ç¬¦ä¸²é•¿åº¦æŽ’åº123&gt;&gt;&gt; list_2 = ['dddd','a','bb','ccc']&gt;&gt;&gt; sorted(list_2, key=len)['a', 'bb', 'ccc', 'dddd'] ä¾‹3ï¼šå°å†™ &lt; å¤§å†™ &lt; å¥‡æ•° &lt; å¶æ•°123&gt;&gt;&gt; s = 'A1ab5C3c4D798'&gt;&gt;&gt; "".join(sorted(s, key=lambda x: (x.isdigit(),x.isdigit() and int(x) % 2 == 0,x.isupper(),x)))'abcACD1357948' è®²ä¸€ä¸‹åŽŸç†ï¼š Boolean çš„æŽ’åºä¼šå°† False æŽ’åœ¨å‰ï¼ŒTrueæŽ’åœ¨åŽ ã€‚ å…ˆæ¯”è¾ƒå…ƒç»„çš„ç¬¬ä¸€ä¸ªå€¼ï¼ŒFALSE&lt;TRUEï¼Œå¦‚æžœç›¸ç­‰å°±æ¯”è¾ƒå…ƒç»„çš„ä¸‹ä¸€ä¸ªå€¼ï¼Œä»¥æ­¤ç±»æŽ¨ã€‚ ç¬¬ä¸€æ­¥æ¯”è¾ƒï¼šx.isdigit()çš„ä½œç”¨æ˜¯æŠŠæ•°å­—æ”¾åœ¨å‰è¾¹,å­—æ¯æ”¾åœ¨åŽè¾¹ã€‚ ç¬¬äºŒæ­¥æ¯”è¾ƒï¼šx.isdigit() and int(x) % 2 == 0çš„ä½œç”¨æ˜¯ä¿è¯å¥‡æ•°åœ¨å‰ï¼Œå¶æ•°åœ¨åŽã€‚ ç¬¬ä¸‰æ­¥æ¯”è¾ƒï¼šx.isupper()çš„ä½œç”¨æ˜¯åœ¨å‰é¢åŸºç¡€ä¸Š,ä¿è¯å­—æ¯å°å†™åœ¨å‰å¤§å†™åœ¨åŽã€‚ ç¬¬å››æ­¥æ¯”è¾ƒï¼šæœ€åŽçš„xè¡¨ç¤ºåœ¨å‰é¢åŸºç¡€ä¸Š,å¯¹æ‰€æœ‰ç±»åˆ«æ•°å­—æˆ–å­—æ¯æŽ’åº ã€‚ ä¾‹4ï¼š æ ¹æ®å­—ç¬¦ä¸²ä¸­çš„å†…åµŒæ•°å­—æŽ’åº1234l = [ 'ch9.txt', 'ch10.txt', 'ch1.txt', 'ch3.txt', 'ch11.txt' ]&gt;&gt;&gt; import re&gt;&gt;&gt; sorted(l, key = lambda x:int(re.match('\D+(\d+)\.txt',x).group(1)))['ch1.txt', 'ch3.txt', 'ch9.txt', 'ch10.txt', 'ch11.txt'] ä¾‹5ï¼šlisté‡Œéƒ½æ˜¯æ­£æ•´æ•°ï¼Œç»„åˆå‡ºæ¥æœ€å¤§çš„æ•°å­—è¿™ä¸ªåœ¨Python2é‡Œé¢ç”¨SortedåŠ cmpå°±å¾ˆå®¹æ˜“å®žçŽ°ï¼Œä½†æ˜¯åœ¨Python3ä¸­ç”±äºŽå–æ¶ˆäº†å†…ç½®å¯¹è±¡__cmp__æ–¹æ³•ï¼Œæ‰€ä»¥sortedå‡½æ•°çš„ä¼ å…¥æ¯”è¾ƒå‡½æ•°çš„cmpå‚æ•°ä¹Ÿå–æ¶ˆäº†ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨cmp_to_key æ¥è§£å†³cmpçš„é—®é¢˜ï¼š 12345&gt;&gt;&gt; from functools import cmp_to_key&gt;&gt;&gt; list_3 = [3, 30, 34, 5, 9]&gt;&gt;&gt; cmp2key = cmp_to_key(lambda x,y: int(y+x)-int(x+y))&gt;&gt;&gt; print( ''.join(sorted(map(str, list_3), key=cmp2key)))9534330 ä¾‹6ï¼šæå–å­—å…¸çš„æŸä¸ªkeyå€¼å¹¶è¿›è¡ŒæŽ’åº12from operator import itemgettersubmission_dicts = sorted(submission_dicts, key=itemgetter(1), reverse=True) 123456789101112131415161718192021222324&gt;&gt;&gt; help(itemgetter)class itemgetter(builtins.object) | itemgetter(item, ...) --&gt; itemgetter object | | Return a callable object that fetches the given item(s) from its operand. | After f = itemgetter(2), the call f(r) returns r[2]. | After g = itemgetter(2, 5, 3), the call g(r) returns (r[2], r[5], r[3]) | | Methods defined here: | | __call__(self, /, *args, **kwargs) | Call self as a function. | | __getattribute__(self, name, /) | Return getattr(self, name). | | __new__(*args, **kwargs) from builtins.type | Create and return a new object. See help(type) for accurate signature. | | __reduce__(...) | Return state information for pickling | | __repr__(self, /) | Return repr(self). sortç”¨æ³•ä¸Žsortedç›¸åŒã€‚ sortå¯¹åˆ—è¡¨è¿›è¡Œæ°¸ä¹…æ€§æŽ’åºã€‚ sortedå¯¹åˆ—è¡¨è¿›è¡Œä¸´æ—¶æŽ’åºï¼Œä¸æ”¹å˜åŽŸåˆ—è¡¨åºåˆ—ã€‚]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Pythonæ¨¡å—</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linuxå­¦ä¹ ç¬”è®°-è¿›ç¨‹åŽå°è¿è¡Œ]]></title>
    <url>%2F2018%2F06%2F21%2FLinux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E8%BF%9B%E7%A8%8B%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C%2F</url>
    <content type="text"><![CDATA[è®©è¿›ç¨‹åœ¨åŽå°å¯é è¿è¡Œçš„å‡ ç§æ–¹æ³•æˆ‘ä»¬ç»å¸¸ä¼šç¢°åˆ°è¿™æ ·çš„é—®é¢˜ï¼Œç”¨ telnet/ssh ç™»å½•äº†è¿œç¨‹çš„ Linux æœåŠ¡å™¨ï¼Œè¿è¡Œäº†ä¸€äº›è€—æ—¶è¾ƒé•¿çš„ä»»åŠ¡ï¼Œ ç»“æžœå´ç”±äºŽç½‘ç»œçš„ä¸ç¨³å®šå¯¼è‡´ä»»åŠ¡ä¸­é€”å¤±è´¥ã€‚å¦‚ä½•è®©å‘½ä»¤æäº¤åŽä¸å—æœ¬åœ°å…³é—­ç»ˆç«¯çª—å£/ç½‘ç»œæ–­å¼€è¿žæŽ¥çš„å¹²æ‰°å‘¢ï¼Ÿä¸‹é¢ä¸¾äº†ä¸€äº›ä¾‹å­ï¼Œ æ‚¨å¯ä»¥é’ˆå¯¹ä¸åŒçš„åœºæ™¯é€‰æ‹©ä¸åŒçš„æ–¹å¼æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚ nohup/setsid/&amp;åœºæ™¯ï¼šå¦‚æžœåªæ˜¯ä¸´æ—¶æœ‰ä¸€ä¸ªå‘½ä»¤éœ€è¦é•¿æ—¶é—´è¿è¡Œï¼Œä»€ä¹ˆæ–¹æ³•èƒ½æœ€ç®€ä¾¿çš„ä¿è¯å®ƒåœ¨åŽå°ç¨³å®šè¿è¡Œå‘¢ï¼Ÿ è§£å†³æ–¹æ³•ï¼šæˆ‘ä»¬çŸ¥é“ï¼Œå½“ç”¨æˆ·æ³¨é”€ï¼ˆlogoutï¼‰æˆ–è€…ç½‘ç»œæ–­å¼€æ—¶ï¼Œç»ˆç«¯ä¼šæ”¶åˆ° HUPï¼ˆhangupï¼‰ä¿¡å·ä»Žè€Œå…³é—­å…¶æ‰€æœ‰å­è¿›ç¨‹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„è§£å†³åŠžæ³•å°±æœ‰ä¸¤ç§é€”å¾„ï¼šè¦ä¹ˆè®©è¿›ç¨‹å¿½ç•¥ HUP ä¿¡å·ï¼Œè¦ä¹ˆè®©è¿›ç¨‹è¿è¡Œåœ¨æ–°çš„ä¼šè¯é‡Œä»Žè€Œæˆä¸ºä¸å±žäºŽæ­¤ç»ˆç«¯çš„å­è¿›ç¨‹ã€‚ hangup åç§°çš„æ¥ç”±ï¼š â€‹ åœ¨ Unix çš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œæ¯ä¸ªç»ˆç«¯éƒ½ä¼šé€šè¿‡ modem å’Œç³»ç»Ÿé€šè®¯ã€‚å½“ç”¨æˆ· logout æ—¶ï¼Œmodem å°±ä¼šæŒ‚æ–­ï¼ˆhang upï¼‰ç”µè¯ã€‚ åŒç†ï¼Œå½“ modem æ–­å¼€è¿žæŽ¥æ—¶ï¼Œå°±ä¼šç»™ç»ˆç«¯å‘é€ hangup ä¿¡å·æ¥é€šçŸ¥å…¶å…³é—­æ‰€æœ‰å­è¿›ç¨‹ã€‚ 1. nohup nohup æ— ç–‘æ˜¯æˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„åŠžæ³•ã€‚é¡¾åæ€ä¹‰ï¼Œnohup çš„ç”¨é€”å°±æ˜¯è®©æäº¤çš„å‘½ä»¤å¿½ç•¥ hangup ä¿¡å·ã€‚è®©æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ nohup çš„å¸®åŠ©ä¿¡æ¯ï¼š 12345678910111213141516NOHUP(1) User Commands NOHUP(1) NAME nohup - run a command immune to hangups, with output to a non-tty SYNOPSIS nohup COMMAND [ARG]... nohup OPTION DESCRIPTION Run COMMAND, ignoring hangup signals. --help display this help and exit --version output version information and exit å¯è§ï¼Œnohup çš„ä½¿ç”¨æ˜¯ååˆ†æ–¹ä¾¿çš„ï¼Œåªéœ€åœ¨è¦å¤„ç†çš„å‘½ä»¤å‰åŠ ä¸Š nohup å³å¯ï¼Œæ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯ç¼ºçœä¼šè¢«é‡å®šå‘åˆ° nohup.out æ–‡ä»¶ä¸­ã€‚ä¸€èˆ¬æˆ‘ä»¬å¯åœ¨ç»“å°¾åŠ ä¸Šâ€œ&amp;â€æ¥å°†å‘½ä»¤åŒæ—¶æ”¾å…¥åŽå°è¿è¡Œï¼Œä¹Ÿå¯ç”¨&quot;&gt; filename 2&gt;&amp;1&quot;æ¥æ›´æ”¹ç¼ºçœçš„é‡å®šå‘æ–‡ä»¶åã€‚ nohup ç¤ºä¾‹1234567[root@pvcent107 ~]# nohup ping www.ibm.com &amp;[1] 3059nohup: appending output to `nohup.out'[root@pvcent107 ~]# ps -ef |grep 3059root 3059 984 0 21:06 pts/3 00:00:00 ping www.ibm.comroot 3067 984 0 21:06 pts/3 00:00:00 grep 3059[root@pvcent107 ~]# 2. setsid nohup æ— ç–‘èƒ½é€šè¿‡å¿½ç•¥ HUP ä¿¡å·æ¥ä½¿æˆ‘ä»¬çš„è¿›ç¨‹é¿å…ä¸­é€”è¢«ä¸­æ–­ï¼Œä½†å¦‚æžœæˆ‘ä»¬æ¢ä¸ªè§’åº¦æ€è€ƒï¼Œå¦‚æžœæˆ‘ä»¬çš„è¿›ç¨‹ä¸å±žäºŽæŽ¥å— HUP ä¿¡å·çš„ç»ˆç«¯çš„å­è¿›ç¨‹ï¼Œé‚£ä¹ˆè‡ªç„¶ä¹Ÿå°±ä¸ä¼šå—åˆ° HUP ä¿¡å·çš„å½±å“äº†ã€‚setsid å°±èƒ½å¸®åŠ©æˆ‘ä»¬åšåˆ°è¿™ä¸€ç‚¹ã€‚è®©æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ setsid çš„å¸®åŠ©ä¿¡æ¯ï¼š 12345678910SETSID(8) Linux Programmerâ€™s Manual SETSID(8) NAME setsid - run a program in a new session SYNOPSIS setsid program [ arg ... ] DESCRIPTION setsid runs a program in a new session. å¯è§ setsid çš„ä½¿ç”¨ä¹Ÿæ˜¯éžå¸¸æ–¹ä¾¿çš„ï¼Œä¹Ÿåªéœ€åœ¨è¦å¤„ç†çš„å‘½ä»¤å‰åŠ ä¸Š setsid å³å¯ã€‚ setsid ç¤ºä¾‹12345[root@pvcent107 ~]# setsid ping www.ibm.com[root@pvcent107 ~]# ps -ef |grep www.ibm.comroot 31094 1 0 07:28 ? 00:00:00 ping www.ibm.comroot 31102 29217 0 07:29 pts/4 00:00:00 grep www.ibm.com[root@pvcent107 ~]# å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸Šä¾‹ä¸­æˆ‘ä»¬çš„è¿›ç¨‹ ID(PID)ä¸º31094ï¼Œè€Œå®ƒçš„çˆ¶ IDï¼ˆPPIDï¼‰ä¸º1ï¼ˆå³ä¸º init è¿›ç¨‹ IDï¼‰ï¼Œå¹¶ä¸æ˜¯å½“å‰ç»ˆç«¯çš„è¿›ç¨‹ IDã€‚è¯·å°†æ­¤ä¾‹ä¸Žnohup ä¾‹ä¸­çš„çˆ¶ ID åšæ¯”è¾ƒã€‚ 3. &amp; è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå…³äºŽ subshell çš„å°æŠ€å·§ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå°†ä¸€ä¸ªæˆ–å¤šä¸ªå‘½ååŒ…å«åœ¨â€œ()â€ä¸­å°±èƒ½è®©è¿™äº›å‘½ä»¤åœ¨å­ shell ä¸­è¿è¡Œä¸­ï¼Œä»Žè€Œæ‰©å±•å‡ºå¾ˆå¤šæœ‰è¶£çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬çŽ°åœ¨è¦è®¨è®ºçš„å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚ å½“æˆ‘ä»¬å°†â€&amp;â€ä¹Ÿæ”¾å…¥â€œ()â€å†…ä¹‹åŽï¼Œæˆ‘ä»¬å°±ä¼šå‘çŽ°æ‰€æäº¤çš„ä½œä¸šå¹¶ä¸åœ¨ä½œä¸šåˆ—è¡¨ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ˜¯æ— æ³•é€šè¿‡jobsæ¥æŸ¥çœ‹çš„ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆè¿™æ ·å°±èƒ½èº²è¿‡ HUP ä¿¡å·çš„å½±å“å§ã€‚ subshell ç¤ºä¾‹12345root@pvcent107 ~]# (ping www.ibm.com &amp;)[root@pvcent107 ~]# ps -ef |grep www.ibm.comroot 16270 1 0 14:13 pts/4 00:00:00 ping www.ibm.comroot 16278 15362 0 14:13 pts/4 00:00:00 grep www.ibm.com[root@pvcent107 ~]# ä»Žä¸Šä¾‹ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ–°æäº¤çš„è¿›ç¨‹çš„çˆ¶ IDï¼ˆPPIDï¼‰ä¸º1ï¼ˆinit è¿›ç¨‹çš„ PIDï¼‰ï¼Œå¹¶ä¸æ˜¯å½“å‰ç»ˆç«¯çš„è¿›ç¨‹ IDã€‚å› æ­¤å¹¶ä¸å±žäºŽå½“å‰ç»ˆç«¯çš„å­è¿›ç¨‹ï¼Œä»Žè€Œä¹Ÿå°±ä¸ä¼šå—åˆ°å½“å‰ç»ˆç«¯çš„ HUP ä¿¡å·çš„å½±å“äº†ã€‚ disownåœºæ™¯ï¼šæˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œå¦‚æžœäº‹å…ˆåœ¨å‘½ä»¤å‰åŠ ä¸Š nohup æˆ–è€… setsid å°±å¯ä»¥é¿å… HUP ä¿¡å·çš„å½±å“ã€‚ä½†æ˜¯å¦‚æžœæˆ‘ä»¬æœªåŠ ä»»ä½•å¤„ç†å°±å·²ç»æäº¤äº†å‘½ä»¤ï¼Œè¯¥å¦‚ä½•è¡¥æ•‘æ‰èƒ½è®©å®ƒé¿å… HUP ä¿¡å·çš„å½±å“å‘¢ï¼Ÿ è§£å†³æ–¹æ³•ï¼šè¿™æ—¶æƒ³åŠ  nohup æˆ–è€… setsid å·²ç»ä¸ºæ—¶å·²æ™šï¼Œåªèƒ½é€šè¿‡ä½œä¸šè°ƒåº¦å’Œ disown æ¥è§£å†³è¿™ä¸ªé—®é¢˜äº†ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ disown çš„å¸®åŠ©ä¿¡æ¯ï¼š 1234567891011disown [-ar] [-h] [jobspec ...] Without options, each jobspec is removed from the table of active jobs. If the -h option is given, each jobspec is not removed from the table, but is marked so that SIGHUP is not sent to the job if the shell receives a SIGHUP. If no jobspec is present, and neither the -a nor the -r option is supplied, the current job is used. If no jobspec is supplied, the -a option means to remove or mark all jobs; the -r option without a jobspec argument restricts operation to running jobs. The return value is 0 unless a jobspec does not specify a valid job. å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¦‚ä¸‹æ–¹å¼æ¥è¾¾æˆæˆ‘ä»¬çš„ç›®çš„ï¼š ç”¨disown -h jobspecæ¥ä½¿æŸä¸ªä½œä¸šå¿½ç•¥HUPä¿¡å·ã€‚ ç”¨disown -ahæ¥ä½¿æ‰€æœ‰çš„ä½œä¸šéƒ½å¿½ç•¥HUPä¿¡å·ã€‚ ç”¨disown -rhæ¥ä½¿æ­£åœ¨è¿è¡Œçš„ä½œä¸šå¿½ç•¥HUPä¿¡å·ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ä½¿ç”¨è¿‡ disown ä¹‹åŽï¼Œä¼šå°†æŠŠç›®æ ‡ä½œä¸šä»Žä½œä¸šåˆ—è¡¨ä¸­ç§»é™¤ï¼Œæˆ‘ä»¬å°†ä¸èƒ½å†ä½¿ç”¨jobsæ¥æŸ¥çœ‹å®ƒï¼Œä½†æ˜¯ä¾ç„¶èƒ½å¤Ÿç”¨ps -efæŸ¥æ‰¾åˆ°å®ƒã€‚ ä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè¿™ç§æ–¹æ³•çš„æ“ä½œå¯¹è±¡æ˜¯ä½œä¸šï¼Œå¦‚æžœæˆ‘ä»¬åœ¨è¿è¡Œå‘½ä»¤æ—¶åœ¨ç»“å°¾åŠ äº†â€œ&amp;â€æ¥ä½¿å®ƒæˆä¸ºä¸€ä¸ªä½œä¸šå¹¶åœ¨åŽå°è¿è¡Œï¼Œé‚£ä¹ˆå°±ä¸‡äº‹å¤§å‰äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡jobså‘½ä»¤æ¥å¾—åˆ°æ‰€æœ‰ä½œä¸šçš„åˆ—è¡¨ã€‚ä½†æ˜¯å¦‚æžœå¹¶æ²¡æœ‰æŠŠå½“å‰å‘½ä»¤ä½œä¸ºä½œä¸šæ¥è¿è¡Œï¼Œå¦‚ä½•æ‰èƒ½å¾—åˆ°å®ƒçš„ä½œä¸šå·å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ç”¨ CTRL-zï¼ˆæŒ‰ä½Ctrlé”®çš„åŒæ—¶æŒ‰ä½zé”®ï¼‰äº†ï¼ CTRL-z çš„ç”¨é€”å°±æ˜¯å°†å½“å‰è¿›ç¨‹æŒ‚èµ·ï¼ˆSuspendï¼‰ï¼Œç„¶åŽæˆ‘ä»¬å°±å¯ä»¥ç”¨jobså‘½ä»¤æ¥æŸ¥è¯¢å®ƒçš„ä½œä¸šå·ï¼Œå†ç”¨bg jobspecæ¥å°†å®ƒæ”¾å…¥åŽå°å¹¶ç»§ç»­è¿è¡Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æžœæŒ‚èµ·ä¼šå½±å“å½“å‰è¿›ç¨‹çš„è¿è¡Œç»“æžœï¼Œè¯·æ…Žç”¨æ­¤æ–¹æ³•ã€‚ çµæ´»è¿ç”¨ CTRL-zåœ¨æˆ‘ä»¬çš„æ—¥å¸¸å·¥ä½œä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ CTRL-z æ¥å°†å½“å‰è¿›ç¨‹æŒ‚èµ·åˆ°åŽå°æš‚åœè¿è¡Œï¼Œæ‰§è¡Œä¸€äº›åˆ«çš„æ“ä½œï¼Œç„¶åŽå†ç”¨ fg æ¥å°†æŒ‚èµ·çš„è¿›ç¨‹é‡æ–°æ”¾å›žå‰å°ï¼ˆä¹Ÿå¯ç”¨ bg æ¥å°†æŒ‚èµ·çš„è¿›ç¨‹æ”¾åœ¨åŽå°ï¼‰ç»§ç»­è¿è¡Œã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ä¸€ä¸ªç»ˆç«¯å†…çµæ´»åˆ‡æ¢è¿è¡Œå¤šä¸ªä»»åŠ¡ï¼Œè¿™ä¸€ç‚¹åœ¨è°ƒè¯•ä»£ç æ—¶å°¤ä¸ºæœ‰ç”¨ã€‚å› ä¸ºå°†ä»£ç ç¼–è¾‘å™¨æŒ‚èµ·åˆ°åŽå°å†é‡æ–°æ”¾å›žæ—¶ï¼Œå…‰æ ‡å®šä½ä»ç„¶åœç•™åœ¨ä¸Šæ¬¡æŒ‚èµ·æ—¶çš„ä½ç½®ï¼Œé¿å…äº†é‡æ–°å®šä½çš„éº»çƒ¦ã€‚ disown ç¤ºä¾‹1ï¼ˆå¦‚æžœæäº¤å‘½ä»¤æ—¶å·²ç»ç”¨â€œ&amp;â€å°†å‘½ä»¤æ”¾å…¥åŽå°è¿è¡Œï¼Œåˆ™å¯ä»¥ç›´æŽ¥ä½¿ç”¨â€œdisownâ€ï¼‰123456789[root@pvcent107 build]# cp -r testLargeFile largeFile &amp;[1] 4825[root@pvcent107 build]# jobs[1]+ Running cp -i -r testLargeFile largeFile &amp;[root@pvcent107 build]# disown -h %1[root@pvcent107 build]# ps -ef |grep largeFileroot 4825 968 1 09:46 pts/4 00:00:00 cp -i -r testLargeFile largeFileroot 4853 968 0 09:46 pts/4 00:00:00 grep largeFile[root@pvcent107 build]# logout disown ç¤ºä¾‹2ï¼ˆå¦‚æžœæäº¤å‘½ä»¤æ—¶æœªä½¿ç”¨â€œ&amp;â€å°†å‘½ä»¤æ”¾å…¥åŽå°è¿è¡Œï¼Œå¯ä½¿ç”¨ CTRL-z å’Œâ€œbgâ€å°†å…¶æ”¾å…¥åŽå°ï¼Œå†ä½¿ç”¨â€œdisownâ€ï¼‰123456789101112[root@pvcent107 build]# cp -r testLargeFile largeFile2 [1]+ Stopped cp -i -r testLargeFile largeFile2[root@pvcent107 build]# bg %1[1]+ cp -i -r testLargeFile largeFile2 &amp;[root@pvcent107 build]# jobs[1]+ Running cp -i -r testLargeFile largeFile2 &amp;[root@pvcent107 build]# disown -h %1[root@pvcent107 build]# ps -ef |grep largeFile2root 5790 5577 1 10:04 pts/3 00:00:00 cp -i -r testLargeFile largeFile2root 5824 5577 0 10:05 pts/3 00:00:00 grep largeFile2[root@pvcent107 build]# screenåœºæ™¯ï¼šæˆ‘ä»¬å·²ç»çŸ¥é“äº†å¦‚ä½•è®©è¿›ç¨‹å…å— HUP ä¿¡å·çš„å½±å“ï¼Œä½†æ˜¯å¦‚æžœæœ‰å¤§é‡è¿™ç§å‘½ä»¤éœ€è¦åœ¨ç¨³å®šçš„åŽå°é‡Œè¿è¡Œï¼Œå¦‚ä½•é¿å…å¯¹æ¯æ¡å‘½ä»¤éƒ½åšè¿™æ ·çš„æ“ä½œå‘¢ï¼Ÿ è§£å†³æ–¹æ³•ï¼šæ­¤æ—¶æœ€æ–¹ä¾¿çš„æ–¹æ³•å°±æ˜¯ screen äº†ã€‚ç®€å•çš„è¯´ï¼Œscreen æä¾›äº† ANSI/VT100 çš„ç»ˆç«¯æ¨¡æ‹Ÿå™¨ï¼Œä½¿å®ƒèƒ½å¤Ÿåœ¨ä¸€ä¸ªçœŸå®žç»ˆç«¯ä¸‹è¿è¡Œå¤šä¸ªå…¨å±çš„ä¼ªç»ˆç«¯ã€‚screen çš„å‚æ•°å¾ˆå¤šï¼Œå…·æœ‰å¾ˆå¼ºå¤§çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬åœ¨æ­¤ä»…ä»‹ç»å…¶å¸¸ç”¨åŠŸèƒ½ä»¥åŠç®€è¦åˆ†æžä¸€ä¸‹ä¸ºä»€ä¹ˆä½¿ç”¨ screen èƒ½å¤Ÿé¿å… HUP ä¿¡å·çš„å½±å“ã€‚æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ screen çš„å¸®åŠ©ä¿¡æ¯ï¼š 12345678910111213141516171819SCREEN(1) SCREEN(1) NAME screen - screen manager with VT100/ANSI terminal emulation SYNOPSIS screen [ -options ] [ cmd [ args ] ] screen -r [[pid.]tty[.host]] screen -r sessionowner/[[pid.]tty[.host]] DESCRIPTION Screen is a full-screen window manager that multiplexes a physical terminal between several processes (typically interactive shells). Each virtual terminal provides the functions of a DEC VT100 terminal and, in addition, several control functions from the ISO 6429 (ECMA 48, ANSI X3.64) and ISO 2022 standards (e.g. insert/delete line and support for multiple character sets). There is a scrollback history buffer for each virtual terminal and a copy-and-paste mechanism that allows moving text regions between windows. ä½¿ç”¨ screen å¾ˆæ–¹ä¾¿ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªå¸¸ç”¨é€‰é¡¹ï¼š ç”¨screen -dmS session nameæ¥å»ºç«‹ä¸€ä¸ªå¤„äºŽæ–­å¼€æ¨¡å¼ä¸‹çš„ä¼šè¯ï¼ˆå¹¶æŒ‡å®šå…¶ä¼šè¯åï¼‰ã€‚ ç”¨screen -listæ¥åˆ—å‡ºæ‰€æœ‰ä¼šè¯ã€‚ ç”¨screen -r session nameæ¥é‡æ–°è¿žæŽ¥æŒ‡å®šä¼šè¯ã€‚ ç”¨å¿«æ·é”®CTRL-a dæ¥æš‚æ—¶æ–­å¼€å½“å‰ä¼šè¯ã€‚ screen ç¤ºä¾‹1234567[root@pvcent107 ~]# screen -dmS Urumchi[root@pvcent107 ~]# screen -listThere is a screen on: 12842.Urumchi (Detached)1 Socket in /tmp/screens/S-root. [root@pvcent107 ~]# screen -r Urumchi å½“æˆ‘ä»¬ç”¨â€œ-râ€è¿žæŽ¥åˆ° screen ä¼šè¯åŽï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨è¿™ä¸ªä¼ªç»ˆç«¯é‡Œé¢ä¸ºæ‰€æ¬²ä¸ºï¼Œå†ä¹Ÿä¸ç”¨æ‹…å¿ƒ HUP ä¿¡å·ä¼šå¯¹æˆ‘ä»¬çš„è¿›ç¨‹é€ æˆå½±å“ï¼Œä¹Ÿä¸ç”¨ç»™æ¯ä¸ªå‘½ä»¤å‰éƒ½åŠ ä¸Šâ€œnohupâ€æˆ–è€…â€œsetsidâ€äº†ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿè®©æˆ‘æ¥çœ‹ä¸€ä¸‹ä¸‹é¢ä¸¤ä¸ªä¾‹å­å§ã€‚ 1. æœªä½¿ç”¨ screen æ—¶æ–°è¿›ç¨‹çš„è¿›ç¨‹æ ‘123456789[root@pvcent107 ~]# ping www.google.com &amp;[1] 9499[root@pvcent107 ~]# pstree -H 9499initâ”€â”¬â”€Xvnc â”œâ”€acpid â”œâ”€atd â”œâ”€2*[sendmail] â”œâ”€sshdâ”€â”¬â”€sshdâ”€â”€â”€bashâ”€â”€â”€pstree â”‚ â””â”€sshdâ”€â”€â”€bashâ”€â”€â”€ping æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæœªä½¿ç”¨ screen æ—¶æˆ‘ä»¬æ‰€å¤„çš„ bash æ˜¯ sshd çš„å­è¿›ç¨‹ï¼Œå½“ ssh æ–­å¼€è¿žæŽ¥æ—¶ï¼ŒHUP ä¿¡å·è‡ªç„¶ä¼šå½±å“åˆ°å®ƒä¸‹é¢çš„æ‰€æœ‰å­è¿›ç¨‹ï¼ˆåŒ…æ‹¬æˆ‘ä»¬æ–°å»ºç«‹çš„ ping è¿›ç¨‹ï¼‰ã€‚ 2. ä½¿ç”¨äº† screen åŽæ–°è¿›ç¨‹çš„è¿›ç¨‹æ ‘123456789[root@pvcent107 ~]# screen -r Urumchi[root@pvcent107 ~]# ping www.ibm.com &amp;[1] 9488[root@pvcent107 ~]# pstree -H 9488initâ”€â”¬â”€Xvnc â”œâ”€acpid â”œâ”€atd â”œâ”€screenâ”€â”€â”€bashâ”€â”€â”€ping â”œâ”€2*[sendmail] è€Œä½¿ç”¨äº† screen åŽå°±ä¸åŒäº†ï¼Œæ­¤æ—¶ bash æ˜¯ screen çš„å­è¿›ç¨‹ï¼Œè€Œ screen æ˜¯ initï¼ˆPIDä¸º1ï¼‰çš„å­è¿›ç¨‹ã€‚é‚£ä¹ˆå½“ ssh æ–­å¼€è¿žæŽ¥æ—¶ï¼ŒHUP ä¿¡å·è‡ªç„¶ä¸ä¼šå½±å“åˆ° screen ä¸‹é¢çš„å­è¿›ç¨‹äº†ã€‚ æ€»ç»“çŽ°åœ¨å‡ ç§æ–¹æ³•å·²ç»ä»‹ç»å®Œæ¯•ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸åŒçš„åœºæ™¯æ¥é€‰æ‹©ä¸åŒçš„æ–¹æ¡ˆã€‚nohup/setsid æ— ç–‘æ˜¯ä¸´æ—¶éœ€è¦æ—¶æœ€æ–¹ä¾¿çš„æ–¹æ³•ï¼Œdisown èƒ½å¸®åŠ©æˆ‘ä»¬æ¥äº‹åŽè¡¥æ•‘å½“å‰å·²ç»åœ¨è¿è¡Œäº†çš„ä½œä¸šï¼Œè€Œ screen åˆ™æ˜¯åœ¨å¤§æ‰¹é‡æ“ä½œæ—¶ä¸äºŒçš„é€‰æ‹©äº†ã€‚]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLå­¦ä¹ ç¬”è®°-ä¸»ä»Žä¸Žä¸»ä¸»]]></title>
    <url>%2F2018%2F06%2F21%2FMySQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%B8%BB%E4%BB%8E%E4%B8%8E%E4%B8%BB%E4%B8%BB%2F</url>
    <content type="text"><![CDATA[MySQLä¸»ä»Žä¸Žä¸»ä¸»å¤åˆ¶åŽŸç† MySQLä¸»ä»Žæ˜¯åŸºäºŽBinLogçš„ï¼Œä¸»ä¸Šé¡»å¼€å¯BinLogæ‰èƒ½è¿›è¡Œä¸»ä»Žã€‚ ä¸»ä»Žè¿‡ç¨‹å¤§è‡´æœ‰3ä¸ªæ­¥éª¤ï¼š Masterå°†æ›´æ”¹æ“ä½œè®°å½•åˆ°BinLogé‡Œã€‚ Slaveå°†Masterçš„BinLogäº‹ä»¶ï¼ˆSQLè¯­å¥ï¼‰åŒæ­¥åˆ°ä»Žæœ¬æœºä¸Šå¹¶è®°å½•åœ¨RelayLogé‡Œã€‚ Slaveæ ¹æ®RelayLogé‡Œé¢çš„SQLè¯­å¥æŒ‰é¡ºåºæ‰§è¡Œã€‚ Masterä¸Šæœ‰ä¸€ä¸ªLogDumpçº¿ç¨‹ï¼Œç”¨æ¥å’ŒSlaveçš„I/Oçº¿ç¨‹ä¼ é€’BinLogã€‚ Slaveä¸Šæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œå…¶ä¸­I/Oçº¿ç¨‹ç”¨æ¥åŒæ­¥ä¸»çš„BinLogå¹¶ç”ŸæˆRelayLogï¼Œå¦å¤–ä¸€ä¸ªSQLçº¿ç¨‹ç”¨æ¥æŠŠRelayLogé‡Œé¢çš„SQLè¯­å¥æ‰§è¡Œä¸€éã€‚ ä¸»ä»Žå¤§æ¦‚æµç¨‹Master å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—ã€‚ é…ç½®å”¯ä¸€çš„server-idã€‚ èŽ·å¾—MasteräºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ååŠä½ç½®ã€‚ åˆ›å»ºä¸€ä¸ªç”¨äºŽSlaveå’ŒMasteré€šä¿¡çš„ç”¨æˆ·ã€‚ Slave é…ç½®å”¯ä¸€çš„server-idã€‚ ä½¿ç”¨Masteråˆ†é…çš„ç”¨æˆ·è¯»å–MasteräºŒè¿›åˆ¶æ—¥å¿—ã€‚ å¯ç”¨SlaveæœåŠ¡ã€‚ è¯¦ç»†è¿‡ç¨‹MasteræœåŠ¡å™¨ ä¿®æ”¹é…ç½®æ–‡ä»¶ 123456789101112131415# /etc/my.cnf[mysqld]# å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—log-bin = mysql-bin# è®¾ç½®å”¯ä¸€çš„server-idserver-id = 1# å…¶ä»–é…ç½®# ä¸åŒæ­¥çš„æ•°æ®åº“ binlog-ignore-db = mysql binlog-ignore-db = test binlog-ignore-db = information_schema# åªåŒæ­¥å“ªäº›æ•°æ®åº“ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå…¶ä»–ä¸åŒæ­¥binlog-do-db = test é‡å¯MySQLï¼Œåˆ›å»ºåŒæ­¥ç”¨æˆ· 12345mysql&gt; grant replication slave on *.* to dbsync@'%' identified by '123456';Query OK, 0 rows affected, 1 warning (0.00 sec)mysql&gt; flush privileges;Query OK, 0 rows affected (0.00 sec) æŸ¥çœ‹MasterçŠ¶æ€ï¼Œè®°å½•äºŒè¿›åˆ¶æ–‡ä»¶åå’Œä½ç½® 1234567mysql&gt; SHOW MASTER STATUS;+------------------+----------+--------------+------------------+-------------------+| File | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |+------------------+----------+--------------+------------------+-------------------+| mysql-bin.000001 | 154 | | | |+------------------+----------+--------------+------------------+-------------------+1 row in set (0.00 sec) Fileï¼šmysql-bin.000001 Positionï¼š 154 SlaveæœåŠ¡å™¨ ä¿®æ”¹é…ç½®æ–‡ä»¶ 1234# /etc/my.cnf[mysqld]# è®¾ç½®å”¯ä¸€çš„server-idserver-id=2 é‡å¯MySQLï¼Œæ‰§è¡ŒåŒæ­¥SQLè¯­å¥ 123456mysql&gt; CHANGE MASTER TO -&gt; MASTER_HOST='192.168.198.22', -&gt; MASTER_USER='dbsync', -&gt; MASTER_PASSWORD='123456', -&gt; MASTER_LOG_FILE='mysql-bin.000001', -&gt; MASTER_LOG_POS=154; å¯åŠ¨SlaveåŒæ­¥è¿›ç¨‹ 12mysql&gt; start slave;Query OK, 0 rows affected (0.01 sec) æŸ¥çœ‹SlaveçŠ¶æ€ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960mysql&gt; show slave status\G*************************** 1. row *************************** Slave_IO_State: Waiting for master to send event Master_Host: 192.168.198.22 Master_User: dbsync Master_Port: 3306 Connect_Retry: 60 Master_Log_File: mysql-bin.000001 Read_Master_Log_Pos: 154 Relay_Log_File: localhost-relay-bin.000002 Relay_Log_Pos: 320 Relay_Master_Log_File: mysql-bin.000001 Slave_IO_Running: Yes Slave_SQL_Running: Yes Replicate_Do_DB: Replicate_Ignore_DB: Replicate_Do_Table: Replicate_Ignore_Table: Replicate_Wild_Do_Table: Replicate_Wild_Ignore_Table: Last_Errno: 0 Last_Error: Skip_Counter: 0 Exec_Master_Log_Pos: 154 Relay_Log_Space: 531 Until_Condition: None Until_Log_File: Until_Log_Pos: 0 Master_SSL_Allowed: No Master_SSL_CA_File: Master_SSL_CA_Path: Master_SSL_Cert: Master_SSL_Cipher: Master_SSL_Key: Seconds_Behind_Master: 0Master_SSL_Verify_Server_Cert: No Last_IO_Errno: 0 Last_IO_Error: Last_SQL_Errno: 0 Last_SQL_Error: Replicate_Ignore_Server_Ids: Master_Server_Id: 1 Master_UUID: dd329e6e-a06d-11e8-ab57-000c2902a227 Master_Info_File: /var/lib/mysql/master.info SQL_Delay: 0 SQL_Remaining_Delay: NULL Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates Master_Retry_Count: 86400 Master_Bind: Last_IO_Error_Timestamp: Last_SQL_Error_Timestamp: Master_SSL_Crl: Master_SSL_Crlpath: Retrieved_Gtid_Set: Executed_Gtid_Set: Auto_Position: 0 Replicate_Rewrite_DB: Channel_Name: Master_TLS_Version: 1 row in set (0.00 sec) Slave_IO_Runningï¼ŒSlave_SQL_Running éƒ½ä¸ºYesæ—¶è¡¨ç¤ºä¸»ä»ŽåŒæ­¥æˆåŠŸã€‚ ä¸»ä¸»å³ä¸¤å°MySQLæœåŠ¡å™¨äº’ä¸ºä¸»ä»Žã€‚ å¤§æ¦‚æ€è·¯ ä¸¤å°MySQLæœåŠ¡å™¨éƒ½å¯è¯»å†™ï¼Œäº’ä¸ºä¸»ä»Žï¼Œé»˜è®¤åªä½¿ç”¨ä¸€å°è´Ÿè´£æ•°æ®çš„å†™å…¥ï¼Œå¦ä¸€å°åšå¤‡ç”¨ã€‚ ä¸¤å°ä¸»åº“ä¹‹é—´åšé«˜å¯ç”¨ï¼Œé‡‡ç”¨Keeplivedæˆ–Haproxyä½¿ç”¨VIPå¯¹å¤–æä¾›æœåŠ¡ï¼Œå®žçŽ°çƒ­å¤‡ä¸Žè´Ÿè½½ã€‚ è¯¦ç»†è¿‡ç¨‹é…ç½®æ–‡ä»¶ä¿®æ”¹MySQLé…ç½®æ–‡ä»¶ mysql-1ï¼š 1234567891011121314151617181920212223242526272829303132333435363738[mysqld]# è®¾ç½®å”¯ä¸€çš„server-idserver_id = 1# å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—log-bin = mysql-bin# äºŒè¿›åˆ¶æ—¥å¿—æ¸…å•log-bin-index = mysql-bin.index# æŒ‡å®šmysqlçš„binlogæ—¥å¿—çš„æ ¼å¼ï¼Œmixedæ˜¯æ··åˆæ¨¡å¼binlog_format = MIXED# å°†å¤åˆ¶äº‹ä»¶å†™å…¥binlogï¼Œä¸€å°æœåŠ¡å™¨æ—¢åšä¸»åº“åˆåšä»Žåº“æ­¤é€‰é¡¹å¿…é¡»è¦å¼€å¯log-slave-updates = true# å¼€å¯ä¸­ç»§æ—¥å¿—åŠŸèƒ½relay-log = relay-bin# ä¸­ç»§æ—¥å¿—æ¸…å•relay-log-index = salve-relay-bin.index# ç”¨æ¥è®¾å®šæ•°æ®åº“ä¸­è‡ªåŠ¨å¢žé•¿çš„èµ·ç‚¹(å³åˆå§‹å€¼)ï¼Œå› ä¸ºè¿™ä¸¤èƒ½æœåŠ¡å™¨éƒ½è®¾å®šäº†ä¸€æ¬¡è‡ªåŠ¨å¢žé•¿å€¼2ï¼Œæ‰€ä»¥å®ƒä»¬çš„èµ·ç‚¹å¿…é¡»å¾—ä¸åŒï¼Œè¿™æ ·æ‰èƒ½é¿å…ä¸¤å°æœåŠ¡å™¨æ•°æ®åŒæ­¥æ—¶å‡ºçŽ°ä¸»é”®å†²çªauto_increment_offset = 1 # è¡¨ç¤ºè‡ªå¢žé•¿å­—æ®µæ¯æ¬¡é€’å¢žçš„é‡ï¼Œå…¶é»˜è®¤å€¼æ˜¯1ã€‚å®ƒçš„å€¼åº”è®¾ä¸ºæ•´ä¸ªç»“æž„ä¸­æœåŠ¡å™¨çš„æ€»æ•°ï¼Œç”¨åˆ°ä¸¤å°æœåŠ¡å™¨ï¼Œæ‰€ä»¥å€¼è®¾ä¸º2auto_increment_increment = 2 # è®¾ç½®binlogæ—¥å¿—è€åŒ–æ—¶é—´expire_logs_days = 10# è®¾ç½®binlogæ—¥å¿—æ–‡ä»¶å¤§å°æœ€å¤§å€¼max_binlog_size = 900M# è®¾ç½®relaylogæ–‡ä»¶å¤§å°æœ€å¤§å€¼max_relay_log_size = 900M# è¿‡æ»¤ä¸åŒæ­¥çš„æ•°æ®åº“binlog-ignore-db = sysbinlog-ignore-db = mysqlbinlog-ignore-db = information_schemabinlog-ignore-db = performance_schema# è·³è¿‡ä¸€äº›åŒæ­¥é”™è¯¯slave-skip-errors = ddl_exist_errors# è®¾ç½®ä¸»ä»Žè¿žæŽ¥è¶…æ—¶æ—¶é—´slave-net-timeout = 30 mysql-2ï¼š server_idå’Œauto_increment_offsetä¸Žmysql-1ä¸åŒã€‚ 123456789101112131415161718192021222324# my.cnf# è®¾ç½®å”¯ä¸€çš„server-idserver_id = 2log-bin = mysql-binbinlog_format = MIXEDlog-slave-updates = truerelay-log = relay-binrelay-log-index = salve-relay-bin.index# ç”¨æ¥è®¾å®šæ•°æ®åº“ä¸­è‡ªåŠ¨å¢žé•¿çš„èµ·ç‚¹(å³åˆå§‹å€¼)ï¼Œå› ä¸ºè¿™ä¸¤èƒ½æœåŠ¡å™¨éƒ½è®¾å®šäº†ä¸€æ¬¡è‡ªåŠ¨å¢žé•¿å€¼2ï¼Œæ‰€ä»¥å®ƒä»¬çš„èµ·ç‚¹å¿…é¡»å¾—ä¸åŒï¼Œè¿™æ ·æ‰èƒ½é¿å…ä¸¤å°æœåŠ¡å™¨æ•°æ®åŒæ­¥æ—¶å‡ºçŽ°ä¸»é”®å†²çªauto_increment_offset = 2auto_increment_increment = 2 expire_logs_days = 10max_binlog_size = 900Mmax_relay_log_size = 900Mbinlog-ignore-db = sysbinlog-ignore-db = mysqlbinlog-ignore-db = information_schemabinlog-ignore-db = performance_schemaslave-skip-errors = ddl_exist_errorsslave-net-timeout = 30 slave-skip-errors slave_skip_errorsé€‰é¡¹æœ‰å››ä¸ªå¯ç”¨å€¼ï¼Œåˆ†åˆ«ä¸ºï¼š offï¼Œallï¼ŒErorCodeï¼Œddl_exist_errorsã€‚ é»˜è®¤æƒ…å†µä¸‹è¯¥å‚æ•°å€¼æ˜¯offï¼Œæˆ‘ä»¬å¯ä»¥åˆ—å‡ºå…·ä½“çš„error codeï¼Œä¹Ÿå¯ä»¥é€‰æ‹©allï¼Œmysql5.6åŠMySQL Cluster NDB 7.3ä»¥åŠåŽç»­ç‰ˆæœ¬å¢žåŠ äº†å‚æ•°ddl_exist_errorsï¼Œè¯¥å‚æ•°åŒ…å«ä¸€ç³»åˆ—error codeï¼ˆ1007,1008,1050,1051,1054,1060,1061,1068,1094,1146ï¼‰ã€‚ ä¸€äº›error codeä»£è¡¨çš„é”™è¯¯å¦‚ä¸‹ï¼š 1007ï¼šæ•°æ®åº“å·²å­˜åœ¨ï¼Œåˆ›å»ºæ•°æ®åº“å¤±è´¥ 1008ï¼šæ•°æ®åº“ä¸å­˜åœ¨ï¼Œåˆ é™¤æ•°æ®åº“å¤±è´¥ 1050ï¼šæ•°æ®è¡¨å·²å­˜åœ¨ï¼Œåˆ›å»ºæ•°æ®è¡¨å¤±è´¥ 1051ï¼šæ•°æ®è¡¨ä¸å­˜åœ¨ï¼Œåˆ é™¤æ•°æ®è¡¨å¤±è´¥ 1054ï¼šå­—æ®µä¸å­˜åœ¨ï¼Œæˆ–ç¨‹åºæ–‡ä»¶è·Ÿæ•°æ®åº“æœ‰å†²çª 1060ï¼šå­—æ®µé‡å¤ï¼Œå¯¼è‡´æ— æ³•æ’å…¥ 1061ï¼šé‡å¤é”®å 1068ï¼šå®šä¹‰äº†å¤šä¸ªä¸»é”® 1094ï¼šä½ç½®çº¿ç¨‹ID 1146ï¼šæ•°æ®è¡¨ç¼ºå¤±ï¼Œè¯·æ¢å¤æ•°æ®åº“ 1053ï¼šå¤åˆ¶è¿‡ç¨‹ä¸­ä¸»æœåŠ¡å™¨å®•æœº 1062ï¼šä¸»é”®å†²çª é…ç½®å®ŒæˆåŽè¿›è¡Œé‡å¯MySQLæ“ä½œã€‚ mysql-1è®¾ç½®ä¸ºmysql-2çš„ä¸»æœåŠ¡å™¨ mysql-1åˆ›å»ºåŒæ­¥ç”¨æˆ· 12345mysql&gt; grant replication slave on *.* to dbsync@'%' identified by '123456';Query OK, 0 rows affected, 1 warning (0.00 sec)mysql&gt; flush privileges;Query OK, 0 rows affected (0.00 sec) æŸ¥çœ‹mysql-1çš„binlogçŠ¶æ€ï¼Œè®°å½•äºŒè¿›åˆ¶æ–‡ä»¶åå’Œä½ç½® 1234567mysql&gt; SHOW MASTER STATUS;+------------------+----------+--------------+------------------+-------------------+| File | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |+------------------+----------+--------------+------------------+-------------------+| mysql-bin.000002 | 154 | | æ­¤å¤„çœç•¥ä¸åŒæ­¥çš„åº“ | |+------------------+----------+--------------+------------------+-------------------+1 row in set (0.00 sec) åœ¨mysql-2æœåŠ¡å™¨ä¸Šæ‰§è¡ŒåŒæ­¥SQLè¯­å¥ 123456mysql&gt; CHANGE MASTER TO -&gt; MASTER_HOST='192.168.198.22', -&gt; MASTER_USER='dbsync', -&gt; MASTER_PASSWORD='123456', -&gt; MASTER_LOG_FILE='mysql-bin.000002', -&gt; MASTER_LOG_POS=154; å¯åŠ¨å¹¶æŸ¥çœ‹SlaveçŠ¶æ€ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061mysql&gt; start slave;mysql&gt; show slave status\G*************************** 1. row *************************** Slave_IO_State: Waiting for master to send event Master_Host: 192.168.198.22 Master_User: dbsync Master_Port: 3306 Connect_Retry: 60 Master_Log_File: mysql-bin.000002 Read_Master_Log_Pos: 154 Relay_Log_File: relay-bin.000002 Relay_Log_Pos: 320 Relay_Master_Log_File: mysql-bin.000002 Slave_IO_Running: Yes Slave_SQL_Running: Yes Replicate_Do_DB: Replicate_Ignore_DB: Replicate_Do_Table: Replicate_Ignore_Table: Replicate_Wild_Do_Table: Replicate_Wild_Ignore_Table: Last_Errno: 0 Last_Error: Skip_Counter: 0 Exec_Master_Log_Pos: 154 Relay_Log_Space: 521 Until_Condition: None Until_Log_File: Until_Log_Pos: 0 Master_SSL_Allowed: No Master_SSL_CA_File: Master_SSL_CA_Path: Master_SSL_Cert: Master_SSL_Cipher: Master_SSL_Key: Seconds_Behind_Master: 0Master_SSL_Verify_Server_Cert: No Last_IO_Errno: 0 Last_IO_Error: Last_SQL_Errno: 0 Last_SQL_Error: Replicate_Ignore_Server_Ids: Master_Server_Id: 1 Master_UUID: dd329e6e-a06d-11e8-ab57-000c2902a227 Master_Info_File: /var/lib/mysql/master.info SQL_Delay: 0 SQL_Remaining_Delay: NULL Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates Master_Retry_Count: 86400 Master_Bind: Last_IO_Error_Timestamp: Last_SQL_Error_Timestamp: Master_SSL_Crl: Master_SSL_Crlpath: Retrieved_Gtid_Set: Executed_Gtid_Set: Auto_Position: 0 Replicate_Rewrite_DB: Channel_Name: Master_TLS_Version: mysql-2è®¾ç½®ä¸ºmysql-1çš„ä¸»æœåŠ¡å™¨æ­¥éª¤ç›¸åŒï¼Œåè¿‡æ¥å³å¯ã€‚ mysql-2åˆ›å»ºåŒæ­¥ç”¨æˆ· 12345mysql&gt; grant replication slave on *.* to dbsync@'%' identified by '123456';Query OK, 0 rows affected, 1 warning (0.00 sec)mysql&gt; flush privileges;Query OK, 0 rows affected (0.00 sec) æŸ¥çœ‹mysql-2çš„binlogçŠ¶æ€ï¼Œè®°å½•äºŒè¿›åˆ¶æ–‡ä»¶åå’Œä½ç½® 1234567mysql&gt; SHOW MASTER STATUS;+------------------+----------+--------------+------------------+-------------------+| File | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |+------------------+----------+--------------+------------------+-------------------+| mysql-bin.000003 | 850 | | æ­¤å¤„çœç•¥ä¸åŒæ­¥çš„åº“ | |+------------------+----------+--------------+------------------+-------------------+1 row in set (0.00 sec) åœ¨mysql-1æœåŠ¡å™¨ä¸Šæ‰§è¡ŒåŒæ­¥SQLè¯­å¥ 123456mysql&gt; CHANGE MASTER TO -&gt; MASTER_HOST='192.168.198.23', -&gt; MASTER_USER='dbsync', -&gt; MASTER_PASSWORD='123456', -&gt; MASTER_LOG_FILE='mysql-bin.000003', -&gt; MASTER_LOG_POS=850; å¯åŠ¨å¹¶æŸ¥çœ‹SlaveçŠ¶æ€ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061mysql&gt; start slave;mysql&gt; show slave status\G*************************** 1. row *************************** Slave_IO_State: Waiting for master to send event Master_Host: 192.168.198.23 Master_User: dbsync Master_Port: 3306 Connect_Retry: 60 Master_Log_File: mysql-bin.000003 Read_Master_Log_Pos: 850 Relay_Log_File: relay-bin.000002 Relay_Log_Pos: 320 Relay_Master_Log_File: mysql-bin.000003 Slave_IO_Running: Yes Slave_SQL_Running: Yes Replicate_Do_DB: Replicate_Ignore_DB: Replicate_Do_Table: Replicate_Ignore_Table: Replicate_Wild_Do_Table: Replicate_Wild_Ignore_Table: Last_Errno: 0 Last_Error: Skip_Counter: 0 Exec_Master_Log_Pos: 850 Relay_Log_Space: 521 Until_Condition: None Until_Log_File: Until_Log_Pos: 0 Master_SSL_Allowed: No Master_SSL_CA_File: Master_SSL_CA_Path: Master_SSL_Cert: Master_SSL_Cipher: Master_SSL_Key: Seconds_Behind_Master: 0Master_SSL_Verify_Server_Cert: No Last_IO_Errno: 0 Last_IO_Error: Last_SQL_Errno: 0 Last_SQL_Error: Replicate_Ignore_Server_Ids: Master_Server_Id: 2 Master_UUID: 8d6b7632-a23d-11e8-bb9f-000c29420492 Master_Info_File: /var/lib/mysql/master.info SQL_Delay: 0 SQL_Remaining_Delay: NULL Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates Master_Retry_Count: 86400 Master_Bind: Last_IO_Error_Timestamp: Last_SQL_Error_Timestamp: Master_SSL_Crl: Master_SSL_Crlpath: Retrieved_Gtid_Set: Executed_Gtid_Set: Auto_Position: 0 Replicate_Rewrite_DB: Channel_Name: Master_TLS_Version:]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Pythonå­¦ä¹ ç¬”è®°-sysæ¨¡å—]]></title>
    <url>%2F2018%2F06%2F21%2FPython%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-sys%E6%A8%A1%E5%9D%97%2F</url>
    <content type="text"><![CDATA[sys æ¨¡å—æä¾›äº†è®¸å¤šå‡½æ•°å’Œå˜é‡æ¥å¤„ç† Python è¿è¡Œæ—¶çŽ¯å¢ƒçš„ä¸åŒéƒ¨åˆ† ã€‚ å¤„ç†å‘½ä»¤è¡Œå‚æ•° åœ¨è§£é‡Šå™¨å¯åŠ¨åŽ, argv åˆ—è¡¨åŒ…å«äº†ä¼ é€’ç»™è„šæœ¬çš„æ‰€æœ‰å‚æ•°, åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºè„šæœ¬è‡ªèº«çš„åç§°ã€‚ ä½¿ç”¨sysæ¨¡å—èŽ·å¾—è„šæœ¬çš„å‚æ•°1234567print "script name is", sys.argv[0] # ä½¿ç”¨sys.argv[0]é‡‡é›†è„šæœ¬åç§°if len(sys.argv) &gt; 1: print "there are", len(sys.argv)-1, "arguments:" # ä½¿ç”¨len(sys.argv)-1é‡‡é›†å‚æ•°ä¸ªæ•°-1ä¸ºå‡åŽ»[0]è„šæœ¬åç§° for arg in sys.argv[1:]: #è¾“å‡ºé™¤äº†[0]å¤–æ‰€æœ‰å‚æ•° print argelse: print "there are no arguments!" å¦‚æžœæ˜¯ä»Žæ ‡å‡†è¾“å…¥è¯»å…¥è„šæœ¬ (æ¯”å¦‚ â€œpython &lt; sys-argv-example-1.pyâ€), è„šæœ¬çš„åç§°å°†è¢«è®¾ç½®ä¸ºç©ºä¸²ã€‚ å¦‚æžœæŠŠè„šæœ¬ä½œä¸ºå­—ç¬¦ä¸²ä¼ é€’ç»™python (ä½¿ç”¨ -c é€‰é¡¹), è„šæœ¬åä¼šè¢«è®¾ç½®ä¸º â€œ-câ€ã€‚ å¤„ç†æ¨¡å— path åˆ—è¡¨æ˜¯ä¸€ä¸ªç”±ç›®å½•åæž„æˆçš„åˆ—è¡¨, Python ä»Žä¸­æŸ¥æ‰¾æ‰©å±•æ¨¡å—( Python æºæ¨¡å—, ç¼–è¯‘æ¨¡å—,æˆ–è€…äºŒè¿›åˆ¶æ‰©å±•). å¯åŠ¨ Python æ—¶,è¿™ä¸ªåˆ—è¡¨ä»Žæ ¹æ®å†…å»ºè§„åˆ™, PYTHONPATH çŽ¯å¢ƒå˜é‡çš„å†…å®¹, ä»¥åŠæ³¨å†Œè¡¨( Windows ç³»ç»Ÿ)ç­‰è¿›è¡Œåˆå§‹åŒ–. ç”±äºŽå®ƒåªæ˜¯ä¸€ä¸ªæ™®é€šçš„åˆ—è¡¨, ä½ å¯ä»¥åœ¨ç¨‹åºä¸­å¯¹å®ƒè¿›è¡Œæ“ä½œã€‚ ä½¿ç”¨sysæ¨¡å—æ“ä½œæ¨¡å—æœç´¢è·¯å¾„123456print "path has", len(sys.path), "members"sys.path.insert(0, "samples") #å°†è·¯å¾„æ’å…¥åˆ°path,[0]ä¸­import samplesys.path = [] #åˆ é™¤pathä¸­æ‰€æœ‰è·¯å¾„import random ä½¿ç”¨sysæ¨¡å—æŸ¥æ‰¾å†…å»ºæ¨¡å—builtin_module_names åˆ—è¡¨åŒ…å« Python è§£é‡Šå™¨ä¸­æ‰€æœ‰å†…å»ºæ¨¡å—çš„åç§°ã€‚ 123456789101112131415161718def dump(module): print module, "=&gt;", if module in sys.builtin_module_names: #æŸ¥æ‰¾å†…å»ºæ¨¡å—æ˜¯å¦å­˜åœ¨ print "&lt;BUILTIN&gt;" else: module = _ _import_ _(module) #éžå†…å»ºæ¨¡å—è¾“å‡ºæ¨¡å—è·¯å¾„ print module._ _file_ _dump("os")dump("sys")dump("string")dump("strop")dump("zlib")os =&gt; C:\python\lib\os.pycsys =&gt; &lt;BUILTIN&gt;string =&gt; C:\python\lib\string.pycstrop =&gt; &lt;BUILTIN&gt;zlib =&gt; C:\python\zlib.pyd ä½¿ç”¨sysæ¨¡å—æŸ¥æ‰¾å·²å¯¼å…¥çš„æ¨¡å—modules å­—å…¸åŒ…å«æ‰€æœ‰åŠ è½½çš„æ¨¡å—. import è¯­å¥åœ¨ä»Žç£ç›˜å¯¼å…¥å†…å®¹ä¹‹å‰ä¼šå…ˆæ£€æŸ¥è¿™ä¸ªå­—å…¸ã€‚ Python åœ¨å¤„ç†ä½ çš„è„šæœ¬ä¹‹å‰å°±å·²ç»å¯¼å…¥äº†å¾ˆå¤šæ¨¡å—ã€‚ 1234print sys.modules.keys()['os.path', 'os', 'exceptions', '_ _main_ _', 'ntpath', 'strop', 'nt','sys', '_ _builtin_ _', 'site', 'signal', 'UserDict', 'string', 'stat'] ä½¿ç”¨sysæ¨¡å—èŽ·å¾—å½“å‰å¹³å°sys.platform è¿”å›žå½“å‰å¹³å° å‡ºçŽ°å¦‚ï¼š â€œwin32â€ â€œlinux2â€ ç­‰ å¤„ç†æ ‡å‡†è¾“å‡º/è¾“å…¥æ ‡å‡†è¾“å…¥å’Œæ ‡å‡†é”™è¯¯ (é€šå¸¸ç¼©å†™ä¸º stdout å’Œ stderr) æ˜¯å†…å»ºåœ¨æ¯ä¸€ä¸ª UNIX ç³»ç»Ÿä¸­çš„ç®¡é“ã€‚ å½“ä½  print æŸäº›ä¸œè¥¿æ—¶ï¼Œç»“æžœå‰å¾€ stdout ç®¡é“ï¼›å½“ä½ çš„ç¨‹åºå´©æºƒå¹¶æ‰“å°å‡ºè°ƒè¯•ä¿¡æ¯ (ä¾‹å¦‚ Python ä¸­çš„ traceback (é”™è¯¯è·Ÿè¸ª)) çš„æ—¶å€™ï¼Œä¿¡æ¯å‰å¾€ stderr ç®¡é“ã€‚ 1234567891011121314&gt;&gt;&gt; for i in range(3):... print'Dive in'Dive inDive inDive in&gt;&gt;&gt; import sys&gt;&gt;&gt; for i in range(3):... sys.stdout.write('Dive in')Dive inDive inDive in&gt;&gt;&gt; for i in range(3):... sys.stderr.write('Dive in')Dive inDive inDive in stdout æ˜¯ä¸€ä¸ªç±»æ–‡ä»¶å¯¹è±¡ï¼›è°ƒç”¨å®ƒçš„ write å‡½æ•°å¯ä»¥æ‰“å°å‡ºä½ ç»™å®šçš„ä»»ä½•å­—ç¬¦ä¸²ã€‚ å®žé™…ä¸Šï¼Œè¿™å°±æ˜¯ print å‡½æ•°çœŸæ­£åšçš„äº‹æƒ…ï¼›å®ƒåœ¨ä½ æ‰“å°çš„å­—ç¬¦ä¸²åŽé¢åŠ ä¸Šä¸€ä¸ªç¡¬å›žè½¦ï¼Œç„¶åŽè°ƒç”¨ sys.stdout.write å‡½æ•°ã€‚ åœ¨æœ€ç®€å•çš„ä¾‹å­ä¸­ï¼Œstdout å’Œ stderr æŠŠå®ƒä»¬çš„è¾“å‡ºå‘é€åˆ°ç›¸åŒçš„åœ°æ–¹ å’Œ stdout ä¸€æ ·ï¼Œstderr å¹¶ä¸ä¸ºä½ æ·»åŠ ç¡¬å›žè½¦ï¼›å¦‚æžœéœ€è¦ï¼Œè¦è‡ªå·±åŠ ä¸Šã€‚ stdout å’Œ stderr éƒ½æ˜¯ç±»æ–‡ä»¶å¯¹è±¡ï¼Œä½†æ˜¯å®ƒä»¬éƒ½æ˜¯åªå†™çš„ã€‚ å®ƒä»¬éƒ½æ²¡æœ‰ read æ–¹æ³•ï¼Œåªæœ‰ write æ–¹æ³•ã€‚ç„¶è€Œï¼Œå®ƒä»¬ä»ç„¶æ˜¯ç±»æ–‡ä»¶å¯¹è±¡ï¼Œå› æ­¤ä½ å¯ä»¥å°†å…¶å®ƒä»»ä½• (ç±») æ–‡ä»¶å¯¹è±¡èµ‹å€¼ç»™å®ƒä»¬æ¥é‡å®šå‘å…¶è¾“å‡ºã€‚ ä½¿ç”¨sysé‡å®šå‘è¾“å‡º123456789print 'Dive in' # æ ‡å‡†è¾“å‡ºsaveout = sys.stdout # ç»ˆåœ¨é‡å®šå‘å‰ä¿å­˜stdoutï¼Œè¿™æ ·çš„è¯ä¹‹åŽä½ è¿˜å¯ä»¥å°†å…¶è®¾å›žæ­£å¸¸fsock = open('out.log', 'w') # æ‰“å¼€ä¸€ä¸ªæ–°æ–‡ä»¶ç”¨äºŽå†™å…¥ã€‚å¦‚æžœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå°†ä¼šè¢«åˆ›å»ºã€‚å¦‚æžœæ–‡ä»¶å­˜åœ¨ï¼Œå°†è¢«è¦†ç›–ã€‚sys.stdout = fsock # æ‰€æœ‰åŽç»­çš„è¾“å‡ºéƒ½ä¼šè¢«é‡å®šå‘åˆ°åˆšæ‰æ‰“å¼€çš„æ–°æ–‡ä»¶ä¸Šã€‚print 'This message will be logged instead of displayed' # è¿™æ ·åªä¼šå°†è¾“å‡ºç»“æžœâ€œæ‰“å°â€åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼›å±å¹•ä¸Šä¸ä¼šçœ‹åˆ°è¾“å‡ºsys.stdout = saveout # åœ¨æˆ‘ä»¬å°† stdout æžä¹±ä¹‹å‰ï¼Œè®©æˆ‘ä»¬æŠŠå®ƒè®¾å›žåŽŸæ¥çš„æ–¹å¼ã€‚ fsock.close() # å…³é—­æ—¥å¿—æ–‡ä»¶ã€‚ é‡å®šå‘é”™è¯¯ä¿¡æ¯ fsock = open(â€˜error.logâ€™, â€˜wâ€™) # æ‰“å¼€ä½ è¦å­˜å‚¨è°ƒè¯•ä¿¡æ¯çš„æ—¥å¿—æ–‡ä»¶ã€‚sys.stderr = fsock # å°†æ–°æ‰“å¼€çš„æ—¥å¿—æ–‡ä»¶çš„æ–‡ä»¶å¯¹è±¡èµ‹å€¼ç»™stderrä»¥é‡å®šå‘æ ‡å‡†é”™è¯¯ã€‚raise Exception, â€˜this error will be loggedâ€™ # å¼•å‘ä¸€ä¸ªå¼‚å¸¸,æ²¡æœ‰åœ¨å±å¹•ä¸Šæ‰“å°å‡ºä»»ä½•ä¸œè¥¿,æ‰€æœ‰æ­£å¸¸çš„è·Ÿè¸ªä¿¡æ¯å·²ç»å†™è¿›error.log è¿˜è¦æ³¨æ„ä½ æ—¢æ²¡æœ‰æ˜¾å¼å…³é—­æ—¥å¿—æ–‡ä»¶ï¼Œä¹Ÿæ²¡æœ‰å°† stderr è®¾å›žæœ€åˆçš„å€¼ã€‚ è¿™æ ·æŒºå¥½ï¼Œå› ä¸ºä¸€æ—¦ç¨‹åºå´©æºƒ (ç”±äºŽå¼•å‘çš„å¼‚å¸¸)ï¼ŒPython å°†æ›¿æˆ‘ä»¬æ¸…ç†å¹¶å…³é—­æ–‡ä»¶ æ‰“å°åˆ° stderrå‘æ ‡å‡†é”™è¯¯å†™å…¥é”™è¯¯ä¿¡æ¯æ˜¯å¾ˆå¸¸è§çš„ï¼Œæ‰€ä»¥æœ‰ä¸€ç§è¾ƒå¿«çš„è¯­æ³•å¯ä»¥ç«‹åˆ»å¯¼å‡ºä¿¡æ¯ ã€‚ 12345&gt;&gt;&gt; print 'entering function'entering function&gt;&gt;&gt; import sys&gt;&gt;&gt; print &gt;&gt; sys.stderr, 'entering function'entering function print è¯­å¥çš„å¿«æ·è¯­æ³•å¯ä»¥ç”¨äºŽå†™å…¥ä»»ä½•æ‰“å¼€çš„æ–‡ä»¶ (æˆ–è€…æ˜¯ç±»æ–‡ä»¶å¯¹è±¡)ã€‚ åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥å°†å•ä¸ªprintè¯­å¥é‡å®šå‘åˆ°stderrè€Œä¸”ä¸ç”¨å½±å“åŽé¢çš„printè¯­å¥ã€‚ ä½¿ç”¨sysæ¨¡å—é€€å‡ºç¨‹åº12import syssys.exit(1) æ³¨æ„ sys.exit å¹¶ä¸æ˜¯ç«‹å³é€€å‡º. è€Œæ˜¯å¼•å‘ä¸€ä¸ª SystemExit å¼‚å¸¸. è¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨ä¸»ç¨‹åºä¸­æ•èŽ·å¯¹ sys.exit çš„è°ƒç”¨ã€‚ æ•èŽ·sys.exitè°ƒç”¨ 12345678910import sysprint "hello"try: sys.exit(1)except SystemExit: # æ•èŽ·é€€å‡ºçš„å¼‚å¸¸ pass # æ•èŽ·åŽä¸åšä»»ä½•æ“ä½œprint "there"hellothere å¦‚æžœå‡†å¤‡åœ¨é€€å‡ºå‰è‡ªå·±æ¸…ç†ä¸€äº›ä¸œè¥¿(æ¯”å¦‚åˆ é™¤ä¸´æ—¶æ–‡ä»¶), ä½ å¯ä»¥é…ç½®ä¸€ä¸ª â€œé€€å‡ºå¤„ç†å‡½æ•°â€(exit handler), å®ƒå°†åœ¨ç¨‹åºé€€å‡ºçš„æ—¶å€™è‡ªåŠ¨è¢«è°ƒç”¨ ã€‚ å¦ä¸€ç§æ•èŽ·sys.exitè°ƒç”¨çš„æ–¹æ³• 12345678910def exitfunc(): print "world"sys.exitfunc = exitfunc # è®¾ç½®æ•èŽ·æ—¶è°ƒç”¨çš„å‡½æ•°print "hello"sys.exit(1) # é€€å‡ºè‡ªåŠ¨è°ƒç”¨exitfunc()åŽï¼Œç¨‹åºä¾ç„¶é€€å‡ºäº†print "there" # ä¸ä¼šè¢« printhelloworld æ€»ç»“123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164# sys_demo.py sysæ¨¡å—ç›¸å…³å‡½æ•°# è¯¥æ¨¡å—å«æœ‰è§£é‡Šå™¨çš„ä¸€äº›å˜é‡ï¼Œä¸Žè§£é‡Šå™¨äº¤äº’çš„å‡½æ•°import sysdef sys_demo(): # é»˜è®¤ç¼–ç  print(sys.getdefaultencoding()) # Pythonç‰ˆæœ¬ print(sys.version) # æ·»åŠ æ¨¡å—è·¯å¾„åˆ°æœç´¢è·¯å¾„ sys.path.append('./module') # (å‡½æ•°)æ‰“å°å¼‚å¸¸ä¿¡æ¯ ''' try: 1 / 0 except: types, value, back = sys.exc_info() # æ•èŽ·å¼‚å¸¸ sys.excepthook(types, value, back) # æ‰“å°å¼‚å¸¸ ''' # è¾“å…¥å’Œè¾“å‡º # æ ‡å‡†è¾“å‡º sys.stdout.write("&gt;&gt; ") # åˆ·æ–°è¾“å‡º(è²Œä¼¼3.6ç‰ˆæœ¬æ— è®ºæ˜¯Linuxè¿˜æ˜¯winodwsåŠ ä¸åŠ éƒ½ä¸€æ ·) sys.stdout.flush() # æ ‡å‡†è¾“å…¥ strs = sys.stdin.readline()[:-1] # é”™è¯¯è¾“å‡º sys.stderr.write("è¾“å…¥å†…å®¹ä¸ºï¼š &#123;&#125;".format(strs)) sys.stderr.flush()def sys_func(): # ä¼ é€’ç»™pythonè„šæœ¬çš„å‘½ä»¤è¡Œå‚æ•°åˆ—è¡¨ # =&gt; python p.py -&gt; ['p.py'] / python p.py a 1 -&gt; ['p.py', 'a', '1'] / ç¨‹åºå†…æ‰§è¡Œ -&gt; ['ç¨‹åºæœ¬èº«è·¯å¾„'] # sys.argv[0] èŽ·å–è„šæœ¬å # sys.argv[1] èŽ·å–ç¬¬ä¸€ä¸ªå‚æ•° # ... lists = sys.argv # é»˜è®¤å­—ç¬¦é›†åç§° strs = sys.getdefaultencoding() # ç³»ç»Ÿæ–‡ä»¶åå­—ç¬¦é›†åç§° strs = sys.getfilesystemencoding() # è¿”å›žobjectçš„å¼•ç”¨è®¡æ•° num = sys.getrefcount(object) # å·²åŠ è½½çš„æ¨¡å—ï¼Œå¯ä¿®æ”¹ï¼Œä½†ä¸èƒ½é€šè¿‡ä¿®æ”¹è¿”å›žçš„å­—å…¸è¿›è¡Œä¿®æ”¹ dicts = sys.modules # æ¨¡å—æœç´¢è·¯å¾„,åˆå§‹åŒ–æ—¶ä½¿ç”¨PYTHONPATHçŽ¯å¢ƒå˜é‡çš„å€¼ lists = sys.path # åŠ¨æ€æ·»åŠ æ¨¡å—æœç´¢è·¯å¾„ sys.path.append('./test') # å¹³å°æ ‡è¯†ç¬¦(ç³»ç»Ÿèº«ä»½è¿›è¡Œè¯¦ç»†çš„æ£€æŸ¥ï¼ŒæŽ¨èä½¿ç”¨) strs = sys.platform # pythonè§£é‡Šå™¨ç‰ˆæœ¬ strs = sys.version # ç›‘è§†å™¨C APIç‰ˆæœ¬ num = sys.api_version # çº¿ç¨‹ä¿¡æ¯ lists = sys.thread_info # æ•èŽ·å¼‚å¸¸ types, value, back = sys.exc_info() # æ‰“å°å¼‚å¸¸ sys.excepthook(types, value, back) # å¼•å‘SystemExitå¼‚å¸¸é€€å‡ºPython(å¯ä»¥try), èŒƒå›´[0,127], None==0, "string"==1 # sys.exit([arg]) # æ­£å¸¸é€€å‡º sys.exit(0) # æœ€å¤§é€’å½’æ•°(å †æ ˆæœ€å¤§æ·±åº¦) num = sys.getrecursionlimit() # ä¿®æ”¹æœ€å¤§é€’å½’æ•° sys.setrecursionlimit(5000) # èŽ·å–çº¿ç¨‹åˆ‡æ¢é—´éš” fnum = sys.getswitchinterval() # è®¾ç½®çº¿ç¨‹åˆ‡æ¢é—´éš”, å•ä½ç§’ sys.setswitchinterval(0.005) # è§£é‡Šå™¨çš„æ£€æŸ¥é—´éš” num = sys.getcheckinterval() # è®¾ç½®è§£é‡Šå™¨æ£€æŸ¥é—´éš”, æ‰§è¡Œ(é»˜è®¤)100ä¸ªè™šæ‹ŸæŒ‡ä»¤æ‰§è¡Œä¸€æ¬¡æ£€æŸ¥, å€¼ä¸º&lt;=0æ—¶,æ£€æŸ¥æ¯ä¸ªè™šæ‹ŸæŒ‡ä»¤ sys.setcheckinterval(100) # sys.stdin // æ ‡å‡†è¾“å…¥æµ strs = sys.stdin.readline()[:-1] # sys.stdout // æ ‡å‡†å‡ºå…¥è¾“å‡º sys.stdout.write("&gt;&gt;") sys.stdout.flush() # sys.stderr // æ ‡æ³¨é”™è¯¯æµ sys.stderr.write("&gt;&gt;") # æ‰€æœ‰æ¨¡å— (æ³¨:éžå¯¼å…¥æ¨¡å—) lists = sys.builtin_module_names # Pythonå®‰è£…è·¯å¾„ path = sys.base_exec_prefix # åŒbase_exec_prefix path = sys.base_prefix # åŒbase_exec_prefix path = sys.exec_prefix # åŒbase_exec_prefix path = sys.prefix # Pythonè§£é‡Šå™¨çš„ç»å¯¹è·¯å¾„ path = sys.executable # æœ¬æœºå­—èŠ‚é¡ºåºæŒ‡ç¤ºå™¨, big-endian(æœ€é«˜æœ‰æ•ˆå­—èŠ‚åœ¨ç¬¬ä¸€ä½)å€¼ä¸º'big', little-endian(æœ€ä½Žæœ‰æ•ˆå­—èŠ‚åœ¨ç¬¬ä¸€ä½)å€¼ä¸º'little' strs = ys.byteorder # pythonç‰ˆæƒ strs = sys.copyright # 16è¿›åˆ¶ç‰ˆæœ¬å· num = sys.hexversion # å½“å‰è¿è¡Œçš„è§£é‡Šå™¨çš„ä¿¡æ¯ lists = sys.implementation # è§£é‡Šå™¨å½“å‰åˆ†é…çš„å†…å­˜å—çš„æ•°é‡ num = sys.getallocatedblocks() # æ˜¯å¦ä¸ä¼šå°è¯•å¯¼å…¥æºæ¨¡å—æ˜¯å†™å…¥.pycæ–‡ä»¶ (Falseä¼šå†™å…¥.pycæ–‡ä»¶) boolean = sys.dont_write_bytecode # è¿”å›žå¯¹è±¡çš„å¤§å°bit, åªè®¡ç®—è‡ªèº«å†…å­˜æ¶ˆè€—, ä¸è®¡ç®—å¼•ç”¨å¯¹è±¡çš„å†…å­˜æ¶ˆè€—, è°ƒç”¨å¯¹è±¡çš„__sizeof__(), defaultæ²¡æœ‰èŽ·å–åˆ°é»˜è®¤è¿”å›žå€¼ # sys.getsizeof(object[, default]) num = sys.getsizeof(object) # è§£é‡Šå™¨æ˜¯å¦æ­£åœ¨è¢«å…³æœº boolean = sys.is_finalizing() # æœ€å¤§æ•´æ•°å€¼(2 ** 31 -1), ä¸Žç³»ç»Ÿæœ‰å…³ num = sys.maxsize # æœ€å¤§Unicodeå€¼çš„æ•´æ•° (1114111) num = sys.maxunicode # è§£é‡Šå™¨ä¸»æç¤ºç¬¦ strs = sys.ps1 # è§£é‡Šå™¨æ¬¡æç¤ºç¬¦ strs = sys.ps2 # è°ƒç”¨å‡½æ•° sys.call_tracing(func, ("arg",)) # æ¸…é™¤å†…éƒ¨ç±»åž‹ç¼“å­˜ sys._clear_type_cache() # æ‰“å°CPythonå†…å­˜åˆ†é…å™¨çŠ¶æ€çš„ä½Žçº§ä¿¡æ¯ sys._debugmallocstats() # è®¾ç½®profileå‡½æ•°, é»˜è®¤None sys.setprofile(profilefunc) # èŽ·å–profileå‡½æ•° sys.getprofile() # è®¾ç½®è·Ÿè¸ªå‡½æ•°, def tracefunc(frameã€event å’Œarg): sys.settrace(tracefunc) # èŽ·å–è·Ÿè¸ªå‡½æ•°, é»˜è®¤None sys.gettrace() # è®¾ç½®åŒ…è£… def wrapper(coro): sys.set_coroutine_wrapper(wrapper) # åŒ…è£…, é»˜è®¤None sys.get_coroutine_wrapper()if __name__ == '__main__': sys_demo() #sys_func()]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Pythonå­¦ä¹ ç¬”è®°-timeitæ¨¡å—]]></title>
    <url>%2F2018%2F06%2F21%2FPython%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-timeit%E6%A8%A1%E5%9D%97%2F</url>
    <content type="text"><![CDATA[timeitæ¨¡å— timeit.timeit(stmt=â€™passâ€™, setup=â€™passâ€™, timer=\&lt;defaulttimer>, number=1000000) è¿”å›žï¼šè¿”å›žæ‰§è¡Œstmtè¿™æ®µä»£ç numberéæ‰€ç”¨çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’ï¼Œfloatåž‹å‚æ•°ï¼š stmtï¼šè¦æ‰§è¡Œçš„é‚£æ®µä»£ç setupï¼šæ‰§è¡Œä»£ç çš„å‡†å¤‡å·¥ä½œ,åˆå§‹åŒ–ä»£ç æˆ–æž„å»ºçŽ¯å¢ƒå¯¼å…¥è¯­å¥,ä¸è®¡å…¥æ—¶é—´ï¼Œä¸€èˆ¬æ˜¯importä¹‹ç±»çš„timerï¼šè¿™ä¸ªåœ¨win32ä¸‹æ˜¯time.clock()ï¼Œlinuxä¸‹æ˜¯time.time()ï¼Œé»˜è®¤çš„ï¼Œä¸ç”¨ç®¡numberï¼šè¦æ‰§è¡Œstmtå¤šå°‘é 12345678910111213import timeitprint(timeit.timeit('sum(x)', 'x=(i for i in range(100))'))def test(): L = [i for i in range(100)]if __name__ == '__main__': import timeit print(timeit.timeit('test()', setup="from __main__ import test", number=100000)) 120.101190333638963780.321354159539091 repeat(stmt=â€™passâ€™, setup=â€™passâ€™, timer=\&lt;defaulttimer>, repeat=3, number=1000000) è¿™ä¸ªå‡½æ•°æ¯”timeitå‡½æ•°å¤šäº†ä¸€ä¸ªrepeatå‚æ•°è€Œå·²ï¼Œè¡¨ç¤ºé‡å¤æ‰§è¡Œtimeitè¿™ä¸ªè¿‡ç¨‹å¤šå°‘éï¼Œè¿”å›žä¸€ä¸ªåˆ—è¡¨ï¼Œè¡¨ç¤ºæ‰§è¡Œæ¯éçš„æ—¶é—´ å½“ç„¶ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œpythonè¿˜ç”¨äº†ä¸€ä¸ªTimerç±»ï¼ŒTimerç±»é‡Œé¢çš„å‡½æ•°è·Ÿä¸Šé¢ä»‹ç»çš„ä¸¤ä¸ªå‡½æ•°æ˜¯ä¸€æ ·çš„ã€‚ 12345678910111213import timeitprint(timeit.repeat('sum(x)', 'x=(i for i in range(100))'))def test(): L = [i for i in range(100)]if __name__ == '__main__': import timeit print(timeit.repeat('test()', setup="from __main__ import test", repeat=5, number=100000)) 12[0.106236657178438, 0.1073258932847974, 0.10616481121618107][0.29790928249832355, 0.3105618696372121, 0.30556985822396787, 0.30301376705486294, 0.30120607132593435] timeit.default_timer() é»˜è®¤çš„è®¡æ—¶å™¨ 123456789101112131415161718192021import timeit# è®¡æ—¶å™¨1s1 = timeit.default_timer()print(timeit.repeat('sum(x)', 'x=(i for i in range(100))'))def test(): L = [i for i in range(100)]if __name__ == '__main__': import timeit print(timeit.repeat('test()', setup="from __main__ import test", repeat=5, number=100000))# è®¡æ—¶å™¨2s2 = timeit.default_timer()print(s1, s2, s2 - s1) 123[0.10179332653647721, 0.10404193409330395, 0.10724164534096042][0.30232567090443807, 0.30226451630561224, 0.2942087877875549, 0.30265410958904115, 0.29502689091730194]0.0 1.8100781923555895 1.8100781923555895 Timerç±»ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œpythonè¿˜ç”¨äº†ä¸€ä¸ªTimerç±»ï¼ŒTimerç±»é‡Œé¢çš„å‡½æ•°è·Ÿä¸Šé¢ä»‹ç»çš„ä¸¤ä¸ªå‡½æ•°æ˜¯ä¸€æ ·ã€‚ class timeit.Timer(stmt=â€™passâ€™, setup=â€™passâ€™,timer=\) Timer.timeit(number=1000000) Timer.repeat(repeat=3,number=1000000) 12345678910import timeitdef test(): L = [i for i in range(100)]time_obj = timeit.Timer(stmt="test()", setup="from __main__ import test")print(time_obj.timeit(number=20000))print(time_obj.repeat(repeat=2, number=20000))print(time_obj.repeat(repeat=5, number=20000)) 1230.06169643712451932[0.060732503797572286, 0.06019152080795917][0.05959408741942987, 0.05915531386421796, 0.06217412724262039, 0.06109216126339412, 0.06159337238104362] å‘½ä»¤è¡Œè°ƒç”¨ python -m timeit [-n N][-r N][-s S][-t][-c][-h][statementâ€¦] -n N æ‰§è¡ŒæŒ‡å®šè¯­å¥çš„æ¬¡æ•°-r N é‡å¤æµ‹é‡çš„æ¬¡æ•°(é»˜è®¤3æ¬¡)-s S æŒ‡å®šåˆå§‹åŒ–ä»£ç æ´»æž„å»ºçŽ¯å¢ƒçš„å¯¼å…¥è¯­å¥(é»˜è®¤pass)-t ä½¿ç”¨time.time() (ä¸æŽ¨è)-c ä½¿ç”¨time.clock() (ä¸æŽ¨è)-v æ‰“å°åŽŸå§‹è®¡æ—¶ç»“æžœ-h å¸®åŠ© 123456$ python -m timeit '"-".join(str(n) for n in range(100))'10000 loops, best of 3: 40.3 usec per loop$ python -m timeit '"-".join([str(n) for n in range(100)])'10000 loops, best of 3: 33.4 usec per loop$ python -m timeit '"-".join(map(str, range(100)))'10000 loops, best of 3: 25.2 usec per loop]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Pythonæ¨¡å—</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Pythonå­¦ä¹ ç¬”è®°-randomæ¨¡å—]]></title>
    <url>%2F2018%2F06%2F21%2FPython%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-random%E6%A8%A1%E5%9D%97%2F</url>
    <content type="text"><![CDATA[1. random ç”Ÿæˆä¼ªéšæœºæ•° ä¼ªéšæœºæ•°æ˜¯å¯é¢„æµ‹çš„ï¼Œä¸¥æ ¼æ„ä¹‰ä¸Šä¸å…·æœ‰éšæœºæ€§è´¨ï¼Œé€šå¸¸ç”¨æ•°å­¦å…¬å¼çš„æ–¹æ³•ï¼ˆæ¯”å¦‚ç»Ÿè®¡åˆ†å¸ƒï¼Œå¹³æ–¹å–ä¸­ç­‰ï¼‰èŽ·å¾— æ­£å¦‚æ•°åˆ—éœ€è¦æœ‰é¦–é¡¹ï¼Œäº§ç”Ÿä¼ªéšæœºæ•°éœ€è¦ä¸€ä¸ªåˆå€¼ç”¨æ¥è®¡ç®—æ•´ä¸ªåºåˆ—ï¼Œè¿™ä¸ªåˆå€¼è¢«ç§°ä¸ºâ€œç§å­â€ã€‚ç§å­å¯ä»¥æ˜¯ä¸€ä¸ªå›ºå®šçš„å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯æ ¹æ®å½“å‰ç³»ç»ŸçŠ¶æ€ç¡®å®šçš„å€¼ã€‚ 2. randomæ–¹æ³•1. seed()ï¼šæ”¹å˜éšæœºæ•°ç”Ÿæˆå™¨çš„ç§å­seed12345678910111213141516# seed() æ–¹æ³•æ”¹å˜éšæœºæ•°ç”Ÿæˆå™¨çš„ç§å­ï¼Œå¯ä»¥åœ¨è°ƒç”¨å…¶ä»–éšæœºæ¨¡å—å‡½æ•°ä¹‹å‰è°ƒç”¨æ­¤å‡½æ•°# seed()æ˜¯ä¸èƒ½ç›´æŽ¥è®¿é—®çš„ï¼Œéœ€è¦å¯¼å…¥ random æ¨¡å—ï¼Œç„¶åŽé€šè¿‡ random é™æ€å¯¹è±¡è°ƒç”¨è¯¥æ–¹æ³•import randomrandom.seed()print ("ä½¿ç”¨é»˜è®¤ç§å­ç”Ÿæˆéšæœºæ•°ï¼š", random.random())random.seed(10)print ("ä½¿ç”¨æ•´æ•°ç§å­ç”Ÿæˆéšæœºæ•°ï¼š", random.random())random.seed('hello')print ("ä½¿ç”¨å­—ç¬¦ä¸²ç§å­ç”Ÿæˆéšæœºæ•°ï¼š", random.random())random.seed(10)print(random.random())random.seed('hello')print(random.random()) æ‰§è¡ŒåŽç»“æžœä¸ºï¼š 12345ä½¿ç”¨é»˜è®¤ç§å­ç”Ÿæˆéšæœºæ•°ï¼š 0.7446141652673619ä½¿ç”¨æ•´æ•°ç§å­ç”Ÿæˆéšæœºæ•°ï¼š 0.5714025946899135ä½¿ç”¨å­—ç¬¦ä¸²ç§å­ç”Ÿæˆéšæœºæ•°ï¼š 0.35377544047307220.57140259468991350.3537754404730722 ä¹Ÿå°±æ˜¯è¯´ï¼Œseed( ) ç”¨äºŽæŒ‡å®šéšæœºæ•°ç”Ÿæˆæ—¶æ‰€ç”¨ç®—æ³•å¼€å§‹çš„æ•´æ•°å€¼ï¼Œå¦‚æžœä½¿ç”¨ç›¸åŒçš„seed( )å€¼ï¼Œåˆ™æ¯æ¬¡ç”Ÿæˆçš„éšå³æ•°éƒ½ç›¸åŒï¼Œå¦‚æžœä¸è®¾ç½®è¿™ä¸ªå€¼ï¼Œåˆ™ç³»ç»Ÿæ ¹æ®æ—¶é—´æ¥è‡ªå·±é€‰æ‹©è¿™ä¸ªå€¼ï¼Œæ­¤æ—¶æ¯æ¬¡ç”Ÿæˆçš„éšæœºæ•°å› æ—¶é—´å·®å¼‚è€Œä¸åŒã€‚ 2. getrandbits(k)ï¼šè¿”å›žä¸€ä¸ªå…·æœ‰xä½ï¼ˆbitï¼‰éšæœºæ•´æ•°12345678910111213141516171819202122#æœ€å°å€¼ä¸º0ï¼Œæœ€å¤§å€¼ä¸º15&gt;&gt;&gt; random.getrandbits(4)8&gt;&gt;&gt; random.getrandbits(4)14&gt;&gt;&gt; random.getrandbits(4)15&gt;&gt;&gt; random.getrandbits(4)12&gt;&gt;&gt; random.getrandbits(4)10&gt;&gt;&gt; random.getrandbits(4)7#æœ€å°å€¼ä¸º0ï¼Œæœ€å¤§å€¼ä¸º255random.getrandbits(8)&gt;&gt;&gt; random.getrandbits(8)239&gt;&gt;&gt; random.getrandbits(8)109&gt;&gt;&gt; random.getrandbits(8)41 3. randrange([start],stop,[step])ï¼šä»ŽæŒ‡å®šèŒƒå›´å†…ï¼ŒæŒ‰æŒ‡å®šåŸºæ•°é€’å¢žçš„é›†åˆä¸­èŽ·å–ä¸€ä¸ªéšæœºæ•°123456789&gt;&gt;&gt; random.randrange(100)52&gt;&gt;&gt; random.randrange(100)37&gt;&gt;&gt; random.randrange(1, 100, 2)25&gt;&gt;&gt; random.randrange(1, 100, 2)99 4. randint(a, b)ï¼šéšæœºç”Ÿæˆaï¼Œbä¹‹é—´çš„æ•´æ•°1234&gt;&gt;&gt; random.randint(10, 15)13&gt;&gt;&gt; random.randint(10, 15)15 5. choice(seq)ï¼šä»Žéžç©ºåºåˆ—ä¸­éšæœºæŒ‘é€‰ä¸€ä¸ªå…ƒç´ 123456789&gt;&gt;&gt; random.choice([1, 3, 6, [3, 6]])1&gt;&gt;&gt; random.choice([1, 3, 6, [3, 6]])[3, 6]&gt;&gt;&gt; random.choice('hello, python')'y'&gt;&gt;&gt; random.choice('hello, python')'n' 6. shuffle(seq, [random] )ï¼šå°†åºåˆ—çš„æ‰€æœ‰å…ƒç´ éšæœºæŽ’åº1234&gt;&gt;&gt; l = list(range(10))&gt;&gt;&gt; random.shuffle(l)&gt;&gt;&gt; l[2, 6, 3, 4, 7, 5, 0, 8, 1, 9] 7. sample(seq, n)ï¼šä»ŽæŒ‡å®šçš„åºåˆ—ä¸­ï¼Œé€‰å–nä¸ªéšæœºä¸”ç‹¬ç«‹çš„å…ƒç´ ç»„ï¼Œä¸æ”¹å˜åŽŸåºåˆ—12345&gt;&gt;&gt; l = list(range(10))&gt;&gt;&gt; l[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]&gt;&gt;&gt; random.sample(l, 5)[5, 3, 1, 7, 0] 8. random()ï¼šéšæœºç”Ÿæˆä¸€ä¸ª0åˆ°1ä¹‹é—´çš„æµ®ç‚¹æ•°1234&gt;&gt;&gt; random.random()0.585264330791065&gt;&gt;&gt; random.random()0.4522431095454009 9. uniform(a, b)ï¼šéšæœºç”Ÿæˆä¸€ä¸ªaåˆ°bä¹‹é—´çš„æµ®ç‚¹æ•°1234&gt;&gt;&gt; random.uniform(1, 2)1.489053942575901&gt;&gt;&gt; random.uniform(1, 2)1.7829116037672397 å¸¸è§çš„å‡½æ•°å°±ä»‹ç»åˆ°è¿™ï¼Œè¿˜æœ‰ä¸€äº›ä»¥åŽéœ€è¦ç”¨åˆ°åœ¨è®°å½•ã€‚]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Pythonæ¨¡å—</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[pythonç”±åˆ—è¡¨ç»„æˆçš„åˆ—è¡¨ä¸­æ³¨æ„çš„é—®é¢˜]]></title>
    <url>%2F2018%2F06%2F21%2F%E5%88%9D%E6%AD%A5%E4%BA%86%E8%A7%A3%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6%2F</url>
    <content type="text"><![CDATA[ä»Šå¤©å­¦ä¹ pythonäºŒåˆ†æŸ¥æ‰¾ï¼Œé‡è§äº†æ—¶é—´å¤æ‚åº¦ï¼Œæœ‰ç‚¹æ‡µï¼Œå…ˆç®€å•äº†è§£ä¸€ä¸‹ã€‚ åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå®šæ€§æè¿°äº†è¯¥ç®—æ³•çš„è¿è¡Œæ—¶é—´ã€‚è¿™æ˜¯ä¸€ä¸ªå…³äºŽä»£è¡¨ç®—æ³•è¾“å…¥å€¼çš„å­—ç¬¦ä¸²çš„é•¿åº¦çš„å‡½æ•°ã€‚æ—¶é—´å¤æ‚åº¦å¸¸ç”¨å¤§Oç¬¦å·è¡¨è¿°ï¼Œä¸åŒ…æ‹¬è¿™ä¸ªå‡½æ•°çš„ä½Žé˜¶é¡¹å’Œé¦–é¡¹ç³»æ•°ã€‚ ä¸æ‡‚ã€‚ç»§ç»­æŸ¥èµ„æ–™ã€‚ æ—¶é—´é¢‘åº¦ï¼š ä¸€ä¸ªç®—æ³•æ‰§è¡Œæ‰€æ¶ˆè€—çš„æ—¶é—´ï¼Œä»Žç†è®ºä¸Šæ˜¯ä¸èƒ½ç®—å‡ºæ¥çš„ï¼Œå¿…é¡»ä¸Šæœºè¿è¡Œæµ‹è¯•æ‰èƒ½çŸ¥é“ã€‚ä½†æˆ‘ä»¬ä¸å¯èƒ½ä¹Ÿæ²¡æœ‰å¿…è¦å¯¹æ¯ä¸ªç®—æ³•éƒ½ä¸Šæœºæµ‹è¯•ï¼Œåªéœ€çŸ¥é“ç®—æ³•èŠ±è´¹çš„æ—¶é—´æ˜¯å¤šå°‘ã€‚ ä¸€ä¸ªç®—æ³•èŠ±è´¹çš„æ—¶é—´ä¸Žç®—æ³•ä¸­è¯­å¥çš„æ‰§è¡Œæ¬¡æ•°æˆæ­£æ¯”ï¼Œå“ªä¸ªç®—æ³•ä¸­è¯­å¥æ‰§è¡Œæ¬¡æ•°å¤šï¼Œå®ƒèŠ±è´¹çš„æ—¶é—´å°±å¤šã€‚ ä¸€ä¸ªç®—æ³•ä¸­çš„è¯­å¥æ‰§è¡Œæ¬¡æ•°ç§°ä¸ºè¯­å¥é¢‘åº¦æˆ–æ—¶é—´é¢‘åº¦ã€‚è®°ä¸ºT(n)ã€‚ æ—¶é—´å¤æ‚åº¦ nç§°ä¸ºé—®é¢˜çš„è§„æ¨¡ï¼Œå½“nä¸æ–­å˜åŒ–æ—¶ï¼Œæ—¶é—´é¢‘åº¦T(n)ä¹Ÿä¼šä¸æ–­å˜åŒ–ã€‚ä½†æœ‰æ—¶æˆ‘ä»¬æƒ³çŸ¥é“å®ƒå˜åŒ–æ—¶å‘ˆçŽ°ä»€ä¹ˆè§„å¾‹ã€‚å› æ­¤æˆ‘ä»¬å¼•å…¥æ—¶é—´å¤æ‚åº¦æ¦‚å¿µã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç®—æ³•ä¸­åŸºæœ¬æ“ä½œé‡å¤æ‰§è¡Œçš„æ¬¡æ•°æ˜¯é—®é¢˜è§„æ¨¡nçš„æŸä¸ªå‡½æ•°ï¼Œç”¨T(n)è¡¨ç¤ºï¼Œè‹¥æœ‰æŸä¸ªè¾…åŠ©å‡½æ•°f(n)ï¼Œä½¿å¾—å½“nè¶‹è¿‘äºŽæ— ç©·å¤§æ—¶ï¼ŒT(n)/f(n)çš„æžé™å€¼ä¸ºä¸ç­‰äºŽé›¶çš„å¸¸æ•°ï¼Œåˆ™ç§°f(n)æ˜¯T(n)çš„åŒæ•°é‡çº§å‡½æ•°ã€‚è®°ä½œT(n)=O(f(n)) ç§°O(f(n))ä¸ºç®—æ³•çš„æ¸è¿›æ—¶é—´å¤æ‚åº¦ï¼Œç®€ç§°æ—¶é—´å¤æ‚åº¦ã€‚ æ³¨æ„ï¼Œæ—¶é—´é¢‘åº¦ä¸Žæ—¶é—´å¤æ‚åº¦æ—¶ä¸åŒçš„ï¼Œæ—¶é—´é¢‘åº¦ä¸åŒä½†æ—¶é—´å¤æ‚åº¦å¯èƒ½ç›¸åŒã€‚ å¦‚ï¼šT(n)=n^2+3n+4ä¸ŽT(n)=4n2+2n+1å®ƒä»¬çš„é¢‘åº¦ä¸åŒï¼Œä½†æ—¶é—´å¤æ‚åº¦ç›¸åŒï¼Œéƒ½ä¸ºO(n^2)ã€‚ å¸¸è§çš„æ—¶é—´å¤æ‚åº¦æœ‰ï¼š å¸¸æ•°é˜¶O(1) &lt; å¯¹æ•°é˜¶O(log2n) &lt; çº¿æ€§é˜¶O(n) &lt; çº¿æ€§å¯¹æ•°é˜¶O(nlog2n) &lt; å¹³æ–¹é˜¶O(n^2) &lt; æ–¹é˜¶O(n3) &lt; kæ¬¡æ–¹é˜¶O(n^k) &lt; æŒ‡æ•°é˜¶O(2^n) &lt; O(n!)&lt;O(n^n) ç›®å‰ä¸æƒ³äº†è§£å¤ªæ·±å…¥ï¼Œç›®å‰ä¸»è¦è¿˜æ˜¯ä»¥è¯­æ³•å­¦ä¹ ä¸ºä¸»ï¼Œä»¥åŽå­¦ä¹ ç®—æ³•æ—¶å†è¯¦ç»†äº†è§£ã€‚ ä¸¾å‡ ä¸ªå¸¸è§çš„ä¾‹å­ï¼š æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œå°±æ˜¯æœ€ä½Žçš„æ—¶é—´å¤æ‚åº¦äº†ï¼Œä¹Ÿå°±æ˜¯è€—æ—¶/è€—ç©ºé—´ä¸Žè¾“å…¥æ•°æ®å¤§å°æ— å…³ï¼Œæ— è®ºè¾“å…¥æ•°æ®å¢žå¤§å¤šå°‘å€ï¼Œè€—æ—¶/ç©ºé—´éƒ½ä¸å˜ã€‚å“ˆå¸Œç®—æ³•å°±æ˜¯å…¸åž‹çš„O(1)æ—¶é—´å¤æ‚åº¦ï¼Œæ— è®ºæ•°æ®è§„æ¨¡å¤šå¤§ï¼Œéƒ½å¯ä»¥åœ¨ä¸€æ¬¡è®¡ç®—åŽæ‰¾åˆ°ç›®æ ‡ã€‚ æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œå°±ä»£è¡¨æ•°æ®é‡å¢žå¤§å‡ å€ï¼Œè€—æ—¶ä¹Ÿå¢žå¤§å‡ å€ã€‚æ¯”å¦‚å¸¸è§çš„éåŽ†ç®—æ³•ã€‚ 12for i in list: print(i) æ—¶é—´å¤æ‚åº¦ä¸ºO(n^2)ï¼Œå°±ä»£è¡¨æ•°æ®é‡å¢žå¤§nå€æ—¶ï¼Œè€—æ—¶å¢žå¤§nçš„å¹³æ–¹å€ï¼Œè¿™æ˜¯æ¯”çº¿æ€§æ›´é«˜çš„æ—¶é—´å¤æ‚åº¦ã€‚æ¯”å¦‚å†’æ³¡æŽ’åºï¼Œå°±æ˜¯å…¸åž‹çš„O(n^2)çš„ç®—æ³•ï¼Œå¯¹nä¸ªæ•°æŽ’åºï¼Œéœ€è¦æ‰«ænÃ—næ¬¡ã€‚ 123456def bubble_sort(numbers): for i in range(len(numbers) -1): for j in range(len(numbers) - i - 1): if numbers[j] &gt; numbers[j + 1]: numbers[j], numbers[j + 1] = numbers[j + 1], numbers[j] return numbers æ—¶é—´å¤æ‚åº¦ä¸ºO(logn)ï¼Œå½“æ•°æ®é‡å¢žå¤§nå€æ—¶ï¼Œè€—æ—¶é‡å¢žå¤§lognå€ï¼ˆè¿™é‡Œçš„logæ˜¯ä»¥2ä¸ºåº•çš„ï¼Œæ¯”å¦‚ï¼Œå½“æ•°æ®é‡å¢žå¤§256å€æ—¶ï¼Œè€—æ—¶åªå¢žå¤§8å€ï¼Œæ˜¯æ¯”çº¿æ€§è¿˜è¦ä½Žçš„æ—¶é—´å¤æ‚åº¦ï¼‰ã€‚äºŒåˆ†æŸ¥æ‰¾å°±æ˜¯O(logn)çš„ç®—æ³•ã€‚ 123456789101112def binary_search(data_list, val): low = 0 high = len(data_list) - 1 while low &lt; high: mid = (low + high) // 2 if data_list[mid] == val: return mid elif data_list[mid] &gt; val: high = mid - 1 else: low = mid + 1 return O(nlogn)åŒç†ï¼Œå°±æ˜¯nä¹˜ä»¥lognï¼Œå½“æ•°æ®å¢žå¤§256å€æ—¶ï¼Œè€—æ—¶å¢žå¤§256*8=2048å€ã€‚è¿™ä¸ªå¤æ‚åº¦é«˜äºŽçº¿æ€§ä½ŽäºŽå¹³æ–¹ã€‚å½’å¹¶æŽ’åºå°±æ˜¯O(nlogn)çš„æ—¶é—´å¤æ‚åº¦ã€‚]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Pythonå­¦ä¹ ç¬”è®°-äºŒåˆ†æŸ¥æ‰¾ä¸Žbisectæ¨¡å—]]></title>
    <url>%2F2018%2F06%2F20%2FPython%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE%E4%B8%8Ebisect%E6%A8%A1%E5%9D%97%2F</url>
    <content type="text"><![CDATA[1. äºŒåˆ†æŸ¥æ‰¾ Python çš„åˆ—è¡¨ï¼ˆlistï¼‰å†…éƒ¨å®žçŽ°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªçº¿æ€§è¡¨ã€‚åœ¨åˆ—è¡¨ä¸­æŸ¥æ‰¾å…ƒç´ å¯ä»¥ä½¿ç”¨ list.index() æ–¹æ³•ï¼Œå…¶æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚å¯¹äºŽå¤§æ•°æ®é‡ï¼Œåˆ™å¯ä»¥ç”¨äºŒåˆ†æŸ¥æ‰¾è¿›è¡Œä¼˜åŒ–ã€‚äºŒåˆ†æŸ¥æ‰¾è¦æ±‚å¯¹è±¡å¿…é¡»æœ‰åºï¼Œå…¶åŸºæœ¬åŽŸç†å¦‚ä¸‹ï¼š ä»Žæ•°ç»„çš„ä¸­é—´å…ƒç´ å¼€å§‹ï¼Œå¦‚æžœä¸­é—´å…ƒç´ æ­£å¥½æ˜¯è¦æŸ¥æ‰¾çš„å…ƒç´ ï¼Œåˆ™æœç´ è¿‡ç¨‹ç»“æŸï¼› å¦‚æžœæŸä¸€ç‰¹å®šå…ƒç´ å¤§äºŽæˆ–è€…å°äºŽä¸­é—´å…ƒç´ ï¼Œåˆ™åœ¨æ•°ç»„å¤§äºŽæˆ–å°äºŽä¸­é—´å…ƒç´ çš„é‚£ä¸€åŠä¸­æŸ¥æ‰¾ï¼Œè€Œä¸”è·Ÿå¼€å§‹ä¸€æ ·ä»Žä¸­é—´å…ƒç´ å¼€å§‹æ¯”è¾ƒã€‚ å¦‚æžœåœ¨æŸä¸€æ­¥éª¤æ•°ç»„ä¸ºç©ºï¼Œåˆ™ä»£è¡¨æ‰¾ä¸åˆ°ã€‚ äºŒåˆ†æŸ¥æ‰¾ä¹Ÿæˆä¸ºæŠ˜åŠæŸ¥æ‰¾ï¼Œç®—æ³•æ¯ä¸€æ¬¡æ¯”è¾ƒéƒ½ä½¿æœç´¢èŒƒå›´ç¼©å°ä¸€åŠï¼Œ å…¶æ—¶é—´å¤æ‚åº¦ä¸º O(logn)ã€‚ æˆ‘ä»¬åˆ†åˆ«ç”¨é€’å½’å’Œå¾ªçŽ¯æ¥å®žçŽ°äºŒåˆ†æŸ¥æ‰¾ï¼š 123456789101112131415161718192021222324def binary_search_loop(data_list, val): low = 0 high = len(data_list) - 1 while low &lt; high: mid = (low + high) // 2 if data_list[mid] == val: return mid elif data_list[mid] &gt; val: high = mid - 1 else: low = mid + 1 returndef binary_search_recursion(data_list, val, low, high): if high &lt; low: return mid = (low + high) // 2 if data_list[mid] == val: return mid elif data_list[mid] &lt; val: return binary_search_recursion(data_list, val, mid + 1, high) else: return binary_search_recursion(data_list, val, low, mid - 1) æŽ¥ç€å¯¹è¿™ä¸¤ç§å®žçŽ°è¿›è¡Œä¸€ä¸‹æ€§èƒ½æµ‹è¯•ï¼š 123456789101112131415161718192021if __name__ == '__main__': import random import timeit data_list = [random.randint(0, 100000) for _ in range(100000)] data_list.sort() def test_recursion(): binary_search_recursion(data_list, 999, 0, len(data_list) - 1) def test_loop(): binary_search(data_list, 999) t1 = timeit.Timer('test_recursion()', setup='from __main__ import test_recursion') t2 = timeit.Timer('test_loop()', setup='from __main__ import test_loop') print("Recursion: ", t1.timeit()) print("Loop: ", t2.timeit()) æ‰§è¡Œç»“æžœå¦‚ä¸‹ï¼š 12Recursion: 5.192518525994553Loop: 3.60416338798188 å¯ä»¥çœ‹å‡ºå¾ªçŽ¯æ–¹å¼æ¯”é€’å½’æ•ˆçŽ‡é«˜ã€‚ 2. bisectæ¨¡å— 2.1 ç”¨bisectæ¥æœç´¢å¹¶æ’å…¥bisect(haystack, needle)åœ¨haystackï¼ˆå¹²è‰åž›ï¼‰é‡Œæœç´¢needleï¼ˆé’ˆï¼‰çš„ä½ç½®ï¼Œè¯¥ä½ç½®æ»¡è¶³çš„æ¡ä»¶æ˜¯ï¼ŒæŠŠneedleæ’å…¥è¿™ä¸ªä½ç½®ä¹‹åŽï¼Œhaystackè¿˜èƒ½ä¿æŒå‡åºã€‚ ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªå‡½æ•°è¿”å›žçš„ä½ç½®å‰é¢çš„å€¼ï¼Œéƒ½å°äºŽæˆ–ç­‰äºŽneedleçš„å€¼ã€‚ å…¶ä¸­haystackå¿…é¡»æ˜¯ä¸€ä¸ªæœ‰åºçš„åºåˆ—ã€‚ ä½ å¯ä»¥å…ˆç”¨bisect(haystack, needle)æŸ¥æ‰¾ä½ç½®indexï¼Œå†ç”¨haystack.inset(index, needle)æ¥æ’å…¥æ–°å€¼ã€‚ä½†ä½ ä¹Ÿå¯ä»¥ç”¨insortæ¥ä¸€æ­¥åˆ°ä½ï¼Œå¹¶ä¸”åŽè€…é€Ÿåº¦æ›´å¿«ä¸€äº›ã€‚ ä¸¾ä¾‹ï¼š 123456789101112131415161718192021222324252627282930import bisectimport syshaystack = [1, 4, 5, 6, 8, 12, 15, 20, 21, 23, 23, 26, 29, 30]needles = [0, 1, 2, 5, 8, 10, 22, 23, 29, 30, 31]ROW_FMT = '&#123;0:2d&#125; @ &#123;1:2d&#125; &#123;2&#125;&#123;0:&lt;2d&#125;'def demo(bisect_fn): for needle in reversed(needles): # ç”¨ç‰¹å®šçš„bisectå‡½æ•°æ¥è®¡ç®—å…ƒç´ åº”è¯¥å‡ºçŽ°çš„ä½ç½® position = bisect_fn(haystack, needle) # åˆ©ç”¨è¯¥ä½ç½®æ¥ç®—å‡ºéœ€è¦å‡ ä¸ªåˆ†éš”ç¬¦å· offset = position * ' |' # æŠŠå…ƒç´ å’Œå…¶åº”è¯¥å‡ºçŽ°çš„ä½ç½®æ‰“å°å‡ºæ¥ print(ROW_FMT.format(needle, position, offset))if __name__ == '__main__': # æ ¹æ®å‘½ä»¤ä¸Šæœ€åŽä¸€ä¸ªå‚æ•°æ¥é€‰ç”¨bisectå‡½æ•° if sys.argv[-1] == 'left': bisect_fn = bisect.bisect_left else: bisect_fn = bisect.bisect # æŠŠé€‰å®šçš„å‡½æ•°åœ¨æŠ¬å¤´æ‰“å°å‡ºæ¥ print('DEMO:', bisect_fn.__name__) print('haystack -&gt;', ' '.join('%2d' % n for n in haystack)) demo(bisect_fn) 1234567891011121314C:\Users\Peng.Gao\Desktop\fluency_python\c2&gt;python bisect_demo.pyDEMO: bisecthaystack -&gt; 1 4 5 6 8 12 15 20 21 23 23 26 29 3031 @ 14 | | | | | | | | | | | | | |3130 @ 14 | | | | | | | | | | | | | |3029 @ 13 | | | | | | | | | | | | |2923 @ 11 | | | | | | | | | | |2322 @ 9 | | | | | | | | |2210 @ 5 | | | | |10 8 @ 5 | | | | |8 5 @ 3 | | |5 2 @ 1 |2 1 @ 1 |1 0 @ 0 0 bisectå‡½æ•°å…¶å®žæ˜¯bisect_rightå‡½æ•°çš„åˆ«åï¼ŒåŽè€…è¿˜æœ‰ä¸ªå§Šå¦¹å‡½æ•°å«bisect_leftã€‚ ä»–ä»¬çš„åŒºåˆ«åœ¨äºŽï¼Œbisect_leftè¿”å›žçš„æ’å…¥ä½ç½®æ˜¯åŽŸåºåˆ—ä¸­è·Ÿè¢«æ’å…¥å…ƒç´ ç›¸ç­‰çš„å…ƒç´ çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯æ–°å…ƒç´ ä¼šè¢«æ”¾ç½®äºŽä¸Žå®ƒç›¸ç­‰çš„å…ƒç´ çš„å‰é¢ï¼Œè€Œbisect_rightè¿”å›žçš„åˆ™æ˜¯è·Ÿå®ƒç›¸ç­‰çš„å…ƒç´ ä¹‹åŽçš„ä½ç½®ã€‚ è¿™ä¸ªç»†å¾®çš„å·®åˆ«å¯èƒ½å¯¹äºŽæ•´æ•°åºåˆ—æ¥è®²æ²¡ä»€ä¹ˆç”¨ï¼Œä½†æ˜¯å¯¹äºŽé‚£äº›å€¼ç›¸ç­‰ä½†æ˜¯å½¢å¼ä¸åŒçš„æ•°æ®ç±»åž‹æ¥è®²ï¼Œç»“æžœå°±ä¸ä¸€æ ·äº†ã€‚ æ¯”å¦‚è¯´è™½ç„¶1 == 1.0çš„è¿”å›žå€¼æ˜¯Trueï¼Œä½†1å’Œ1.0å…¶å®žæ˜¯ä¸¤ä¸ªä¸åŒçš„å…ƒç´ ã€‚ æˆ‘ä»¬è¯•è¯•ä½¿ç”¨bisect_leftæ¥è¿è¡Œä¸Šé¢çš„æ¨¡å—ï¼š 1234567891011121314C:\Users\Peng.Gao\Desktop\fluency_python\c2&gt;python bisect_demo.py leftDEMO: bisect_lefthaystack -&gt; 1 4 5 6 8 12 15 20 21 23 23 26 29 3031 @ 14 | | | | | | | | | | | | | |3130 @ 13 | | | | | | | | | | | | |3029 @ 12 | | | | | | | | | | | |2923 @ 9 | | | | | | | | |2322 @ 9 | | | | | | | | |2210 @ 5 | | | | |10 8 @ 4 | | | |8 5 @ 2 | |5 2 @ 1 |2 1 @ 0 1 0 @ 0 0 å¯¹æ¯”å¯ä»¥å‘çŽ°ï¼Œå€¼1ã€8ã€23ã€29å’Œ30çš„æ’å…¥ä½ç½®å˜æˆäº†åŽŸåºåˆ—ä¸­è¿™äº›å€¼çš„å‰é¢ã€‚ åˆ†æžå®ŒåŽï¼Œæ”¹é€ ä¸€ä¸‹å‡½æ•°ï¼Œè®©å®ƒç›´æŽ¥è¿”å›žæ’å…¥åŽçš„ç»“æžœï¼š 1234567891011121314151617181920import bisectimport syshaystack = [1, 4, 5, 6, 8.0, 12, 15, 20, 21, 23, 23, 26, 29, 30]needles = [0, 1, 2, 5, 8, 10, 22, 23, 29, 30, 31]def demo(bisect_fn): for needle in reversed(needles): position = bisect_fn(haystack, needle) haystack.insert(position, needle) return haystackif __name__ == '__main__': if sys.argv[-1] == 'left': bisect_fn = bisect.bisect_left else: bisect_fn = bisect.bisect print(demo(bisect_fn)) æ‰§è¡Œï¼š 1234567# 8åœ¨8.0åŽé¢C:\Users\Peng.Gao\Desktop\fluency_python\c2&gt;python bisect_demo.py[0, 1, 1, 2, 4, 5, 5, 6, 8.0, 8, 10, 12, 15, 20, 21, 22, 23, 23, 23, 26, 29, 29, 30, 30, 31]# 8åœ¨8.0å‰é¢C:\Users\Peng.Gao\Desktop\fluency_python\c2&gt;python bisect_demo.py left[0, 1, 1, 2, 4, 5, 5, 6, 8, 8.0, 10, 12, 15, 20, 21, 22, 23, 23, 23, 26, 29, 29, 30, 30, 31] bisectå¯ä»¥ç”¨æ¥å»ºç«‹ä¸€ä¸ªç”¨æ•°å­—ä½œä¸ºç´¢å¼•çš„æŸ¥è¯¢è¡¨æ ¼ï¼Œæ¯”å¦‚è¯´æŠŠåˆ†æ•°å’Œæˆç»©å¯¹åº”èµ·æ¥ï¼š 1234567891011import bisectdef grade(score, breakpoints=list(range(60, 100, 10)), grades='FDCBA'): i = bisect.bisect(breakpoints, score) return grades[i]if __name__ == '__main__': r = [grade(score) for score in [22, 33, 66, 88, 50, 70, 90, 100]] print(r) 2.2 ç”¨bisect.insortæ’å…¥æ–°å…ƒç´ æŽ’åºå¾ˆè€—æ—¶ï¼Œå› æ­¤åœ¨ç­‰åˆ°ä¸€ä¸ªæœ‰åºåºåˆ—ä¹‹åŽï¼Œæˆ‘ä»¬æœ€å¥½èƒ½ä¿æŒå®ƒçš„æœ‰åºã€‚ bisect.insortå°±æ˜¯ä¸ºäº†è¿™ä¸ªè€Œå­˜åœ¨çš„ã€‚ insort(seq, item)æŠŠå˜é‡itemæ’å…¥åˆ°åºåˆ—seqä¸­ï¼Œå¹¶èƒ½ä¿æŒseqçš„å‡åºé¡ºåºã€‚ 123456789101112import bisectimport randomSIZE = 7random.seed(1729)my_list = []for i in range(SIZE): new_item = random.randrange(SIZE*2) bisect.insort(my_list, new_item) print('%2d -&gt;' % new_item, my_list) è¾“å‡ºç»“æžœå¦‚ä¸‹ï¼š 123456710 -&gt; [10] 0 -&gt; [0, 10] 6 -&gt; [0, 6, 10] 8 -&gt; [0, 6, 8, 10] 7 -&gt; [0, 6, 7, 8, 10] 2 -&gt; [0, 2, 6, 7, 8, 10]10 -&gt; [0, 2, 6, 7, 8, 10, 10] insortå’Œbisectä¸€æ ·ä¹Ÿæœ‰ä¸ªå˜ä½“å«insort_leftï¼Œè¿™ä¸ªå˜ä½“åœ¨èƒŒåŽç”¨çš„æ˜¯bisect_leftã€‚ é™„ä¸Šä¸€ä¸ªinsortå’Œsortçš„æ‰§è¡Œæ—¶é—´æµ‹è¯•ï¼š 1234567891011121314151617181920212223242526272829303132333435363738import bisectimport randomimport timeitdef biscet_insort(list_1, size): random.seed(1729) for i in range(size): new_item = random.randrange(size * 2) bisect.insort(list_1, new_item) return list_1def list_sort(list_2, size): random.seed(1729) for i in range(size): new_item = random.randrange(size * 2) list_2.append(new_item) list_2.sort() return list_2if __name__ == '__main__': list_1, list_2 = [], [] size = 1000 def test_insort(): biscet_insort(list_1, size) def test_sort(): list_sort(list_2, size) t_1 = timeit.Timer('test_insort()', setup='from __main__ import test_insort') t_2 = timeit.Timer('test_sort()', setup='from __main__ import test_sort') print(t_1.timeit(number=100)) print(t_2.timeit(number=100)) æ‰§è¡Œç»“æžœå¦‚ä¸‹ï¼š 121.357789898457706685.78586909665677]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Pythonæ¨¡å—</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Pythonç”±åˆ—è¡¨ç»„æˆçš„åˆ—è¡¨ä¸­æ³¨æ„çš„é—®é¢˜]]></title>
    <url>%2F2018%2F06%2F20%2FPython%E7%94%B1%E5%88%97%E8%A1%A8%E7%BB%84%E6%88%90%E7%9A%84%E5%88%97%E8%A1%A8%E4%B8%AD%E6%B3%A8%E6%84%8F%E7%9A%84%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦åˆå§‹åŒ–ä¸€ä¸ªåµŒå¥—ç€å‡ ä¸ªåˆ—è¡¨çš„åˆ—è¡¨ã€‚ æœ€å¥½çš„é€‰æ‹©æ˜¯ä½¿ç”¨åˆ—è¡¨æŽ¨å¯¼ï¼š 12345&gt;&gt;&gt; board = [['-'] * 3 for i in range(3)][['-', '-', '-'], ['-', '-', '-'], ['-', '-', '-']]&gt;&gt;&gt; board[1][2] = 'X'&gt;&gt;&gt; board[['-', '-', '-'], ['-', '-', 'X'], ['-', '-', '-']] è¿˜æœ‰ä¸€ç§çœ‹ä¸ŠåŽ»æ˜¯ä¸ªæœ‰äººçš„æ·å¾„ï¼Œä½†å®žé™…ä¸Šæ˜¯é”™è¯¯çš„ï¼š 123456&gt;&gt;&gt; board = [['-'] * 3] * 3&gt;&gt;&gt; board[['-', '-', '-'], ['-', '-', '-'], ['-', '-', '-']]&gt;&gt;&gt; board[1][2] = 'X'&gt;&gt;&gt; board[['-', '-', 'X'], ['-', '-', 'X'], ['-', '-', 'X']] é”™è¯¯çš„åœ°æ–¹åœ¨äºŽï¼šç¬¬äºŒç§æ–¹æ³•æœ€ç»ˆç”Ÿæˆçš„åˆ—è¡¨å…¶å®žåŒ…å«3ä¸ªæŒ‡å‘ç”¨ä¸€ä¸ªåˆ—è¡¨çš„å¼•ç”¨ã€‚æˆ‘ä»¬ä¸åšä¿®æ”¹çš„æ—¶å€™ï¼Œçœ‹èµ·æ¥è¿˜å¥½ï¼Œä¸€æ—¦æˆ‘ä»¬è¯•å›¾ä¿®æ”¹å…¶ä¸­åŒ…å«çš„æŸä¸€ä¸ªåˆ—è¡¨ä¸­çš„å…ƒç´ æ—¶ï¼Œå°±æš´éœ²äº†åˆ—è¡¨å†…çš„3ä¸ªå¼•ç”¨æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡çš„äº‹å®žã€‚ å¦‚å›¾ï¼š åˆ—è¡¨æŽ¨å¯¼ç”Ÿæˆåˆ—è¡¨ï¼š ä½¿ç”¨*ä¾¿æ·ç”Ÿæˆåˆ—è¡¨ï¼š]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Pythonä¸­__name__ == '__main__'çš„ä½œç”¨]]></title>
    <url>%2F2018%2F06%2F20%2FPython%E4%B8%AD__name__%20%3D%20__main__%E7%9A%84%E4%BD%9C%E7%94%A8%2F</url>
    <content type="text"><![CDATA[åŽŸç† å­¦ä¹ pythonçš„è¿‡ç¨‹ä¸­é‡è§äº†if __name__ = = â€˜__main__â€™æ¡ä»¶åˆ¤æ–­ã€‚ ä¸æ˜Žç™½å…¶ä½œç”¨ï¼ŒåŽ»ç½‘ä¸ŠæŸ¥äº†ä¸€ä¸‹ã€‚ ç½‘ä¸Šæœ‰ä¸€å¥è¯æ¦‚æ‹¬äº†è¿™æ®µä»£ç çš„å«ä¹‰ï¼š è®©ä½ å†™çš„è„šæœ¬æ¨¡å—æ—¢å¯ä»¥å¯¼å…¥åˆ°åˆ«çš„æ¨¡å—ä¸­ç”¨ï¼Œå¦å¤–è¯¥æ¨¡å—è‡ªå·±ä¹Ÿå¯æ‰§è¡Œã€‚ æˆ‘ä»¬æ€Žä¹ˆåŽ»ç†è§£å®ƒå‘¢ï¼Ÿ å…¶å®žå¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦å¼„æ¸…æ¥š2ç‚¹ï¼š æ‰§è¡Œpythonæ¨¡å—æ—¶ï¼Œä¹Ÿä¼šæ‰§è¡Œå…¶ä¸­æ‰€importçš„æ¨¡å— __name__æ˜¯pythonå†…ç½®çš„å…¨å±€å˜é‡ï¼Œå…¨å±€å˜é‡__name__å­˜æ”¾çš„æ˜¯æ¨¡å—çš„åå­—ã€‚ å¦‚æžœå½“å‰æ¨¡å—æ˜¯ä¸»æ¨¡å—æˆ–è€…ç›´æŽ¥è¢«æ‰§è¡Œæ—¶ï¼Œæ­¤æ—¶æ¨¡å—çš„__name__å˜é‡å°±æ˜¯__main__ï¼Œå¦‚æžœå½“å‰æ¨¡å—è¢«å…¶ä»–æ¨¡å—è°ƒç”¨ï¼Œåˆ™å½“å‰æ¨¡å—çš„__name__å°±æ˜¯è¯¥æ¨¡å—çš„åå­—ã€‚ æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜Žï¼š æƒ…å†µä¸€ï¼šç›´æŽ¥æ‰§è¡Œå½“å‰æ¨¡å—æ—¶ æ–°å»ºä¸€ä¸ªtest_name_1.pyæ¨¡å—ï¼š 12# test_name_1.pyprint(__name__) è¾“å‡ºä¸ºï¼š 1__main__ ç»§ç»­æ‰©å±•ï¼š 12345678# test_name_1.pydef test(): print('__name__=', __name__) print(__name__ == '__main__')if __name__ == '__main__': print("Test:") test() æ‰§è¡Œtest_name_1.pyæ—¶ï¼Œè¾“å‡ºä¸ºï¼š 123Test:__name__= __main__True ä¹Ÿå°±æ˜¯è¯´ å½“ä½ ç›´æŽ¥æ‰§è¡Œtest_name_1.pyæ—¶ï¼Œif __name__ == __main__æˆç«‹ï¼Œæ­¤æ—¶å°±ä¼šæ‰§è¡Œifè¯­å¥é‡Œé¢çš„ä»£ç ã€‚ æƒ…å†µäºŒï¼š è¢«å…¶ä»–æ¨¡å—å¯¼å…¥å¹¶æ‰§è¡Œæ—¶ æˆ‘ä»¬æ–°å»ºä¸€ä¸ªtest_name_2.pyæ¨¡å—ï¼š 1234# test_name_2.pyimport test_name_1 as tn1tn1.test() è¾“å‡ºä¸ºï¼š 12__name__= test_name_1False æ³¨æ„ï¼Œæ­¤æ—¶è°ƒç”¨test_name_1æ¨¡å—æ—¶ï¼Œ__name__å°±å‘ç”Ÿäº†å˜åŒ–ï¼Œå˜æˆäº†test_name_1çš„æ¨¡å—åï¼Œè€Œä¸æ˜¯â€™__main__äº†â€™ã€‚ æ‰€ä»¥æ‰§è¡Œtest_name_2.pyæ—¶ï¼Œæ‰§è¡Œå…¶ä¸­importå¯¼å…¥çš„æ¨¡å—test_name_1.pyæ—¶ï¼Œif __name__ == __main__ä¸æˆç«‹ï¼Œæ­¤æ—¶å°±ä¸ä¼šæ‰§è¡Œifè¯­å¥é‡Œé¢çš„ä»£ç ã€‚ åº”ç”¨åœºæ™¯ åŠ ä¸Šif __name__ == â€˜__main__â€™ åº”ç”¨äºŽä»€ä¹ˆåœºæ™¯ï¼Ÿ æˆ‘ä»¬æƒ³æŽ’æŸ¥é—®é¢˜çš„æ—¶å€™é€šå¸¸ä¼šåœ¨æ¨¡å—ä¸‹é¢åŠ å…¥ä¸€äº›æˆ‘ä»¬è°ƒè¯•çš„ä»£ç ï¼Œæˆ‘ä¹‹å‰æ˜¯è¿™æ ·åšçš„ï¼š 12345678# test_name_1.pydef test(): print('__name__=', __name__) print(__name__ == '__main__')print('Test:')test() ç›´æŽ¥æ‰§è¡Œtest_name_1.pyæ—¶ï¼Œè¾“å‡ºç»“æžœå’ŒåŠ ä¸Šif __name == â€˜__main__â€™ç›¸åŒï¼š 123Test:__name__= __main__True ä½†æ˜¯è¿™æ ·åšæœ‰ä¸ªå¾ˆå¤§çš„å¼Šç«¯ï¼š å½“ä½ ä»Žå¦å¤–ä¸€ä¸ªæ¨¡å—å¯¼å…¥æ­¤æ¨¡å—æ—¶ï¼Œæ‰§è¡Œå¦å¤–ä¸€ä¸ªæ¨¡å—æ—¶ï¼Œä¹Ÿä¼šæ‰§è¡Œè¢«å¯¼å…¥çš„æ¨¡å—ã€‚ æ¯”å¦‚æˆ‘ä»¬æ–°å»ºä¸€ä¸ªtest_name_2.py 12# test_name_2.pyimport test_name_1 as tn1 æ‰§è¡Œtest_name_2.pyæ—¶ï¼Œå°±ä¼šå‡ºçŽ°ä¸€äº›æˆ‘åœ¨test_name_1.pyåŠ å…¥çš„è°ƒè¯•ä»£ç ï¼š 123test:__name__= test_name_1False æ­¤æ—¶ï¼Œå¦‚æžœä¸æƒ³åˆ é™¤è°ƒè¯•ä»£ç æ–¹ä¾¿ä»¥åŽçš„è°ƒè¯•ï¼Œå°±éœ€è¦æŠŠè°ƒè¯•ä»£ç æ”¾åœ¨if __name__ == __main__å½“ä¸­äº†ã€‚ é€šè¿‡è¿™ä¸ªç‰¹æ€§å¯ä»¥åœ¨ifè¯­å¥é‡Œé¢æ·»åŠ æµ‹è¯•ä»£ç ï¼Œæ–¹ä¾¿åŽç»­çš„æµ‹è¯•ã€‚]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Pythonå­—ç¬¦ä¸²æ ¼å¼åŒ–-å ä½ç¬¦ä¸Žformatç”¨æ³•]]></title>
    <url>%2F2018%2F06%2F18%2FPython%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F%E5%8C%96-%E5%8D%A0%E4%BD%8D%E7%AC%A6%E4%B8%8Eformat%E7%94%A8%E6%B3%95%2F</url>
    <content type="text"><![CDATA[å­—ç¬¦ä¸²æ ¼å¼åŒ–æ–¹æ³•åˆ†ä¸ºä¸¤ç§ï¼šå ä½ç¬¦ï¼ˆ%ï¼‰å’Œstr.formatæ–¹å¼ã€‚ å ä½ç¬¦æ–¹å¼åœ¨python2.xä¸­ç”¨çš„æ¯”è¾ƒå¹¿æ³›ï¼Œéšç€python3.xçš„ä½¿ç”¨è¶Šæ¥è¶Šå¹¿ï¼Œstr.formatæ–¹å¼ä½¿ç”¨çš„æ›´åŠ å¹¿æ³›ã€‚ ä¸ªäººæ¥è®²æˆ‘æ›´å–œæ¬¢str.formatï¼Œä½†æ˜¯å¤§éƒ¨åˆ†æ•™ç¨‹è¿˜ä½¿ç”¨%ã€‚ 1 å ä½ç¬¦ï¼ˆ%ï¼‰ æ ¼å¼ æè¿° %% ç™¾åˆ†å·æ ‡è®° %c å­—ç¬¦åŠASCIIç  %s å­—ç¬¦ä¸²ï¼ˆstrï¼‰ %r å­—ç¬¦ä¸²ï¼ˆreprï¼‰ %d æœ‰ç¬¦å·æ•´æ•°ï¼ˆåè¿›åˆ¶ï¼‰ %u æ— ç¬¦å·æ•´æ•°ï¼ˆåè¿›åˆ¶ï¼‰ %o æ— ç¬¦å·æ•´æ•°ï¼ˆå…«è¿›åˆ¶ï¼‰ %x æ— ç¬¦å·æ•´æ•°ï¼ˆåå…­è¿›åˆ¶ï¼‰ %X æ— ç¬¦å·æ•´æ•°ï¼ˆåå…­è¿›åˆ¶å¤§å†™å­—ç¬¦ï¼‰ %e æµ®ç‚¹æ•°å­—ï¼ˆç§‘å­¦è®¡æ•°æ³•ï¼‰ %E æµ®ç‚¹æ•°å­—ï¼ˆç§‘å­¦è®¡æ•°æ³•ï¼Œç”¨Eä»£æ›¿eï¼‰ %f æµ®ç‚¹æ•°å­—ï¼ˆç”¨å°æ•°ç‚¹ç¬¦å·ï¼‰ %g æµ®ç‚¹æ•°å­—ï¼ˆç”¨æ ¹æ®å€¼çš„å¤§å°é‡‡ç”¨%eæˆ–%fï¼‰ %G æµ®ç‚¹æ•°å­—ï¼ˆç±»ä¼¼äºŽ%gï¼‰ %p æŒ‡é’ˆï¼ˆç”¨åå…­è¿›åˆ¶æ‰“å°å€¼çš„å†…å­˜åœ°å€ï¼‰ %n å­˜å‚¨è¾“å‡ºå­—ç¬¦çš„æ•°é‡æ”¾è¿›å‚æ•°åˆ—è¡¨çš„ä¸‹ä¸€ä¸ªå˜é‡ä¸­ 1234567891011121314151617&gt;&gt;&gt; age = 25&gt;&gt;&gt; print("My age is %d" %age)My age is 25&gt;&gt;&gt; print("My name is %s" %name)My name is gao&gt;&gt;&gt; x, y = 2, 4&gt;&gt;&gt; print('Vector(%r, %r)' % (x, y))Vector(2, 4)&gt;&gt;&gt; print('%6.3f' % 2.3) 2.300&gt;&gt;&gt; print('%.3f' % 2.3)2.300&gt;&gt;&gt; print('%f' % 2.3)2.300000 2 formatæ–¹æ³• 2.1 æ˜ å°„ ä½ç½®æ˜ å°„ 123&gt;&gt;&gt; name = 'gao'&gt;&gt;&gt; print('&#123;&#125;,&#123;&#125;!'.format('hello', name))hello,gao! å…³é”®å­—æ˜ å°„ 12&gt;&gt;&gt; print('&#123;name&#125; is &#123;age&#125; years old.'.format(age=25, name='gao'))gao is 25 years old. å…ƒç´ è®¿é—® 123456&gt;&gt;&gt; metro_areas = ('Tokyo', 'JP', 36.933, (35.689722, 139.691667))&gt;&gt;&gt; '&#123;0[0]&#125; | &#123;0[3][0]&#125; | &#123;0[3][1]&#125;'.format(metro_areas)'Tokyo | 35.689722 | 139.691667'&gt;&gt;&gt; '&#123;1[0]&#125;:&#123;0[1]&#125;'.format((1, 2), [3, 4])'3:2' 2.2 æŒ‡å®šæ ¼å¼ç»“åˆâ€™:â€™ä½¿ç”¨ æŒ‡å®šç²¾åº¦ f 1234&gt;&gt;&gt; '&#123;:.4f&#125;'.format(40.808611)'40.8086'&gt;&gt;&gt; '&#123;:9.4f&#125;'.format(40.808611)' 40.8086' æŒ‡å®šè¿›åˆ¶ bã€dã€oã€xã€åˆ†åˆ«è¡¨ç¤ºäºŒè¿›åˆ¶ã€åè¿›åˆ¶ã€å…«è¿›åˆ¶ã€åå…­è¿›åˆ¶ 1234567&gt;&gt;&gt; '&#123;:b&#125;'.format(25)'11001'&gt;&gt;&gt; '&#123;:d&#125;'.format(25)'25'&gt;&gt;&gt; '&#123;:x&#125;'.format(25)'19'&gt;&gt;&gt; '&#123;:o&#125;'.format(25) æŒ‡å®šå¯¹å…¶æ–¹å¼^ã€&lt;ã€&gt;åˆ†åˆ«è¡¨ç¤ºå±…ä¸­ã€å·¦å¯¹é½ã€å³å¯¹é½ã€‚åŽé¢å¸¦å®½åº¦ï¼Œé»˜è®¤ç”¨â€™ â€˜å¡«å……ï¼Œå¯æŒ‡å®šå¡«å……æ–¹å¼ã€‚ 12&gt;&gt;&gt; print('&#123;:-&lt;15&#125; | &#123;:*^9&#125; | &#123;:&gt;9&#125;'.format('', 'lat', 'long'))--------------- | ***lat*** | long æ³¨ï¼šå¡«å……å¿…é¡»å’Œå¯¹å…¶æ–¹å¼ç»“åˆä½¿ç”¨ 2.3 å®šä¹‰å¯¹è±¡å±žæ€§1234567891011&gt;&gt;&gt; class Person:... def __init__(self, name, age):... self.name = name... self.age = age... def __str__(self):... return '&#123;self.name&#125; is &#123;self.age&#125;'.format(self=self)...&gt;&gt;&gt; Person('gao', 25)&lt;__main__.Person object at 0x000002708A0C24E0&gt;&gt;&gt;&gt; str(Person('gao', 25))'gao is 25']]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Djangoå­¦ä¹ ç¬”è®° - 4 APIä¸ŽåŽå°ç®¡ç†]]></title>
    <url>%2F2018%2F06%2F17%2FDjango%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-4-API%E4%B8%8E%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%2F</url>
    <content type="text"><![CDATA[1. API 1.1 åˆè¯•APIçŽ°åœ¨è®©æˆ‘ä»¬è¿›å…¥äº¤äº’å¼ Python å‘½ä»¤è¡Œï¼Œå°è¯•ä¸€ä¸‹ Django ä¸ºä½ åˆ›å»ºçš„å„ç§ APIã€‚é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ‰“å¼€ Python å‘½ä»¤è¡Œï¼š 1python manage.py shell æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªå‘½ä»¤è€Œä¸æ˜¯ç®€å•çš„ä½¿ç”¨ â€œPythonâ€ æ˜¯å› ä¸º manage.py ä¼šè®¾ç½® DJANGO_SETTINGS_MODULE çŽ¯å¢ƒå˜é‡ï¼Œè¿™ä¸ªå˜é‡ä¼šè®© Django æ ¹æ® mysite/settings.pyæ–‡ä»¶æ¥è®¾ç½® Python åŒ…çš„å¯¼å…¥è·¯å¾„ã€‚ 1234567891011121314151617181920212223242526272829# å¯¼å…¥æˆ‘ä»¬åˆšå†™çš„æ¨¡åž‹ç±»&gt;&gt;&gt; from polls.models import Choice, Question# ç³»ç»Ÿä¸­ç›®å‰æ²¡æœ‰é—®é¢˜&gt;&gt;&gt; Question.objects.all()&lt;QuerySet []&gt;# åˆ›å»ºä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯é€šè¿‡ç±»æ¥åˆ›å»ºå¯¹è±¡# å¦‚æžœä½ æƒ³è®¾ç½®æˆä¸­å›½æ—¶åŒºï¼Œåœ¨settings.pyæ–‡ä»¶ä¸­æŠŠUSE_TZè®¾ç½®ä¸ºFalseï¼ŒTIME_ZONEè®¾ç½®ä¸º'Asia/Shanghai'&gt;&gt;&gt; from django.utils import timezone&gt;&gt;&gt; q = Question(question_text="What's new?", pub_date=timezone.now())# å°†å¯¹è±¡ä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œsave()æ–¹æ³•ç”¨äºŽåˆ›å»ºå’Œæ›´æ–°å¯¹è±¡ã€‚&gt;&gt;&gt; q.save()# ç¬¬ä¸€æ¬¡ä¿å­˜å¯¹è±¡åŽï¼ŒDjangoä¼šä¸ºQuestionå®žä¾‹åˆ›å»ºä¸€ä¸ªID&gt;&gt;&gt; q.id1# æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡pythonå±žæ€§æ¥è®¿é—®å…¶ä»–çš„æ¨¡åž‹å­—æ®µå€¼&gt;&gt;&gt; q.question_text"What's new?"&gt;&gt;&gt; q.pub_datedatetime.datetime(2018, 6, 11, 14, 33, 13, 469975)# é€šè¿‡æ›´æ”¹å±žæ€§æ¥æ›´æ”¹å­—æ®µå€¼ï¼Œå¹¶ä½¿ç”¨save()æ¥æ›´æ–°&gt;&gt;&gt; q.question_text = "What's up?"&gt;&gt;&gt; q.save()&gt;&gt;&gt; Question.objects.all()&lt;QuerySet [&lt;Question: Question object (1)&gt;]&gt; ç­‰ç­‰ã€‚\&lt;Question: Question object (1)> å¯¹äºŽæˆ‘ä»¬äº†è§£è¿™ä¸ªå¯¹è±¡çš„ç»†èŠ‚æ²¡ä»€ä¹ˆå¸®åŠ©ã€‚è®©æˆ‘ä»¬é€šè¿‡ç¼–è¾‘ Question æ¨¡åž‹çš„ä»£ç ï¼ˆä½äºŽ polls/models.py ä¸­ï¼‰æ¥ä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚ç»™ Question å’Œ Choice å¢žåŠ  str() æ–¹æ³•ã€‚ __str__æ–¹æ³•æ˜¯å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æè¿°å±žæ€§æ¥è¡¨ç¤ºå®ƒã€‚ 12345678910111213# åˆ›å»ºä¸€ä¸ªé—®é¢˜ç±»åž‹class Question(models.Model): ... def __str__(self): return self.question_text # åˆ›å»ºä¸€ä¸ªè§£å†³æ–¹æ¡ˆç±»åž‹class Choice(models.Model): ... def __str__(self): return self.choice_text ä¿å­˜æ–‡ä»¶åŽå†æ¬¡æ‰“å¼€pythonäº¤äº’å¼å‘½ä»¤è¡Œï¼š 12345678910111213141516171819202122&gt;&gt;&gt; from polls.models import Choice, Question&gt;&gt;&gt; Question.objects.all()&lt;QuerySet [&lt;Question: What's up?&gt;]&gt; # Djangoæä¾›äº†ç”±å…³é”®å­—å‚æ•°æ¥æŸ¥æ‰¾æ•°API&gt;&gt;&gt; Question.objects.filter(id=1)&lt;QuerySet [&lt;Question: What's up?&gt;]&gt;&gt;&gt;&gt; Question.objects.filter(question_text__startswith='What')&lt;QuerySet [&lt;Question: What's up?&gt;]&gt;# èŽ·å–ä»Šå¹´å‘å¸ƒçš„é—®é¢˜&gt;&gt;&gt; Question.objects.filter(question_text__startswith='What')&lt;QuerySet [&lt;Question: What's up?&gt;]&gt; # å½“ä½ è¯·æ±‚ä¸€ä¸ªä¸å­˜åœ¨çš„IDæ—¶ï¼Œä¼šå¼•å‘å¼‚å¸¸Traceback (most recent call last): ...polls.models.DoesNotExist: Question matching query does not exist.# é€šè¿‡ä¸»é”®æŸ¥æ‰¾æ˜¯æœ€å¸¸è§çš„æƒ…å†µï¼ŒDjangoæä¾›äº†ä¸»é”®ç²¾å‡†æŸ¥æ‰¾çš„æ–¹æ³•&gt;&gt;&gt; Question.objects.get(pk=1)&lt;Question: What's up?&gt; æˆ‘ä»¬ç»™è¿™ä¸ªé—®é¢˜æä¾›å‡ ä¸ªé€‰é¡¹ï¼Œè°ƒç”¨create()æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„Choiceå¯¹è±¡ã€‚ 12345678910111213141516171819202122232425262728# é€šè¿‡å­—æ®µæ ‡è¯†èŽ·å–å•ä¸ªå¯¹è±¡&gt;&gt;&gt; q = Question.objects.get(pk=1)# ç›®å‰è¿™ä¸ªé—®é¢˜è¿˜æ²¡æœ‰é€‰é¡¹&gt;&gt;&gt; q.choice_set.all()&lt;QuerySet []&gt;# åˆ›å»º3ä¸ªé€‰é¡¹&gt;&gt;&gt; q.choice_set.create(choice_text='Not much', votes=0)&gt;&gt;&gt; q.choice_set.create(choice_text='The sky', votes=0)&gt;&gt;&gt; c = q.choice_set.create(choice_text='Just hacking again', votes=0)# Choiceå¯¹è±¡æœ‰å’Œå®ƒç›¸å…³è”çš„Questionå¯¹è±¡çš„è®¿é—®æƒé™&gt;&gt;&gt; c.question&lt;Question: What's up?&gt;# åä¹‹äº¦ç„¶ï¼ŒQuestionå¯¹è±¡ä¹Ÿå¯ä»¥è®¿é—®Choiceå¯¹è±¡&gt;&gt;&gt; q.choice_set.all()&lt;QuerySet [&lt;Choice: Not much&gt;, &lt;Choice: The sky&gt;, &lt;Choice: Just hacking again&gt;]&gt;# æŸ¥æ‰¾ä»Šå¹´å‘å¸ƒé—®é¢˜çš„æ‰€æœ‰é€‰é¡¹ï¼Œä½¿ç”¨åŒä¸‹åˆ’çº¿æ¥åˆ†éš”å…³ç³»ã€‚# æˆ‘ä»¬ä¼šé‡ç”¨ä¸Šé¢ä½¿ç”¨çš„current_yearå˜é‡&gt;&gt;&gt; Choice.objects.filter(question__pub_date__year=current_year)&lt;QuerySet [&lt;Choice: Not much&gt;, &lt;Choice: The sky&gt;, &lt;Choice: Just hacking again&gt;]&gt;# ä½¿ç”¨delete()åˆ é™¤å…¶ä¸­ä¸€ä¸ªé€‰é¡¹ã€‚&gt;&gt;&gt; c = q.choice_set.filter(choice_text__startswith='Just hacking')&gt;&gt;&gt; c.delete() 1.2 æ•°æ®åº“APIæ•´ç†1.2.1 åˆ›å»ºå¯¹è±¡123456789# æ–¹æ³•ä¸€&gt;&gt;&gt; Question.objects.create(question_text="What's up?", pub_date=timezone.now())# æ–¹æ³•äºŒ&gt;&gt;&gt; q = Question(question_text="What'upï¼Ÿ", pub_date=timezone.now())&gt;&gt;&gt; q.save()# æ–¹æ³•ä¸‰ï¼Œå…ˆå°è¯•èŽ·å–ï¼Œä¸å­˜åœ¨å°±åˆ›å»ºï¼ˆè¿”å›žTrueï¼‰ï¼Œå­˜åœ¨æ—¶ä¸åˆ›å»º(è¿”å›žFalse)ã€‚&gt;&gt;&gt; Question.objects.get_or_create(question_text="What's up?", pub_date=timezone.now()) å½“ä½ åˆ›å»ºæœ‰å…³è”çš„å¯¹è±¡æ—¶(ForeignKeyã€OneToOneFieldã€ManyToManyFieldï¼‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆèŽ·å–ä¸Žä¹‹ç›¸å…³è”çš„å¯¹è±¡ã€‚æˆ‘ä»¬è¿™æ ·æ¥åˆ›å»ºï¼š 123456789101112# æ–¹æ³•ä¸€ï¼š&gt;&gt;&gt; q = Question.objects.get(pk=1)&gt;&gt;&gt; Choice.objects.create(question=q, Choice_text="Not much", votes=0)# æ–¹æ³•äºŒï¼š&gt;&gt;&gt; q = Question.objects.get(pk=1)&gt;&gt;&gt; c = Choice(question=q, Choice_text="Not much", votes=0)&gt;&gt;&gt; c.save()# æ–¹æ³•ä¸‰ï¼š&gt;&gt;&gt; q = Question.objects.get(pk=1)&gt;&gt;&gt; Choice.objects.get_or_create(question=q, Choice_text="Not much", votes=0) Django æä¾›äº†ä¸€ä¸ªæ›´å¿«æ·çš„APIæ¥åˆ›å»ºå¯¹è±¡ï¼š 1234567# æ–¹æ³•ä¸€&gt;&gt;&gt; q = Question.objects.get(pk=1)&gt;&gt;&gt; q.choice_set.create(choice_text='Not much', votes=0)# æ–¹æ³•äºŒ,å…ˆå°è¯•èŽ·å–ï¼Œä¸å­˜åœ¨å°±åˆ›å»ºï¼ˆè¿”å›žTrueï¼‰ï¼Œå­˜åœ¨æ—¶ä¸åˆ›å»º(è¿”å›žFalse)ã€‚&gt;&gt;&gt; q = Question.objects.get(pk=1)&gt;&gt;&gt; q.choice_set.get_or_create(choice_text='Not much', votes=0 1.2.2 æ›´æ”¹å¯¹è±¡æˆ‘ä»¬ä½¿ç”¨save()æ¥ä¿å­˜å·²ç»å­˜åœ¨äºŽæ•°æ®åº“ä¸­çš„å¯¹è±¡çš„æ›´æ”¹ï¼š 123&gt;&gt;&gt; q = Question.objects.get(pk=1)&gt;&gt;&gt; q.question_text = "What's new?"&gt;&gt;&gt; q.save ä½¿ç”¨update()æ‰¹é‡æ›´æ”¹å¯¹è±¡ï¼š 12# å°†æ‰€æœ‰2018å¹´6æœˆ12å·å‘å¸ƒçš„é—®é¢˜æè¿°å…¨éƒ¨æ”¹ä¸º"What"&gt;&gt;&gt; Question.objects.filter(pub_date__year=2018, pub_date__month=6, pub_date__day=12).update(question_text='What') æ‰¹é‡æ›´æ–°å¯¹è±¡ä¸éœ€è¦æ‰§è¡Œsave()å°±å·²ç»ä¿å­˜è‡³æ•°æ®åº“ï¼Œéœ€è°¨æ…Žæ“ä½œã€‚ 1.2.3 èŽ·å–å¯¹è±¡1234567891011121314151617181920# èŽ·å–æ‰€æœ‰å¯¹è±¡&gt;&gt;&gt; Question.objects.all()# èŽ·å–å•ä¸ªå¯¹è±¡ï¼Œpkä»£è¡¨ä¸»é”®ï¼Œä¸»é”®çš„å­—æ®µæ˜¯IDï¼Œæ‰€ä»¥ä¸‹é¢2ä¸ªè¯­å¥æ˜¯ç­‰ä»·çš„&gt;&gt;&gt; Question.objects.get(pk=1)&gt;&gt;&gt; Question.objects.get(id=1)# ä½¿ç”¨filterè¿‡æ»¤å™¨èŽ·å–ç‰¹å®šå¯¹è±¡# filter(**kwargs)ï¼šè¿”å›žåŒ¹é…ç»™å®šçš„æŸ¥æ‰¾å‚æ•°çš„å¯¹è±¡# èŽ·å–idç­‰äºŽ1çš„é—®é¢˜&gt;&gt;&gt; Question.objects.filter(id=1)# èŽ·å–å‘å¸ƒæ—¶é—´ä¸º2018å¹´çš„é—®é¢˜&gt;&gt;&gt; Question.objects.filter(pub_date__year=2018)# ä½¿ç”¨excludeè¿‡æ»¤å™¨èŽ·å–ç‰¹å®šå¯¹è±¡# exclude(**kwargs)ï¼šè¿”å›žä¸Žç»™å®šçš„æŸ¥æ‰¾å‚æ•°ä¸åŒ¹é…çš„å¯¹è±¡# èŽ·å–idä¸ç­‰äºŽ1ä¹‹å¤–çš„æ‰€æœ‰é—®é¢˜&gt;&gt;&gt; Question.objects.exclude(id=1)# èŽ·å–é™¤2018å¹´ä¹‹å¤–æ‰€æœ‰å‘å¸ƒçš„é—®é¢˜&gt;&gt;&gt; Question.objects.exclude(pub_date__year=2018) å½“ä½ èŽ·å–ä¸Žå…¶ä»–å¯¹è±¡æœ‰å…³è”çš„å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è·¨è¶Šå…³ç³»æŸ¥æ‰¾ã€‚åªéœ€ä½¿ç”¨æ¨¡åž‹ä¸­ç›¸å…³å­—æ®µçš„å­—æ®µåç§°ç”¨åŒä¸‹åˆ’çº¿åˆ†éš”å³å¯ï¼š 123456# èŽ·å–é—®é¢˜IDä¸º6çš„æ‰€æœ‰é€‰é¡¹ï¼Œå†æ¬¡å¼ºè°ƒpkä¸ºä¸»é”®ï¼Œidæ˜¯ä¸»é”®å­—æ®µ&gt;&gt;&gt; Choice.objects.filter(question__id=1)&gt;&gt;&gt; Choice.objects.filter(question__pk=1)# åå‘æŸ¥æ‰¾ï¼ŒèŽ·å–é€‰é¡¹å¼€å¤´ä¸º"not"(ä¸åŒºåˆ†å¤§å°å†™)çš„æ‰€æœ‰é—®é¢˜&gt;&gt;&gt; Question.objects.filter(choice__choice_text__istartswith='not') é“¾æŽ¥è¿‡æ»¤å™¨ï¼š 12345678# èŽ·å–åŒæ—¶æ»¡è¶³å‘å¸ƒæ—¶é—´ä¸º2018ã€å†…å®¹å¼€å¤´ä¸ºâ€œWhatâ€å¹¶ä¸”ä¸æ˜¯å·²â€œ?â€ç»“å°¾çš„çš„é—®é¢˜&gt;&gt;&gt; Question.objects.filter(... question_text__startswith='What'... ).filter(... pub_date__year=2018... ).exclude(... question_text__endswith='?'... ) QuerySetï¼ˆæŸ¥è¯¢é›†ï¼‰æ˜¯æƒ°æ€§æ‰§è¡Œçš„ï¼Œåˆ›å»ºæŸ¥è¯¢é›†ä¸ä¼šå¸¦æ¥ä»»ä½•æ•°æ®åº“çš„è®¿é—®ï¼Œç›´åˆ°æŸ¥è¯¢é›†å†™å®ŒåŽéœ€è¦æ±‚å€¼æ—¶ï¼Œæ‰ä¼šåŽ»è®¿é—®æ•°æ®åº“ã€‚ä¾‹å¦‚ï¼š 12345&gt;&gt;&gt; q = Question.objects.filter(question_text__startswith='What')&gt;&gt;&gt; q.filter(pub_date__year=2018)&gt;&gt;&gt; q.exclude(question_text__endswith='?')# ç›´åˆ°ä½ éœ€è¦èŽ·å–å€¼æ—¶ï¼Œæ‰ä¼šåŽ»è®¿é—®æ•°æ®åº“&gt;&gt;&gt; print(q) å¸¸ç”¨ç­›é€‰æ¡ä»¶ï¼š å¤§äºŽã€å¤§äºŽç­‰äºŽï¼š__gt ï¼Œ __gte å°äºŽã€å°äºŽç­‰äºŽï¼š__ltï¼Œ __lte ç²¾å‡†åŒ¹é…ï¼š__exactï¼Œ __iexact åŒ…å«ï¼š__containsï¼ˆä¸å¿½ç•¥å¤§å°å†™ï¼‰, __icontainsï¼ˆå¿½ç•¥å¤§å°å†™ï¼‰ ä»¥â€¦å¼€å¤´ï¼š__startwithï¼Œ __istartwithï¼ˆåŒ¹é…å­—ç¬¦åŠ iå¿½ç•¥å¤§å°å†™åŸºæœ¬é€‚ç”¨ï¼Œä¹‹åŽä¸åœ¨æè¿°ï¼‰ ä»¥â€¦ç»“å°¾ï¼š__endswithï¼Œ__iendswith åœ¨â€¦ä¸­ï¼š__in åœ¨â€¦èŒƒå›´ï¼ˆä½¿ç”¨å…ƒç»„ï¼‰ï¼š__range æ˜¯å¦ä¸ºç©ºå€¼ï¼š __isnull=Trueï¼Œ__isnull=False æ—¥æœŸç±»åž‹ï¼š å¹´ï¼š__year æœˆï¼š__month æ—¥ï¼š__day å°æ—¶:__hour åˆ†é’Ÿ:__minut ç§’ï¼š__second 1.2.4 åˆ é™¤å¯¹è±¡æˆ‘ä»¬ä½¿ç”¨delete()æ¥åˆ é™¤å¯¹è±¡ï¼š 12345678# åˆ é™¤idç­‰äºŽ1çš„é—®é¢˜&gt;&gt;&gt; Question.bojects.filter(id=1).delete()# ç­‰åŒäºŽ&gt;&gt;&gt; q = Question.bojects.filter(id=1)&gt;&gt;&gt; q.delete()# åˆ é™¤æ‰€æœ‰å¯¹è±¡&gt;&gt;&gt; Question.objects.all().delete() 1.2.5 æŽ’åºå¯¹è±¡12345# æ ¹æ®æ—¶é—´æŽ’åº&gt;&gt;&gt; Question.objects.all().order_by('pub_date')# å‚æ•°å‰é¢åŠ -å·å¯ä»¥å®žçŽ°å€’åº&gt;&gt;&gt; Question.objects.all().order_by('-pub_date') 1.2.6 ä½¿ç”¨ç´¢å¼•æŸ¥è¯¢é›†ä¸æ”¯æŒè´Ÿç´¢å¼•ï¼Œæƒ³èŽ·å–æœ€åŽå‡ ä¸ªå€¼éœ€è¦é€šè¿‡å…¶ä»–çš„æ–¹æ³•ï¼Œä¾‹å¦‚reverse()æˆ–è€…é€šè¿‡å‚æ•°å‰é¢åŠ -å·çš„æ–¹å¼ï¼š 123456789101112# èŽ·å–æ‰€æœ‰é—®é¢˜çš„å‰5æ¡&gt;&gt;&gt; Question.objects.all()[:5]# ä½¿ç”¨è´Ÿç´¢å¼•ä¼šæŠ¥é”™&gt;&gt;&gt; Question.objects.all()[-5:]...AssertionError: Negative indexing is not supported.# èŽ·å–æœ€åŽ3ä¸ªå€¼&gt;&gt;&gt; Question.objects.all().order_by('id').reverse()[:3]# ç­‰åŒäºŽ&gt;&gt;&gt; Question.objects.all().order_by('-id')[:3] 1.2.7 åŽ»é‡å¯¹è±¡123# åŽ»é™¤é‡å¤çš„å¯¹è±¡&gt;&gt;&gt; q = Question.objects.all()&gt;&gt;&gt; q.distinct() 1.2.8 èŽ·å–å…ƒç»„å½¢å¼çš„å¯¹è±¡æˆ‘ä»¬ä½¿ç”¨values_list()æ¥èŽ·å–å…ƒç»„å½¢å¼çš„å¯¹è±¡ï¼š 1234567891011# ä»¥å…ƒç»„å½¢å¼èŽ·å–é—®é¢˜çš„æè¿°ä¸Žå‘å¸ƒæ—¶é—´&gt;&gt;&gt; Question.objects.values_list('question_text', 'pub_date')&lt;QuerySet [('What', datetime.datetime(2018, 6, 11, 17, 46)), ('What', datetime.datetime(2018, 6, 11, 18, 47))]&gt;# å¦‚æžœåªéœ€è¦ä¸€ä¸ªå­—æ®µï¼Œå¯ä»¥æŒ‡å®šflat=True&gt;&gt;&gt; Question.objects.values_list('pub_date', flat=True)&lt;QuerySet ['What', 'What', 'What', 'What', 'What', 'What', 'What']&gt;# è½¬åŒ–ä¸ºåˆ—è¡¨&gt;&gt;&gt; list(Question.objects.values_list('question_text', flat=True))['What', 'What', 'What', 'What', 'What', 'What', 'What'] 1.2.9 èŽ·å–å­—å…¸å½¢å¼çš„å¯¹è±¡æˆ‘ä»¬ä½¿ç”¨values()æ¥èŽ·å–å­—å…¸å½¢å¼çš„å¯¹è±¡ï¼š 1234567# ä»¥å­—å…¸å½¢å¼èŽ·å–é—®é¢˜çš„æè¿°ä¸Žå‘å¸ƒæ—¶é—´&gt;&gt;&gt; Question.objects.values('question_text', 'pub_date')&lt;QuerySet [&#123;'question_text': 'What', 'pub_date': datetime.datetime(2018, 6, 11, 17, 46)&#125;]&gt;# è½¬åŒ–ä¸ºåˆ—è¡¨&gt;&gt;&gt; list(Question.objects.values('question_text', 'pub_date'))[&#123;'question_text': 'What', 'pub_date': datetime.datetime(2018, 6, 11, 17, 46)&#125;] 2. Djangoç®¡ç†é¡µé¢ ä¸ºä½ çš„å‘˜å·¥æˆ–å®¢æˆ·ç”Ÿæˆä¸€ä¸ªç”¨æˆ·æ·»åŠ ï¼Œä¿®æ”¹å’Œåˆ é™¤å†…å®¹çš„åŽå°æ˜¯ä¸€é¡¹ç¼ºä¹åˆ›é€ æ€§å’Œä¹å‘³çš„å·¥ä½œã€‚å› æ­¤ï¼ŒDjango å…¨è‡ªåŠ¨åœ°æ ¹æ®æ¨¡åž‹åˆ›å»ºåŽå°ç•Œé¢ã€‚ Django äº§ç”ŸäºŽä¸€ä¸ªå…¬ä¼—é¡µé¢å’Œå†…å®¹å‘å¸ƒè€…é¡µé¢å®Œå…¨åˆ†ç¦»çš„æ–°é—»ç±»ç«™ç‚¹çš„å¼€å‘è¿‡ç¨‹ä¸­ã€‚ç«™ç‚¹ç®¡ç†äººå‘˜ä½¿ç”¨ç®¡ç†ç³»ç»Ÿæ¥æ·»åŠ æ–°é—»ã€äº‹ä»¶å’Œä½“è‚²æ—¶è®¯ç­‰ï¼Œè¿™äº›æ·»åŠ çš„å†…å®¹è¢«æ˜¾ç¤ºåœ¨å…¬ä¼—é¡µé¢ä¸Šã€‚Django é€šè¿‡ä¸ºç«™ç‚¹ç®¡ç†äººå‘˜åˆ›å»ºç»Ÿä¸€çš„å†…å®¹ç¼–è¾‘ç•Œé¢è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ ç®¡ç†ç•Œé¢ä¸æ˜¯ä¸ºäº†ç½‘ç«™çš„è®¿é—®è€…ï¼Œè€Œæ˜¯ä¸ºç®¡ç†è€…å‡†å¤‡çš„ã€‚ 2.1 åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜è´¦å·123456789python manage.py createsuperuser# è¾“å…¥ç®¡ç†ç”¨æˆ·åUsername: admin# è¾“å…¥ç®¡ç†å‘˜é‚®ç®±ï¼Œå¯ä¸å¡«Email address:# è¾“å…¥ç®¡ç†å‘˜å¯†ç Password:Password (again): 2.2 å¯åŠ¨å¼€å‘æœåŠ¡å™¨Django çš„ç®¡ç†ç•Œé¢é»˜è®¤å°±æ˜¯å¯ç”¨çš„ï¼Œå®ƒæ˜¯ç”±django.contrib.adminæä¾›çš„ï¼Œä¸éœ€è¦æ·»åŠ åº”ç”¨ã€‚ ç›´æŽ¥å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼Œçœ‹çœ‹å®ƒæ˜¯ä»€ä¹ˆæ ·çš„ã€‚ 1python manage.py runserver çŽ°åœ¨ï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œè½¬åˆ°ä½ æœ¬åœ°åŸŸåçš„ â€œ/admin/â€œ ç›®å½•ï¼Œ æ¯”å¦‚ â€œhttp://127.0.0.1:8000/admin/â€œ ã€‚ä½ åº”è¯¥ä¼šçœ‹è§ç®¡ç†å‘˜ç™»å½•ç•Œé¢ï¼š å¦‚æžœä½ æƒ³ä½¿ç”¨ä¸­æ–‡ï¼Œå°†settings.pyä¸­LANGUAGE_CODEè®¾ç½®ä¸ºâ€™zh-hansâ€™ã€‚ 123456789LANGUAGE_CODE = 'zh-hans'TIME_ZONE = 'Asia/Shanghai'USE_I18N = TrueUSE_L10N = TrueUSE_TZ = False 2.3 è¿›å…¥ç®¡ç†ç«™ç‚¹é¡µé¢çŽ°åœ¨ï¼Œè¯•ç€ä½¿ç”¨ä½ åœ¨ä¸Šä¸€æ­¥ä¸­åˆ›å»ºçš„è¶…çº§ç”¨æˆ·æ¥ç™»å½•ã€‚ç„¶åŽä½ å°†ä¼šçœ‹åˆ° Django ç®¡ç†é¡µé¢çš„ç´¢å¼•é¡µï¼š ä½ å°†ä¼šçœ‹åˆ°å‡ ç§å¯ç¼–è¾‘çš„å†…å®¹ï¼šç»„å’Œç”¨æˆ·ã€‚å®ƒä»¬æ˜¯ç”± django.contrib.auth æä¾›çš„ï¼Œè¿™æ˜¯ Django å¼€å‘çš„è®¤è¯æ¡†æž¶ã€‚ 2.4 å‘ç®¡ç†é¡µé¢ä¸­åŠ å…¥æŠ•ç¥¨åº”ç”¨ä½†æ˜¯æˆ‘ä»¬çš„æŠ•ç¥¨åº”ç”¨åœ¨å“ªå‘¢ï¼Ÿå®ƒæ²¡åœ¨ç´¢å¼•é¡µé¢é‡Œæ˜¾ç¤ºã€‚ åªéœ€è¦åšä¸€ä»¶äº‹ï¼šæˆ‘ä»¬å¾—å‘Šè¯‰ç®¡ç†é¡µé¢ï¼Œé—®é¢˜ Question å¯¹è±¡éœ€è¦è¢«ç®¡ç†ã€‚æ‰“å¼€ polls/admin.py æ–‡ä»¶ï¼ŒæŠŠå®ƒç¼–è¾‘æˆä¸‹é¢è¿™æ ·ï¼š 1234567from django.contrib import adminfrom .models import Choice, Question#æ³¨å†Œæ¨¡å—åº”ç”¨admin.site.register(Question)admin.site.register(Choice) çŽ°åœ¨æˆ‘ä»¬å‘ç®¡ç†é¡µé¢æ³¨å†Œäº†é—®é¢˜ Questionç±»å’ŒChoiceç±»ï¼ŒæŽ¥ä¸‹æ¥åœ¨åŽå°ç®¡ç†é¡µé¢ä¸Šæ¥æ·»åŠ é—®é¢˜å’Œé€‰é¡¹ï¼š]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Django</tag>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Djangoå­¦ä¹ ç¬”è®° - 3 æ•°æ®åº“é…ç½®ä¸Žæ¨¡åž‹]]></title>
    <url>%2F2018%2F06%2F17%2FDjango%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-3-%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE%E4%B8%8E%E6%A8%A1%E5%9E%8B%2F</url>
    <content type="text"><![CDATA[çŽ°åœ¨èµ·ï¼Œæˆ‘ä»¬å°†å»ºç«‹æ•°æ®åº“ï¼Œå¹¶åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªæ¨¡åž‹ã€‚ 1. æ•°æ®åº“é…ç½® çŽ°åœ¨ï¼Œæ‰“å¼€ mysite/settings.py ã€‚è¿™æ˜¯ä¸ªåŒ…å«äº† Django é¡¹ç›®è®¾ç½®çš„ Python æ¨¡å—ã€‚ é€šå¸¸ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶ä½¿ç”¨ SQLite ä½œä¸ºé»˜è®¤æ•°æ®åº“ã€‚å¦‚æžœä½ ä¸ç†Ÿæ‚‰æ•°æ®åº“ï¼Œæˆ–è€…åªæ˜¯æƒ³å°è¯•ä¸‹ Djangoï¼Œè¿™æ˜¯æœ€ç®€å•çš„é€‰æ‹©ã€‚Python å†…ç½® SQLiteï¼Œæ‰€ä»¥ä½ æ— éœ€å®‰è£…é¢å¤–ä¸œè¥¿æ¥ä½¿ç”¨å®ƒã€‚å½“ä½ å¼€å§‹ä¸€ä¸ªçœŸæ­£çš„é¡¹ç›®æ—¶ï¼Œä½ å¯èƒ½æ›´å€¾å‘ä½¿ç”¨ä¸€ä¸ªæ›´å…·æ‰©å±•æ€§çš„æ•°æ®åº“ï¼Œä¾‹å¦‚ MySQLï¼Œé¿å…ä¸­é€”åˆ‡æ¢æ•°æ®åº“è¿™ä¸ªä»¤äººå¤´ç–¼çš„é—®é¢˜ã€‚ å¦‚æžœä½ æƒ³ä½¿ç”¨å…¶ä»–æ•°æ®åº“ï¼Œä½ éœ€è¦å®‰è£…åˆé€‚çš„ database bindings ï¼Œç„¶åŽæ”¹å˜è®¾ç½®æ–‡ä»¶ä¸­ DATABASES &#39;default&#39; é¡¹ç›®ä¸­çš„ä¸€äº›é”®å€¼ï¼š ENGINE â€“ æ•°æ®åº“å¼•æ“Žé…ç½® ï¼Œå¯é€‰å€¼æœ‰ â€˜django.db.backends.sqlite3â€™ï¼Œâ€™django.db.backends.postgresqlâ€™ï¼Œâ€™django.db.backends.mysqlâ€™ï¼Œæˆ– â€˜django.db.backends.oracleâ€™ã€‚å…¶å®ƒ å¯ç”¨åŽç«¯ã€‚ NAME - æ•°æ®åº“çš„åç§°ã€‚å¦‚æžœä½¿ç”¨çš„æ˜¯ SQLiteï¼Œæ•°æ®åº“å°†æ˜¯ä½ ç”µè„‘ä¸Šçš„ä¸€ä¸ªæ–‡ä»¶ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ NAME åº”è¯¥æ˜¯æ­¤æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼ŒåŒ…æ‹¬æ–‡ä»¶åã€‚é»˜è®¤å€¼ os.path.join(BASE_DIR,â€™db.sqlite3â€™) å°†ä¼šæŠŠæ•°æ®åº“æ–‡ä»¶å‚¨å­˜åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ã€‚ å¦‚æžœä½ ä¸ä½¿ç”¨ SQLiteï¼Œåˆ™å¿…é¡»æ·»åŠ ä¸€äº›é¢å¤–è®¾ç½®ï¼Œæ¯”å¦‚ USER ã€ PASSWORD ã€ HOST ç­‰ç­‰ã€‚æƒ³äº†è§£æ›´å¤šæ•°æ®åº“è®¾ç½®æ–¹é¢çš„å†…å®¹ï¼Œè¯·çœ‹æ–‡æ¡£ï¼šDATABASES ã€‚ SQLite ä»¥å¤–çš„å…¶å®ƒæ•°æ®åº“ å¦‚æžœä½ ä½¿ç”¨äº† SQLite ä»¥å¤–çš„æ•°æ®åº“ï¼Œè¯·ç¡®è®¤åœ¨ä½¿ç”¨å‰å·²ç»åˆ›å»ºäº†æ•°æ®åº“ã€‚ä½ å¯ä»¥é€šè¿‡åœ¨ä½ çš„æ•°æ®åº“äº¤äº’å¼å‘½ä»¤è¡Œä¸­ä½¿ç”¨ â€œCREATE DATABASE database_name;â€œ å‘½ä»¤æ¥å®Œæˆè¿™ä»¶äº‹ã€‚ å¦å¤–ï¼Œè¿˜è¦ç¡®ä¿è¯¥æ•°æ®åº“ç”¨æˆ·ä¸­æä¾› mysite/settings.py å…·æœ‰ â€œcreate databaseâ€ æƒé™ã€‚è¿™ä½¿å¾—è‡ªåŠ¨åˆ›å»ºçš„ test database èƒ½è¢«ä»¥åŽçš„æ•™ç¨‹ä½¿ç”¨ã€‚ å¦‚æžœä½ ä½¿ç”¨ SQLiteï¼Œé‚£ä¹ˆä½ ä¸éœ€è¦åœ¨ä½¿ç”¨å‰åšä»»ä½•äº‹â€”â€”æ•°æ®åº“ä¼šåœ¨éœ€è¦çš„æ—¶å€™è‡ªåŠ¨åˆ›å»ºã€‚ æœ¬æ¬¡å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨MySQLæ•°æ®åº“æ¥å®ŒæˆåŽç»­çš„æ“ä½œã€‚ 1.1 å®‰è£…MySQLæ•°æ®åº“å¹¶é…ç½®é¦–å…ˆåœ¨æœ¬åœ°å®‰è£…mysqlæ•°æ®åº“ï¼Œæœ¬æ¬¡æ˜¯åœ¨winodwsçŽ¯å¢ƒä¸‹å®‰è£…çš„8.0ç‰ˆæœ¬ã€‚ å®‰è£…å®ŒæˆåŽï¼Œä¸ºä½¿ç”¨æ–¹ä¾¿ä½¿ç”¨æˆ‘è®¾ç½®äº†çŽ¯å¢ƒå˜é‡ï¼š MYSQLHOME D:\MySQL\MySQL Server 8.0 å¹¶åœ¨çŽ¯å¢ƒå˜é‡pathä¸­æ·»åŠ äº† %MYSQL_HOME%\bin å‰é¢æˆ‘ä»¬æåˆ°ï¼Œå¦‚æžœä½¿ç”¨SQLiteä»¥å¤–å…¶ä»–æ•°æ®åº“ï¼Œå¿…é¡»åœ¨ä½¿ç”¨å‰å·²ç»åˆ›å»ºäº†æ•°æ®åº“ï¼Œå¹¶å…·æœ‰ä¸€å®šçš„æƒé™ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿›å…¥æ•°æ®åº“å¹¶åˆ›å»ºæˆ‘ä»¬ä½¿ç”¨çš„æ•°æ®åº“åŠç”¨æˆ·ï¼Œå¹¶èµ‹äºˆç”¨æˆ·ä¸€äº›æƒé™ã€‚ 12345mysql -hlocalhost -uroot -p123456create database pydb character set utf8;create user py_user@&apos;%&apos; identified by &apos;123456&apos;;grant all privileges on pydb.* to &apos;py_user&apos;@&apos;%&apos;;flush privileges; åˆ°è¿™ï¼Œæˆ‘ä»¬mysqlæ•°æ®åº“çŽ¯å¢ƒå·²ç»å‡†å¤‡å®Œæ¯•ã€‚ 1.2 å®‰è£…mysqlclienté©±åŠ¨å¹¶é…ç½®å‰é¢æˆ‘ä»¬è¿˜æåˆ°ï¼Œå¦‚æžœä½ æƒ³ä½¿ç”¨å…¶ä»–æ•°æ®åº“ï¼Œå¿…é¡»å®‰è£…åˆé€‚çš„ database bindingsã€‚æ‰€ä»¥ä½ éœ€è¦ä¸€ä¸ªDB API Driversï¼Œå³æ•°æ®åº“æŽ¥å£é©±åŠ¨ï¼Œå¸¸è§çš„æœ‰ï¼š mysqlclient - æ˜¯ä¸€ä¸ªåŽŸç”Ÿé©±åŠ¨ã€‚ç›®å‰æ”¯æŒPython 2.7,3.4+ ï¼Œè¿™æ˜¯å®˜ç½‘æŽ¨èçš„é©±åŠ¨ã€‚ MySQL Connector/Python - Oracleå®˜ç½‘æä¾›çš„çº¯é©±åŠ¨ç¨‹åºï¼Œå®ƒä¸éœ€è¦MySQLå®¢æˆ·ç«¯åº“æˆ–æ ‡å‡†åº“ä¹‹å¤–çš„ä»»ä½•Pythonæ¨¡å—ã€‚ mysqldb - æ˜¯ç”¨äºŽPython çš„æµè¡Œçš„MySQLæ•°æ®åº“æœåŠ¡å™¨çš„æŽ¥å£ï¼Œç›®å‰æ”¯æŒPython-2.4åˆ°2.7 ï¼Œå¹¶ä¸æ”¯æŒpython3.6ã€‚ pymysql - ç›®æ ‡æ˜¯æˆä¸ºMySQLdbçš„æ›¿ä»£å“ï¼Œæ”¯æŒPython 2.7,3.4+ ã€‚ é™¤äº†DB API Driverä¹‹å¤–ï¼ŒDjangoè¿˜éœ€è¦ä¸€ä¸ªé€‚é…å™¨æ‰èƒ½ä»Žå…¶ORMè®¿é—®æ•°æ®åº“é©±åŠ¨ç¨‹åºã€‚Djangoä¸ºmysqlclientæä¾›äº†ä¸€ä¸ªé€‚é…å™¨ï¼Œè€ŒMySQL Connector / PythonåŒ…å«ä»–è‡ªå·±çš„é€‚é…å™¨ã€‚ æˆ‘ä»¬ä½¿ç”¨å®˜ç½‘æŽ¨èçš„é©±åŠ¨mysqlclientã€‚ 1pip install mysqlclient å®‰è£…å®ŒæˆåŽï¼Œè¿›è¡Œé…ç½®æ¥é“¾æŽ¥æ•°æ®åº“ã€‚æ‰“å¼€mysite/mysite/settings.pyé…ç½®æ–‡ä»¶ï¼Œæ·»åŠ æ•°æ®åº“è¿žæŽ¥é…ç½®ä¿¡æ¯ï¼š 1234567891011121314151617# ä¿®æ”¹DATABASEé…ç½®DATABASES = &#123; 'default': &#123; # æ•°æ®åº“è¿žæŽ¥å­—ç¬¦ 'ENGINE': 'django.db.backends.mysql', # æ•°æ®åº“åç§° 'NAME': 'pydb', # æ•°æ®åº“ç™»å½•ç”¨æˆ· 'USER': 'py_user', # æ•°æ®åº“ç™»å½•å¯†ç  'PASSWORD': '123456', # æ•°æ®åº“æ‰€åœ¨ä¸»æœºIPï¼Œæœ¬åœ°å¯ä»¥ä¸ºç©º 'HOST': '', # æ•°æ®åº“è¿žæŽ¥ç«¯å£ 'PORT': '3306' &#125;&#125; åˆ°è¿™æˆ‘ä»¬é¡¹ç›®å°±å¯ä»¥è¿žæŽ¥åˆ°mysqlæ•°æ®åº“äº†ã€‚ ä½¿ç”¨å…¶ä»–çš„é©±åŠ¨ï¼š 1 MySQL Connector/Python 12&gt; pip install mysql-connector-python&gt; 123456789101112131415161718&gt; # ä¿®æ”¹DATABASEé…ç½®&gt; DATABASES = &#123;&gt; 'default': &#123;&gt; # æ•°æ®åº“è¿žæŽ¥å­—ç¬¦&gt; 'ENGINE': 'mysql.connector.django',&gt; # æ•°æ®åº“åç§°&gt; 'NAME': 'pydb',&gt; # æ•°æ®åº“ç™»å½•ç”¨æˆ·&gt; 'USER': 'py_user',&gt; # æ•°æ®åº“ç™»å½•å¯†ç &gt; 'PASSWORD': '123456',&gt; # æ•°æ®åº“æ‰€åœ¨ä¸»æœºIPï¼Œæœ¬åœ°å¯ä»¥ä¸ºç©º&gt; 'HOST': '',&gt; # æ•°æ®åº“è¿žæŽ¥ç«¯å£&gt; 'PORT': '3306'&gt; &#125;&gt; &#125;&gt; æ³¨æ„ENGINEå‘ç”Ÿäº†æ”¹å˜ï¼Œå› ä¸ºmysql.connector.djangoä¸ºMySQLè‡ªå·±æä¾›çš„DjangoåŽç«¯æ¨¡å—ã€‚ 2 pymysql 12&gt; pip install pimysql&gt; 1234567891011121314151617181920212223&gt; # å¼•å…¥pymysqlæ¨¡å—&gt; import pymysql&gt; # æŒ‡å®šæŒ‰ç…§mysqldbçš„æ–¹å¼ä½¿ç”¨&gt; pymysql.install_as_MySQLdb()&gt; &gt; # ä¿®æ”¹DATABASEé…ç½®&gt; DATABASES = &#123;&gt; 'default': &#123;&gt; # æ•°æ®åº“è¿žæŽ¥å­—ç¬¦&gt; 'ENGINE': 'django.db.backends.mysql',&gt; # æ•°æ®åº“åç§°&gt; 'NAME': 'pydb',&gt; # æ•°æ®åº“ç™»å½•ç”¨æˆ·&gt; 'USER': 'py_user',&gt; # æ•°æ®åº“ç™»å½•å¯†ç &gt; 'PASSWORD': '123456',&gt; # æ•°æ®åº“æ‰€åœ¨ä¸»æœºIPï¼Œæœ¬åœ°å¯ä»¥ä¸ºç©º&gt; 'HOST': '',&gt; # æ•°æ®åº“è¿žæŽ¥ç«¯å£&gt; 'PORT': '3306'&gt; &#125;&gt; &#125;&gt; 2. åˆ›å»ºæ¨¡åž‹å¹¶å’Œæ•°æ®åº“äº¤äº’ 2.1 åˆ›å»ºæ¨¡åž‹åœ¨ Django é‡Œå†™ä¸€ä¸ªæ•°æ®åº“é©±åŠ¨çš„ Web åº”ç”¨çš„ç¬¬ä¸€æ­¥æ˜¯å®šä¹‰æ¨¡åž‹ - ä¹Ÿå°±æ˜¯æ•°æ®åº“ç»“æž„è®¾è®¡å’Œé™„åŠ çš„å…¶å®ƒå…ƒæ•°æ®ã€‚ è®¾è®¡å“²å­¦ æ¨¡åž‹æ˜¯çœŸå®žæ•°æ®çš„ç®€å•æ˜Žç¡®çš„æè¿°ã€‚å®ƒåŒ…å«äº†å‚¨å­˜çš„æ•°æ®æ‰€å¿…è¦çš„å­—æ®µå’Œè¡Œä¸ºã€‚Django éµå¾ª DRY Principle ã€‚å®ƒçš„ç›®æ ‡æ˜¯ä½ åªéœ€è¦å®šä¹‰æ•°æ®æ¨¡åž‹ï¼Œç„¶åŽå…¶å®ƒçš„æ‚ä¸ƒæ‚å…«ä»£ç ä½ éƒ½ä¸ç”¨å…³å¿ƒï¼Œå®ƒä»¬ä¼šè‡ªåŠ¨ä»Žæ¨¡åž‹ç”Ÿæˆã€‚ æ¥ä»‹ç»ä¸€ä¸‹è¿ç§» - ä¸¾ä¸ªä¾‹å­ï¼Œä¸åƒ Ruby On Railsï¼ŒDjango çš„è¿ç§»ä»£ç æ˜¯ç”±ä½ çš„æ¨¡åž‹æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œå®ƒæœ¬è´¨ä¸Šåªæ˜¯ä¸ªåŽ†å²è®°å½•ï¼ŒDjango å¯ä»¥ç”¨å®ƒæ¥è¿›è¡Œæ•°æ®åº“çš„æ»šåŠ¨æ›´æ–°ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ä½¿å…¶èƒ½å¤Ÿå’Œå½“å‰çš„æ¨¡åž‹åŒ¹é…ã€‚ åœ¨è¿™ä¸ªç®€å•çš„æŠ•ç¥¨åº”ç”¨ä¸­ï¼Œéœ€è¦åˆ›å»ºä¸¤ä¸ªæ¨¡åž‹ï¼šé—®é¢˜ Question å’Œé€‰é¡¹ Choiceã€‚Questionæ¨¡åž‹æœ‰ä¸¤ä¸ªå­—æ®µï¼Œé—®é¢˜æè¿°å’Œå‘å¸ƒæ—¶é—´ã€‚Choice æ¨¡åž‹æœ‰ä¸¤ä¸ªå­—æ®µï¼Œé€‰é¡¹æè¿°å’Œå½“å‰å¾—ç¥¨æ•°ã€‚æ¯ä¸ªé€‰é¡¹å±žäºŽä¸€ä¸ªé—®é¢˜ã€‚ æˆ‘ä»¬é€šè¿‡ç±»å›¾æ¥è¡¨çŽ°è¿™ä¸¤ä¸ªæ¨¡åž‹ä¹‹é—´çš„å…³ç³»ï¼š æˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥è§£è¯»å®ƒä»¬ï¼šä¸€ä¸ªchoiceå¿…é¡»ä¸Žä¸€ä¸ªï¼ˆ1ï¼‰questionç›¸å…³è”ï¼Œä½†æ˜¯questionä¸‹é¢å¯èƒ½ä¸Žå¤šä¸ªï¼ˆ0..*ï¼‰choiceå…³è”ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªé€‰é¡¹å¿…é¡»å±žäºŽä¸€ä¸ªé—®é¢˜ï¼Œæ²¡æœ‰é—®é¢˜å°±æ²¡æœ‰é€‰é¡¹ï¼Œä½†æ˜¯ä¸€ä¸ªé—®é¢˜å¯èƒ½æœ‰å¤šä¸ªé€‰é¡¹ï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰é€‰é¡¹ã€‚ï¼ˆå¤šå¯¹ä¸€å…³ç³»ï¼‰ ä»–ä»¬æ˜¯æ€Žä¹ˆå…³è”çš„ï¼Ÿé€šè¿‡å¤–é”®æ¥å…³è”ï¼Œä¹‹åŽæˆ‘ä»¬ä¼šè¯¦ç»†è®²åˆ°ã€‚ æˆ‘ä»¬è¦åšçš„å°±æ˜¯æ¥åˆ›å»ºDjangoæ‰€è¡¨ç¤ºçš„ç±»ã€‚æŒ‰ç…§ä¸‹é¢çš„ä¾‹å­æ¥ç¼–è¾‘ polls/models.pyæ–‡ä»¶ï¼š 1234567891011121314151617181920# å¼•å…¥django.dbæ¨¡å—ä¸­çš„modelsæ¨¡å—from django.db import models# åˆ›å»ºä¸€ä¸ªé—®é¢˜ç±»åž‹class Question(models.Model): # åˆå§‹åŒ–é—®é¢˜æè¿°å±žæ€§ï¼ŒæŒ‡å®šä¸ºå­—ç¬¦ä¸²ç±»åž‹ï¼Œæœ€å¤§é•¿åº¦200ä¸ªå­—ç¬¦ question_text = models.CharField(max_length=200) # åˆå§‹åŒ–å‘å¸ƒæ—¶é—´å±žæ€§ï¼ŒæŒ‡å®šä¸ºæ—¥æœŸæ—¶é—´ç±»åž‹ pub_date = models.DateTimeField('date published')# åˆ›å»ºä¸€ä¸ªè§£å†³æ–¹æ¡ˆç±»åž‹class Choice(models.Model): # å°†è§£å†³æ–¹æ¡ˆå’Œé—®é¢˜å…³è”èµ·æ¥ï¼Œé€šè¿‡å¤–é”®çš„å½¢å¼ question = models.ForeignKey(Question, on_delete=models.CASCADE) # è§£å†³æ–¹æ¡ˆçš„æè¿°ä¿¡æ¯ï¼Œå­—ç¬¦ä¸²ï¼Œæœ€å¤§é•¿åº¦ choice_text = models.CharField(max_length=200) # è§£å†³æ–¹æ¡ˆçš„æŠ•ç¥¨æ€»æ•°ï¼Œæ•´æ•°ç±»åž‹ï¼Œé»˜è®¤0 votes = models.IntegerField(default=0) æ¯ä¸ªæ¨¡åž‹éƒ½æ˜¯django.db.models.Modelç±»çš„å­ç±»ã€‚æ¯ä¸ªç±»å°†è¢«è½¬æ¢ä¸ºæ•°æ®åº“è¡¨ï¼Œæ¯ä¸ªæ¨¡åž‹æœ‰ä¸€äº›ç±»å˜é‡ï¼Œå®ƒä»¬éƒ½è¡¨ç¤ºæ¨¡åž‹é‡Œçš„ä¸€ä¸ªæ•°æ®åº“å­—æ®µã€‚ æ¯ä¸ªå­—æ®µéƒ½æ˜¯ Field ç±»çš„å®žä¾‹ - æ¯”å¦‚ï¼Œå­—ç¬¦å­—æ®µè¢«è¡¨ç¤ºä¸º CharField ï¼Œæ—¥æœŸæ—¶é—´å­—æ®µè¢«è¡¨ç¤ºä¸º DateTimeField ã€‚è¿™å°†å‘Šè¯‰ Django æ¯ä¸ªå­—æ®µè¦å¤„ç†çš„æ•°æ®ç±»åž‹ã€‚ æ¯ä¸ª Field ç±»å®žä¾‹å˜é‡çš„åå­—ï¼ˆä¾‹å¦‚ question_text æˆ– pub_date ï¼‰ä¹Ÿæ˜¯å­—æ®µåï¼Œæ‰€ä»¥æœ€å¥½ä½¿ç”¨å¯¹æœºå™¨å‹å¥½çš„æ ¼å¼ã€‚ä½ å°†ä¼šåœ¨ Python ä»£ç é‡Œä½¿ç”¨å®ƒä»¬ï¼Œè€Œæ•°æ®åº“ä¼šå°†å®ƒä»¬ä½œä¸ºåˆ—åã€‚ æ¯ä¸ª Field ç±»å®žä¾‹å˜é‡çš„åå­—ï¼ˆä¾‹å¦‚ question_text æˆ– pub_date ï¼‰ä¹Ÿæ˜¯å­—æ®µåï¼Œæ‰€ä»¥æœ€å¥½ä½¿ç”¨å¯¹æœºå™¨å‹å¥½çš„æ ¼å¼ã€‚ä½ å°†ä¼šåœ¨ Python ä»£ç é‡Œä½¿ç”¨å®ƒä»¬ï¼Œè€Œæ•°æ®åº“ä¼šå°†å®ƒä»¬ä½œä¸ºåˆ—åã€‚ ä½ å¯ä»¥ä½¿ç”¨å¯é€‰çš„é€‰é¡¹æ¥ä¸º Field å®šä¹‰ä¸€ä¸ªäººç±»å¯è¯»çš„åå­—ã€‚è¿™ä¸ªåŠŸèƒ½åœ¨å¾ˆå¤š Django å†…éƒ¨ç»„æˆéƒ¨åˆ†ä¸­éƒ½è¢«ä½¿ç”¨äº†ï¼Œè€Œä¸”ä½œä¸ºæ–‡æ¡£çš„ä¸€éƒ¨åˆ†ã€‚å¦‚æžœæŸä¸ªå­—æ®µæ²¡æœ‰æä¾›æ­¤åç§°ï¼ŒDjango å°†ä¼šä½¿ç”¨å¯¹æœºå™¨å‹å¥½çš„åç§°ï¼Œä¹Ÿå°±æ˜¯å˜é‡åã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªä¸º Question.pub_date å®šä¹‰äº†å¯¹äººç±»å‹å¥½çš„åå­—ã€‚å¯¹äºŽæ¨¡åž‹å†…çš„å…¶å®ƒå­—æ®µï¼Œå®ƒä»¬çš„æœºå™¨å‹å¥½åä¹Ÿä¼šè¢«ä½œä¸ºäººç±»å‹å¥½åä½¿ç”¨ã€‚ å®šä¹‰æŸäº› Field ç±»å®žä¾‹éœ€è¦å‚æ•°ã€‚ä¾‹å¦‚ CharField éœ€è¦ä¸€ä¸ª max_length å‚æ•°ã€‚è¿™ä¸ªå‚æ•°çš„ç”¨å¤„ä¸æ­¢äºŽç”¨æ¥å®šä¹‰æ•°æ®åº“ç»“æž„ï¼Œä¹Ÿç”¨äºŽéªŒè¯æ•°æ®ã€‚ Field ä¹Ÿèƒ½å¤ŸæŽ¥æ”¶å¤šä¸ªå¯é€‰å‚æ•°ï¼›åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼šæˆ‘ä»¬å°† votes çš„ default ä¹Ÿå°±æ˜¯é»˜è®¤å€¼ï¼Œè®¾ä¸º0ã€‚ æˆ‘ä»¬ä½¿ç”¨ ForeignKey å®šä¹‰äº†æ¨¡åž‹ä¹‹é—´çš„å…³ç³»ã€‚questionå­—æ®µæ˜¯Questionæ¨¡åž‹çš„ForeignKeyï¼Œè¿™å°†å‘Šè¯‰ Djangoï¼Œæ¯ä¸ª Choice å¯¹è±¡éƒ½å…³è”åˆ°ä¸€ä¸ª Question å¯¹è±¡ï¼Œå¹¶åœ¨æ•°æ®åº“çº§åˆ«åˆ›å»ºé€‚å½“çš„å…³ç³»ï¼Œä¹Ÿå°±æ˜¯å¤–é”®å…³è”ã€‚åœ¨åˆ›å»ºå¤šå¯¹ä¸€å…³ç³»æ—¶ï¼Œéœ€è¦åœ¨ForeignKeyçš„ç¬¬äºŒå‚æ•°ä¸­åŠ å…¥on_delete=models.CASCADEï¼Œè¡¨ç¤ºä¸»å¤–å…³ç³»é”®ä¸­çº§è”åˆ é™¤ï¼Œä¹Ÿå°±æ˜¯è¯´å½“åˆ é™¤ä¸»è¡¨çš„æ•°æ®æ—¶ä»Žè¡¨ä¸­çš„æ•°æ®ä¹Ÿä¸€å¹¶åˆ é™¤ã€‚ 2.2 æ¿€æ´»æ¨¡åž‹ä¸Šé¢çš„ä¸€å°æ®µç”¨äºŽåˆ›å»ºæ¨¡åž‹çš„ä»£ç ç»™äº† Django å¾ˆå¤šä¿¡æ¯ï¼Œé€šè¿‡è¿™äº›ä¿¡æ¯ï¼ŒDjango å¯ä»¥ï¼š ä¸ºè¿™ä¸ªåº”ç”¨åˆ›å»ºæ•°æ®åº“ schemaï¼ˆç”Ÿæˆ CREATE TABLE è¯­å¥ï¼‰ã€‚ åˆ›å»ºå¯ä»¥ä¸Ž Question å’Œ Choice å¯¹è±¡è¿›è¡Œäº¤äº’çš„ Python æ•°æ®åº“ APIã€‚ ä½†æ˜¯é¦–å…ˆå¾—æŠŠ polls åº”ç”¨å®‰è£…åˆ°æˆ‘ä»¬çš„é¡¹ç›®é‡Œã€‚ è®¾è®¡å“²å­¦ Django åº”ç”¨æ˜¯â€œå¯æ’æ‹”â€çš„ã€‚ä½ å¯ä»¥åœ¨å¤šä¸ªé¡¹ç›®ä¸­ä½¿ç”¨åŒä¸€ä¸ªåº”ç”¨ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä½ è¿˜å¯ä»¥å‘å¸ƒè‡ªå·±çš„åº”ç”¨ï¼Œå› ä¸ºå®ƒä»¬å¹¶ä¸ä¼šè¢«ç»‘å®šåˆ°å½“å‰å®‰è£…çš„ Django ä¸Šã€‚ ä¸ºäº†åœ¨æˆ‘ä»¬çš„å·¥ç¨‹ä¸­åŒ…å«è¿™ä¸ªåº”ç”¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é…ç½®ç±» INSTALLED_APPS ä¸­æ·»åŠ è®¾ç½®ã€‚å› ä¸º PollsConfig ç±»å†™åœ¨æ–‡ä»¶ polls/apps.py ä¸­ï¼Œæ‰€ä»¥å®ƒçš„ç‚¹å¼è·¯å¾„æ˜¯ â€˜polls.apps.PollsConfigâ€™ã€‚åœ¨æ–‡ä»¶ mysite/settings.py ä¸­ INSTALLED_APPS å­é¡¹æ·»åŠ ç‚¹å¼è·¯å¾„åŽï¼Œå®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼š 12345678910111213141516INSTALLED_APPS = [ # æŠ•ç¥¨æ¨¡å—åº”ç”¨,å³æˆ‘ä»¬éœ€è¦æ·»åŠ çš„åº”ç”¨ 'polls.apps.PollsConfig', # é»˜è®¤æä¾›çš„åŽå°ç®¡ç†ç½‘ç«™ 'django.contrib.admin', # æƒé™è®¤è¯æ¨¡å— 'django.contrib.auth', # å†…å®¹ç¼–ç æ¡†æž¶æ¨¡å— 'django.contrib.contenttypes', # sessionä¼šè¯ç®¡ç†æ¡†æž¶æ¨¡å— 'django.contrib.sessions', # æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†æ¨¡å— 'django.contrib.messages', # é¡¹ç›®é™æ€æ–‡ä»¶ç®¡ç†æ¨¡å— 'django.contrib.staticfiles',] çŽ°åœ¨ä½ çš„ Django é¡¹ç›®ä¼šåŒ…å« polls åº”ç”¨ã€‚æŽ¥ç€è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š 1python manage.py makemigrations polls ä½ å°†ä¼šçœ‹åˆ°ç±»ä¼¼äºŽä¸‹é¢è¿™æ ·çš„è¾“å‡ºï¼š 12345Migrations for 'polls': polls/migrations/0001_initial.py: - Create model Choice - Create model Question - Add field question to choice é€šè¿‡è¿è¡Œ makemigrations å‘½ä»¤ï¼ŒDjango ä¼šæ£€æµ‹ä½ å¯¹æ¨¡åž‹æ–‡ä»¶çš„ä¿®æ”¹ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å·²ç»å–å¾—äº†æ–°çš„ï¼‰ï¼Œå¹¶ä¸”æŠŠä¿®æ”¹çš„éƒ¨åˆ†å‚¨å­˜ä¸ºä¸€æ¬¡ è¿ç§»ã€‚ è¿ç§»æ˜¯ Django å¯¹äºŽæ¨¡åž‹å®šä¹‰ï¼ˆä¹Ÿå°±æ˜¯ä½ çš„æ•°æ®åº“ç»“æž„ï¼‰çš„å˜åŒ–çš„å‚¨å­˜å½¢å¼ - æ²¡é‚£ä¹ˆçŽ„ä¹Žï¼Œå®ƒä»¬å…¶å®žä¹Ÿåªæ˜¯ä¸€äº›ä½ ç£ç›˜ä¸Šçš„æ–‡ä»¶ã€‚å¦‚æžœä½ æƒ³çš„è¯ï¼Œä½ å¯ä»¥é˜…è¯»ä¸€ä¸‹ä½ æ¨¡åž‹çš„è¿ç§»æ•°æ®ï¼Œå®ƒè¢«å‚¨å­˜åœ¨ polls/migrations/0001_initial.py é‡Œã€‚åˆ«æ‹…å¿ƒï¼Œä½ ä¸éœ€è¦æ¯æ¬¡éƒ½é˜…è¯»è¿ç§»æ–‡ä»¶ï¼Œä½†æ˜¯å®ƒä»¬è¢«è®¾è®¡æˆäººç±»å¯è¯»çš„å½¢å¼ï¼Œè¿™æ˜¯ä¸ºäº†ä¾¿äºŽä½ æ‰‹åŠ¨ä¿®æ”¹å®ƒä»¬ã€‚ Django æœ‰ä¸€ä¸ªè‡ªåŠ¨æ‰§è¡Œæ•°æ®åº“è¿ç§»å¹¶åŒæ­¥ç®¡ç†ä½ çš„æ•°æ®åº“ç»“æž„çš„å‘½ä»¤ - è¿™ä¸ªå‘½ä»¤æ˜¯ migrateï¼Œæˆ‘ä»¬é©¬ä¸Šå°±ä¼šæŽ¥è§¦å®ƒ - ä½†æ˜¯é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹è¿ç§»å‘½ä»¤ä¼šæ‰§è¡Œå“ªäº› SQL è¯­å¥ã€‚sqlmigrate å‘½ä»¤æŽ¥æ”¶ä¸€ä¸ªè¿ç§»çš„åç§°ï¼Œç„¶åŽè¿”å›žå¯¹åº”çš„ SQLï¼š 1python manage.py sqlmigrate polls 0001 ä½ å°†ä¼šçœ‹åˆ°ç±»ä¼¼ä¸‹é¢è¿™æ ·çš„è¾“å‡º ï¼š 123456789101112131415BEGIN;---- Create model Choice--CREATE TABLE `polls_choice` (`id` integer AUTO_INCREMENT NOT NULL PRIMARY KEY, `choice_text` varchar(200) NOT NULL, `votes` integer NOT NULL);---- Create model Question--CREATE TABLE `polls_question` (`id` integer AUTO_INCREMENT NOT NULL PRIMARY KEY, `question_text` varchar(200) NOT NULL, `pub_date` datetime(6) NOT NULL);---- Add field question to choice--ALTER TABLE `polls_choice` ADD COLUMN `question_id` integer NOT NULL;ALTER TABLE `polls_choice` ADD CONSTRAINT `polls_choice_question_id_c5b4b260_fk_polls_question_id` FOREIGN KEY (`question_id`) REFERENCES `polls_question` (`id`);COMMIT; è¯·æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š è¾“å‡ºçš„å†…å®¹å’Œä½ ä½¿ç”¨çš„æ•°æ®åº“æœ‰å…³ï¼Œä¸Šé¢çš„è¾“å‡ºç¤ºä¾‹ä½¿ç”¨çš„æ˜¯ MySQLã€‚ æ•°æ®åº“çš„è¡¨åæ˜¯ç”±åº”ç”¨å(polls)å’Œæ¨¡åž‹åçš„å°å†™å½¢å¼( question å’Œ choice)è¿žæŽ¥è€Œæ¥ï¼ˆå¯è‡ªå®šä¹‰ï¼‰ã€‚ ä¸»é”®(IDs)ä¼šè¢«è‡ªåŠ¨åˆ›å»ºï¼ˆå¯è‡ªå®šä¹‰ï¼‰ã€‚ é»˜è®¤çš„ï¼ŒDjango ä¼šåœ¨å¤–é”®å­—æ®µååŽè¿½åŠ å­—ç¬¦ä¸² â€œ_idâ€ ã€‚ï¼ˆå¯è‡ªå®šä¹‰ï¼‰ å¤–é”®å…³ç³»ç”± FOREIGN KEY ç”Ÿæˆã€‚ ç”Ÿæˆçš„ SQL è¯­å¥æ˜¯ä¸ºä½ æ‰€ç”¨çš„æ•°æ®åº“å®šåˆ¶çš„ï¼Œæ‰€ä»¥é‚£äº›å’Œæ•°æ®åº“æœ‰å…³çš„å­—æ®µç±»åž‹ï¼Œæ¯”å¦‚ auto_increment (MySQL)ã€ serial (PostgreSQL)å’Œ integer primary keyautoincrement (SQLite)ï¼ŒDjango ä¼šå¸®ä½ è‡ªåŠ¨å¤„ç†ã€‚é‚£äº›å’Œå¼•å·ç›¸å…³çš„äº‹æƒ… - ä¾‹å¦‚ï¼Œæ˜¯ä½¿ç”¨å•å¼•å·è¿˜æ˜¯åŒå¼•å· - ä¹Ÿä¸€æ ·ä¼šè¢«è‡ªåŠ¨å¤„ç†ã€‚ è¿™ä¸ª sqlmigrate å‘½ä»¤å¹¶æ²¡æœ‰çœŸæ­£åœ¨ä½ çš„æ•°æ®åº“ä¸­çš„æ‰§è¡Œè¿ç§» - å®ƒåªæ˜¯æŠŠå‘½ä»¤è¾“å‡ºåˆ°å±å¹•ä¸Šï¼Œè®©ä½ çœ‹çœ‹ Django è®¤ä¸ºéœ€è¦æ‰§è¡Œå“ªäº› SQL è¯­å¥ã€‚è¿™åœ¨ä½ æƒ³çœ‹çœ‹ Django åˆ°åº•å‡†å¤‡åšä»€ä¹ˆï¼Œæˆ–è€…å½“ä½ æ˜¯æ•°æ®åº“ç®¡ç†å‘˜ï¼Œéœ€è¦å†™è„šæœ¬æ¥æ‰¹é‡å¤„ç†æ•°æ®åº“æ—¶ä¼šå¾ˆæœ‰ç”¨ã€‚ å¦‚æžœä½ æ„Ÿå…´è¶£ï¼Œä½ ä¹Ÿå¯ä»¥è¯•è¯•è¿è¡Œ python manage.py check ;è¿™ä¸ªå‘½ä»¤å¸®åŠ©ä½ æ£€æŸ¥é¡¹ç›®ä¸­çš„é—®é¢˜ï¼Œå¹¶ä¸”åœ¨æ£€æŸ¥è¿‡ç¨‹ä¸­ä¸ä¼šå¯¹æ•°æ®åº“è¿›è¡Œä»»ä½•æ“ä½œã€‚ çŽ°åœ¨ï¼Œå†æ¬¡è¿è¡Œ migrate å‘½ä»¤ï¼Œåœ¨æ•°æ®åº“é‡Œåˆ›å»ºæ–°å®šä¹‰çš„æ¨¡åž‹çš„æ•°æ®è¡¨ï¼š 1python manage.py migrate 123456789101112131415161718Operations to perform: Apply all migrations: admin, auth, contenttypes, polls, sessionsRunning migrations: Applying contenttypes.0001_initial... OK Applying auth.0001_initial... OK Applying admin.0001_initial... OK Applying admin.0002_logentry_remove_auto_add... OK Applying contenttypes.0002_remove_content_type_name... OK Applying auth.0002_alter_permission_name_max_length... OK Applying auth.0003_alter_user_email_max_length... OK Applying auth.0004_alter_user_username_opts... OK Applying auth.0005_alter_user_last_login_null... OK Applying auth.0006_require_contenttypes_0002... OK Applying auth.0007_alter_validators_add_error_messages... OK Applying auth.0008_alter_user_username_max_length... OK Applying auth.0009_alter_user_last_name_max_length... OK Applying polls.0001_initial... OK Applying sessions.0001_initial... OK å› ä¸ºæ˜¯ä¸€æ¬¡æ‰§è¡Œmigrateå‘½ä»¤ï¼Œæ‰€ä»¥æŠŠè‡ªå¸¦çš„é»˜è®¤åº”ç”¨ä¹Ÿéƒ½è¿ç§»äº†ã€‚ è¿™ä¸ª migrate å‘½ä»¤é€‰ä¸­æ‰€æœ‰è¿˜æ²¡æœ‰æ‰§è¡Œè¿‡çš„è¿ç§»ï¼ˆDjango é€šè¿‡åœ¨æ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„è¡¨ django_migrations æ¥è·Ÿè¸ªæ‰§è¡Œè¿‡å“ªäº›è¿ç§»ï¼‰å¹¶åº”ç”¨åœ¨æ•°æ®åº“ä¸Š - ä¹Ÿå°±æ˜¯å°†ä½ å¯¹æ¨¡åž‹çš„æ›´æ”¹åŒæ­¥åˆ°æ•°æ®åº“ç»“æž„ä¸Šã€‚ è¿ç§»æ˜¯éžå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œå®ƒèƒ½è®©ä½ åœ¨å¼€å‘è¿‡ç¨‹ä¸­æŒç»­çš„æ”¹å˜æ•°æ®åº“ç»“æž„è€Œä¸éœ€è¦é‡æ–°åˆ é™¤å’Œåˆ›å»ºè¡¨ - å®ƒä¸“æ³¨äºŽä½¿æ•°æ®åº“å¹³æ»‘å‡çº§è€Œä¸ä¼šä¸¢å¤±æ•°æ®ã€‚æˆ‘ä»¬ä¼šåœ¨åŽé¢çš„æ•™ç¨‹ä¸­æ›´åŠ æ·±å…¥çš„å­¦ä¹ è¿™éƒ¨åˆ†å†…å®¹ï¼ŒçŽ°åœ¨ï¼Œä½ åªéœ€è¦è®°ä½ï¼Œæ”¹å˜æ¨¡åž‹éœ€è¦è¿™ä¸‰æ­¥ï¼š ç¼–è¾‘ models.py æ–‡ä»¶ï¼Œæ”¹å˜æ¨¡åž‹ã€‚ è¿è¡Œ python manage.py makemigrations ä¸ºæ¨¡åž‹çš„æ”¹å˜ç”Ÿæˆè¿ç§»æ–‡ä»¶ã€‚ è¿è¡Œ python manage.py migrate æ¥åº”ç”¨æ•°æ®åº“è¿ç§»ã€‚ æ•°æ®åº“è¿ç§»è¢«åˆ†è§£æˆç”Ÿæˆå’Œåº”ç”¨ä¸¤ä¸ªå‘½ä»¤æ˜¯ä¸ºäº†è®©ä½ èƒ½å¤Ÿåœ¨ä»£ç æŽ§åˆ¶ç³»ç»Ÿä¸Šæäº¤è¿ç§»æ•°æ®å¹¶ä½¿å…¶èƒ½åœ¨å¤šä¸ªåº”ç”¨é‡Œä½¿ç”¨ï¼›è¿™ä¸ä»…ä»…ä¼šè®©å¼€å‘æ›´åŠ ç®€å•ï¼Œä¹Ÿç»™åˆ«çš„å¼€å‘è€…å’Œç”Ÿäº§çŽ¯å¢ƒä¸­çš„ä½¿ç”¨å¸¦æ¥æ–¹ä¾¿ã€‚]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Django</tag>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Djangoå­¦ä¹ ç¬”è®° - 2 é¡¹ç›®ä¸Žæ¨¡å—]]></title>
    <url>%2F2018%2F06%2F17%2FDjango%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-2-%E9%A1%B9%E7%9B%AE%E4%B8%8E%E6%A8%A1%E5%9D%97%2F</url>
    <content type="text"><![CDATA[é€šè¿‡è¿™ä¸ªæ•™ç¨‹ï¼Œæˆ‘ä»¬å°†å¸¦ç€ä½ åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„æŠ•ç¥¨åº”ç”¨ç¨‹åºã€‚ å®ƒå°†ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š ä¸€ä¸ªè®©äººä»¬æŸ¥çœ‹å’ŒæŠ•ç¥¨çš„å…¬å…±ç«™ç‚¹ã€‚ ä¸€ä¸ªè®©ä½ èƒ½æ·»åŠ ã€ä¿®æ”¹å’Œåˆ é™¤æŠ•ç¥¨çš„ç®¡ç†ç«™ç‚¹ã€‚ 1. é¡¹ç›® 1.1 Djangoåˆ›å»ºé¡¹ç›®çš„ç»“æž„åœ¨ä½¿ç”¨djangoå¼€å§‹åˆ›å»ºå¹¶å¼€å‘é¡¹ç›®ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç®€å•äº†è§£ä¸€ä¸‹Djangoå¯¹äºŽé¡¹ç›®çš„ç®¡ç†ç»“æž„ã€‚ Djangoä¹‹æ‰€ä»¥å¯ä»¥æ–¹ä¾¿å¿«æ·çš„å¼€å‘å¤§åž‹WEBåº”ç”¨ï¼Œæœ€å¤§çš„ç‰¹ç‚¹æ˜¯å®ƒé¢å‘å¯¹è±¡å¼€å‘çš„åŸºç¡€ä¸Šçš„æ¨¡å—åŒ–å¼€å‘ï¼Œå°†é¡¹ç›®ä¸­éœ€è¦çš„å„ä¸ªåŠŸèƒ½å¯ä»¥å°è£…æˆæˆ–å¤§æˆ–å°çš„æ¨¡å—ï¼Œè¿™äº›æ¨¡å—åœ¨é¡¹ç›®ä¸­æ˜¯å¯æ’æ‹”æ—¶çš„ï¼Œéžå¸¸æœ‰åˆ©äºŽé¡¹ç›®çš„æ›´æ–°å’Œæ‰©å±• ã€‚ æ‰€ä»¥ï¼ŒDjangoæ¡†æž¶åœ¨ä½¿ç”¨æ—¶ï¼Œé¦–å…ˆå¸¸è§ä¸€ä¸ªé¡¹ç›®ï¼Œç„¶åŽåœ¨é¡¹ç›®çš„åŸºç¡€ä¸Šï¼Œåˆ›å»ºå„ä¸ªåº”ç”¨çš„æ¨¡å—ï¼Œå°†æ¨¡å—å¼•å…¥åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­è¿›è¡Œä½¿ç”¨ã€‚ 1.2 Djangoåˆ›å»ºé¡¹ç›®é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç¡®è®¤è¦å¼€å‘Djangoé¡¹ç›®çš„æ–‡ä»¶å¤¹ï¼Œå¹¶åˆ‡æ¢åˆ°æ­¤ç›®å½•ä¸‹ 1cd vote_poll\ ç„¶åŽå¯åŠ¨ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ Django é¡¹ç›®ï¼š 1django-admin.exe startproject mysite å‘½ä»¤è¡Œå·¥å…·django-adminä¼šåœ¨å®‰è£…Djangoçš„æ—¶å€™ä¸€èµ·è‡ªåŠ¨å®‰è£…å¥½ã€‚ æ‰§è¡Œäº†ä¸Šé¢çš„å‘½ä»¤ä»¥åŽï¼Œç³»ç»Ÿä¼šä¸ºDjangoé¡¹ç›®ç”ŸæˆåŸºç¡€æ–‡ä»¶å¤¹ç»“æž„ã€‚ çŽ°åœ¨ï¼Œæˆ‘ä»¬çš„vote_pollç›®å½•ç»“æž„å¦‚ä¸‹æ‰€ç¤ºï¼š 123456789vote_poll/ &lt;-- é«˜çº§åˆ«çš„æ–‡ä»¶å¤¹ |-- mysite/ &lt;-- Djangoé¡¹ç›®æ–‡ä»¶å¤¹ | |-- mysite/ &lt;-- æ ¹æ¨¡å— | | |-- __init__.py | | |-- settings.py | | |-- urls.py | | |-- wsgi.py | +-- manage.py +-- vote_poll_venv/ &lt;-- è™šæ‹ŸçŽ¯å¢ƒæ–‡ä»¶å¤¹ è¿™äº›ç›®å½•å’Œæ–‡ä»¶çš„ç”¨å¤„æ˜¯ï¼š æœ€å¤–å±‚çš„:file:vote_poll/ æ ¹ç›®å½•åªæ˜¯ä½ é¡¹ç›®çš„å®¹å™¨ï¼Œ Django ä¸å…³å¿ƒå®ƒçš„åå­—ï¼Œä½ å¯ä»¥å°†å®ƒé‡å‘½åä¸ºä»»ä½•ä½ å–œæ¬¢çš„åå­—ã€‚ manage.py : ä¸€ä¸ªè®©ä½ ç”¨å„ç§æ–¹å¼ç®¡ç† Django é¡¹ç›®çš„å‘½ä»¤è¡Œå·¥å…·ã€‚ é‡Œé¢ä¸€å±‚çš„ mysite/ ç›®å½•åŒ…å«ä½ çš„é¡¹ç›®ï¼Œå®ƒæ˜¯ä¸€ä¸ªçº¯ Python åŒ…ã€‚å®ƒçš„åå­—å°±æ˜¯å½“ä½ å¼•ç”¨å®ƒå†…éƒ¨ä»»ä½•ä¸œè¥¿æ—¶éœ€è¦ç”¨åˆ°çš„ Python åŒ…åã€‚ (æ¯”å¦‚ mysite.urls)ã€‚ __init.pyï¼šä¸€ä¸ªç©ºæ–‡ä»¶ï¼Œè¿™ä¸ªç©ºæ–‡ä»¶å‘Šè¯‰pythonè¿™ä¸ªæ–‡ä»¶å¤¹æ˜¯ä¸€ä¸ªpythonåŒ…ã€‚ settings.pyï¼šè¿™ä¸ªæ–‡ä»¶åŒ…å«äº†æ‰€æœ‰çš„é¡¹ç›®é…ç½®ã€‚ urls.pyï¼šDjango é¡¹ç›®çš„ URL å£°æ˜Žï¼Œå°±åƒä½ ç½‘ç«™çš„â€œç›®å½•â€ã€‚ è¿™ä¸ªæ–‡ä»¶è´Ÿè´£æ˜ å°„æˆ‘ä»¬é¡¹ç›®ä¸­çš„è·¯ç”±å’Œè·¯å¾„ã€‚ wsgi.pyï¼šè¯¥æ–‡ä»¶æ˜¯ç”¨äºŽéƒ¨ç½²çš„ç®€å•ç½‘å…³æŽ¥å£ï¼Œä½œä¸ºä½ çš„é¡¹ç›®çš„è¿è¡Œåœ¨ WSGI å…¼å®¹çš„WebæœåŠ¡å™¨ä¸Šçš„å…¥å£ã€‚ 1.3 è¿è¡ŒåŠè®¿é—®Djangoé¡¹ç›®djangoè‡ªå¸¦äº†ä¸€ä¸ªç®€å•çš„ç½‘ç»œæœåŠ¡å™¨ã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­éžå¸¸æ–¹ä¾¿ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— éœ€å®‰è£…ä»»ä½•å…¶ä»–è½¯ä»¶å³å¯åœ¨æœ¬åœ°è¿è¡Œé¡¹ç›®ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰§è¡Œå‘½ä»¤æ¥æµ‹è¯•ä¸€ä¸‹å®ƒï¼š 1python manage.py runserver æ›´æ¢ç«¯å£ é»˜è®¤æƒ…å†µä¸‹ï¼Œrunserver å‘½ä»¤ä¼šå°†æœåŠ¡å™¨è®¾ç½®ä¸ºç›‘å¬æœ¬æœºå†…éƒ¨ IP çš„ 8000 ç«¯å£ã€‚ å¦‚æžœä½ æƒ³æ›´æ¢æœåŠ¡å™¨çš„ç›‘å¬ç«¯å£ï¼Œè¯·ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹é¢çš„å‘½ä»¤ä¼šä½¿æœåŠ¡å™¨ç›‘å¬ 8080 ç«¯å£ï¼š 12&gt; $ python manage.py runserver 8080&gt; å¦‚æžœä½ æƒ³è¦ä¿®æ”¹æœåŠ¡å™¨ç›‘å¬çš„IPï¼Œåœ¨ç«¯å£ä¹‹å‰è¾“å…¥æ–°çš„ã€‚æ¯”å¦‚ï¼Œä¸ºäº†ç›‘å¬æ‰€æœ‰æœåŠ¡å™¨çš„å…¬å¼€IPï¼ˆè¿™ä½ è¿è¡Œ Vagrant æˆ–æƒ³è¦å‘ç½‘ç»œä¸Šçš„å…¶å®ƒç”µè„‘å±•ç¤ºä½ çš„æˆæžœæ—¶å¾ˆæœ‰ç”¨ï¼‰ï¼Œä½¿ç”¨ï¼š 12&gt; $ python manage.py runserver 0:8000&gt; ä¼šè‡ªåŠ¨é‡æ–°åŠ è½½çš„æœåŠ¡å™¨ runserver ç”¨äºŽå¼€å‘çš„æœåŠ¡å™¨åœ¨éœ€è¦çš„æƒ…å†µä¸‹ä¼šå¯¹æ¯ä¸€æ¬¡çš„è®¿é—®è¯·æ±‚é‡æ–°è½½å…¥ä¸€é Python ä»£ç ã€‚æ‰€ä»¥ä½ ä¸éœ€è¦ä¸ºäº†è®©ä¿®æ”¹çš„ä»£ç ç”Ÿæ•ˆè€Œé¢‘ç¹çš„é‡æ–°å¯åŠ¨æœåŠ¡å™¨ã€‚ç„¶è€Œï¼Œä¸€äº›åŠ¨ä½œï¼Œæ¯”å¦‚æ·»åŠ æ–°æ–‡ä»¶ï¼Œå°†ä¸ä¼šè§¦å‘è‡ªåŠ¨é‡æ–°åŠ è½½ï¼Œè¿™æ—¶ä½ å¾—è‡ªå·±æ‰‹åŠ¨é‡å¯æœåŠ¡å™¨ã€‚ 2. æ¨¡å—åº”ç”¨ 2.1 åˆ›å»ºæ¨¡å—åº”ç”¨çŽ°åœ¨ä½ çš„å¼€å‘çŽ¯å¢ƒâ€”â€”è¿™ä¸ªâ€œé¡¹ç›®â€ â€”â€”å·²ç»é…ç½®å¥½äº†ï¼Œä½ å¯ä»¥å¼€å§‹å¹²æ´»äº†ã€‚ åœ¨ Django ä¸­ï¼Œæ¯ä¸€ä¸ªåº”ç”¨éƒ½æ˜¯ä¸€ä¸ª Python åŒ…ï¼Œå¹¶ä¸”éµå¾ªç€ç›¸åŒçš„çº¦å®šã€‚Django è‡ªå¸¦ä¸€ä¸ªå·¥å…·ï¼Œå¯ä»¥å¸®ä½ ç”Ÿæˆåº”ç”¨çš„åŸºç¡€ç›®å½•ç»“æž„ï¼Œè¿™æ ·ä½ å°±èƒ½ä¸“å¿ƒå†™ä»£ç ï¼Œè€Œä¸æ˜¯åˆ›å»ºç›®å½•äº†ã€‚ é¡¹ç›® VS åº”ç”¨ï¼š é¡¹ç›®å’Œåº”ç”¨æœ‰å•¥åŒºåˆ«ï¼Ÿåº”ç”¨æ˜¯ä¸€ä¸ªä¸“é—¨åšæŸä»¶äº‹çš„ç½‘ç»œåº”ç”¨ç¨‹åºâ€”â€”æ¯”å¦‚åšå®¢ç³»ç»Ÿï¼Œæˆ–è€…å…¬å…±è®°å½•çš„æ•°æ®åº“ï¼Œæˆ–è€…ç®€å•çš„æŠ•ç¥¨ç¨‹åºã€‚é¡¹ç›®åˆ™æ˜¯ä¸€ä¸ªç½‘ç«™ä½¿ç”¨çš„é…ç½®å’Œåº”ç”¨çš„é›†åˆã€‚é¡¹ç›®å¯ä»¥åŒ…å«å¾ˆå¤šä¸ªåº”ç”¨ã€‚åº”ç”¨å¯ä»¥è¢«å¾ˆå¤šä¸ªé¡¹ç›®ä½¿ç”¨ã€‚ ä½ çš„åº”ç”¨å¯ä»¥å­˜æ”¾åœ¨ä»»ä½• Python pathä¸­å®šä¹‰çš„è·¯å¾„ã€‚åœ¨è¿™ä¸ªæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨ä½ çš„ manage.py åŒçº§ç›®å½•ä¸‹åˆ›å»ºæŠ•ç¥¨åº”ç”¨ã€‚è¿™æ ·å®ƒå°±å¯ä»¥ä½œä¸ºé¡¶çº§æ¨¡å—å¯¼å…¥ï¼Œè€Œä¸æ˜¯ mysite çš„å­æ¨¡å—ã€‚ è¯·ç¡®å®šä½ çŽ°åœ¨å¤„äºŽ manage.py æ‰€åœ¨çš„ç›®å½•ä¸‹ï¼Œç„¶åŽè¿è¡Œè¿™è¡Œå‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªåº”ç”¨ï¼š 1python manage.py startapp polls è¿™å°†ä¼šåˆ›å»ºä¸€ä¸ª polls ç›®å½•ï¼Œå®ƒçš„ç›®å½•ç»“æž„å¤§è‡´å¦‚ä¸‹ï¼š 123456789polls/ __init__.py admin.py apps.py migrations/ __init__.py models.py tests.py views.py è¿™ä¸ªç›®å½•ç»“æž„åŒ…æ‹¬äº†æŠ•ç¥¨åº”ç”¨çš„å…¨éƒ¨å†…å®¹ã€‚ 2.2 åˆ›å»ºæ¨¡å—åº”ç”¨çš„ç¬¬ä¸€ä¸ªè§†å›¾æ¨¡å—ä¸­çš„è§†å›¾å¯¹åº”çš„æ˜¯views.pyæ–‡ä»¶ï¼Œæ‰“å¼€polls/views.pyæ–‡ä»¶ï¼Œåˆ›å»ºå¦‚ä¸‹æ–¹æ³•ï¼š 1234567# å¼•å…¥éœ€è¦çš„æ¨¡å—from django.http import HttpResponse# å®šä¹‰ä¸€ä¸ªå¤„ç†æ–¹æ³•def index(request): return HttpResponse("hello, world. you're at the polls index.") è§†å›¾åˆ›å»ºå®ŒæˆåŽï¼Œå¦‚æžœæƒ³çœ‹è§æ•ˆæžœï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªURLæ˜ å°„åˆ°å®ƒï¼Œè¿™å°±æ˜¯æˆ‘ä»¬éœ€è¦URLconfçš„åŽŸå› ã€‚ ä¸ºäº†åˆ›å»ºURLconfgï¼Œåœ¨pollsç›®å½•é‡Œæ–°å»ºä¸€ä¸ªurls.pyæ–‡ä»¶ã€‚ çŽ°åœ¨ä½ çš„åº”ç”¨ç›®å½•çœ‹èµ·æ¥åº”è¯¥æ˜¯ï¼š 12345678910polls/ __init__.py admin.py apps.py migrations/ __init__.py models.py tests.py urls.py views.py åœ¨polls/urls.puä¸­ï¼Œè¾“å…¥å¦‚ä¸‹ä»£ç ï¼š 1234567from django.urls import pathfrom . import viewsurlpatterns = [ path('', views.index, name='index'),] ä¸‹ä¸€æ­¥æ˜¯è¦åœ¨æ ¹URLconfæ–‡ä»¶ä¸­æŒ‡å®šæˆ‘ä»¬åˆ›å»ºçš„polls.urlsæ¨¡å—ï¼Œåœ¨mysite/urls.pyæ–‡ä»¶çš„urlpatternsåˆ—è¡¨é‡Œæ’å…¥ä¸€ä¸ªinclude(),å¦‚ä¸‹ï¼š 12345678from django.contrib import adminfrom django.urls import include, pathurlpatterns = [ path('admin/', admin.site.urls), path('polls/', include('polls.urls'))] å‡½æ•° include()å…è®¸å¼•ç”¨å…¶å®ƒ URLconfsã€‚æ¯å½“ Django é‡åˆ° :funcï¼š~django.urls.include æ—¶ï¼Œå®ƒä¼šæˆªæ–­ä¸Žæ­¤é¡¹åŒ¹é…çš„ URL çš„éƒ¨åˆ†ï¼Œå¹¶å°†å‰©ä½™çš„å­—ç¬¦ä¸²å‘é€åˆ° URLconf ä»¥ä¾›è¿›ä¸€æ­¥å¤„ç†ã€‚ æˆ‘ä»¬è®¾è®¡ include() çš„ç†å¿µæ˜¯ä½¿å…¶å¯ä»¥å³æ’å³ç”¨ã€‚å› ä¸ºæŠ•ç¥¨åº”ç”¨æœ‰å®ƒè‡ªå·±çš„ URLconf( polls/urls.py )ï¼Œä»–ä»¬èƒ½å¤Ÿè¢«æ”¾åœ¨ â€œ/polls/â€œ ï¼Œ â€œ/fun_polls/â€œ ï¼Œâ€/content/polls/â€œï¼Œæˆ–è€…å…¶ä»–ä»»ä½•è·¯å¾„ä¸‹ï¼Œè¿™ä¸ªåº”ç”¨éƒ½èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚ ä½•æ—¶ä½¿ç”¨ include()ï¼š å½“åŒ…æ‹¬å…¶å®ƒ URL æ¨¡å¼æ—¶ä½ åº”è¯¥æ€»æ˜¯ä½¿ç”¨ include() ï¼Œ admin.site.urls æ˜¯å”¯ä¸€ä¾‹å¤–ã€‚ ä½ çŽ°åœ¨æŠŠ index è§†å›¾æ·»åŠ è¿›äº† URLconfã€‚å¯ä»¥éªŒè¯æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤: 1python manage.py runserver ç”¨ä½ çš„æµè§ˆå™¨è®¿é—® http://localhost:8000/polls/ï¼Œä½ åº”è¯¥èƒ½å¤Ÿçœ‹è§ â€œHello, world. Youâ€™re at the polls index.â€œ ï¼Œè¿™æ˜¯ä½ åœ¨ indexè§†å›¾ä¸­å®šä¹‰çš„ã€‚ å‡½æ•° path() å…·æœ‰å››ä¸ªå‚æ•°ï¼Œä¸¤ä¸ªå¿…é¡»å‚æ•°ï¼šroute å’Œ viewï¼Œä¸¤ä¸ªå¯é€‰å‚æ•°ï¼škwargs å’Œ nameã€‚çŽ°åœ¨ï¼Œæ˜¯æ—¶å€™æ¥ç ”ç©¶è¿™äº›å‚æ•°çš„å«ä¹‰äº†ã€‚ path() å‚æ•°ï¼š route route æ˜¯ä¸€ä¸ªåŒ¹é… URL çš„å‡†åˆ™ï¼ˆç±»ä¼¼æ­£åˆ™è¡¨è¾¾å¼ï¼‰ã€‚å½“ Django å“åº”ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå®ƒä¼šä»Ž urlpatterns çš„ç¬¬ä¸€é¡¹å¼€å§‹ï¼ŒæŒ‰é¡ºåºä¾æ¬¡åŒ¹é…åˆ—è¡¨ä¸­çš„é¡¹ï¼Œç›´åˆ°æ‰¾åˆ°åŒ¹é…çš„é¡¹ã€‚ è¿™äº›å‡†åˆ™ä¸ä¼šåŒ¹é… GET å’Œ POST å‚æ•°æˆ–åŸŸåã€‚ä¾‹å¦‚ï¼ŒURLconf åœ¨å¤„ç†è¯·æ±‚ https://www.example.com/myapp/ æ—¶ï¼Œå®ƒä¼šå°è¯•åŒ¹é… myapp/ ã€‚å¤„ç†è¯·æ±‚ https://www.example.com/myapp/?page=3 æ—¶ï¼Œä¹Ÿåªä¼šå°è¯•åŒ¹é… myapp/ã€‚ path() å‚æ•°ï¼š view å½“ Django æ‰¾åˆ°äº†ä¸€ä¸ªåŒ¹é…çš„å‡†åˆ™ï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªç‰¹å®šçš„è§†å›¾å‡½æ•°ï¼Œå¹¶ä¼ å…¥ä¸€ä¸ª HttpRequestå¯¹è±¡ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¢«â€œæ•èŽ·â€çš„å‚æ•°ä»¥å…³é”®å­—å‚æ•°çš„å½¢å¼ä¼ å…¥ã€‚ç¨åŽï¼Œæˆ‘ä»¬ä¼šç»™å‡ºä¸€ä¸ªä¾‹å­ã€‚ path() å‚æ•°ï¼š kwargs ä»»æ„ä¸ªå…³é”®å­—å‚æ•°å¯ä»¥ä½œä¸ºä¸€ä¸ªå­—å…¸ä¼ é€’ç»™ç›®æ ‡è§†å›¾å‡½æ•°ã€‚æœ¬æ•™ç¨‹ä¸­ä¸ä¼šä½¿ç”¨è¿™ä¸€ç‰¹æ€§ã€‚ path() å‚æ•°ï¼š name ä¸ºä½ çš„ URL å–åèƒ½ä½¿ä½ åœ¨ Django çš„ä»»æ„åœ°æ–¹å”¯ä¸€åœ°å¼•ç”¨å®ƒï¼Œå°¤å…¶æ˜¯åœ¨æ¨¡æ¿ä¸­ã€‚è¿™ä¸ªæœ‰ç”¨çš„ç‰¹æ€§å…è®¸ä½ åªæ”¹ä¸€ä¸ªæ–‡ä»¶å°±èƒ½å…¨å±€åœ°ä¿®æ”¹æŸä¸ª URL æ¨¡å¼ã€‚ åœ¨ä¸Šè¿°é…ç½®ä¸­æˆ‘ä»¬é€šè¿‡urlpatternsæ¥å…³è”æ˜ å°„å…³ç³»ï¼Œæ•´ä½“å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ï¼šhttp://localhost:8000/polls é¡¹ç›®æŽ¥æ”¶åˆ°ç”¨æˆ·è¯·æ±‚ï¼Œurlåœ°å€-&gt; polls/ è¿›å…¥é¡¹ç›®çš„æ˜ å°„æ–‡ä»¶urls.pyä¸­è¿›è¡Œæ­£åˆ™åŒ¹é…ï¼šurl(&#39;polls&#39;, include(&#39;polls/urls&#39;))ï¼Œå¼€å§‹æ‰“å¼€é€šè¿‡includeåŒ…å«çš„polls.urlså­æ¨¡å—æ˜ å°„æ–‡ä»¶polls/urls.py è¿›å…¥é¡¹ç›®å­æ¨¡å—pollsçš„æ˜ å°„æ–‡ä»¶ä¸­è¿›è¡ŒåŒ¹é…ï¼Œç”±äºŽpolls/è·¯å¾„å·²ç»åŒ¹é…é€šè¿‡ï¼Œå¼€å§‹åŒ¹é…polls/åŽé¢çš„è·¯å¾„-&gt; è·¯å¾„ä¸ºï¼šâ€™ â€˜ï¼› è¿›å…¥polls/urls.pyä¸­æŸ¥æ‰¾å¯¹åº”çš„è·¯å¾„-&gt;url(&#39;&#39;, view.index, name=&quot;index&quot;) åŒ¹é…åˆ°views.indexï¼Œå¼€å§‹æ‰“å¼€å­æ¨¡å—çš„views.pyè§†å›¾æ–‡ä»¶ï¼Œæ‰§è¡Œindexè§†å›¾æ–¹æ³• views.pyä¸­çš„è§†å›¾æ–¹æ³•index()è¿”å›žäº†ä¸€æ¡å­—ç¬¦ä¸²ï¼Œæ‰“å°åˆ°æˆ‘ä»¬æµè§ˆå™¨çš„é¡µé¢ä¸Š]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Django</tag>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Djangoå­¦ä¹ ç¬”è®° - 1 æ¦‚è¿°ä¸Žå®‰è£…]]></title>
    <url>%2F2018%2F06%2F17%2FDjango%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1-%E6%A6%82%E8%BF%B0%E4%B8%8E%E5%AE%89%E8%A3%85%2F</url>
    <content type="text"><![CDATA[pythonç¨‹åºwebé¡¹ç›®å¼€å‘ï¼Œæ˜¯éžå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†ï¼ŒPythonä¸ºåŸºç¡€çš„webé¡¹ç›®å¼€å‘çš„æ¡†æž¶æœ‰å¾ˆå¤šï¼Œdjangoæ— ç–‘æ˜¯æœ€å¼ºå¤§webæ¡†æž¶ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å¿…é¡»æŽŒæ¡çš„æ¡†æž¶ä¹‹ä¸€ ã€‚ æ¡†æž¶ï¼ˆframeworkï¼‰ï¼Œå°±æ˜¯å·²ç»åŒ…å«äº†é¡¹ç›®ç»“æž„å’Œéƒ¨åˆ†é€šç”¨åŠŸèƒ½çš„è‡ªåŠ¨åŒ–å¤„ç†å·¥å…·ï¼Œä¸»è¦ç”¨äºŽè¿›è¡Œé¡¹ç›®çš„å¿«æ·å’Œé«˜æ•ˆå¼€å‘ Djangoæ˜¯ä¸€ä¸ªç”¨ Python ç¼–å†™çš„ Web æ¡†æž¶ã€‚Web æ¡†æž¶æ˜¯ä¸€ç§è½¯ä»¶ï¼ŒåŸºäºŽwebæ¡†æž¶å¯ä»¥å¼€å‘åŠ¨æ€ç½‘ç«™ï¼Œå„ç§åº”ç”¨ç¨‹åºä»¥åŠæœåŠ¡ã€‚å®ƒæä¾›äº†ä¸€ç³»åˆ—å·¥å…·å’ŒåŠŸèƒ½ï¼Œå¯ä»¥è§£å†³è®¸å¤šä¸ŽWebå¼€å‘ç›¸å…³çš„å¸¸è§é—®é¢˜ï¼Œæ¯”å¦‚ï¼šå®‰å…¨åŠŸèƒ½ï¼Œæ•°æ®åº“è®¿é—®ï¼Œä¼šè¯ï¼Œæ¨¡æ¿å¤„ç†ï¼ŒURLè·¯ç”±ï¼Œå›½é™…åŒ–ï¼Œæœ¬åœ°åŒ–ï¼Œç­‰ç­‰ã€‚ Djangoæ˜¯ç”¨pythonç¼–å†™çš„æœ€æµè¡Œçš„webæ¡†æž¶ä¹‹ä¸€ã€‚å®ƒç»å¯¹æ˜¯æœ€å®Œæ•´çš„ï¼Œæä¾›äº†å„ç§å„æ ·çš„å¼€ç®±å³ç”¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ç”¨äºŽå¼€å‘å’Œæµ‹è¯•çš„ç‹¬ç«‹WebæœåŠ¡å™¨ï¼Œç¼“å­˜ï¼Œä¸­é—´ä»¶ç³»ç»Ÿï¼ŒORMï¼Œæ¨¡æ¿å¼•æ“Žï¼Œè¡¨å•å¤„ç†ï¼ŒåŸºäºŽPythonå•å…ƒæµ‹è¯•çš„å·¥å…·æŽ¥å£ã€‚ Djangoè¿˜è‡ªå¸¦å†…éƒ¨ç”µæ± ï¼Œæä¾›å†…ç½®åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚ä¸€ä¸ªè®¤è¯ç³»ç»Ÿï¼Œä¸€ä¸ªå¯ç”¨äºŽ CRUD(å¢žåˆ æ”¹æŸ¥) æ“ä½œå¹¶ä¸”è‡ªåŠ¨ç”Ÿæˆé¡µé¢çš„åŽå°ç®¡ç†ç•Œé¢ï¼Œç”Ÿæˆè®¢é˜…æ–‡æ¡£ï¼ˆRSS/Atomï¼‰,ç«™ç‚¹åœ°å›¾ç­‰ã€‚ç”šè‡³åœ¨djangoä¸­å†…å»ºäº†ä¸€ä¸ªåœ°ç†ä¿¡æ¯ç³»ç»Ÿï¼ˆGISï¼‰æ¡†æž¶ã€‚ 1. æ ¸å¿ƒç»„ä»¶ Djangoè¢«è®¾è®¡çš„æ ¸å¿ƒç»„ä»¶ä¸»è¦åŒ…å«ï¼š å¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆORMï¼‰ï¼šä»¥pythonç±»çš„å½¢å¼å®šä¹‰æ•°æ®æ¨¡åž‹ï¼Œå’Œæ•°æ®åº“è¡¨å…³è” URLåˆ†é…ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…URLï¼Œå¯ä»¥è®¾è®¡ä»»æ„çš„URLæ²¡æœ‰ç‰¹å®šé™å®šï¼Œéžå¸¸çµæ´» æ¨¡æ¿ç³»ç»Ÿï¼šå¼ºå¤§å¹¶ä¸”å¯æ‰©å±•çš„æ¨¡æ¿é¢„è¨€ï¼Œåˆ†éš”è®¾è®¡ã€å†…å®¹å’Œä»£ç ï¼Œå¹¶ä¸”å¯ä»¥ç»§æ‰¿ è¡¨å•å¤„ç†ï¼šå¯ä»¥æ–¹ä¾¿ç”Ÿæˆå„ç§è¡¨å•æ¨¡åž‹ï¼Œå®žçŽ°è¡¨å•çš„æœ‰æ•ˆæ€§éªŒè¯ è§£å†³å’Œå¤„ç†æ€§èƒ½é—®é¢˜çš„ç¼“å­˜ 2.Djangoèƒ½åšä»€ä¹ˆ Djangoæ˜¯ä¸€ä¸ªpythonè¯­è¨€ä¸ºåŸºç¡€çš„webæ¡†æž¶ Djangoå¯ä»¥å¼€å‘ç½‘ç«™åº”ç”¨ï¼Œå¦‚å…¬å¸é—¨æˆ·ç½‘ç«™ã€å­¦æ ¡å®˜æ–¹ç½‘ç«™ã€æ–°é—»åŠ¨æ€ç½‘ç«™ã€è´­ç‰©ç½‘ç«™ç­‰ç­‰å„ç§æ¶‰åŠå°ã€ä¸­ã€å¤§åž‹çš„ç½‘ç«™ Djangoå¯ä»¥ç”¨äºŽå¼€å‘å„ç§B/Sç»“æž„çš„ç³»ç»Ÿå¹³å°é¡¹ç›®ï¼Œå¦‚å…¬å¸å†…éƒ¨æ•°æ®ç®¡ç†å¹³å°ã€å…¬å¸å·¥ä½œæµç¨‹ç®¡ç†å¹³å°ã€å†…å®¹ç®¡ç†ç³»ç»Ÿå¹³å°ã€OAåŠžå…¬ç³»ç»Ÿå¹³å°ç­‰ç­‰ æ€»ä¹‹ï¼ŒDiangoæ˜¯ç”¨æ¥è¿›è¡ŒB/Sç»“æž„çš„ç½‘ç»œè½¯ä»¶å¼€å‘ C/Sç»“æž„çš„è½¯ä»¶ï¼š ä¸»è¦æ˜¯æŒ‡client-serverè½¯ä»¶ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯æœåŠ¡å™¨è½¯ä»¶ï¼Œè¿™æ ·çš„è½¯ä»¶åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä¸‹è½½è½¯ä»¶çš„å®‰è£…åŒ…ï¼Œå®‰è£…åˆ°æˆ‘ä»¬çš„ä¸ªäººPCä¸Šï¼Œç„¶åŽæ‰“å¼€è”ç½‘ä½¿ç”¨ï¼Œå¦‚QQï¼ŒDOTA2ç­‰ç­‰ B/Sç»“æž„çš„è½¯ä»¶ï¼š ä¸»è¦æ˜¯æŒ‡browser-serverè½¯ä»¶ï¼Œå®¢æˆ·ç«¯åªéœ€è¦ä¸€ä¸ªæµè§ˆå™¨å°±å¯ä»¥ï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—®æœåŠ¡å™¨ä¸Šçš„æ•°æ®ï¼Œæ¥å®Œæˆè½¯ä»¶çš„åŠŸèƒ½ï¼Œå¦‚æ·˜å®ã€äº¬ä¸œç±»ä¼¼çš„ç½‘ç«™å°±æ˜¯B/Sç»“æž„çš„è½¯ä»¶ï¼Œæˆ‘ä»¬åœ¨å®¢æˆ·ç«¯PCä¸Šåªéœ€è¦æ‰“å¼€æµè§ˆå™¨è®¿é—®æŒ‡å®šçš„URLåœ°å€ï¼Œå°±å¯ä»¥è¿›è¡Œè´­ç‰©ç­‰åŠŸèƒ½çš„ä½¿ç”¨äº†ã€‚ 3.å®‰è£… 3.1 å®‰è£…python3.6.5å‚è€ƒæ–‡æ¡£ï¼šCentos 7 ç¼–è¯‘å®‰è£…Python3.6.5çŽ¯å¢ƒ â€‹ windwosçŽ¯å¢ƒä¸‹å®‰è£…Python3.6.5çŽ¯å¢ƒ æˆ‘ä»¬å°†ä½¿ç”¨windowsçŽ¯å¢ƒä¸‹é…åˆIDEæ¥å­¦ä¹ ã€‚ 3.2 å®‰è£…Virtualenv1pip3 install virtualenv åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æ‰§è¡Œçš„å®‰è£…éƒ½æ˜¯åœ¨æ“ä½œç³»ç»ŸçŽ¯å¢ƒä¸‹è¿è¡Œçš„ã€‚ä»ŽçŽ°åœ¨å¼€å§‹ï¼Œæˆ‘ä»¬å®‰è£…çš„æ‰€æœ‰ä¸œè¥¿ï¼ŒåŒ…æ‹¬djangoæœ¬èº«ï¼Œéƒ½å°†å®‰è£…åœ¨è™šæ‹ŸçŽ¯å¢ƒä¸­ã€‚ è¿™æ ·æƒ³ä¸€ä¸‹ï¼šå¯¹äºŽä½ å¼€å§‹çš„æ¯ä¸ªDjangoé¡¹ç›®ï¼Œä½ é¦–å…ˆä¼šä¸ºå®ƒåˆ›å»ºä¸€ä¸ªè™šæ‹ŸçŽ¯å¢ƒã€‚è¿™å°±åƒæ¯ä¸ªDjangoé¡¹ç›®éƒ½æœ‰ä¸€ä¸ªæ²™ç›’ã€‚æ‰€ä»¥ä½ éšæ„è¿è¡Œï¼Œå®‰è£…è½¯ä»¶åŒ…ï¼Œå¸è½½è½¯ä»¶åŒ…è€Œä¸ä¼šç ´åä»»ä½•ä¸œè¥¿ã€‚ å…ˆåˆ›å»ºä¸€ä¸ªvote_pollç›®å½•ï¼š 12mkdir vote_pollcd vote_poll Cmderè½¯ä»¶ï¼š å’Œcmdè¯´æ‹œæ‹œ è¿™ä¸ªæ–‡ä»¶å¤¹æ˜¯çº§åˆ«è¾ƒé«˜çš„ç›®å½•ï¼Œå°†å­˜å‚¨ä¸Žæˆ‘ä»¬çš„Djangoé¡¹ç›®ç›¸å…³çš„æ‰€æœ‰æ–‡ä»¶å’Œä¸œè¥¿ï¼ŒåŒ…æ‹¬å®ƒçš„è™šæ‹ŸçŽ¯å¢ƒã€‚ æ‰€ä»¥è®©æˆ‘ä»¬å¼€å§‹åˆ›å»ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªè™šæ‹ŸçŽ¯å¢ƒå¹¶å®‰è£…djangoã€‚ åœ¨vote_pollæ–‡ä»¶å¤¹ä¸­åˆ›å»ºè™šæ‹ŸçŽ¯å¢ƒå¹¶æ¿€æ´»å®ƒï¼š 12python -m venv vote_poll_venvvote_poll_venv\Scripts\activate.bat å¦‚æžœä½ åœ¨å‘½ä»¤è¡Œå‰é¢çœ‹åˆ° (vote_poll_venv)ï¼Œå°±ä»£è¡¨æ¿€æ´»æˆåŠŸäº†ï¼Œå°±åƒè¿™æ ·ï¼š è®©æˆ‘ä»¬è¯•ç€äº†è§£ä¸€ä¸‹è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆã€‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸ºvenvçš„ç‰¹æ®Šæ–‡ä»¶å¤¹ã€‚è¯¥æ–‡ä»¶å¤¹å†…åŒ…å«äº†ä¸€ä¸ªpythonçš„å‰¯æœ¬ã€‚åœ¨æˆ‘ä»¬æ¿€æ´»äº†venvçŽ¯å¢ƒä¹‹åŽï¼Œå½“æˆ‘ä»¬è¿è¡ŒPythonå‘½ä»¤æ—¶ï¼Œå®ƒå°†ä½¿ç”¨æˆ‘ä»¬å­˜å‚¨åœ¨venvé‡Œé¢çš„æœ¬åœ°å‰¯æœ¬ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬ä¹‹å‰åœ¨æ“ä½œç³»ç»Ÿä¸­å®‰è£…çš„é‚£ä¸ªã€‚ å¦ä¸€ä¸ªé‡è¦çš„äº‹æƒ…æ˜¯ï¼Œpipç¨‹åºä¹Ÿå·²ç»å®‰è£…å¥½äº†ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨å®ƒæ¥å®‰è£…Pythonçš„è½¯ä»¶åŒ…ï¼ˆæ¯”å¦‚Djangoï¼‰æ—¶ï¼Œå®ƒå°†è¢«å®‰è£…åœ¨venvçŽ¯å¢ƒä¸­ã€‚ è¯·æ³¨æ„ï¼Œå½“æˆ‘ä»¬å¯ç”¨venvæ—¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å‘½ä»¤pythonï¼ˆè€Œä¸æ˜¯python3ï¼‰æ¥è°ƒç”¨Python 3.6.2ï¼Œå¹¶ä¸”ä»…ä½¿ç”¨pipï¼ˆè€Œä¸æ˜¯pip3ï¼‰æ¥å®‰è£…è½¯ä»¶åŒ…ã€‚ é¡ºä¾¿è¯´ä¸€å¥ï¼Œè¦æƒ³é€€å‡ºvenvçŽ¯å¢ƒï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š 1deactivate 3.3 å®‰è£…Django 2.0.6åœ¨è™šæ‹ŸçŽ¯å¢ƒä¸­æ‰§è¡Œä¸€ä¸‹å‘½ä»¤æ¥å®‰è£…djangoï¼š 1pip install django 3.4 éªŒè¯è‹¥è¦éªŒè¯ Django æ˜¯å¦èƒ½è¢« Python è¯†åˆ«ï¼Œå¯ä»¥åœ¨ shell ä¸­è¾“å…¥ pythonã€‚ ç„¶åŽåœ¨ Python æç¤ºç¬¦ä¸‹ï¼ˆå¿…é¡»åœ¨è™šæ‹ŸçŽ¯å¢ƒä¸‹ï¼‰ï¼Œå°è¯•å¯¼å…¥ Djangoï¼š 123&gt;&gt;&gt; import django&gt;&gt;&gt; print(django.get_version())2.0.6]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Django</tag>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Centos 7 ç¼–è¯‘å®‰è£…Python3.6.5çŽ¯å¢ƒ]]></title>
    <url>%2F2018%2F06%2F17%2FCentos%207%20%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85Python3.6.5%E7%8E%AF%E5%A2%83%2F</url>
    <content type="text"><![CDATA[ä¸€ï¼šç¼–è¯‘å®‰è£…123456789101112131415161718192021222324252627# å®‰è£…ä¾èµ–åŒ…yum -y install gcc zlib zlib-devel sqlite-devel openssl-devel# ä¸‹è½½wgetå·¥å…·yum -y install wget# ä¸‹è½½æºç åŒ…wget -c https://www.python.org/ftp/python/3.6.5/Python-3.6.5.tgz# è§£åŽ‹æºç åŒ…tar zxf Python-3.6.5.tgz# è¿›å…¥ç›®å½•cd Python-3.6.5# æ·»åŠ é…ç½®./configure \--prefix=/usr/python3.6 \ # æŒ‡å®šå®‰è£…ç›®å½•--with-ssl \ # å¼€å¯sslåè®®--enable-shared # å¯ç”¨æž„å»ºå…±äº«pythonåº“# ç¼–è¯‘å®‰è£…make &amp;&amp; make install# å¤‡ä»½python2.7è½¯è¿žæŽ¥mv /usr/bin/python /usr/bin/python.bak# é…ç½®python3è½¯è¿žæŽ¥ï¼Œè®©ç³»ç»Ÿé»˜è®¤ä½¿ç”¨Python3ln -s /usr/python3.6/bin/python3 /usr/bin/pythonln -s /usr/python3.6/bin/pip3 /usr/bin/pip# yumä½¿ç”¨çš„æ˜¯python2ï¼Œæ›¿æ¢python3ä¹‹åŽå¯¼è‡´æ— æ³•æ­£å¸¸å·¥ä½œï¼Œå› æ­¤éœ€è¦yumç»§ç»­ä½¿ç”¨python2sed -i 's/python/python2/g' /usr/bin/yumsed -i 's/python/python2/g' /usr/libexec/urlgrabber-ext-down# é…ç½®python3çŽ¯å¢ƒå˜é‡sed -i '$a PATH=$PATH:/usr/python/bin/' /etc/profile æ³¨ï¼šå¦‚æžœç³»ç»Ÿæå‰æ²¡æœ‰å®‰è£…openssl-develï¼Œç›´æŽ¥ç¼–è¯‘å®‰è£…äº†python3ï¼Œä½¿ç”¨pipå®‰è£…æ—¶ä¼šå‡ºçŽ°æŠ¥é”™ï¼š pip is configured with locations that require TLS/SSL, however the ssl module in Python is not available. è¿™æ—¶éœ€è¦å®‰è£…openssl-develåŽé‡æ–°é…ç½®Python3å†ç¼–è¯‘å®‰è£…æ‰å¯ä½¿ç”¨pipå®‰è£…ï¼š 1234yum -y install openssl-develcd Python-3.6.5./configure --prefix=/usr/python --with-sslmake &amp;&amp; make install å®‰è£…å¥½python3åŽï¼Œè¿è¡Œå‡ºçŽ°ä¸‹é¢é”™è¯¯ï¼š python3: error while loading shared libraries: libpython3.6m.so.1.0: cannot open shared object file: No such file or directory è§£å†³æ–¹æ¡ˆï¼šè®¾ç½®çŽ¯å¢ƒå˜é‡ï¼š 1export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/python/lib/ æ³¨ï¼šå…¶ä¸­/usr/python/ä¸ºpython3å®‰è£…çš„ç›®å½• äºŒï¼šyumå®‰è£…1234567# å®‰è£…epelæºyum -y install epel-release# å®‰è£…python3.6yum -y install python36 python36-devel# å®‰è£…pipwget --no-check-certificate https://bootstrap.pypa.io/get-pip.pypython get-pip.py]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Pythonå­¦ä¹ ç¬”è®° - pipç”¨æ³•]]></title>
    <url>%2F2018%2F06%2F15%2FPython%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-pip%E7%94%A8%E6%B3%95%2F</url>
    <content type="text"><![CDATA[Pythonå­¦ä¹ ç¬”è®° - pipç”¨æ³•pipæä¾›çš„å­å‘½ä»¤ï¼š å­å‘½ä»¤ è§£é‡Šè¯´æ˜Ž install å®‰è£…è½¯ä»¶åŒ… download ä¸‹è½½è½¯ä»¶åŒ… uninstall å¸è½½è½¯ä»¶åŒ… freeze æŒ‰ç…§requirementsæ ¼å¼è¾“å‡ºå®‰è£…åŒ…ï¼Œå¯ä»¥åˆ°å…¶ä»–æœåŠ¡å™¨ä¸Šæ‰§è¡Œpip install -r requirements.txt ç›´æŽ¥å®‰è£…è½¯ä»¶ list åˆ—å‡ºå½“å‰ç³»ç»Ÿçš„å®‰è£…åŒ… show æŸ¥çœ‹å®‰è£…åŒ…çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬ã€ä¾èµ–ã€è®¸å¯è¯ã€ä½œè€…ã€ä¸»é¡µç­‰ä¿¡æ¯ check æ£€æŸ¥å®‰è£…åŒ…çš„ä¾èµ–æ˜¯å¦å®Œæ•´ config ç®¡ç†æœ¬åœ°æˆ–å…¨å±€é…ç½®æ–‡ä»¶ search æŸ¥æ‰¾å®‰è£…åŒ… wheel æ‰“åŒ…è½¯ä»¶åˆ°whellæ ¼å¼ completion ç”Ÿæˆå‘½ä»¤è¡¥å…¨é…ç½® help èŽ·å–pipå’Œå­å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ ä¸‹é¢ä»¥Flaskä¸ºä¾‹ï¼Œæ¥çœ‹ä¸€ä¸‹pipå‡ ä¸ªå¸¸ç”¨çš„å­å‘½ä»¤ 1234567891011121314151617181920212223242526272829303132333435# æŸ¥æ‰¾å®‰è£…åŒ…ï¼špip search flask# å®‰è£…ç‰¹å®šçš„å®‰è£…åŒ…ç‰ˆæœ¬ï¼špip install flask==0.8# åˆ é™¤å®‰è£…åŒ…pip uninstall flask# æŸ¥çœ‹å®‰è£…åŒ…çš„ä¿¡æ¯ï¼špip show flask# æ£€æŸ¥å®‰è£…åŒ…çš„ä¾èµ–æ˜¯å¦å®Œæ•´ï¼špip check flask# æŸ¥çœ‹å·²å®‰è£…çš„å®‰è£…åŒ…åˆ—è¡¨ï¼špip list# å¯¼å‡ºç³»ç»Ÿå·²å®‰è£…çš„å®‰è£…åŒ…åˆ—è¡¨åˆ°requirementsæ–‡ä»¶pip freeze &gt; requirements.txt# ä»Žrequirementsæ–‡ä»¶å®‰è£…ï¼špip install -r requirements.txt# æŸ¥çœ‹æœ¬åœ°æˆ–å…¨å±€é…ç½®ï¼špip config list# æŸ¥çœ‹ã€ä¿®æ”¹ã€åˆ é™¤æœ¬åœ°æˆ–å…¨å±€é…ç½®ï¼špip config set 'global.index-url' 'https://pypi.douban.com/simple/'pip config get 'global.index-url' pip config unset 'global.index-url'# ä½¿ç”¨pipå‘½ä»¤è¡¥å…¨ï¼špip completion --bash &gt;&gt; ~/.profilesource ~/.profile ä½¿ç”¨è±†ç“£æˆ–é˜¿é‡Œäº‘çš„æºåŠ é€Ÿè½¯ä»¶å®‰è£…123456789101112# é€šè¿‡pipå‘½ä»¤çš„-ié€‰é¡¹æŒ‡å®šé•œåƒæºå³å¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼špip install -i https://pypi.douban.com/simple/ flask# æ¯æ¬¡éƒ½è¦æŒ‡å®šé•œåƒæºçš„åœ°å€æ¯”è¾ƒéº»çƒ¦ï¼Œå¯ä»¥ä¿®æ”¹Pipé…ç½®æ–‡ä»¶ï¼Œå°†é•œåƒæºå†™å…¥é…ç½®æ–‡ä»¶ä¸­ã€‚# è±†ç“£æºï¼Œå¯ä»¥æ¢æˆå…¶ä»–çš„æºpip config set 'global.index-url' 'https://pypi.douban.com/simple/'# æ·»åŠ è±†ç“£æºä¸ºå¯ä¿¡ä¸»æœºï¼Œè¦ä¸ç„¶å¯èƒ½æŠ¥é”™pip config set 'trusted-host' 'pypi.douban.com'# å–æ¶ˆpipç‰ˆæœ¬æ£€æŸ¥ï¼ŒæŽ’é™¤æ¯æ¬¡éƒ½æŠ¥æœ€æ–°çš„pippip config set 'disable-pip-version-check' 'true'# è®¾ç½®è¶…æ—¶æ—¶é—´pip config set 'timeout' '120' æ³¨ï¼špipæºé…ç½®æ–‡ä»¶å¯ä»¥æ”¾ç½®çš„ä½ç½®ï¼š /etc/pip.conf ~/.pip/pip.conf ~/.config/pip/pip.conf(ä½¿ç”¨pip config setå‘½ä»¤æ—¶ä¼šåˆ›å»ºåœ¨æ­¤ç›®å½•ä¸­) å°†è½¯ä»¶ä¸‹è½½åˆ°æœ¬åœ°éƒ¨ç½²12345# ä¸‹è½½åˆ°æœ¬åœ°pip download -d 'pwd' -r requirements.txt # æœ¬åœ°å®‰è£…pip install --no-index -f file://'pwd' -r requirements.txt â€‹ â€‹ â€‹ â€‹ â€‹ â€‹ â€‹]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
</search>
